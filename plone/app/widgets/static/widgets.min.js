var requirejs,require,define;!function(global){function commentReplace(match,multi,multiText,singlePrefix){return singlePrefix||""}function isFunction(it){return"[object Function]"===ostring.call(it)}function isArray(it){return"[object Array]"===ostring.call(it)}function each(ary,func){if(ary){var i;for(i=0;i<ary.length&&(!ary[i]||!func(ary[i],i,ary));i+=1);}}function eachReverse(ary,func){if(ary){var i;for(i=ary.length-1;i>-1&&(!ary[i]||!func(ary[i],i,ary));i-=1);}}function hasProp(obj,prop){return hasOwn.call(obj,prop)}function getOwn(obj,prop){return hasProp(obj,prop)&&obj[prop]}function eachProp(obj,func){var prop;for(prop in obj)if(hasProp(obj,prop)&&func(obj[prop],prop))break}function mixin(target,source,force,deepStringMixin){return source&&eachProp(source,function(value,prop){!force&&hasProp(target,prop)||(!deepStringMixin||"object"!=typeof value||!value||isArray(value)||isFunction(value)||value instanceof RegExp?target[prop]=value:(target[prop]||(target[prop]={}),mixin(target[prop],value,force,deepStringMixin)))}),target}function bind(obj,fn){return function(){return fn.apply(obj,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(err){throw err}function getGlobal(value){if(!value)return value;var g=global;return each(value.split("."),function(part){g=g[part]}),g}function makeError(id,msg,err,requireModules){var e=new Error(msg+"\nhttp://requirejs.org/docs/errors.html#"+id);return e.requireType=id,e.requireModules=requireModules,err&&(e.originalError=err),e}function newContext(contextName){function trimDots(ary){var i,part;for(i=0;i<ary.length;i++)if(part=ary[i],"."===part)ary.splice(i,1),i-=1;else if(".."===part){if(0===i||1===i&&".."===ary[2]||".."===ary[i-1])continue;i>0&&(ary.splice(i-1,2),i-=2)}}function normalize(name,baseName,applyMap){var pkgMain,mapValue,nameParts,i,j,nameSegment,lastIndex,foundMap,foundI,foundStarMap,starI,normalizedBaseParts,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"];if(name&&(name=name.split("/"),lastIndex=name.length-1,config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])&&(name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,"")),"."===name[0].charAt(0)&&baseParts&&(normalizedBaseParts=baseParts.slice(0,baseParts.length-1),name=normalizedBaseParts.concat(name)),trimDots(name),name=name.join("/")),applyMap&&map&&(baseParts||starMap)){nameParts=name.split("/");outerLoop:for(i=nameParts.length;i>0;i-=1){if(nameSegment=nameParts.slice(0,i).join("/"),baseParts)for(j=baseParts.length;j>0;j-=1)if(mapValue=getOwn(map,baseParts.slice(0,j).join("/")),mapValue&&(mapValue=getOwn(mapValue,nameSegment))){foundMap=mapValue,foundI=i;break outerLoop}!foundStarMap&&starMap&&getOwn(starMap,nameSegment)&&(foundStarMap=getOwn(starMap,nameSegment),starI=i)}!foundMap&&foundStarMap&&(foundMap=foundStarMap,foundI=starI),foundMap&&(nameParts.splice(0,foundI,foundMap),name=nameParts.join("/"))}return pkgMain=getOwn(config.pkgs,name),pkgMain?pkgMain:name}function removeScript(name){isBrowser&&each(scripts(),function(scriptNode){if(scriptNode.getAttribute("data-requiremodule")===name&&scriptNode.getAttribute("data-requirecontext")===context.contextName)return scriptNode.parentNode.removeChild(scriptNode),!0})}function hasPathFallback(id){var pathConfig=getOwn(config.paths,id);if(pathConfig&&isArray(pathConfig)&&pathConfig.length>1)return pathConfig.shift(),context.require.undef(id),context.makeRequire(null,{skipMap:!0})([id]),!0}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;return index>-1&&(prefix=name.substring(0,index),name=name.substring(index+1,name.length)),[prefix,name]}function makeModuleMap(name,parentModuleMap,isNormalized,applyMap){var url,pluginModule,suffix,nameParts,prefix=null,parentName=parentModuleMap?parentModuleMap.name:null,originalName=name,isDefine=!0,normalizedName="";return name||(isDefine=!1,name="_@r"+(requireCounter+=1)),nameParts=splitPrefix(name),prefix=nameParts[0],name=nameParts[1],prefix&&(prefix=normalize(prefix,parentName,applyMap),pluginModule=getOwn(defined,prefix)),name&&(prefix?normalizedName=pluginModule&&pluginModule.normalize?pluginModule.normalize(name,function(name){return normalize(name,parentName,applyMap)}):name.indexOf("!")===-1?normalize(name,parentName,applyMap):name:(normalizedName=normalize(name,parentName,applyMap),nameParts=splitPrefix(normalizedName),prefix=nameParts[0],normalizedName=nameParts[1],isNormalized=!0,url=context.nameToUrl(normalizedName))),suffix=!prefix||pluginModule||isNormalized?"":"_unnormalized"+(unnormalizedCounter+=1),{prefix:prefix,name:normalizedName,parentMap:parentModuleMap,unnormalized:!!suffix,url:url,originalName:originalName,isDefine:isDefine,id:(prefix?prefix+"!"+normalizedName:normalizedName)+suffix}}function getModule(depMap){var id=depMap.id,mod=getOwn(registry,id);return mod||(mod=registry[id]=new context.Module(depMap)),mod}function on(depMap,name,fn){var id=depMap.id,mod=getOwn(registry,id);!hasProp(defined,id)||mod&&!mod.defineEmitComplete?(mod=getModule(depMap),mod.error&&"error"===name?fn(mod.error):mod.on(name,fn)):"defined"===name&&fn(defined[id])}function onError(err,errback){var ids=err.requireModules,notified=!1;errback?errback(err):(each(ids,function(id){var mod=getOwn(registry,id);mod&&(mod.error=err,mod.events.error&&(notified=!0,mod.emit("error",err)))}),notified||req.onError(err))}function takeGlobalQueue(){globalDefQueue.length&&(each(globalDefQueue,function(queueItem){var id=queueItem[0];"string"==typeof id&&(context.defQueueMap[id]=!0),defQueue.push(queueItem)}),globalDefQueue=[])}function cleanRegistry(id){delete registry[id],delete enabledRegistry[id]}function breakCycle(mod,traced,processed){var id=mod.map.id;mod.error?mod.emit("error",mod.error):(traced[id]=!0,each(mod.depMaps,function(depMap,i){var depId=depMap.id,dep=getOwn(registry,depId);!dep||mod.depMatched[i]||processed[depId]||(getOwn(traced,depId)?(mod.defineDep(i,defined[depId]),mod.check()):breakCycle(dep,traced,processed))}),processed[id]=!0)}function checkLoaded(){var err,usingPathFallback,waitInterval=1e3*config.waitSeconds,expired=waitInterval&&context.startTime+waitInterval<(new Date).getTime(),noLoads=[],reqCalls=[],stillLoading=!1,needCycleCheck=!0;if(!inCheckLoaded){if(inCheckLoaded=!0,eachProp(enabledRegistry,function(mod){var map=mod.map,modId=map.id;if(mod.enabled&&(map.isDefine||reqCalls.push(mod),!mod.error))if(!mod.inited&&expired)hasPathFallback(modId)?(usingPathFallback=!0,stillLoading=!0):(noLoads.push(modId),removeScript(modId));else if(!mod.inited&&mod.fetched&&map.isDefine&&(stillLoading=!0,!map.prefix))return needCycleCheck=!1}),expired&&noLoads.length)return err=makeError("timeout","Load timeout for modules: "+noLoads,null,noLoads),err.contextName=context.contextName,onError(err);needCycleCheck&&each(reqCalls,function(mod){breakCycle(mod,{},{})}),expired&&!usingPathFallback||!stillLoading||!isBrowser&&!isWebWorker||checkLoadedTimeoutId||(checkLoadedTimeoutId=setTimeout(function(){checkLoadedTimeoutId=0,checkLoaded()},50)),inCheckLoaded=!1}}function callGetModule(args){hasProp(defined,args[0])||getModule(makeModuleMap(args[0],null,!0)).init(args[1],args[2])}function removeListener(node,func,name,ieName){node.detachEvent&&!isOpera?ieName&&node.detachEvent(ieName,func):node.removeEventListener(name,func,!1)}function getScriptData(evt){var node=evt.currentTarget||evt.srcElement;return removeListener(node,context.onScriptLoad,"load","onreadystatechange"),removeListener(node,context.onScriptError,"error"),{node:node,id:node&&node.getAttribute("data-requiremodule")}}function intakeDefines(){var args;for(takeGlobalQueue();defQueue.length;){if(args=defQueue.shift(),null===args[0])return onError(makeError("mismatch","Mismatched anonymous define() module: "+args[args.length-1]));callGetModule(args)}context.defQueueMap={}}var inCheckLoaded,Module,context,handlers,checkLoadedTimeoutId,config={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},registry={},enabledRegistry={},undefEvents={},defQueue=[],defined={},urlFetched={},bundlesMap={},requireCounter=1,unnormalizedCounter=1;return handlers={require:function(mod){return mod.require?mod.require:mod.require=context.makeRequire(mod.map)},exports:function(mod){if(mod.usingExports=!0,mod.map.isDefine)return mod.exports?defined[mod.map.id]=mod.exports:mod.exports=defined[mod.map.id]={}},module:function(mod){return mod.module?mod.module:mod.module={id:mod.map.id,uri:mod.map.url,config:function(){return getOwn(config.config,mod.map.id)||{}},exports:mod.exports||(mod.exports={})}}},Module=function(map){this.events=getOwn(undefEvents,map.id)||{},this.map=map,this.shim=getOwn(config.shim,map.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},Module.prototype={init:function(depMaps,factory,errback,options){options=options||{},this.inited||(this.factory=factory,errback?this.on("error",errback):this.events.error&&(errback=bind(this,function(err){this.emit("error",err)})),this.depMaps=depMaps&&depMaps.slice(0),this.errback=errback,this.inited=!0,this.ignore=options.ignore,options.enabled||this.enabled?this.enable():this.check())},defineDep:function(i,depExports){this.depMatched[i]||(this.depMatched[i]=!0,this.depCount-=1,this.depExports[i]=depExports)},fetch:function(){if(!this.fetched){this.fetched=!0,context.startTime=(new Date).getTime();var map=this.map;return this.shim?void context.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return map.prefix?this.callPlugin():this.load()})):map.prefix?this.callPlugin():this.load()}},load:function(){var url=this.map.url;urlFetched[url]||(urlFetched[url]=!0,context.load(this.map.id,url))},check:function(){if(this.enabled&&!this.enabling){var err,cjsModule,id=this.map.id,depExports=this.depExports,exports=this.exports,factory=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(factory)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{exports=context.execCb(id,factory,depExports,exports)}catch(e){err=e}else exports=context.execCb(id,factory,depExports,exports);if(this.map.isDefine&&void 0===exports&&(cjsModule=this.module,cjsModule?exports=cjsModule.exports:this.usingExports&&(exports=this.exports)),err)return err.requireMap=this.map,err.requireModules=this.map.isDefine?[this.map.id]:null,err.requireType=this.map.isDefine?"define":"require",onError(this.error=err)}else exports=factory;if(this.exports=exports,this.map.isDefine&&!this.ignore&&(defined[id]=exports,req.onResourceLoad)){var resLoadMaps=[];each(this.depMaps,function(depMap){resLoadMaps.push(depMap.normalizedMap||depMap)}),req.onResourceLoad(context,this.map,resLoadMaps)}cleanRegistry(id),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(context.defQueueMap,id)||this.fetch()}},callPlugin:function(){var map=this.map,id=map.id,pluginMap=makeModuleMap(map.prefix);this.depMaps.push(pluginMap),on(pluginMap,"defined",bind(this,function(plugin){var load,normalizedMap,normalizedMod,bundleId=getOwn(bundlesMap,this.map.id),name=this.map.name,parentName=this.map.parentMap?this.map.parentMap.name:null,localRequire=context.makeRequire(map.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(plugin.normalize&&(name=plugin.normalize(name,function(name){return normalize(name,parentName,!0)})||""),normalizedMap=makeModuleMap(map.prefix+"!"+name,this.map.parentMap),on(normalizedMap,"defined",bind(this,function(value){this.map.normalizedMap=normalizedMap,this.init([],function(){return value},null,{enabled:!0,ignore:!0})})),normalizedMod=getOwn(registry,normalizedMap.id),void(normalizedMod&&(this.depMaps.push(normalizedMap),this.events.error&&normalizedMod.on("error",bind(this,function(err){this.emit("error",err)})),normalizedMod.enable()))):bundleId?(this.map.url=context.nameToUrl(bundleId),void this.load()):(load=bind(this,function(value){this.init([],function(){return value},null,{enabled:!0})}),load.error=bind(this,function(err){this.inited=!0,this.error=err,err.requireModules=[id],eachProp(registry,function(mod){0===mod.map.id.indexOf(id+"_unnormalized")&&cleanRegistry(mod.map.id)}),onError(err)}),load.fromText=bind(this,function(text,textAlt){var moduleName=map.name,moduleMap=makeModuleMap(moduleName),hasInteractive=useInteractive;textAlt&&(text=textAlt),hasInteractive&&(useInteractive=!1),getModule(moduleMap),hasProp(config.config,id)&&(config.config[moduleName]=config.config[id]);try{req.exec(text)}catch(e){return onError(makeError("fromtexteval","fromText eval for "+id+" failed: "+e,e,[id]))}hasInteractive&&(useInteractive=!0),this.depMaps.push(moduleMap),context.completeLoad(moduleName),localRequire([moduleName],load)}),void plugin.load(map.name,localRequire,load,config))})),context.enable(pluginMap,this),this.pluginMaps[pluginMap.id]=pluginMap},enable:function(){enabledRegistry[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(depMap,i){var id,mod,handler;if("string"==typeof depMap){if(depMap=makeModuleMap(depMap,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[i]=depMap,handler=getOwn(handlers,depMap.id))return void(this.depExports[i]=handler(this));this.depCount+=1,on(depMap,"defined",bind(this,function(depExports){this.undefed||(this.defineDep(i,depExports),this.check())})),this.errback?on(depMap,"error",bind(this,this.errback)):this.events.error&&on(depMap,"error",bind(this,function(err){this.emit("error",err)}))}id=depMap.id,mod=registry[id],hasProp(handlers,id)||!mod||mod.enabled||context.enable(depMap,this)})),eachProp(this.pluginMaps,bind(this,function(pluginMap){var mod=getOwn(registry,pluginMap.id);mod&&!mod.enabled&&context.enable(pluginMap,this)})),this.enabling=!1,this.check()},on:function(name,cb){var cbs=this.events[name];cbs||(cbs=this.events[name]=[]),cbs.push(cb)},emit:function(name,evt){each(this.events[name],function(cb){cb(evt)}),"error"===name&&delete this.events[name]}},context={config:config,contextName:contextName,registry:registry,defined:defined,urlFetched:urlFetched,defQueue:defQueue,defQueueMap:{},Module:Module,makeModuleMap:makeModuleMap,nextTick:req.nextTick,onError:onError,configure:function(cfg){if(cfg.baseUrl&&"/"!==cfg.baseUrl.charAt(cfg.baseUrl.length-1)&&(cfg.baseUrl+="/"),"string"==typeof cfg.urlArgs){var urlArgs=cfg.urlArgs;cfg.urlArgs=function(id,url){return(url.indexOf("?")===-1?"?":"&")+urlArgs}}var shim=config.shim,objs={paths:!0,bundles:!0,config:!0,map:!0};eachProp(cfg,function(value,prop){objs[prop]?(config[prop]||(config[prop]={}),mixin(config[prop],value,!0,!0)):config[prop]=value}),cfg.bundles&&eachProp(cfg.bundles,function(value,prop){each(value,function(v){v!==prop&&(bundlesMap[v]=prop)})}),cfg.shim&&(eachProp(cfg.shim,function(value,id){isArray(value)&&(value={deps:value}),!value.exports&&!value.init||value.exportsFn||(value.exportsFn=context.makeShimExports(value)),shim[id]=value}),config.shim=shim),cfg.packages&&each(cfg.packages,function(pkgObj){var location,name;pkgObj="string"==typeof pkgObj?{name:pkgObj}:pkgObj,name=pkgObj.name,location=pkgObj.location,location&&(config.paths[name]=pkgObj.location),config.pkgs[name]=pkgObj.name+"/"+(pkgObj.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(registry,function(mod,id){mod.inited||mod.map.unnormalized||(mod.map=makeModuleMap(id,null,!0))}),(cfg.deps||cfg.callback)&&context.require(cfg.deps||[],cfg.callback)},makeShimExports:function(value){function fn(){var ret;return value.init&&(ret=value.init.apply(global,arguments)),ret||value.exports&&getGlobal(value.exports)}return fn},makeRequire:function(relMap,options){function localRequire(deps,callback,errback){var id,map,requireMod;return options.enableBuildCallback&&callback&&isFunction(callback)&&(callback.__requireJsBuild=!0),"string"==typeof deps?isFunction(callback)?onError(makeError("requireargs","Invalid require call"),errback):relMap&&hasProp(handlers,deps)?handlers[deps](registry[relMap.id]):req.get?req.get(context,deps,relMap,localRequire):(map=makeModuleMap(deps,relMap,!1,!0),id=map.id,hasProp(defined,id)?defined[id]:onError(makeError("notloaded",'Module name "'+id+'" has not been loaded yet for context: '+contextName+(relMap?"":". Use require([])")))):(intakeDefines(),context.nextTick(function(){intakeDefines(),requireMod=getModule(makeModuleMap(null,relMap)),requireMod.skipMap=options.skipMap,requireMod.init(deps,callback,errback,{enabled:!0}),checkLoaded()}),localRequire)}return options=options||{},mixin(localRequire,{isBrowser:isBrowser,toUrl:function(moduleNamePlusExt){var ext,index=moduleNamePlusExt.lastIndexOf("."),segment=moduleNamePlusExt.split("/")[0],isRelative="."===segment||".."===segment;return index!==-1&&(!isRelative||index>1)&&(ext=moduleNamePlusExt.substring(index,moduleNamePlusExt.length),moduleNamePlusExt=moduleNamePlusExt.substring(0,index)),context.nameToUrl(normalize(moduleNamePlusExt,relMap&&relMap.id,!0),ext,!0)},defined:function(id){return hasProp(defined,makeModuleMap(id,relMap,!1,!0).id)},specified:function(id){return id=makeModuleMap(id,relMap,!1,!0).id,hasProp(defined,id)||hasProp(registry,id)}}),relMap||(localRequire.undef=function(id){takeGlobalQueue();var map=makeModuleMap(id,relMap,!0),mod=getOwn(registry,id);mod.undefed=!0,removeScript(id),delete defined[id],delete urlFetched[map.url],delete undefEvents[id],eachReverse(defQueue,function(args,i){args[0]===id&&defQueue.splice(i,1)}),delete context.defQueueMap[id],mod&&(mod.events.defined&&(undefEvents[id]=mod.events),cleanRegistry(id))}),localRequire},enable:function(depMap){var mod=getOwn(registry,depMap.id);mod&&getModule(depMap).enable()},completeLoad:function(moduleName){var found,args,mod,shim=getOwn(config.shim,moduleName)||{},shExports=shim.exports;for(takeGlobalQueue();defQueue.length;){if(args=defQueue.shift(),null===args[0]){if(args[0]=moduleName,found)break;found=!0}else args[0]===moduleName&&(found=!0);callGetModule(args)}if(context.defQueueMap={},mod=getOwn(registry,moduleName),!found&&!hasProp(defined,moduleName)&&mod&&!mod.inited){if(!(!config.enforceDefine||shExports&&getGlobal(shExports)))return hasPathFallback(moduleName)?void 0:onError(makeError("nodefine","No define call for "+moduleName,null,[moduleName]));callGetModule([moduleName,shim.deps||[],shim.exportsFn])}checkLoaded()},nameToUrl:function(moduleName,ext,skipExt){var paths,syms,i,parentModule,url,parentPath,bundleId,pkgMain=getOwn(config.pkgs,moduleName);if(pkgMain&&(moduleName=pkgMain),bundleId=getOwn(bundlesMap,moduleName))return context.nameToUrl(bundleId,ext,skipExt);if(req.jsExtRegExp.test(moduleName))url=moduleName+(ext||"");else{for(paths=config.paths,syms=moduleName.split("/"),i=syms.length;i>0;i-=1)if(parentModule=syms.slice(0,i).join("/"),parentPath=getOwn(paths,parentModule)){isArray(parentPath)&&(parentPath=parentPath[0]),syms.splice(0,i,parentPath);break}url=syms.join("/"),url+=ext||(/^data\:|^blob\:|\?/.test(url)||skipExt?"":".js"),url=("/"===url.charAt(0)||url.match(/^[\w\+\.\-]+:/)?"":config.baseUrl)+url}return config.urlArgs&&!/^blob\:/.test(url)?url+config.urlArgs(moduleName,url):url},load:function(id,url){req.load(context,id,url)},execCb:function(name,callback,args,exports){return callback.apply(exports,args)},onScriptLoad:function(evt){if("load"===evt.type||readyRegExp.test((evt.currentTarget||evt.srcElement).readyState)){interactiveScript=null;var data=getScriptData(evt);context.completeLoad(data.id)}},onScriptError:function(evt){var data=getScriptData(evt);if(!hasPathFallback(data.id)){var parents=[];return eachProp(registry,function(value,key){0!==key.indexOf("_@r")&&each(value.depMaps,function(depMap){if(depMap.id===data.id)return parents.push(key),!0})}),onError(makeError("scripterror",'Script error for "'+data.id+(parents.length?'", needed by: '+parents.join(", "):'"'),evt,[data.id]))}}},context.require=context.makeRequire(),context}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(script){if("interactive"===script.readyState)return interactiveScript=script}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.2.0",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(deps,callback,errback,optional){var context,config,contextName=defContextName;return isArray(deps)||"string"==typeof deps||(config=deps,isArray(callback)?(deps=callback,callback=errback,errback=optional):deps=[]),config&&config.context&&(contextName=config.context),context=getOwn(contexts,contextName),context||(context=contexts[contextName]=req.s.newContext(contextName)),config&&context.configure(config),context.require(deps,callback,errback)},req.config=function(config){return req(config)},req.nextTick="undefined"!=typeof setTimeout?function(fn){setTimeout(fn,4)}:function(fn){fn()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(prop){req[prop]=function(){var ctx=contexts[defContextName];return ctx.require[prop].apply(ctx,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(config,moduleName,url){var node=config.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return node.type=config.scriptType||"text/javascript",node.charset="utf-8",node.async=!0,node},req.load=function(context,moduleName,url){var node,config=context&&context.config||{};if(isBrowser)return node=req.createNode(config,moduleName,url),node.setAttribute("data-requirecontext",context.contextName),node.setAttribute("data-requiremodule",moduleName),!node.attachEvent||node.attachEvent.toString&&node.attachEvent.toString().indexOf("[native code")<0||isOpera?(node.addEventListener("load",context.onScriptLoad,!1),node.addEventListener("error",context.onScriptError,!1)):(useInteractive=!0,node.attachEvent("onreadystatechange",context.onScriptLoad)),node.src=url,config.onNodeCreated&&config.onNodeCreated(node,config,moduleName,url),currentlyAddingScript=node,baseElement?head.insertBefore(node,baseElement):head.appendChild(node),currentlyAddingScript=null,node;if(isWebWorker)try{setTimeout(function(){},0),importScripts(url),context.completeLoad(moduleName)}catch(e){context.onError(makeError("importscripts","importScripts failed for "+moduleName+" at "+url,e,[moduleName]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(script){if(head||(head=script.parentNode),dataMain=script.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||mainScript.indexOf("!")!==-1||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(name,deps,callback){var node,context;"string"!=typeof name&&(callback=deps,deps=name,name=null),isArray(deps)||(callback=deps,deps=null),!deps&&isFunction(callback)&&(deps=[],callback.length&&(callback.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(match,dep){deps.push(dep)}),deps=(1===callback.length?["require"]:["require","exports","module"]).concat(deps))),useInteractive&&(node=currentlyAddingScript||getInteractiveScript(),node&&(name||(name=node.getAttribute("data-requiremodule")),context=contexts[node.getAttribute("data-requirecontext")])),context?(context.defQueue.push([name,deps,callback]),context.defQueueMap[name]=!0):globalDefQueue.push([name,deps,callback])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("node_modules/requirejs/require.js",function(){}),function(global,factory){"object"==typeof module&&"object"==typeof module.exports?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){function isArraylike(obj){var length="length"in obj&&obj.length,type=jQuery.type(obj);return"function"!==type&&!jQuery.isWindow(obj)&&(!(1!==obj.nodeType||!length)||("array"===type||0===length||"number"==typeof length&&length>0&&length-1 in obj))}function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not});if(qualifier.nodeType)return jQuery.grep(elements,function(elem){return elem===qualifier!==not});if("string"==typeof qualifier){if(risSimple.test(qualifier))return jQuery.filter(qualifier,elements,not);qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return jQuery.inArray(elem,qualifier)>=0!==not})}function sibling(cur,dir){do cur=cur[dir];while(cur&&1!==cur.nodeType);return cur}function createOptions(options){var object=optionsCache[options]={};return jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=!0}),object}function detach(){document.addEventListener?(document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1)):(document.detachEvent("onreadystatechange",completed),window.detachEvent("onload",completed))}function completed(){(document.addEventListener||"load"===event.type||"complete"===document.readyState)&&(detach(),jQuery.ready())}function dataAttr(elem,key,data){if(void 0===data&&1===elem.nodeType){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();if(data=elem.getAttribute(name),"string"==typeof data){try{data="true"===data||"false"!==data&&("null"===data?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data)}catch(e){}jQuery.data(elem,key,data)}else data=void 0}return data}function isEmptyDataObject(obj){var name;for(name in obj)if(("data"!==name||!jQuery.isEmptyObject(obj[name]))&&"toJSON"!==name)return!1;return!0}function internalData(elem,name,data,pvt){if(jQuery.acceptData(elem)){var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if(id&&cache[id]&&(pvt||cache[id].data)||void 0!==data||"string"!=typeof name)return id||(id=isNode?elem[internalKey]=deletedIds.pop()||jQuery.guid++:internalKey),cache[id]||(cache[id]=isNode?{}:{toJSON:jQuery.noop}),"object"!=typeof name&&"function"!=typeof name||(pvt?cache[id]=jQuery.extend(cache[id],name):cache[id].data=jQuery.extend(cache[id].data,name)),thisCache=cache[id],pvt||(thisCache.data||(thisCache.data={}),thisCache=thisCache.data),void 0!==data&&(thisCache[jQuery.camelCase(name)]=data),"string"==typeof name?(ret=thisCache[name],null==ret&&(ret=thisCache[jQuery.camelCase(name)])):ret=thisCache,ret}}function internalRemoveData(elem,name,pvt){if(jQuery.acceptData(elem)){var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(cache[id]){if(name&&(thisCache=pvt?cache[id]:cache[id].data)){jQuery.isArray(name)?name=name.concat(jQuery.map(name,jQuery.camelCase)):name in thisCache?name=[name]:(name=jQuery.camelCase(name),name=name in thisCache?[name]:name.split(" ")),i=name.length;for(;i--;)delete thisCache[name[i]];if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache))return}(pvt||(delete cache[id].data,isEmptyDataObject(cache[id])))&&(isNode?jQuery.cleanData([elem],!0):support.deleteExpando||cache!=cache.window?delete cache[id]:cache[id]=null)}}}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement)for(;list.length;)safeFrag.createElement(list.pop());return safeFrag}function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!==strundefined?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!==strundefined?context.querySelectorAll(tag||"*"):void 0;if(!found)for(found=[],elems=context.childNodes||context;null!=(elem=elems[i]);i++)!tag||jQuery.nodeName(elem,tag)?found.push(elem):jQuery.merge(found,getAll(elem,tag));return void 0===tag||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found}function fixDefaultChecked(elem){rcheckableType.test(elem.type)&&(elem.defaultChecked=elem.checked)}function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(11!==content.nodeType?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){return elem.type=(null!==jQuery.find.attr(elem,"type"))+"/"+elem.type,elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);return match?elem.type=match[1]:elem.removeAttribute("type"),elem}function setGlobalEval(elems,refElements){for(var elem,i=0;null!=(elem=elems[i]);i++)jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"))}function cloneCopyEvent(src,dest){if(1===dest.nodeType&&jQuery.hasData(src)){var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle,curData.events={};for(type in events)for(i=0,l=events[type].length;i<l;i++)jQuery.event.add(dest,type,events[type][i])}curData.data&&(curData.data=jQuery.extend({},curData.data))}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(1===dest.nodeType){if(nodeName=dest.nodeName.toLowerCase(),!support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events)jQuery.removeEvent(dest,e,data.handle);dest.removeAttribute(jQuery.expando)}"script"===nodeName&&dest.text!==src.text?(disableScript(dest).text=src.text,restoreScript(dest)):"object"===nodeName?(dest.parentNode&&(dest.outerHTML=src.outerHTML),support.html5Clone&&src.innerHTML&&!jQuery.trim(dest.innerHTML)&&(dest.innerHTML=src.innerHTML)):"input"===nodeName&&rcheckableType.test(src.type)?(dest.defaultChecked=dest.checked=src.checked,dest.value!==src.value&&(dest.value=src.value)):"option"===nodeName?dest.defaultSelected=dest.selected=src.defaultSelected:"input"!==nodeName&&"textarea"!==nodeName||(dest.defaultValue=src.defaultValue)}}function actualDisplay(name,doc){var style,elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle&&(style=window.getDefaultComputedStyle(elem[0]))?style.display:jQuery.css(elem[0],"display");return elem.detach(),display}function defaultDisplay(nodeName){
var doc=document,display=elemdisplay[nodeName];return display||(display=actualDisplay(nodeName,doc),"none"!==display&&display||(iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement),doc=(iframe[0].contentWindow||iframe[0].contentDocument).document,doc.write(),doc.close(),display=actualDisplay(nodeName,doc),iframe.detach()),elemdisplay[nodeName]=display),display}function addGetHookIf(conditionFn,hookFn){return{get:function(){var condition=conditionFn();if(null!=condition)return condition?void delete this.get:(this.get=hookFn).apply(this,arguments)}}}function vendorPropName(style,name){if(name in style)return name;for(var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;i--;)if(name=cssPrefixes[i]+capName,name in style)return name;return origName}function showHide(elements,show){for(var display,elem,hidden,values=[],index=0,length=elements.length;index<length;index++)elem=elements[index],elem.style&&(values[index]=jQuery._data(elem,"olddisplay"),display=elem.style.display,show?(values[index]||"none"!==display||(elem.style.display=""),""===elem.style.display&&isHidden(elem)&&(values[index]=jQuery._data(elem,"olddisplay",defaultDisplay(elem.nodeName)))):(hidden=isHidden(elem),(display&&"none"!==display||!hidden)&&jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))));for(index=0;index<length;index++)elem=elements[index],elem.style&&(show&&"none"!==elem.style.display&&""!==elem.style.display||(elem.style.display=show?values[index]||"":"none"));return elements}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){for(var i=extra===(isBorderBox?"border":"content")?4:"width"===name?1:0,val=0;i<4;i+=2)"margin"===extra&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles)),isBorderBox?("content"===extra&&(val-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==extra&&(val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(val+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==extra&&(val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles)));return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=!0,val="width"===name?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles);if(val<=0||null==val){if(val=curCSS(elem,name,styles),(val<0||null==val)&&(val=elem.style[name]),rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]),val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}function createFxNow(){return setTimeout(function(){fxNow=void 0}),fxNow=jQuery.now()}function genFx(type,includeWidth){var which,attrs={height:type},i=0;for(includeWidth=includeWidth?1:0;i<4;i+=2-includeWidth)which=cssExpand[i],attrs["margin"+which]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;index<length;index++)if(tween=collection[index].call(animation,prop,value))return tween}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");opts.queue||(hooks=jQuery._queueHooks(elem,"fx"),null==hooks.unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),1===elem.nodeType&&("height"in props||"width"in props)&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],display=jQuery.css(elem,"display"),checkDisplay="none"===display?jQuery._data(elem,"olddisplay")||defaultDisplay(elem.nodeName):display,"inline"===checkDisplay&&"none"===jQuery.css(elem,"float")&&(support.inlineBlockNeedsLayout&&"inline"!==defaultDisplay(elem.nodeName)?style.zoom=1:style.display="inline-block")),opts.overflow&&(style.overflow="hidden",support.shrinkWrapBlocks()||anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}));for(prop in props)if(value=props[prop],rfxtypes.exec(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else display=void 0;if(jQuery.isEmptyObject(orig))"inline"===("none"===display?defaultDisplay(elem.nodeName):display)&&(style.display=display);else{dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=jQuery._data(elem,"fxshow",{}),toggle&&(dataShow.hidden=!hidden),hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()}),anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig)jQuery.style(elem,prop,orig[prop])});for(prop in orig)tween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=tween.start,hidden&&(tween.end=tween.start,tween.start="width"===prop||"height"===prop?1:0))}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(name=jQuery.camelCase(index),easing=specialEasing[name],value=props[index],jQuery.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),hooks=jQuery.cssHooks[name],hooks&&"expand"in hooks){value=hooks.expand(value),delete props[name];for(index in value)index in props||(props[index]=value[index],specialEasing[index]=easing)}else specialEasing[name]=easing}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;index<length;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),percent<1&&length?remaining:(deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;index<length;index++)animation.tweens[index].run(1);return gotoEnd?deferred.resolveWith(elem,[animation,gotoEnd]):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(propFilter(props,animation.opts.specialEasing);index<length;index++)if(result=animationPrefilters[index].call(animation,elem,props,animation.opts))return result;return jQuery.map(props,createTween,animation),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType.charAt(0)?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}var inspected={},seekingTransport=structure===transports;return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}function ajaxHandleResponses(s,jqXHR,responses){for(var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}if(finalDataType)return finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(conv=converters[prev+" "+current]||converters["* "+current],!conv)for(conv2 in converters)if(tmp=conv2.split(" "),tmp[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){conv===!0?conv=converters[conv2]:converters[conv2]!==!0&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(conv!==!0)if(conv&&s["throws"])response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==jQuery.type(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function getWindow(elem){return jQuery.isWindow(elem)?elem:9===elem.nodeType&&(elem.defaultView||elem.parentWindow)}var deletedIds=[],slice=deletedIds.slice,concat=deletedIds.concat,push=deletedIds.push,indexOf=deletedIds.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,support={},version="1.11.3",jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return slice.call(this)},get:function(num){return null!=num?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret.context=this.context,ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:deletedIds.sort,splice:deletedIds.splice},jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[i]||{},i++),"object"==typeof target||jQuery.isFunction(target)||(target={}),i===length&&(target=this,i--);i<length;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray||function(obj){return"array"===jQuery.type(obj)},isWindow:function(obj){return null!=obj&&obj==obj.window},isNumeric:function(obj){return!jQuery.isArray(obj)&&obj-parseFloat(obj)+1>=0},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},isPlainObject:function(obj){var key;if(!obj||"object"!==jQuery.type(obj)||obj.nodeType||jQuery.isWindow(obj))return!1;try{if(obj.constructor&&!hasOwn.call(obj,"constructor")&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(support.ownLast)for(key in obj)return hasOwn.call(obj,key);for(key in obj);return void 0===key||hasOwn.call(obj,key)},type:function(obj){return null==obj?obj+"":"object"==typeof obj||"function"==typeof obj?class2type[toString.call(obj)]||"object":typeof obj},globalEval:function(data){data&&jQuery.trim(data)&&(window.execScript||function(data){window.eval.call(window,data)})(data)},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray)for(;i<length&&(value=callback.apply(obj[i],args),value!==!1);i++);else for(i in obj)if(value=callback.apply(obj[i],args),value===!1)break}else if(isArray)for(;i<length&&(value=callback.call(obj[i],i,obj[i]),value!==!1);i++);else for(i in obj)if(value=callback.call(obj[i],i,obj[i]),value===!1)break;return obj},trim:function(text){return null==text?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArraylike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){var len;if(arr){if(indexOf)return indexOf.call(arr,elem,i);for(len=arr.length,i=i?i<0?Math.max(0,len+i):i:0;i<len;i++)if(i in arr&&arr[i]===elem)return i}return-1},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;j<len;)first[i++]=second[j++];if(len!==len)for(;void 0!==second[j];)first[i++]=second[j++];return first.length=i,first},grep:function(elems,callback,invert){for(var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;i<length;i++)callbackInverse=!callback(elems[i],i),callbackInverse!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray)for(;i<length;i++)value=callback(elems[i],i,arg),null!=value&&ret.push(value);else for(i in elems)value=callback(elems[i],i,arg),null!=value&&ret.push(value);return concat.apply([],ret)},guid:1,proxy:function(fn,context){var args,proxy,tmp;if("string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn))return args=slice.call(arguments,2),proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))},proxy.guid=fn.guid=fn.guid||jQuery.guid++,proxy},now:function(){return+new Date},support:support}),jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});var Sizzle=function(window){function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,results=results||[],nodeType=context.nodeType,"string"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&documentIsHTML){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(elem=context.getElementById(m),!elem||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=1!==nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}var keys=[];return cache}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=attrs.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&"undefined"!=typeof context.getElementsByTagName&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if(outerCache=elem[expando]||(elem[expando]={}),(oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(outerCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if(matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches),matcher[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;i<len;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)},unloadHandler=function(){setDocument()};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;return doc!==document&&9===doc.nodeType&&doc.documentElement?(document=doc,docElem=doc.documentElement,parent=doc.defaultView,parent&&parent!==parent.top&&(parent.addEventListener?parent.addEventListener("unload",unloadHandler,!1):parent.attachEvent&&parent.attachEvent("onunload",unloadHandler)),documentIsHTML=!isXML(doc),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(doc.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!doc.getElementsByName||!doc.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if("undefined"!=typeof context.getElementById&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node="undefined"!=typeof elem.getAttributeNode&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return"undefined"!=typeof context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(doc.querySelectorAll))&&(assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\f]' msallowcapture=''><option selected=''></option></select>",div.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),div.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]")}),assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("name","D"),div.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){
support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare?compare:(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&compare||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||"undefined"!=typeof elem.getAttribute&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(outerCache=parent[expando]||(parent[expando]={}),cache=outerCache[type]||[],nodeIndex=cache[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return diff-=last,diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)idx=indexOf(seed,matched[i]),seed[idx]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return elemLang=elemLang.toLowerCase(),elemLang===lang||0===elemLang.indexOf(lang+"-");while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}},Expr.pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length));for(type in Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)cached=matcherFromTokens(match[i]),cached[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers)),cached.selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(tokens=match[0]=match[0].slice(0),tokens.length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0],!context)return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),selector=seed.length&&toSelector(tokens),!selector)return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return elem[name]===!0?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,risSimple=/^.[^:#\[\.,]*$/;jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++)if(jQuery.contains(self[i],this))return!0}));for(i=0;i<len;i++)jQuery.find(selector,self[i],ret);return ret=this.pushStack(len>1?jQuery.unique(ret):ret),ret.selector=this.selector?this.selector+" "+selector:selector,ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,document=window.document,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector)return this;if("string"==typeof selector){if(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector),!match||!match[1]&&context)return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}if(elem=document.getElementById(match[2]),elem&&elem.parentNode){if(elem.id!==match[2])return rootjQuery.find(selector);this.length=1,this[0]=elem}return this.context=document,this.selector=selector,this}return selector.nodeType?(this.context=this[0]=selector,this.length=1,this):jQuery.isFunction(selector)?"undefined"!=typeof rootjQuery.ready?rootjQuery.ready(selector):selector(jQuery):(void 0!==selector.selector&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))};init.prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.extend({dir:function(elem,dir,until){for(var matched=[],cur=elem[dir];cur&&9!==cur.nodeType&&(void 0===until||1!==cur.nodeType||!jQuery(cur).is(until));)1===cur.nodeType&&matched.push(cur),cur=cur[dir];return matched},sibling:function(n,elem){for(var r=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&r.push(n);return r}}),jQuery.fn.extend({has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++)if(jQuery.contains(this,targets[i]))return!0})},closest:function(selectors,context){for(var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||"string"!=typeof selectors?jQuery(selectors,context||this.context):0;i<l;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(pos?pos.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){return elem?"string"==typeof elem?jQuery.inArray(this[0],jQuery(elem)):jQuery.inArray(elem.jquery?elem[0]:elem,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(ret=jQuery.filter(selector,ret)),this.length>1&&(guaranteedUnique[name]||(ret=jQuery.unique(ret)),rparentsprev.test(name)&&(ret=ret.reverse())),this.pushStack(ret)}});var rnotwhite=/\S+/g,optionsCache={};jQuery.Callbacks=function(options){options="string"==typeof options?optionsCache[options]||createOptions(options):jQuery.extend({},options);var firing,memory,fired,firingLength,firingIndex,firingStart,list=[],stack=!options.once&&[],fire=function(data){for(memory=options.memory&&data,fired=!0,firingIndex=firingStart||0,firingStart=0,firingLength=list.length,firing=!0;list&&firingIndex<firingLength;firingIndex++)if(list[firingIndex].apply(data[0],data[1])===!1&&options.stopOnFalse){memory=!1;break}firing=!1,list&&(stack?stack.length&&fire(stack.shift()):memory?list=[]:self.disable())},self={add:function(){if(list){var start=list.length;!function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);"function"===type?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==type&&add(arg)})}(arguments),firing?firingLength=list.length:memory&&(firingStart=start,fire(memory))}return this},remove:function(){return list&&jQuery.each(arguments,function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),firing&&(index<=firingLength&&firingLength--,index<=firingIndex&&firingIndex--)}),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!(!list||!list.length)},empty:function(){return list=[],firingLength=0,this},disable:function(){return list=stack=memory=void 0,this},disabled:function(){return!list},lock:function(){return stack=void 0,memory||self.disable(),this},locked:function(){return!stack},fireWith:function(context,args){return!list||fired&&!stack||(args=args||[],args=[context,args.slice?args.slice():args],firing?stack.push(args):fire(args)),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify):newDefer[tuple[0]+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)})}),fns=null}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return promise.pipe=promise.then,jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[1^i][2].disable,tuples[2][2].lock),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?promise:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(subordinate){var progressValues,progressContexts,resolveContexts,i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=1!==length||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=1===remaining?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this,values[i]=arguments.length>1?slice.call(arguments):value,values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}};if(length>1)for(progressValues=new Array(length),progressContexts=new Array(length),resolveContexts=new Array(length);i<length;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues)):--remaining;return remaining||deferred.resolveWith(resolveContexts,resolveValues),deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){return jQuery.ready.promise().done(fn),this},jQuery.extend({isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){if(wait===!0?!--jQuery.readyWait:!jQuery.isReady){if(!document.body)return setTimeout(jQuery.ready);jQuery.isReady=!0,wait!==!0&&--jQuery.readyWait>0||(readyList.resolveWith(document,[jQuery]),jQuery.fn.triggerHandler&&(jQuery(document).triggerHandler("ready"),jQuery(document).off("ready")))}}}),jQuery.ready.promise=function(obj){if(!readyList)if(readyList=jQuery.Deferred(),"complete"===document.readyState)setTimeout(jQuery.ready);else if(document.addEventListener)document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1);else{document.attachEvent("onreadystatechange",completed),window.attachEvent("onload",completed);var top=!1;try{top=null==window.frameElement&&document.documentElement}catch(e){}top&&top.doScroll&&!function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}detach(),jQuery.ready()}}()}return readyList.promise(obj)};var i,strundefined="undefined";for(i in jQuery(support))break;support.ownLast="0"!==i,support.inlineBlockNeedsLayout=!1,jQuery(function(){var val,div,body,container;body=document.getElementsByTagName("body")[0],body&&body.style&&(div=document.createElement("div"),container=document.createElement("div"),container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",body.appendChild(container).appendChild(div),typeof div.style.zoom!==strundefined&&(div.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",support.inlineBlockNeedsLayout=val=3===div.offsetWidth,val&&(body.style.zoom=1)),body.removeChild(container))}),function(){var div=document.createElement("div");if(null==support.deleteExpando){support.deleteExpando=!0;try{delete div.test}catch(e){support.deleteExpando=!1}}div=null}(),jQuery.acceptData=function(elem){var noData=jQuery.noData[(elem.nodeName+" ").toLowerCase()],nodeType=+elem.nodeType||1;return(1===nodeType||9===nodeType)&&(!noData||noData!==!0&&elem.getAttribute("classid")===noData)};var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;jQuery.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){return elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando],!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data){return internalData(elem,name,data)},removeData:function(elem,name){return internalRemoveData(elem,name)},_data:function(elem,name,data){return internalData(elem,name,data,!0)},_removeData:function(elem,name){return internalRemoveData(elem,name,!0)}}),jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0===key){if(this.length&&(data=jQuery.data(elem),1===elem.nodeType&&!jQuery._data(elem,"parsedAttrs"))){for(i=attrs.length;i--;)attrs[i]&&(name=attrs[i].name,0===name.indexOf("data-")&&(name=jQuery.camelCase(name.slice(5)),dataAttr(elem,name,data[name])));jQuery._data(elem,"parsedAttrs",!0)}return data}return"object"==typeof key?this.each(function(){jQuery.data(this,key)}):arguments.length>1?this.each(function(){jQuery.data(this,key,value)}):elem?dataAttr(elem,key,jQuery.data(elem,key)):void 0},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;if(elem)return type=(type||"fx")+"queue",queue=jQuery._data(elem,type),data&&(!queue||jQuery.isArray(data)?queue=jQuery._data(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,next,hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue"),jQuery._removeData(elem,key)})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=void 0),type=type||"fx";i--;)tmp=jQuery._data(elements[i],type+"queueHooks"),tmp&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,cssExpand=["Top","Right","Bottom","Left"],isHidden=function(elem,el){return elem=el||elem,"none"===jQuery.css(elem,"display")||!jQuery.contains(elem.ownerDocument,elem)},access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=null==key;if("object"===jQuery.type(key)){chainable=!0;for(i in key)jQuery.access(elems,fn,i,key[i],!0,emptyGet,raw)}else if(void 0!==value&&(chainable=!0,jQuery.isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,key,value){return bulk.call(jQuery(elem),value)})),fn))for(;i<length;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},rcheckableType=/^(?:checkbox|radio)$/i;!function(){var input=document.createElement("input"),div=document.createElement("div"),fragment=document.createDocumentFragment();if(div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",support.leadingWhitespace=3===div.firstChild.nodeType,support.tbody=!div.getElementsByTagName("tbody").length,support.htmlSerialize=!!div.getElementsByTagName("link").length,support.html5Clone="<:nav></:nav>"!==document.createElement("nav").cloneNode(!0).outerHTML,input.type="checkbox",input.checked=!0,fragment.appendChild(input),support.appendChecked=input.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue,fragment.appendChild(div),div.innerHTML="<input type='radio' checked='checked' name='t'/>",support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,support.noCloneEvent=!0,div.attachEvent&&(div.attachEvent("onclick",function(){support.noCloneEvent=!1}),div.cloneNode(!0).click()),null==support.deleteExpando){support.deleteExpando=!0;try{delete div.test}catch(e){support.deleteExpando=!1}}}(),function(){var i,eventName,div=document.createElement("div");for(i in{submit:!0,change:!0,focusin:!0})eventName="on"+i,(support[i+"Bubbles"]=eventName in window)||(div.setAttribute(eventName,"t"),support[i+"Bubbles"]=div.attributes[eventName].expando===!1);div=null}();var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);
if(elemData){for(handler.handler&&(handleObjIn=handler,handler=handleObjIn.handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return typeof jQuery===strundefined||e&&jQuery.event.triggered===e.type?void 0:jQuery.event.dispatch.apply(eventHandle.elem,arguments)},eventHandle.elem=elem),types=(types||"").match(rnotwhite)||[""],t=types.length;t--;)tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||(handlers=events[type]=[],handlers.delegateCount=0,special.setup&&special.setup.call(elem,data,namespaces,eventHandle)!==!1||(elem.addEventListener?elem.addEventListener(type,eventHandle,!1):elem.attachEvent&&elem.attachEvent("on"+type,eventHandle))),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0);elem=null}},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(elemData&&(events=elemData.events)){for(types=(types||"").match(rnotwhite)||[""],t=types.length;t--;)if(tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,handlers=events[type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&special.teardown.call(elem,namespaces,elemData.handle)!==!1||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&(delete elemData.handle,jQuery._removeData(elem,"events"))}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(".")>=0&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event),event.isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||special.trigger.apply(elem,data)!==!1)){if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)event.type=i>1?bubbleType:special.bindType||type,handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle"),handle&&handle.apply(cur,data),handle=ontype&&cur[ontype],handle&&handle.apply&&jQuery.acceptData(cur)&&(event.result=handle.apply(cur,data),event.result===!1&&event.preventDefault());if(event.type=type,!onlyHandlers&&!event.isDefaultPrevented()&&(!special._default||special._default.apply(eventPath.pop(),data)===!1)&&jQuery.acceptData(elem)&&ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype],tmp&&(elem[ontype]=null),jQuery.event.triggered=type;try{elem[type]()}catch(e){}jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)}return event.result}},dispatch:function(event){event=jQuery.event.fix(event);var i,ret,handleObj,matched,j,handlerQueue=[],args=slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};if(args[0]=event,event.delegateTarget=this,!special.preDispatch||special.preDispatch.call(this,event)!==!1){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)event.namespace_re&&!event.namespace_re.test(handleObj.namespace)||(event.handleObj=handleObj,event.data=handleObj.data,ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args),void 0!==ret&&(event.result=ret)===!1&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var sel,handleObj,matches,i,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||"click"!==event.type))for(;cur!=this;cur=cur.parentNode||this)if(1===cur.nodeType&&(cur.disabled!==!0||"click"!==event.type)){for(matches=[],i=0;i<delegateCount;i++)handleObj=handlers[i],sel=handleObj.selector+" ",void 0===matches[sel]&&(matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length),matches[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,handlers:matches})}return delegateCount<handlers.length&&handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)}),handlerQueue},fix:function(event){if(event[jQuery.expando])return event;var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];for(fixHook||(this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}),copy=fixHook.props?this.props.concat(fixHook.props):this.props,event=new jQuery.Event(originalEvent),i=copy.length;i--;)prop=copy[i],event[prop]=originalEvent[prop];return event.target||(event.target=originalEvent.srcElement||document),3===event.target.nodeType&&(event.target=event.target.parentNode),event.metaKey=!!event.metaKey,fixHook.filter?fixHook.filter(event,originalEvent):event},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return null==event.which&&(event.which=null!=original.charCode?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;return null==event.pageX&&null!=original.clientX&&(eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),!event.relatedTarget&&fromElement&&(event.relatedTarget=fromElement===event.target?original.toElement:fromElement),event.which||void 0===button||(event.which=1&button?1:2&button?3:4&button?2:0),event}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(jQuery.nodeName(this,"input")&&"checkbox"===this.type&&this.click)return this.click(),!1},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0,originalEvent:{}});bubble?jQuery.event.trigger(e,null,elem):jQuery.event.dispatch.call(elem,e),e.isDefaultPrevented()&&event.preventDefault()}},jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)}:function(elem,type,handle){var name="on"+type;elem.detachEvent&&(typeof elem[name]===strundefined&&(elem[name]=null),elem.detachEvent(name,handle))},jQuery.Event=function(src,props){return this instanceof jQuery.Event?(src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&src.returnValue===!1?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),void(this[jQuery.expando]=!0)):new jQuery.Event(src,props)},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;return related&&(related===target||jQuery.contains(target,related))||(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),support.submitBubbles||(jQuery.event.special.submit={setup:function(){return!jQuery.nodeName(this,"form")&&void jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:void 0;form&&!jQuery._data(form,"submitBubbles")&&(jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=!0}),jQuery._data(form,"submitBubbles",!0))})},postDispatch:function(event){event._submit_bubble&&(delete event._submit_bubble,this.parentNode&&!event.isTrigger&&jQuery.event.simulate("submit",this.parentNode,event,!0))},teardown:function(){return!jQuery.nodeName(this,"form")&&void jQuery.event.remove(this,"._submit")}}),support.changeBubbles||(jQuery.event.special.change={setup:function(){return rformElems.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(jQuery.event.add(this,"propertychange._change",function(event){"checked"===event.originalEvent.propertyName&&(this._just_changed=!0)}),jQuery.event.add(this,"click._change",function(event){this._just_changed&&!event.isTrigger&&(this._just_changed=!1),jQuery.event.simulate("change",this,event,!0)})),!1):void jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;rformElems.test(elem.nodeName)&&!jQuery._data(elem,"changeBubbles")&&(jQuery.event.add(elem,"change._change",function(event){!this.parentNode||event.isSimulated||event.isTrigger||jQuery.event.simulate("change",this.parentNode,event,!0)}),jQuery._data(elem,"changeBubbles",!0))})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||"radio"!==elem.type&&"checkbox"!==elem.type)return event.handleObj.handler.apply(this,arguments)},teardown:function(){return jQuery.event.remove(this,"._change"),!rformElems.test(this.nodeName)}}),support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),!0)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix);attaches||doc.addEventListener(orig,handler,!0),jQuery._data(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix)-1;attaches?jQuery._data(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),jQuery._removeData(doc,fix))}}}),jQuery.fn.extend({on:function(types,selector,data,fn,one){var type,origFn;if("object"==typeof types){"string"!=typeof selector&&(data=data||selector,selector=void 0);for(type in types)this.on(type,selector,data,types[type],one);return this}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&("string"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),fn===!1)fn=returnFalse;else if(!fn)return this;return 1===one&&(origFn=fn,fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)},fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}return selector!==!1&&"function"!=typeof selector||(fn=selector,selector=void 0),fn===!1&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem)return jQuery.event.trigger(type,data,elem,!0)}});var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")?clone=elem.cloneNode(!0):(fragmentDiv.innerHTML=elem.outerHTML,fragmentDiv.removeChild(clone=fragmentDiv.firstChild)),!(support.noCloneEvent&&support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),srcElements=getAll(elem),i=0;null!=(node=srcElements[i]);++i)destElements[i]&&fixCloneNodeIssues(node,destElements[i]);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0;null!=(node=srcElements[i]);i++)cloneCopyEvent(node,destElements[i]);else cloneCopyEvent(elem,clone);return destElements=getAll(clone,"script"),destElements.length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),destElements=srcElements=node=null,clone},buildFragment:function(elems,context,scripts,selection){for(var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;i<l;i++)if(elem=elems[i],elem||0===elem)if("object"===jQuery.type(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||safe.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;if(!support.leadingWhitespace&&rleadingWhitespace.test(elem)&&nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0])),!support.tbody)for(elem="table"!==tag||rtbody.test(elem)?"<table>"!==wrap[1]||rtbody.test(elem)?0:tmp:tmp.firstChild,j=elem&&elem.childNodes.length;j--;)jQuery.nodeName(tbody=elem.childNodes[j],"tbody")&&!tbody.childNodes.length&&elem.removeChild(tbody);for(jQuery.merge(nodes,tmp.childNodes),tmp.textContent="";tmp.firstChild;)tmp.removeChild(tmp.firstChild);tmp=safe.lastChild}else nodes.push(context.createTextNode(elem));for(tmp&&safe.removeChild(tmp),support.appendChecked||jQuery.grep(getAll(nodes,"input"),fixDefaultChecked),i=0;elem=nodes[i++];)if((!selection||jQuery.inArray(elem,selection)===-1)&&(contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(safe.appendChild(elem),"script"),contains&&setGlobalEval(tmp),scripts))for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return tmp=null,safe},cleanData:function(elems,acceptData){for(var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=support.deleteExpando,special=jQuery.event.special;null!=(elem=elems[i]);i++)if((acceptData||jQuery.acceptData(elem))&&(id=elem[internalKey],data=id&&cache[id])){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);cache[id]&&(delete cache[id],deleteExpando?delete elem[internalKey]:typeof elem.removeAttribute!==strundefined?elem.removeAttribute(internalKey):elem[internalKey]=null,deletedIds.push(id))}}}),jQuery.fn.extend({text:function(value){return access(this,function(value){return void 0===value?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},remove:function(selector,keepData){for(var elem,elems=selector?jQuery.filter(selector,this):this,i=0;null!=(elem=elems[i]);i++)keepData||1!==elem.nodeType||jQuery.cleanData(getAll(elem)),elem.parentNode&&(keepData&&jQuery.contains(elem.ownerDocument,elem)&&setGlobalEval(getAll(elem,"script")),elem.parentNode.removeChild(elem));return this},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++){for(1===elem.nodeType&&jQuery.cleanData(getAll(elem,!1));elem.firstChild;)elem.removeChild(elem.firstChild);elem.options&&jQuery.nodeName(elem,"select")&&(elem.options.length=0)}return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null!=dataAndEvents&&dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value)return 1===elem.nodeType?elem.innerHTML.replace(rinlinejQuery,""):void 0;if("string"==typeof value&&!rnoInnerhtml.test(value)&&(support.htmlSerialize||!rnoshimcache.test(value))&&(support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++)elem=this[i]||{},1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];return this.domManip(arguments,function(elem){arg=this.parentNode,jQuery.cleanData(getAll(this)),arg&&arg.replaceChild(elem,this)}),arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,callback){args=concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&"string"==typeof value&&!support.checkClone&&rchecked.test(value))return this.each(function(index){var self=set.eq(index);isFunction&&(args[0]=value.call(this,index,self.html())),self.domManip(args,callback)});if(l&&(fragment=jQuery.buildFragment(args,this[0].ownerDocument,!1,this),first=fragment.firstChild,1===fragment.childNodes.length&&(fragment=first),first)){for(scripts=jQuery.map(getAll(fragment,"script"),disableScript),hasScripts=scripts.length;i<l;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(this[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;i<hasScripts;i++)node=scripts[i],rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl&&jQuery._evalUrl(node.src):jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,"")));fragment=first=null}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;i<=last;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}});var iframe,elemdisplay={};!function(){var shrinkWrapBlocksVal;support.shrinkWrapBlocks=function(){if(null!=shrinkWrapBlocksVal)return shrinkWrapBlocksVal;shrinkWrapBlocksVal=!1;var div,body,container;return body=document.getElementsByTagName("body")[0],body&&body.style?(div=document.createElement("div"),container=document.createElement("div"),container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",body.appendChild(container).appendChild(div),typeof div.style.zoom!==strundefined&&(div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",div.appendChild(document.createElement("div")).style.width="5px",shrinkWrapBlocksVal=3!==div.offsetWidth),body.removeChild(container),shrinkWrapBlocksVal):void 0}}();var getStyles,curCSS,rmargin=/^margin/,rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),rposition=/^(top|right|bottom|left)$/;window.getComputedStyle?(getStyles=function(elem){return elem.ownerDocument.defaultView.opener?elem.ownerDocument.defaultView.getComputedStyle(elem,null):window.getComputedStyle(elem,null)},curCSS=function(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return computed=computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:void 0,computed&&(""!==ret||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name)),rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),void 0===ret?ret:ret+""}):document.documentElement.currentStyle&&(getStyles=function(elem){return elem.currentStyle},curCSS=function(elem,name,computed){var left,rs,rsLeft,ret,style=elem.style;return computed=computed||getStyles(elem),ret=computed?computed[name]:void 0,null==ret&&style&&style[name]&&(ret=style[name]),rnumnonpx.test(ret)&&!rposition.test(name)&&(left=style.left,rs=elem.runtimeStyle,rsLeft=rs&&rs.left,rsLeft&&(rs.left=elem.currentStyle.left),style.left="fontSize"===name?"1em":ret,ret=style.pixelLeft+"px",style.left=left,rsLeft&&(rs.left=rsLeft)),void 0===ret?ret:ret+""||"auto"}),function(){function computeStyleTests(){var div,body,container,contents;body=document.getElementsByTagName("body")[0],body&&body.style&&(div=document.createElement("div"),container=document.createElement("div"),container.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",body.appendChild(container).appendChild(div),div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",pixelPositionVal=boxSizingReliableVal=!1,reliableMarginRightVal=!0,window.getComputedStyle&&(pixelPositionVal="1%"!==(window.getComputedStyle(div,null)||{}).top,boxSizingReliableVal="4px"===(window.getComputedStyle(div,null)||{width:"4px"}).width,contents=div.appendChild(document.createElement("div")),contents.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",contents.style.marginRight=contents.style.width="0",div.style.width="1px",reliableMarginRightVal=!parseFloat((window.getComputedStyle(contents,null)||{}).marginRight),div.removeChild(contents)),div.innerHTML="<table><tr><td></td><td>t</td></tr></table>",contents=div.getElementsByTagName("td"),contents[0].style.cssText="margin:0;border:0;padding:0;display:none",reliableHiddenOffsetsVal=0===contents[0].offsetHeight,reliableHiddenOffsetsVal&&(contents[0].style.display="",contents[1].style.display="none",reliableHiddenOffsetsVal=0===contents[0].offsetHeight),body.removeChild(container))}var div,style,a,pixelPositionVal,boxSizingReliableVal,reliableHiddenOffsetsVal,reliableMarginRightVal;div=document.createElement("div"),div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=div.getElementsByTagName("a")[0],style=a&&a.style,style&&(style.cssText="float:left;opacity:.5",support.opacity="0.5"===style.opacity,support.cssFloat=!!style.cssFloat,div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,support.boxSizing=""===style.boxSizing||""===style.MozBoxSizing||""===style.WebkitBoxSizing,jQuery.extend(support,{reliableHiddenOffsets:function(){return null==reliableHiddenOffsetsVal&&computeStyleTests(),reliableHiddenOffsetsVal},boxSizingReliable:function(){return null==boxSizingReliableVal&&computeStyleTests(),boxSizingReliableVal},pixelPosition:function(){return null==pixelPositionVal&&computeStyleTests(),pixelPositionVal},reliableMarginRight:function(){return null==reliableMarginRightVal&&computeStyleTests(),reliableMarginRightVal}}))}(),jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];ret=callback.apply(elem,args||[]);for(name in options)elem.style[name]=old[name];return ret};var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp("^("+pnum+")(.*)$","i"),rrelNum=new RegExp("^([+-])=("+pnum+")","i"),cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"];jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;if(name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value)return hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name];if(type=typeof value,"string"===type&&(ret=rrelNum.exec(value))&&(value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name)),type="number"),null!=value&&value===value&&("number"!==type||jQuery.cssNumber[origName]||(value+="px"),support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),!(hooks&&"set"in hooks&&void 0===(value=hooks.set(elem,value,extra)))))try{style[name]=value}catch(e){}}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],hooks&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),extra===!0||jQuery.isNumeric(num)?num||0:val):val}}),jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed)return rdisplayswap.test(jQuery.css(elem,"display"))&&0===elem.offsetWidth?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),styles):0)}}}),support.opacity||(jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+100*value+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1,(value>=1||""===value)&&""===jQuery.trim(filter.replace(ralpha,""))&&style.removeAttribute&&(style.removeAttribute("filter"),
""===value||currentStyle&&!currentStyle.filter)||(style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity)}}),jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed)return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];i<4;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)}),jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){for(styles=getStyles(elem),len=name.length;i<len;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||"swing",this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return null==tween.elem[tween.prop]||tween.elem.style&&null!=tween.elem.style[tween.prop]?(result=jQuery.css(tween.elem,tween.prop,""),result&&"auto"!==result?result:0):tween.elem[tween.prop]},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):tween.elem.style&&(null!=tween.elem.style[jQuery.cssProps[tween.prop]]||jQuery.cssHooks[tween.prop])?jQuery.style(tween.elem,tween.prop,tween.now+tween.unit):tween.elem[tween.prop]=tween.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||"px"!==unit&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3],parts=parts||[],start=+target||1;do scale=scale||".5",start/=scale,jQuery.style(tween.elem,prop,start+unit);while(scale!==(scale=tween.cur()/target)&&1!==scale&&--maxIterations)}return parts&&(start=tween.start=+start||+target||0,tween.unit=unit,tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]),tween}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=["*"]):props=props.split(" ");for(var prop,index=0,length=props.length;index<length;index++)prop=props[index],tweeners[prop]=tweeners[prop]||[],tweeners[prop].unshift(callback)},prefilter:function(callback,prepend){prepend?animationPrefilters.unshift(callback):animationPrefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};return opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default,null!=opt.queue&&opt.queue!==!0||(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||jQuery._data(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&type!==!1&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));!dequeue&&gotoEnd||jQuery.dequeue(this,type)})},finish:function(type){return type!==!1&&(type=type||"fx"),this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;index<length;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.timers=[],jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;for(fxNow=jQuery.now();i<timers.length;i++)timer=timers[i],timer()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),timer()?jQuery.fx.start():jQuery.timers.pop()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx?jQuery.fx.speeds[time]||time:time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},function(){var input,div,select,a,opt;div=document.createElement("div"),div.setAttribute("className","t"),div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=div.getElementsByTagName("a")[0],select=document.createElement("select"),opt=select.appendChild(document.createElement("option")),input=div.getElementsByTagName("input")[0],a.style.cssText="top:1px",support.getSetAttribute="t"!==div.className,support.style=/top/.test(a.getAttribute("style")),support.hrefNormalized="/a"===a.getAttribute("href"),support.checkOn=!!input.value,support.optSelected=opt.selected,support.enctype=!!document.createElement("form").enctype,select.disabled=!0,support.optDisabled=!opt.disabled,input=document.createElement("input"),input.setAttribute("value",""),support.input=""===input.getAttribute("value"),input.value="t",input.setAttribute("type","radio"),support.radioValue="t"===input.value}();var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];{if(arguments.length)return isFunction=jQuery.isFunction(value),this.each(function(i){var val;1===this.nodeType&&(val=isFunction?value.call(this,i,jQuery(this).val()):value,null==val?val="":"number"==typeof val?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()],hooks&&"set"in hooks&&void 0!==hooks.set(this,val,"value")||(this.value=val))});if(elem)return hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()],hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,"value"))?ret:(ret=elem.value,"string"==typeof ret?ret.replace(rreturn,""):null==ret?"":ret)}}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return null!=val?val:jQuery.trim(jQuery.text(elem))}},select:{get:function(elem){for(var value,option,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;i<max;i++)if(option=options[i],(option.selected||i===index)&&(support.optDisabled?!option.disabled:null===option.getAttribute("disabled"))&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)if(option=options[i],jQuery.inArray(jQuery.valHooks.option.get(option),values)>=0)try{option.selected=optionSet=!0}catch(_){option.scrollHeight}else option.selected=!1;return optionSet||(elem.selectedIndex=-1),options}}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value))return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})});var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=support.getSetAttribute,getSetInput=support.input;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}}),jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType)return typeof elem.getAttribute===strundefined?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)),void 0===value?hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:(ret=jQuery.find.attr(elem,name),null==ret?void 0:ret):null!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+""),value):void jQuery.removeAttr(elem,name))},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)propName=jQuery.propFix[name]||name,jQuery.expr.match.bool.test(name)?getSetInput&&getSetAttribute||!ruseDefault.test(name)?elem[propName]=!1:elem[jQuery.camelCase("default-"+name)]=elem[propName]=!1:jQuery.attr(elem,name,""),elem.removeAttribute(getSetAttribute?name:propName)},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&"radio"===value&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}}}),boolHook={set:function(elem,value,name){return value===!1?jQuery.removeAttr(elem,name):getSetInput&&getSetAttribute||!ruseDefault.test(name)?elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name):elem[jQuery.camelCase("default-"+name)]=elem[name]=!0,name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=getSetInput&&getSetAttribute||!ruseDefault.test(name)?function(elem,name,isXML){var ret,handle;return isXML||(handle=attrHandle[name],attrHandle[name]=ret,ret=null!=getter(elem,name,isXML)?name.toLowerCase():null,attrHandle[name]=handle),ret}:function(elem,name,isXML){if(!isXML)return elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null}}),getSetInput&&getSetAttribute||(jQuery.attrHooks.value={set:function(elem,value,name){return jQuery.nodeName(elem,"input")?void(elem.defaultValue=value):nodeHook&&nodeHook.set(elem,value,name)}}),getSetAttribute||(nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(ret||elem.setAttributeNode(ret=elem.ownerDocument.createAttribute(name)),ret.value=value+="","value"===name||value===elem.getAttribute(name))return value}},attrHandle.id=attrHandle.name=attrHandle.coords=function(elem,name,isXML){var ret;if(!isXML)return(ret=elem.getAttributeNode(name))&&""!==ret.value?ret.value:null},jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);if(ret&&ret.specified)return ret.value},set:nodeHook.set},jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,""!==value&&value,name)}},jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){if(""===value)return elem.setAttribute(name,"auto"),value}}})),support.style||(jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||void 0},set:function(elem,value){return elem.style.cssText=value+""}});var rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return name=jQuery.propFix[name]||name,this.each(function(){try{this[name]=void 0,delete this[name]}catch(e){}})}}),jQuery.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType)return notxml=1!==nType||!jQuery.isXMLDoc(elem),notxml&&(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}}}),support.hrefNormalized||jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4)}}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&(parent.selectedIndex,parent.parentNode&&parent.parentNode.selectedIndex),null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),support.enctype||(jQuery.propFix.enctype="encoding");var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,i=0,len=this.length,proceed="string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(proceed)for(classes=(value||"").match(rnotwhite)||[];i<len;i++)if(elem=this[i],cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ")){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");finalValue=jQuery.trim(cur),elem.className!==finalValue&&(elem.className=finalValue)}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,i=0,len=this.length,proceed=0===arguments.length||"string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});if(proceed)for(classes=(value||"").match(rnotwhite)||[];i<len;i++)if(elem=this[i],cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"")){for(j=0;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>=0;)cur=cur.replace(" "+clazz+" "," ");finalValue=value?jQuery.trim(cur):"",elem.className!==finalValue&&(elem.className=finalValue)}return this},toggleClass:function(value,stateVal){var type=typeof value;return"boolean"==typeof stateVal&&"string"===type?stateVal?this.addClass(value):this.removeClass(value):jQuery.isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}):this.each(function(){if("string"===type)for(var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else type!==strundefined&&"boolean"!==type||(this.className&&jQuery._data(this,"__className__",this.className),this.className=this.className||value===!1?"":jQuery._data(this,"__className__")||"")})},hasClass:function(selector){for(var className=" "+selector+" ",i=0,l=this.length;i<l;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0)return!0;return!1}}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var nonce=jQuery.now(),rquery=/\?/,rvalidtokens=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;jQuery.parseJSON=function(data){if(window.JSON&&window.JSON.parse)return window.JSON.parse(data+"");var requireNonComma,depth=null,str=jQuery.trim(data+"");return str&&!jQuery.trim(str.replace(rvalidtokens,function(token,comma,open,close){return requireNonComma&&comma&&(depth=0),0===depth?token:(requireNonComma=open||comma,depth+=!close-!open,"")}))?Function("return "+str)():jQuery.error("Invalid JSON: "+data)},jQuery.parseXML=function(data){var xml,tmp;if(!data||"string"!=typeof data)return null;try{window.DOMParser?(tmp=new DOMParser,xml=tmp.parseFromString(data,"text/xml")):(xml=new ActiveXObject("Microsoft.XMLDOM"),xml.async="false",xml.loadXML(data))}catch(e){xml=void 0}return xml&&xml.documentElement&&!xml.getElementsByTagName("parsererror").length||jQuery.error("Invalid XML: "+data),xml};var ajaxLocParts,ajaxLocation,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;2!==state&&(state=2,timeoutTimer&&clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&status<300||304===status,responses&&(response=ajaxHandleResponses(s,jqXHR,responses)),response=ajaxConvert(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&(modified=jqXHR.getResponseHeader("Last-Modified"),modified&&(jQuery.lastModified[cacheURL]=modified),modified=jqXHR.getResponseHeader("etag"),modified&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,error=response.error,isSuccess=!error)):(error=statusText,!status&&statusText||(statusText="error",status<0&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}"object"==typeof url&&(options=url,url=void 0),options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(2===state){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return 2===state?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();return state||(name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return state||(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(state<2)for(code in map)statusCode[code]=[statusCode[code],map[code]];else jqXHR.always(map[jqXHR.status]);return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR).complete=completeDeferred.add,jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""],null==s.crossDomain&&(parts=rurl.exec(s.url.toLowerCase()),s.crossDomain=!(!parts||parts[1]===ajaxLocParts[1]&&parts[2]===ajaxLocParts[2]&&(parts[3]||("http:"===parts[1]?"80":"443"))===(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?"80":"443")))),s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),2===state)return jqXHR;fireGlobals=jQuery.event&&s.global,fireGlobals&&0===jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url,s.hasContent||(s.data&&(cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),s.cache===!1&&(s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++)),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===!1||2===state))return jqXHR.abort();strAbort="abort";for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);if(transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),s.async&&s.timeout>0&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(state<2))throw e;done(-1,e)}}else done(-1,"No Transport");return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,"script")}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}}),jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html))return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))});if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstChild&&1===elem.firstChild.nodeType;)elem=elem.firstChild;return elem}).append(this)}return this},wrapInner:function(html){return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}}),jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0||!support.reliableHiddenOffsets()&&"none"===(elem.style&&elem.style.display||jQuery.css(elem,"display"))},jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():null==value?"":value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(void 0===traditional&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional),jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.ajaxSettings.xhr=void 0!==window.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&createStandardXHR()||createActiveXHR()}:createStandardXHR;var xhrId=0,xhrCallbacks={},xhrSupported=jQuery.ajaxSettings.xhr();window.attachEvent&&window.attachEvent("onunload",function(){for(var key in xhrCallbacks)xhrCallbacks[key](void 0,!0)}),support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,xhrSupported=support.ajax=!!xhrSupported,xhrSupported&&jQuery.ajaxTransport(function(options){if(!options.crossDomain||support.cors){var callback;return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest");for(i in headers)void 0!==headers[i]&&xhr.setRequestHeader(i,headers[i]+"");xhr.send(options.hasContent&&options.data||null),callback=function(_,isAbort){var status,statusText,responses;if(callback&&(isAbort||4===xhr.readyState))if(delete xhrCallbacks[id],callback=void 0,xhr.onreadystatechange=jQuery.noop,isAbort)4!==xhr.readyState&&xhr.abort();else{responses={},status=xhr.status,"string"==typeof xhr.responseText&&(responses.text=xhr.responseText);try{statusText=xhr.statusText}catch(e){statusText=""}status||!options.isLocal||options.crossDomain?1223===status&&(status=204):status=responses.text?200:404}responses&&complete(status,statusText,responses,xhr.getAllResponseHeaders())},options.async?4===xhr.readyState?setTimeout(callback):xhr.onreadystatechange=xhrCallbacks[id]=callback:callback()},abort:function(){callback&&callback(void 0,!0)}}}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type="GET",
s.global=!1)}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script"),script.async=!0,s.scriptCharset&&(script.charset=s.scriptCharset),script.src=s.url,script.onload=script.onreadystatechange=function(_,isAbort){(isAbort||!script.readyState||/loaded|complete/.test(script.readyState))&&(script.onload=script.onreadystatechange=null,script.parentNode&&script.parentNode.removeChild(script),script=null,isAbort||callback(200,"success"))},head.insertBefore(script,head.firstChild)},abort:function(){script&&script.onload(void 0,!0)}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==!1&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||"jsonp"===s.dataTypes[0])return callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):s.jsonp!==!1&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0}),"script"}),jQuery.parseHTML=function(data,context,keepScripts){if(!data||"string"!=typeof data)return null;"boolean"==typeof context&&(keepScripts=context,context=!1),context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];return parsed?[context.createElement(parsed[1])]:(parsed=jQuery.buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes))};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if("string"!=typeof url&&_load)return _load.apply(this,arguments);var selector,response,type,self=this,off=url.indexOf(" ");return off>=0&&(selector=jQuery.trim(url.slice(off,url.length)),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=void 0):params&&"object"==typeof params&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=("absolute"===position||"fixed"===position)&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,calculatePosition?(curPosition=curElem.position(),curTop=curPosition.top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset)),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(doc)return docElem=doc.documentElement,jQuery.contains(docElem,elem)?(typeof elem.getBoundingClientRect!==strundefined&&(box=elem.getBoundingClientRect()),win=getWindow(doc),{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}):box},position:function(){if(this[0]){var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];return"fixed"===jQuery.css(elem,"position")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),jQuery.nodeName(offsetParent[0],"html")||(parentOffset=offsetParent.offset()),parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",!0)),{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent||docElem;offsetParent&&!jQuery.nodeName(offsetParent,"html")&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);return void 0===val?win?prop in win?win[prop]:win.document.documentElement[method]:elem[method]:void(win?win.scrollTo(top?jQuery(win).scrollLeft():val,top?val:jQuery(win).scrollTop()):elem[method]=val)},method,val,arguments.length,null)}}),jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed)return computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed})}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(margin===!0||value===!0?"margin":"border");return access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:void 0,chainable,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery});var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},typeof noGlobal===strundefined&&(window.jQuery=window.$=jQuery),jQuery}),function(){function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;return arguments.length<3&&(memo=obj[keys?keys[index]:index],index+=dir),iterator(obj,iteratee,memo,keys,index,length)}}function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);for(var length=getLength(array),index=dir>0?0:length-1;index>=0&&index<length;index+=dir)if(predicate(array[index],index,array))return index;return-1}}function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if("number"==typeof idx)dir>0?i=idx>=0?idx:Math.max(idx+length,i):length=idx>=0?Math.min(idx+1,length):idx+length+1;else if(sortedIndex&&idx&&length)return idx=sortedIndex(array,item),array[idx]===item?idx:-1;if(item!==item)return idx=predicateFind(slice.call(array,i,length),_.isNaN),idx>=0?idx+i:-1;for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir)if(array[idx]===item)return idx;return-1}}function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length,constructor=obj.constructor,proto=_.isFunction(constructor)&&constructor.prototype||ObjProto,prop="constructor";for(_.has(obj,prop)&&!_.contains(keys,prop)&&keys.push(prop);nonEnumIdx--;)prop=nonEnumerableProps[nonEnumIdx],prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)&&keys.push(prop)}var root=this,previousUnderscore=root._,ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create,Ctor=function(){},_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(void 0===context)return func;switch(null==argCount?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}},cb=function(value,context,argCount){return null==value?_.identity:_.isFunction(value)?optimizeCb(value,context,argCount):_.isObject(value)?_.matcher(value):_.property(value)};_.iteratee=function(value,context){return cb(value,context,1/0)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||null==obj)return obj;for(var index=1;index<length;index++)for(var source=arguments[index],keys=keysFunc(source),l=keys.length,i=0;i<l;i++){var key=keys[i];undefinedOnly&&void 0!==obj[key]||(obj[key]=source[key])}return obj}},baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;return Ctor.prototype=null,result},property=function(key){return function(obj){return null==obj?void 0:obj[key]}},MAX_ARRAY_INDEX=Math.pow(2,53)-1,getLength=property("length"),isArrayLike=function(collection){var length=getLength(collection);return"number"==typeof length&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj))for(i=0,length=obj.length;i<length;i++)iteratee(obj[i],i,obj);else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++)iteratee(obj[keys[i]],keys[i],obj)}return obj},_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length),index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results},_.reduce=_.foldl=_.inject=createReduce(1),_.reduceRight=_.foldr=createReduce(-1),_.find=_.detect=function(obj,predicate,context){var key;if(key=isArrayLike(obj)?_.findIndex(obj,predicate,context):_.findKey(obj,predicate,context),void 0!==key&&key!==-1)return obj[key]},_.filter=_.select=function(obj,predicate,context){var results=[];return predicate=cb(predicate,context),_.each(obj,function(value,index,list){predicate(value,index,list)&&results.push(value)}),results},_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)},_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return!1}return!0},_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);for(var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return!0}return!1},_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){return isArrayLike(obj)||(obj=_.values(obj)),("number"!=typeof fromIndex||guard)&&(fromIndex=0),_.indexOf(obj,item,fromIndex)>=0},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return null==func?func:func.apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))},_.max=function(obj,iteratee,context){var value,computed,result=-(1/0),lastComputed=-(1/0);if(null==iteratee&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++)value=obj[i],value>result&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(computed>lastComputed||computed===-(1/0)&&result===-(1/0))&&(result=value,lastComputed=computed)});return result},_.min=function(obj,iteratee,context){var value,computed,result=1/0,lastComputed=1/0;if(null==iteratee&&null!=obj){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++)value=obj[i],value<result&&(result=value)}else iteratee=cb(iteratee,context),_.each(obj,function(value,index,list){computed=iteratee(value,index,list),(computed<lastComputed||computed===1/0&&result===1/0)&&(result=value,lastComputed=computed)});return result},_.shuffle=function(obj){for(var rand,set=isArrayLike(obj)?obj:_.values(obj),length=set.length,shuffled=Array(length),index=0;index<length;index++)rand=_.random(0,index),rand!==index&&(shuffled[index]=shuffled[rand]),shuffled[rand]=set[index];return shuffled},_.sample=function(obj,n,guard){return null==n||guard?(isArrayLike(obj)||(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))},_.sortBy=function(obj,iteratee,context){return iteratee=cb(iteratee,context),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(a<b||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};return iteratee=cb(iteratee,context),_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)}),result}};_.groupBy=group(function(result,value,key){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,value,key){result[key]=value}),_.countBy=group(function(result,value,key){_.has(result,key)?result[key]++:result[key]=1}),_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):isArrayLike(obj)?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:isArrayLike(obj)?obj.length:_.keys(obj).length},_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];return _.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)}),[pass,fail]},_.first=_.head=_.take=function(array,n,guard){if(null!=array)return null==n||guard?array[0]:_.initial(array,array.length-n)},_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(null==n||guard?1:n)))},_.last=function(array,n,guard){if(null!=array)return null==n||guard?array[array.length-1]:_.rest(array,Math.max(0,array.length-n))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){for(var output=[],idx=0,i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){shallow||(value=flatten(value,shallow,strict));var j=0,len=value.length;for(output.length+=len;j<len;)output[idx++]=value[j++]}else strict||(output[idx++]=value)}return output};_.flatten=function(array,shallow){return flatten(array,shallow,!1)},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.uniq=_.unique=function(array,isSorted,iteratee,context){_.isBoolean(isSorted)||(context=iteratee,iteratee=isSorted,isSorted=!1),null!=iteratee&&(iteratee=cb(iteratee,context));for(var result=[],seen=[],i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;isSorted?(i&&seen===computed||result.push(value),seen=computed):iteratee?_.contains(seen,computed)||(seen.push(computed),result.push(value)):_.contains(result,value)||result.push(value)}return result},_.union=function(){return _.uniq(flatten(arguments,!0,!0))},_.intersection=function(array){for(var result=[],argsLength=arguments.length,i=0,length=getLength(array);i<length;i++){var item=array[i];if(!_.contains(result,item)){for(var j=1;j<argsLength&&_.contains(arguments[j],item);j++);j===argsLength&&result.push(item)}}return result},_.difference=function(array){var rest=flatten(arguments,!0,!0,1);return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){return _.unzip(arguments)},_.unzip=function(array){for(var length=array&&_.max(array,getLength).length||0,result=Array(length),index=0;index<length;index++)result[index]=_.pluck(array,index);return result},_.object=function(list,values){for(var result={},i=0,length=getLength(list);i<length;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.findIndex=createPredicateIndexFinder(1),_.findLastIndex=createPredicateIndexFinder(-1),_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);for(var value=iteratee(obj),low=0,high=getLength(array);low<high;){var mid=Math.floor((low+high)/2);iteratee(array[mid])<value?low=mid+1:high=mid}return low},_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex),_.lastIndexOf=createIndexFinder(-1,_.findLastIndex),_.range=function(start,stop,step){null==stop&&(stop=start||0,start=0),step=step||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),range=Array(length),idx=0;idx<length;idx++,start+=step)range[idx]=start;return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype),result=sourceFunc.apply(self,args);return _.isObject(result)?result:self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2),bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound},_.partial=function(func){var boundArgs=slice.call(arguments,1),bound=function(){for(var position=0,length=boundArgs.length,args=Array(length),i=0;i<length;i++)args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i];for(;position<arguments.length;)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound},_.bindAll=function(obj){var i,key,length=arguments.length;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++)key=arguments[i],obj[key]=_.bind(obj[key],obj);return obj},_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache,address=""+(hasher?hasher.apply(this,arguments):key);return _.has(cache,address)||(cache[address]=func.apply(this,arguments)),cache[address]};return memoize.cache={},memoize},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=_.partial(_.delay,_,1),_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;last<wait&&last>=0?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),timeout||(context=args=null)))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}},_.compose=function(){var args=arguments,start=args.length-1;return function(){for(var i=start,result=args[start].apply(this,arguments);i--;)result=args[i].call(this,result);return result}},_.after=function(times,func){return function(){if(--times<1)return func.apply(this,arguments)}},_.before=function(times,func){var memo;return function(){return--times>0&&(memo=func.apply(this,arguments)),times<=1&&(func=null),memo}},_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString"),nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);return hasEnumBug&&collectNonEnumProps(obj,keys),keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=Array(length),i=0;i<length;i++)values[i]=obj[keys[i]];return values},_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);for(var currentKey,keys=_.keys(obj),length=keys.length,results={},index=0;index<length;index++)currentKey=keys[index],results[currentKey]=iteratee(obj[currentKey],currentKey,obj);return results},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=Array(length),i=0;i<length;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;i<length;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=createAssigner(_.allKeys),_.extendOwn=_.assign=createAssigner(_.keys),_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);for(var key,keys=_.keys(obj),i=0,length=keys.length;i<length;i++)if(key=keys[i],predicate(obj[key],key,obj))return key},_.pick=function(object,oiteratee,context){var iteratee,keys,result={},obj=object;if(null==obj)return result;_.isFunction(oiteratee)?(keys=_.allKeys(obj),iteratee=optimizeCb(oiteratee,context)):(keys=flatten(arguments,!1,!1,1),iteratee=function(value,key,obj){return key in obj},obj=Object(obj));for(var i=0,length=keys.length;i<length;i++){var key=keys[i],value=obj[key];iteratee(value,key,obj)&&(result[key]=value)}return result},_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee))iteratee=_.negate(iteratee);else{var keys=_.map(flatten(arguments,!1,!1,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)},_.defaults=createAssigner(_.allKeys,!0),_.create=function(prototype,props){var result=baseCreate(prototype);return props&&_.extendOwn(result,props),result},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj},_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(null==object)return!length;for(var obj=Object(object),i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return!1}return!0};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!==toString.call(b))return!1;switch(className){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays="[object Array]"===className;if(!areArrays){if("object"!=typeof a||"object"!=typeof b)return!1;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1}aStack=aStack||[],bStack=bStack||[];for(var length=aStack.length;length--;)if(aStack[length]===a)return bStack[length]===b;if(aStack.push(a),bStack.push(b),areArrays){if(length=a.length,length!==b.length)return!1;for(;length--;)if(!eq(a[length],b[length],aStack,bStack))return!1}else{var key,keys=_.keys(a);if(length=keys.length,_.keys(b).length!==length)return!1;for(;length--;)if(key=keys[length],!_.has(b,key)||!eq(a[key],b[key],aStack,bStack))return!1}return aStack.pop(),bStack.pop(),!0};_.isEqual=function(a,b){return eq(a,b)},_.isEmpty=function(obj){return null==obj||(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))?0===obj.length:0===_.keys(obj).length)},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"===toString.call(obj)},_.isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj},_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return _.has(obj,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(_.isFunction=function(obj){return"function"==typeof obj||!1}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"===toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return null!=obj&&hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.noop=function(){},_.property=property,_.propertyOf=function(obj){return null==obj?function(){}:function(key){return obj[key]}},_.matcher=_.matches=function(attrs){return attrs=_.extendOwn({},attrs),function(obj){return _.isMatch(obj,attrs)}},_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unescapeMap=_.invert(escapeMap),createEscaper=function(map){var escaper=function(match){return map[match]},source="(?:"+_.keys(map).join("|")+")",testRegexp=RegExp(source),replaceRegexp=RegExp(source,"g");return function(string){return string=null==string?"":""+string,testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap),_.unescape=createEscaper(unescapeMap),_.result=function(object,property,fallback){var value=null==object?void 0:object[property];return void 0===value&&(value=fallback),_.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\u2028|\u2029/g,escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){!settings&&oldSettings&&(settings=oldSettings),settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,escapeChar),index=offset+match.length,escape?source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'":interpolate?source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'":evaluate&&(source+="';\n"+evaluate+"\n__p+='"),match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}var template=function(data){return render.call(this,data,_)},argument=settings.variable||"obj";return template.source="function("+argument+"){\n"+source+"}",template},_.chain=function(obj){var instance=_(obj);return instance._chain=!0,instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result(this,func.apply(_,args))}})},_.mixin(_),_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!==name&&"splice"!==name||0!==obj.length||delete obj[0],result(this,obj)}}),_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}}),_.prototype.value=function(){return this._wrapped},_.prototype.valueOf=_.prototype.toJSON=_.prototype.value,
_.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),function(){function IEConsoleWriter(){}function ConsoleWriter(){}function Logger(name,parent){this._loggers={},this.name=name||"",this._parent=parent||null,parent||(this._enabled=!0,this._level=Level.WARN)}function getWriter(){return writer}function setWriter(w){writer=w}Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound});var root,writer,Level={DEBUG:10,INFO:20,WARN:30,ERROR:40,FATAL:50};IEConsoleWriter.prototype={output:function(log_name,level,messages){if("undefined"!=typeof window.console&&"undefined"!=typeof console.log){log_name&&messages.unshift(log_name+":");var message=messages.join(" ");if(void 0===typeof console.info){var level_name;level_name=level<=Level.DEBUG?"DEBUG":level<=Level.INFO?"INFO":level<=Level.WARN?"WARN":level<=Level.ERROR?"ERROR":"FATAL",console.log("["+level_name+"] "+message)}else level<=Level.DEBUG?(message="[DEBUG] "+message,console.log(message)):level<=Level.INFO?console.info(message):level<=Level.WARN?console.warn(message):console.error(message)}}},ConsoleWriter.prototype={output:function(log_name,level,messages){log_name&&messages.unshift(log_name+":"),level<=Level.DEBUG?(messages.unshift("[DEBUG]"),console.log.apply(console,messages)):level<=Level.INFO?console.info.apply(console,messages):level<=Level.WARN?console.warn.apply(console,messages):console.error.apply(console,messages)}},Logger.prototype={getLogger:function(name){for(var path=name.split("."),root=this,route=this.name?[this.name]:[];path.length;){var entry=path.shift();route.push(entry),entry in root._loggers||(root._loggers[entry]=new Logger(route.join("."),root)),root=root._loggers[entry]}return root},_getFlag:function(flag){var context=this;for(flag="_"+flag;null!==context;){if(void 0!==context[flag])return context[flag];context=context._parent}return null},setEnabled:function(state){this._enabled=!!state},isEnabled:function(){this._getFlag("enabled")},setLevel:function(level){"number"==typeof level?this._level=level:"string"==typeof level&&(level=level.toUpperCase(),level in Level&&(this._level=Level[level]))},getLevel:function(){return this._getFlag("level")},log:function(level,messages){!messages.length||!this._getFlag("enabled")||level<this._getFlag("level")||(messages=Array.prototype.slice.call(messages),writer.output(this.name,level,messages))},debug:function(){this.log(Level.DEBUG,arguments)},info:function(){this.log(Level.INFO,arguments)},warn:function(){this.log(Level.WARN,arguments)},error:function(){this.log(Level.ERROR,arguments)},fatal:function(){this.log(Level.FATAL,arguments)}},setWriter(window.console&&window.console.log&&"function"==typeof window.console.log.apply?new ConsoleWriter:new IEConsoleWriter),root=new Logger;for(var match,logconfig=/loglevel(|-[^=]+)=([^&]+)/g;null!==(match=logconfig.exec(window.location.search));){var logger=""===match[1]?root:root.getLogger(match[1].slice(1));logger.setLevel(match[2].toUpperCase())}var api={Level:Level,getLogger:root.getLogger.bind(root),setEnabled:root.setEnabled.bind(root),isEnabled:root.isEnabled.bind(root),setLevel:root.setLevel.bind(root),getLevel:root.getLevel.bind(root),debug:root.debug.bind(root),info:root.info.bind(root),warn:root.warn.bind(root),error:root.error.bind(root),fatal:root.fatal.bind(root),getWriter:getWriter,setWriter:setWriter};"function"==typeof define?define("logging",[],function(){return api}):window.logging=api}(),define("pat-logger",["logging"],function(logging){var log=logging.getLogger("patterns");return log}),function(factory){"function"==typeof define&&define.amd?define("jquery.browser",["jquery"],function($){return factory($)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=factory(require("jquery")):factory(window.jQuery)}(function(jQuery){"use strict";function uaMatch(ua){void 0===ua&&(ua=window.navigator.userAgent),ua=ua.toLowerCase();var match=/(edge)\/([\w.]+)/.exec(ua)||/(opr)[\/]([\w.]+)/.exec(ua)||/(chrome)[ \/]([\w.]+)/.exec(ua)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[],platform_match=/(ipad)/.exec(ua)||/(ipod)/.exec(ua)||/(iphone)/.exec(ua)||/(kindle)/.exec(ua)||/(silk)/.exec(ua)||/(android)/.exec(ua)||/(windows phone)/.exec(ua)||/(win)/.exec(ua)||/(mac)/.exec(ua)||/(linux)/.exec(ua)||/(cros)/.exec(ua)||/(playbook)/.exec(ua)||/(bb)/.exec(ua)||/(blackberry)/.exec(ua)||[],browser={},matched={browser:match[5]||match[3]||match[1]||"",version:match[2]||match[4]||"0",versionNumber:match[4]||match[2]||"0",platform:platform_match[0]||""};if(matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version,browser.versionNumber=parseInt(matched.versionNumber,10)),matched.platform&&(browser[matched.platform]=!0),(browser.android||browser.bb||browser.blackberry||browser.ipad||browser.iphone||browser.ipod||browser.kindle||browser.playbook||browser.silk||browser["windows phone"])&&(browser.mobile=!0),(browser.cros||browser.mac||browser.linux||browser.win)&&(browser.desktop=!0),(browser.chrome||browser.opr||browser.safari)&&(browser.webkit=!0),browser.rv||browser.edge){var ie="msie";matched.browser=ie,browser[ie]=!0}if(browser.safari&&browser.blackberry){var blackberry="blackberry";matched.browser=blackberry,browser[blackberry]=!0}if(browser.safari&&browser.playbook){var playbook="playbook";matched.browser=playbook,browser[playbook]=!0}if(browser.bb){var bb="blackberry";matched.browser=bb,browser[bb]=!0}if(browser.opr){var opera="opera";matched.browser=opera,browser[opera]=!0}if(browser.safari&&browser.android){var android="android";matched.browser=android,browser[android]=!0}if(browser.safari&&browser.kindle){var kindle="kindle";matched.browser=kindle,browser[kindle]=!0}if(browser.safari&&browser.silk){var silk="silk";matched.browser=silk,browser[silk]=!0}return browser.name=matched.browser,browser.platform=matched.platform,browser}return window.jQBrowser=uaMatch(window.navigator.userAgent),window.jQBrowser.uaMatch=uaMatch,jQuery&&(jQuery.browser=window.jQBrowser),window.jQBrowser}),define("pat-utils",["jquery","jquery.browser","underscore"],function($){function debounce(func,wait){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,func.apply(context,args)};clearTimeout(timeout),timeout=setTimeout(later,wait)}}function isObject(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj}function extend(obj){if(!isObject(obj))return obj;for(var source,prop,i=1,length=arguments.length;i<length;i++){source=arguments[i];for(prop in source)hasOwnProperty.call(source,prop)&&(obj[prop]=source[prop])}return obj}function rebaseURL(base,url){return url.indexOf("://")!==-1||"/"===url[0]?url:base.slice(0,base.lastIndexOf("/")+1)+url}function findLabel(input){for(var $label,label=input.parentNode;label&&11!==label.nodeType;label=label.parentNode)if("LABEL"===label.tagName)return label;return input.id&&($label=$('label[for="'+input.id+'"]')),$label&&0===$label.length&&input.form&&($label=$('label[for="'+input.name+'"]',input.form)),$label&&$label.length?$label[0]:null}function elementInViewport(el){var rect=el.getBoundingClientRect(),docEl=document.documentElement,vWidth=window.innerWidth||docEl.clientWidth,vHeight=window.innerHeight||docEl.clientHeight;return!(rect.right<0||rect.bottom<0||rect.left>vWidth||rect.top>vHeight)}function escapeRegExp(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function removeWildcardClass($targets,classes){if(classes.indexOf("*")===-1)$targets.removeClass(classes);else{var matcher=classes.replace(/[\-\[\]{}()+?.,\\\^$|#\s]/g,"\\$&");matcher=matcher.replace(/[*]/g,".*"),matcher=new RegExp("^"+matcher+"$"),$targets.filter("[class]").each(function(){for(var $this=$(this),classes=$this.attr("class").split(/\s+/),ok=[],i=0;i<classes.length;i++)matcher.test(classes[i])||ok.push(classes[i]);ok.length?$this.attr("class",ok.join(" ")):$this.removeAttr("class")})}}function hideOrShow($slave,visible,options,pattern_name){var duration="css"===options.transition||"none"===options.transition?null:options.effect.duration;$slave.removeClass("visible hidden in-progress");var onComplete=function(){$slave.removeClass("in-progress").addClass(visible?"visible":"hidden").trigger("pat-update",{pattern:pattern_name,transition:"complete"})};if(duration){var t=transitions[options.transition];$slave.addClass("in-progress").trigger("pat-update",{pattern:pattern_name,transition:"start"}),$slave[visible?t.show:t.hide]({duration:duration,easing:options.effect.easing,complete:onComplete})}else"css"!==options.transition&&$slave[visible?"show":"hide"](),onComplete()}function addURLQueryParameter(fullURL,param,value){var val=new RegExp("(\\?|\\&)"+param+"=.*?(?=(&|$))"),parts=fullURL.toString().split("#"),url=parts[0],hash=parts[1],qstring=/\?.+$/,newURL=url;return newURL=val.test(url)?url.replace(val,"$1"+param+"="+value):qstring.test(url)?url+"&"+param+"="+value:url+"?"+param+"="+value,hash&&(newURL+="#"+hash),newURL}function removeDuplicateObjects(objs){var comparator=function(v,k){return this[k]===v};return _.reduce(objs,function(list,next_obj){var is_duplicate=!1;return _.each(list,function(obj){is_duplicate=_.keys(obj).length===_.keys(next_obj).length&&!_.chain(obj).omit(comparator.bind(next_obj)).keys().value().length}),is_duplicate||list.push(next_obj),list},[])}function mergeStack(stack,length){for(var results=[],i=0;i<length;i++)results.push({});return _.each(stack,function(frame){for(var frame_length=frame.length-1,x=0;x<length;x++)results[x]=$.extend(results[x]||{},frame[x>frame_length?frame_length:x])}),results}$.fn.safeClone=function(){var $clone=this.clone();return void 0!==$.browser.msie&&$clone.findInclusive(":input[placeholder]").each(function(i,item){var $item=$(item);$item.attr("placeholder")===$item.val()&&$item.val("")}),$clone},Array.prototype.forEach||(Array.prototype.forEach=function(callback,thisArg){var T,k;if(null===this)throw new TypeError(" this is null or not defined");var O=Object(this),len=O.length>>>0;if("function"!=typeof callback)throw new TypeError(callback+" is not a function");for(arguments.length>1&&(T=thisArg),k=0;k<len;){var kValue;k in O&&(kValue=O[k],callback.call(T,kValue,k,O)),k++}});var singleBoundJQueryPlugin=function(pattern,method,options){var $this=this;return $this.each(function(){var pat,$el=$(this);if(pat=pattern.init($el,options),method){if(void 0===pat[method])return $.error("Method "+method+" does not exist on jQuery."+pattern.name),!1;if("_"===method.charAt(0))return $.error("Method "+method+" is private on jQuery."+pattern.name),!1;pat[method].apply(pat,[options])}}),$this},pluralBoundJQueryPlugin=function(pattern,method,options){var $this=this;if(method){if(pattern[method])return pattern[method].apply($this,[$this].concat([options]));$.error("Method "+method+" does not exist on jQuery."+pattern.name)}else pattern.init.apply($this,[$this].concat([options]));return $this},jqueryPlugin=function(pattern){return function(method,options){var $this=this;return 0===$this.length?$this:("object"==typeof method&&(options=method,method=void 0),"function"==typeof pattern?singleBoundJQueryPlugin.call(this,pattern,method,options):pluralBoundJQueryPlugin.call(this,pattern,method,options))}},transitions={none:{hide:"hide",show:"show"},fade:{hide:"fadeOut",show:"fadeIn"},slide:{hide:"slideUp",show:"slideDown"}};isElementInViewport=function(el,partial,offset){if(el===[])return!1;el instanceof $&&(el=el[0]);var rec=el.getBoundingClientRect(),rec_values=[rec.top,rec.bottom,rec.left,rec.right];return!_.every(rec_values,function(v){if(0===v)return!0})&&(partial?(void 0===offset&&(offset=0),rec.top<=0+offset&&rec.bottom>=0+offset):rec.top>=0&&rec.left>=0&&rec.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rec.right<=(window.innerWidth||document.documentElement.clientWidth))};var utils={jqueryPlugin:jqueryPlugin,debounce:debounce,escapeRegExp:escapeRegExp,isObject:isObject,extend:extend,rebaseURL:rebaseURL,findLabel:findLabel,elementInViewport:elementInViewport,removeWildcardClass:removeWildcardClass,hideOrShow:hideOrShow,addURLQueryParameter:addURLQueryParameter,removeDuplicateObjects:removeDuplicateObjects,mergeStack:mergeStack,isElementInViewport:isElementInViewport};return utils}),define("pat-compat",[],function(){Array.prototype.every||(Array.prototype.every=function(fun){"use strict";if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var thisp=arguments[1],i=0;i<len;i++)if(i in t&&!fun.call(thisp,t[i],i,t))return!1;return!0}),Array.prototype.filter||(Array.prototype.filter=function(fun){"use strict";if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var res=[],thisp=arguments[1],i=0;i<len;i++)if(i in t){var val=t[i];fun.call(thisp,val,i,t)&&res.push(val)}return res}),Array.prototype.forEach||(Array.prototype.forEach=function(callback,thisArg){var T,k;if(null===this)throw new TypeError(" this is null or not defined");var O=Object(this),len=O.length>>>0;if("[object Function]"!=={}.toString.call(callback))throw new TypeError(callback+" is not a function");for(thisArg&&(T=thisArg),k=0;k<len;){var kValue;k in O&&(kValue=O[k],callback.call(T,kValue,k,O)),k++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(searchElement){"use strict";if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=0;if(arguments.length>0&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n)))),n>=len)return-1;for(var k=n>=0?n:Math.max(len-Math.abs(n),0);k<len;k++)if(k in t&&t[k]===searchElement)return k;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(searchElement){"use strict";if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if(0===len)return-1;var n=len;arguments.length>1&&(n=Number(arguments[1]),n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n))));for(var k=n>=0?Math.min(n,len-1):len-Math.abs(n);k>=0;k--)if(k in t&&t[k]===searchElement)return k;return-1}),Array.prototype.map||(Array.prototype.map=function(callback,thisArg){var T,A,k;if(null===this)throw new TypeError(" this is null or not defined");var O=Object(this),len=O.length>>>0;if("[object Function]"!=={}.toString.call(callback))throw new TypeError(callback+" is not a function");for(thisArg&&(T=thisArg),A=new Array(len),k=0;k<len;){var kValue,mappedValue;k in O&&(kValue=O[k],mappedValue=callback.call(T,kValue,k,O),A[k]=mappedValue),k++}return A}),Array.prototype.reduce||(Array.prototype.reduce=function(accumulator){if(null===this||void 0===this)throw new TypeError("Object is null or undefined");var curr,i=0,l=this.length>>0;if("function"!=typeof accumulator)throw new TypeError("First argument is not callable");if(arguments.length<2){if(0===l)throw new TypeError("Array length is 0 and no second argument");curr=this[0],i=1}else curr=arguments[1];for(;i<l;)i in this&&(curr=accumulator.call(void 0,curr,this[i],i,this)),++i;return curr}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(callbackfn){"use strict";if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof callbackfn)throw new TypeError;if(0===len&&1===arguments.length)throw new TypeError;var accumulator,k=len-1;if(arguments.length>=2)accumulator=arguments[1];else for(;;){if(k in this){accumulator=this[k--];break}if(--k<0)throw new TypeError}for(;k>=0;)k in t&&(accumulator=callbackfn.call(void 0,accumulator,t[k],k,t)),k--;return accumulator}),Array.prototype.some||(Array.prototype.some=function(fun){"use strict";if(null===this)throw new TypeError;var t=Object(this),len=t.length>>>0;if("function"!=typeof fun)throw new TypeError;for(var thisp=arguments[1],i=0;i<len;i++)if(i in t&&fun.call(thisp,t[i],i,t))return!0;return!1}),Array.isArray||(Array.isArray=function(arg){return"[object Array]"===Object.prototype.toString.call(arg)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&oThis?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound}),Object.keys||(Object.keys=function(){var _hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if("object"!=typeof obj&&"function"!=typeof obj||null===obj)throw new TypeError("Object.keys called on non-object");var result=[];for(var prop in obj)_hasOwnProperty.call(obj,prop)&&result.push(prop);if(hasDontEnumBug)for(var i=0;i<dontEnumsLength;i++)_hasOwnProperty.call(obj,dontEnums[i])&&result.push(dontEnums[i]);return result}}())}),define("pat-jquery-ext",["jquery"],function($){var methods={init:function(options){var settings={time:3,initialTime:8,exceptionAreas:[]};return this.each(function(){var $this=$(this),data=$this.data("timeout");data||(options&&$.extend(settings,options),$this.data("timeout",{lastEvent:new Date,trueTime:settings.time,time:settings.initialTime,untouched:!0,inExceptionArea:!1}),$this.bind("mouseover.timeout",methods.mouseMoved),$this.bind("mouseenter.timeout",methods.mouseMoved),$(settings.exceptionAreas).each(function(){$this.find(this).live("mouseover.timeout",{parent:$this},methods.enteredException).live("mouseleave.timeout",{parent:$this},methods.leftException)}),settings.initialTime>0?$this.timeout("startTimer"):$this.addClass("timeout"))})},enteredException:function(event){var data=event.data.parent.data("timeout");data.inExceptionArea=!0,event.data.parent.data("timeout",data),event.data.parent.trigger("mouseover")},leftException:function(event){var data=event.data.parent.data("timeout");data.inExceptionArea=!1,event.data.parent.data("timeout",data)},destroy:function(){return this.each(function(){var $this=$(this),data=$this.data("timeout");$(window).unbind(".timeout"),data.timeout.remove(),$this.removeData("timeout")})},mouseMoved:function(){var $this=$(this),data=$this.data("timeout");$this.hasClass("timeout")?($this.removeClass("timeout"),$this.timeout("startTimer")):data.untouched&&(data.untouched=!1,data.time=data.trueTime),data.lastEvent=new Date,$this.data("timeout",data)},startTimer:function(){var $this=$(this),data=$this.data("timeout"),fn=function(){var data=$this.data("timeout");if(data&&data.lastEvent)if(data.inExceptionArea)setTimeout(fn,Math.floor(1e3*data.time));else{var now=new Date,diff=Math.floor(1e3*data.time)-(now-data.lastEvent);diff>0?setTimeout(fn,diff+100):$this.addClass("timeout")}};setTimeout(fn,Math.floor(1e3*data.time))}};$.fn.timeout=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.timeout"):methods.init.apply(this,arguments)},$.extend($.expr[":"],{scrollable:function(element){var vertically_scrollable,horizontally_scrollable;return"scroll"===$(element).css("overflow")||"scroll"===$(element).css("overflowX")||"scroll"===$(element).css("overflowY")||((vertically_scrollable=element.clientHeight<element.scrollHeight&&($.inArray($(element).css("overflowY"),["scroll","auto"])!==-1||$.inArray($(element).css("overflow"),["scroll","auto"])!==-1))||(horizontally_scrollable=element.clientWidth<element.scrollWidth&&($.inArray($(element).css("overflowX"),["scroll","auto"])!==-1||$.inArray($(element).css("overflow"),["scroll","auto"])!==-1)))}}),$.fn.makeVisibleInScroll=function(parent_id){var absoluteParent=null;return"string"==typeof parent_id?absoluteParent=$("#"+parent_id):parent_id&&(absoluteParent=$(parent_id)),this.each(function(){var parent,$this=$(this);absoluteParent?parent=absoluteParent:(parent=$this.parents(":scrollable"),parent=$(parent.length>0?parent[0]:window));var elemTop=$this.position().top,elemBottom=$this.height()+elemTop,viewTop=parent.scrollTop(),viewBottom=parent.height()+viewTop;elemTop<viewTop?parent.scrollTop(elemTop):elemBottom>viewBottom-parent.height()/2&&parent.scrollTop(elemTop-(parent.height()-$this.height())/2)})},$.fn.setPositionAbsolute=function(element,offsettop,offsetleft){return this.each(function(){var $this=$(this),thiswidth=$(this).width(),pos=element.offset(),width=element.width(),height=element.height(),setleft=pos.left+width-thiswidth+offsetleft,settop=pos.top+height+offsettop;$this.css({"z-index":1,position:"absolute",marginLeft:0,marginTop:0,left:setleft+"px",top:settop+"px",width:thiswidth}),$this.remove().appendTo("body").show()})},$.fn.positionAncestor=function(selector){var left=0,top=0;return this.each(function(){var $ancestor=$(this).closest(selector);if($ancestor.length&&"static"!==$ancestor.css("position")){var $child=$(this),childMarginEdgeLeft=$child.offset().left-parseInt($child.css("marginLeft"),10),childMarginEdgeTop=$child.offset().top-parseInt($child.css("marginTop"),10),ancestorPaddingEdgeLeft=$ancestor.offset().left+parseInt($ancestor.css("borderLeftWidth"),10),ancestorPaddingEdgeTop=$ancestor.offset().top+parseInt($ancestor.css("borderTopWidth"),10);return left=childMarginEdgeLeft-ancestorPaddingEdgeLeft,top=childMarginEdgeTop-ancestorPaddingEdgeTop,!1}}),{left:left,top:top}},String.prototype.startsWith=function(str){return null!==this.match("^"+str)},String.prototype.endsWith=function(str){return null!==this.match(str+"$")},$.simplePlaceholder={placeholder_class:null,hide_placeholder:function(){var $this=$(this);$this.val()===$this.attr("placeholder")&&$this.val("").removeClass($.simplePlaceholder.placeholder_class)},show_placeholder:function(){var $this=$(this);""===$this.val()&&$this.val($this.attr("placeholder")).addClass($.simplePlaceholder.placeholder_class)},prevent_placeholder_submit:function(){return $(this).find(".simple-placeholder").each(function(){var $this=$(this);$this.val()===$this.attr("placeholder")&&$this.val("")}),!0}},$.fn.simplePlaceholder=function(options){if(void 0===document.createElement("input").placeholder){var config={placeholder_class:"placeholding"};options&&$.extend(config,options),$.simplePlaceholder.placeholder_class=config.placeholder_class,this.each(function(){var $this=$(this);$this.focus($.simplePlaceholder.hide_placeholder),$this.blur($.simplePlaceholder.show_placeholder),""===$this.val()&&($this.val($this.attr("placeholder")),$this.addClass($.simplePlaceholder.placeholder_class)),$this.addClass("simple-placeholder"),$(this.form).submit($.simplePlaceholder.prevent_placeholder_submit)})}return this},$.fn.findInclusive=function(selector){return this.find("*").addBack().filter(selector)},$.fn.slideIn=function(speed,easing,callback){return this.animate({width:"show"},speed,easing,callback)},$.fn.slideOut=function(speed,easing,callback){return this.animate({width:"hide"},speed,easing,callback)},$.expr[":"].Contains=function(a,i,m){return $(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0},$.fn.scopedFind=function(selector){return selector.startsWith("#")?$(selector):this.find(selector)}}),define("pat-registry",["jquery","underscore","pat-logger","pat-utils","pat-compat","pat-jquery-ext"],function($,_,logger,utils){for(var match,log=logger.getLogger("registry"),disable_re=/patterns-disable=([^&]+)/g,dont_catch_re=/patterns-dont-catch/g,dont_catch=!1,disabled={};null!==(match=disable_re.exec(window.location.search));)disabled[match[1]]=!0,log.info("Pattern disabled via url config:",match[1]);for(;null!==(match=dont_catch_re.exec(window.location.search));)dont_catch=!0,log.info("I will not catch init exceptions");var registry={patterns:{},initialized:!1,init:function(){$(document).ready(function(){log.info("loaded: "+Object.keys(registry.patterns).sort().join(", ")),registry.scan(document.body),registry.initialized=!0,log.info("finished initial scan.")})},clear:function(){this.patterns={}},transformPattern:function(name,content){if(disabled[name])return void log.debug("Skipping disabled pattern:",name);var pattern=registry.patterns[name];if(pattern.transform)try{pattern.transform($(content))}catch(e){if(dont_catch)throw e;log.error("Transform error for pattern"+name,e)}},initPattern:function(name,el,trigger){var $el=$(el),pattern=registry.patterns[name];if(pattern.init&&(plog=logger.getLogger("pat."+name),$el.is(pattern.trigger))){plog.debug("Initialising:",$el);try{pattern.init($el,null,trigger),plog.debug("done.")}catch(e){if(dont_catch)throw e;plog.error("Caught error:",e)}}},orderPatterns:function(patterns){return _.contains(patterns,"validation")&&_.contains(patterns,"inject")&&(patterns.splice(patterns.indexOf("validation"),1),patterns.unshift("validation")),patterns},scan:function(content,patterns,trigger){var $match,selectors=[];patterns=this.orderPatterns(patterns||Object.keys(registry.patterns)),patterns.forEach(_.partial(this.transformPattern,_,content)),patterns=_.each(patterns,function(name){var pattern=registry.patterns[name];pattern.trigger&&selectors.unshift(pattern.trigger)}),$match=$(content).findInclusive(selectors.join(",")),$match=$match.filter(function(){return 0===$(this).parents("pre").length}),$match=$match.filter(":not(.cant-touch-this)"),$match.toArray().reduceRight(function(acc,el){patterns.forEach(_.partial(this.initPattern,_,el,trigger))}.bind(this),null),$("body").addClass("patterns-loaded")},register:function(pattern,name){var plugin_name;return(name=name||pattern.name)?registry.patterns[name]?(log.error("Already have a pattern called: "+name),!1):(registry.patterns[name]=pattern,pattern.jquery_plugin&&(plugin_name=("pat-"+name).replace(/-([a-zA-Z])/g,function(match,p1){return p1.toUpperCase()}),$.fn[plugin_name]=utils.jqueryPlugin(pattern),$.fn[plugin_name.replace(/^pat/,"pattern")]=$.fn[plugin_name]),log.debug("Registered pattern:",name,pattern),registry.initialized&&registry.scan(document.body,[name]),!0):(log.error("Pattern lacks a name:",pattern),!1)}};return registry}),define("pat-mockup-parser",["jquery"],function($){"use strict";var parser={getOptions:function getOptions($el,patternName,options){options=options||{},0===$el.length||$.nodeName($el[0],"body")||(options=getOptions($el.parent(),patternName,options));var elOptions={};if(0!==$el.length&&(elOptions=$el.data("pat-"+patternName),elOptions&&"string"==typeof elOptions)){var tmpOptions={};$.each(elOptions.split(";"),function(i,item){item=item.split(":"),item.reverse();var key=item.pop();key=key.replace(/^\s+|\s+$/g,""),item.reverse();var value=item.join(":");value=value.replace(/^\s+|\s+$/g,""),tmpOptions[key]=value}),elOptions=tmpOptions}return $.extend(!0,{},options,elOptions)}};return parser}),define("pat-base",["jquery","pat-registry","pat-mockup-parser","pat-logger"],function($,Registry,mockupParser,logger){"use strict";var log=logger.getLogger("Patternslib Base"),initBasePattern=function($el,options,trigger){var name=this.prototype.name,log=logger.getLogger("pat."+name),pattern=$el.data("pattern-"+name);if(void 0===pattern&&Registry.patterns[name]){try{options="mockup"===this.prototype.parser?mockupParser.getOptions($el,name,options):options,pattern=new Registry.patterns[name]($el,options,trigger)}catch(e){log.error("Failed while initializing '"+name+"' pattern.",e)}$el.data("pattern-"+name,pattern)}return pattern},Base=function($el,options,trigger){this.$el=$el,this.options=$.extend(!0,{},this.defaults||{},options||{}),this.init($el,options,trigger),this.emit("init")};return Base.prototype={constructor:Base,on:function(eventName,eventCallback){this.$el.on(eventName+"."+this.name+".patterns",eventCallback)},emit:function(eventName,args){void 0===args&&(args=[]),this.$el.trigger(eventName+"."+this.name+".patterns",args)}},Base.extend=function(patternProps){var child,parent=this;if(!patternProps)throw new Error("Pattern configuration properties required when calling Base.extend");child=patternProps.hasOwnProperty("constructor")?patternProps.constructor:function(){parent.apply(this,arguments)},child.extend=Base.extend,child.init=initBasePattern,child.jquery_plugin=!0,child.trigger=patternProps.trigger;var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,$.extend(!0,child.prototype,patternProps),child.__super__=parent.prototype,patternProps.name?patternProps.trigger?Registry.register(child,patternProps.name):log.warn("The pattern '"+patternProps.name+"' does not have a trigger attribute, it will not be registered."):log.warn("This pattern without a name attribute will not be registered!"),child},Base}),define("mockup-utils",["jquery"],function($){"use strict";var QueryHelper=function(options){var self=this,defaults={pattern:null,vocabularyUrl:null,searchParam:"SearchableText",attributes:["UID","Title","Description","getURL","portal_type"],batchSize:10,baseCriteria:[],sort_on:"is_folderish",sort_order:"reverse",pathDepth:1};return self.options=$.extend({},defaults,options),self.pattern=self.options.pattern,void 0!==self.pattern&&null!==self.pattern||(self.pattern={browsing:!1,basePath:"/"}),self.options.url&&!self.options.vocabularyUrl?self.options.vocabularyUrl=self.options.url:self.pattern.vocabularyUrl&&(self.options.vocabularyUrl=self.pattern.vocabularyUrl),void 0!==self.options.vocabularyUrl&&null!==self.options.vocabularyUrl?self.valid=!0:self.valid=!1,self.getCurrentPath=function(){var currentPath,pattern=self.pattern;currentPath=self.currentPath?self.currentPath:pattern.currentPath,"function"==typeof currentPath&&(currentPath=currentPath());var path=currentPath;return path||(path=pattern.basePath?pattern.basePath:pattern.options.basePath?pattern.options.basePath:"/"),path},self.getCriterias=function(term,options){void 0===options&&(options={}),options=$.extend({},{useBaseCriteria:!0,additionalCriterias:[]},options);var criterias=[];return options.useBaseCriteria&&(criterias=self.options.baseCriteria.slice(0)),term&&(term+="*",criterias.push({i:self.options.searchParam,o:"plone.app.querystring.operation.string.contains",v:term})),options.searchPath?criterias.push({i:"path",o:"plone.app.querystring.operation.string.path",v:options.searchPath+"::"+self.options.pathDepth}):self.pattern.browsing&&criterias.push({i:"path",o:"plone.app.querystring.operation.string.path",v:self.getCurrentPath()+"::"+self.options.pathDepth}),criterias=criterias.concat(options.additionalCriterias)},self.getBatch=function(page){return page||(page=1),{page:page,size:self.options.batchSize}},self.selectAjax=function(){return{url:self.options.vocabularyUrl,dataType:"JSON",quietMillis:100,data:function(term,page){return self.getQueryData(term,page)},results:function(data,page){var more=10*page<data.total;return{results:data.results,more:more}}}},self.getUrl=function(){
var url=self.options.vocabularyUrl;return url+=url.indexOf("?")===-1?"?":"&",url+$.param(self.getQueryData())},self.getQueryData=function(term,page){var data={query:JSON.stringify({criteria:self.getCriterias(term),sort_on:self.options.sort_on,sort_order:self.options.sort_order}),attributes:JSON.stringify(self.options.attributes)};return page&&(data.batch=JSON.stringify(self.getBatch(page))),data},self.search=function(term,operation,value,callback,useBaseCriteria,type){void 0===useBaseCriteria&&(useBaseCriteria=!0),void 0===type&&(type="GET");var criteria=[];useBaseCriteria&&(criteria=self.options.baseCriteria.slice(0)),criteria.push({i:term,o:operation,v:value});var data={query:JSON.stringify({criteria:criteria}),attributes:JSON.stringify(self.options.attributes)};$.ajax({url:self.options.vocabularyUrl,dataType:"JSON",data:data,type:type,success:callback})},self},Loading=function(options){var self=this;self.className="plone-loader";var defaults={backdrop:null,zIndex:10005};return options||(options={}),self.options=$.extend({},defaults,options),self.init=function(){self.$el=$("."+self.className),0===self.$el.length&&(self.$el=$("<div><div></div></div>"),self.$el.addClass(self.className).hide().appendTo("body"))},self.show=function(closable){self.init(),self.$el.show();var zIndex=self.options.zIndex;"function"==typeof zIndex?zIndex=Math.max(zIndex(),10005):(zIndex=10005,$(".plone-modal-wrapper,.plone-modal-backdrop").each(function(){zIndex=Math.max(zIndex,$(this).css("zIndex")||10005)}),zIndex+=1),self.$el.css("zIndex",zIndex),void 0===closable&&(closable=!0),self.options.backdrop&&(self.options.backdrop.closeOnClick=closable,self.options.backdrop.closeOnEsc=closable,self.options.backdrop.init(),self.options.backdrop.show())},self.hide=function(){self.init(),self.$el.hide()},self},generateId=function(prefix){return void 0===prefix&&(prefix="id"),prefix+Math.floor(65536*(1+Math.random())).toString(16).substring(1)},getWindow=function(){var win=window;return win.parent!==window&&(win=win.parent),win};return{generateId:generateId,parseBodyTag:function(txt){return $(/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(txt)[0].replace("<body","<div").replace("</body>","</div>")).eq(0).html()},setId:function($el,prefix){void 0===prefix&&(prefix="id");var id=$el.attr("id");return id=void 0===id?generateId(prefix):id.replace(/\./g,"-"),$el.attr("id",id),id},bool:function(val){return"string"==typeof val&&(val=$.trim(val).toLowerCase()),["true",!0,1].indexOf(val)!==-1},QueryHelper:QueryHelper,Loading:Loading,loading:new Loading,getAuthenticator:function(){var $el=$('input[name="_authenticator"]');return 0===$el.length?($el=$('a[href*="_authenticator"]'),$el.length>0?$el.attr("href").split("_authenticator=")[1]:""):$el.val()},getWindow:getWindow,featureSupport:{dragAndDrop:function(){return"draggable"in document.createElement("span")},fileApi:function(){return"undefined"!=typeof FileReader},history:function(){return!(!window.history||!window.history.pushState)}},escapeHTML:function(val){return $("<div/>").text(val).html()}}}),function(root){define("select2",["jquery"],function(){return function(){!function($){"undefined"==typeof $.fn.each2&&$.extend($.fn,{each2:function(c){for(var j=$([0]),i=-1,l=this.length;++i<l&&(j.context=j[0]=this[i])&&c.call(j[0],i,j)!==!1;);return this}})}(jQuery),function($,undefined){"use strict";function reinsertElement(element){var placeholder=$(document.createTextNode(""));element.before(placeholder),placeholder.before(element),placeholder.remove()}function stripDiacritics(str){function match(a){return DIACRITICS[a]||a}return str.replace(/[^\u0000-\u007E]/g,match)}function indexOf(value,array){for(var i=0,l=array.length;i<l;i+=1)if(equal(value,array[i]))return i;return-1}function measureScrollbar(){var $template=$(MEASURE_SCROLLBAR_TEMPLATE);$template.appendTo(document.body);var dim={width:$template.width()-$template[0].clientWidth,height:$template.height()-$template[0].clientHeight};return $template.remove(),dim}function equal(a,b){return a===b||a!==undefined&&b!==undefined&&(null!==a&&null!==b&&(a.constructor===String?a+""==b+"":b.constructor===String&&b+""==a+""))}function splitVal(string,separator,transform){var val,i,l;if(null===string||string.length<1)return[];for(val=string.split(separator),i=0,l=val.length;i<l;i+=1)val[i]=transform(val[i]);return val}function getSideBorderPadding(element){return element.outerWidth(!1)-element.width()}function installKeyUpChangeEvent(element){var key="keyup-change-value";element.on("keydown",function(){$.data(element,key)===undefined&&$.data(element,key,element.val())}),element.on("keyup",function(){var val=$.data(element,key);val!==undefined&&element.val()!==val&&($.removeData(element,key),element.trigger("keyup-change"))})}function installFilteredMouseMove(element){element.on("mousemove",function(e){var lastpos=lastMousePosition;lastpos!==undefined&&lastpos.x===e.pageX&&lastpos.y===e.pageY||$(e.target).trigger("mousemove-filtered",e)})}function debounce(quietMillis,fn,ctx){ctx=ctx||undefined;var timeout;return function(){var args=arguments;window.clearTimeout(timeout),timeout=window.setTimeout(function(){fn.apply(ctx,args)},quietMillis)}}function installDebouncedScroll(threshold,element){var notify=debounce(threshold,function(e){element.trigger("scroll-debounced",e)});element.on("scroll",function(e){indexOf(e.target,element.get())>=0&&notify(e)})}function focus($el){$el[0]!==document.activeElement&&window.setTimeout(function(){var range,el=$el[0],pos=$el.val().length;$el.focus();var isVisible=el.offsetWidth>0||el.offsetHeight>0;isVisible&&el===document.activeElement&&(el.setSelectionRange?el.setSelectionRange(pos,pos):el.createTextRange&&(range=el.createTextRange(),range.collapse(!1),range.select()))},0)}function getCursorInfo(el){el=$(el)[0];var offset=0,length=0;if("selectionStart"in el)offset=el.selectionStart,length=el.selectionEnd-offset;else if("selection"in document){el.focus();var sel=document.selection.createRange();length=document.selection.createRange().text.length,sel.moveStart("character",-el.value.length),offset=sel.text.length-length}return{offset:offset,length:length}}function killEvent(event){event.preventDefault(),event.stopPropagation()}function killEventImmediately(event){event.preventDefault(),event.stopImmediatePropagation()}function measureTextWidth(e){if(!sizer){var style=e[0].currentStyle||window.getComputedStyle(e[0],null);sizer=$(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:style.fontSize,fontFamily:style.fontFamily,fontStyle:style.fontStyle,fontWeight:style.fontWeight,letterSpacing:style.letterSpacing,textTransform:style.textTransform,whiteSpace:"nowrap"}),sizer.attr("class","select2-sizer"),$(document.body).append(sizer)}return sizer.text(e.val()),sizer.width()}function syncCssClasses(dest,src,adapter){var classes,adapted,replacements=[];classes=$.trim(dest.attr("class")),classes&&(classes=""+classes,$(classes.split(/\s+/)).each2(function(){0===this.indexOf("select2-")&&replacements.push(this)})),classes=$.trim(src.attr("class")),classes&&(classes=""+classes,$(classes.split(/\s+/)).each2(function(){0!==this.indexOf("select2-")&&(adapted=adapter(this),adapted&&replacements.push(adapted))})),dest.attr("class",replacements.join(" "))}function markMatch(text,term,markup,escapeMarkup){var match=stripDiacritics(text.toUpperCase()).indexOf(stripDiacritics(term.toUpperCase())),tl=term.length;return match<0?void markup.push(escapeMarkup(text)):(markup.push(escapeMarkup(text.substring(0,match))),markup.push("<span class='select2-match'>"),markup.push(escapeMarkup(text.substring(match,match+tl))),markup.push("</span>"),void markup.push(escapeMarkup(text.substring(match+tl,text.length))))}function defaultEscapeMarkup(markup){var replace_map={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(markup).replace(/[&<>"'\/\\]/g,function(match){return replace_map[match]})}function ajax(options){var timeout,handler=null,quietMillis=options.quietMillis||100,ajaxUrl=options.url,self=this;return function(query){window.clearTimeout(timeout),timeout=window.setTimeout(function(){var data=options.data,url=ajaxUrl,transport=options.transport||$.fn.select2.ajaxDefaults.transport,deprecated={type:options.type||"GET",cache:options.cache||!1,jsonpCallback:options.jsonpCallback||undefined,dataType:options.dataType||"json"},params=$.extend({},$.fn.select2.ajaxDefaults.params,deprecated);data=data?data.call(self,query.term,query.page,query.context):null,url="function"==typeof url?url.call(self,query.term,query.page,query.context):url,handler&&"function"==typeof handler.abort&&handler.abort(),options.params&&($.isFunction(options.params)?$.extend(params,options.params.call(self)):$.extend(params,options.params)),$.extend(params,{url:url,dataType:options.dataType,data:data,success:function(data){var results=options.results(data,query.page,query);query.callback(results)},error:function(jqXHR,textStatus,errorThrown){var results={hasError:!0,jqXHR:jqXHR,textStatus:textStatus,errorThrown:errorThrown};query.callback(results)}}),handler=transport.call(self,params)},quietMillis)}}function local(options){var dataText,tmp,data=options,text=function(item){return""+item.text};$.isArray(data)&&(tmp=data,data={results:tmp}),$.isFunction(data)===!1&&(tmp=data,data=function(){return tmp});var dataItem=data();return dataItem.text&&(text=dataItem.text,$.isFunction(text)||(dataText=dataItem.text,text=function(item){return item[dataText]})),function(query){var process,t=query.term,filtered={results:[]};return""===t?void query.callback(data()):(process=function(datum,collection){var group,attr;if(datum=datum[0],datum.children){group={};for(attr in datum)datum.hasOwnProperty(attr)&&(group[attr]=datum[attr]);group.children=[],$(datum.children).each2(function(i,childDatum){process(childDatum,group.children)}),(group.children.length||query.matcher(t,text(group),datum))&&collection.push(group)}else query.matcher(t,text(datum),datum)&&collection.push(datum)},$(data().results).each2(function(i,datum){process(datum,filtered.results)}),void query.callback(filtered))}}function tags(data){var isFunc=$.isFunction(data);return function(query){var t=query.term,filtered={results:[]},result=isFunc?data(query):data;$.isArray(result)&&($(result).each(function(){var isObject=this.text!==undefined,text=isObject?this.text:this;(""===t||query.matcher(t,text))&&filtered.results.push(isObject?this:{id:this,text:this})}),query.callback(filtered))}}function checkFormatter(formatter,formatterName){if($.isFunction(formatter))return!0;if(!formatter)return!1;if("string"==typeof formatter)return!0;throw new Error(formatterName+" must be a string, function, or falsy value")}function evaluate(val,context){if($.isFunction(val)){var args=Array.prototype.slice.call(arguments,2);return val.apply(context,args)}return val}function countResults(results){var count=0;return $.each(results,function(i,item){item.children?count+=countResults(item.children):count++}),count}function defaultTokenizer(input,selection,selectCallback,opts){var token,index,i,l,separator,original=input,dupe=!1;if(!opts.createSearchChoice||!opts.tokenSeparators||opts.tokenSeparators.length<1)return undefined;for(;;){for(index=-1,i=0,l=opts.tokenSeparators.length;i<l&&(separator=opts.tokenSeparators[i],index=input.indexOf(separator),!(index>=0));i++);if(index<0)break;if(token=input.substring(0,index),input=input.substring(index+separator.length),token.length>0&&(token=opts.createSearchChoice.call(this,token,selection),token!==undefined&&null!==token&&opts.id(token)!==undefined&&null!==opts.id(token))){for(dupe=!1,i=0,l=selection.length;i<l;i++)if(equal(opts.id(token),opts.id(selection[i]))){dupe=!0;break}dupe||selectCallback(token)}}return original!==input?input:void 0}function cleanupJQueryElements(){var self=this;$.each(arguments,function(i,element){self[element].remove(),self[element]=null})}function clazz(SuperClass,methods){var constructor=function(){};return constructor.prototype=new SuperClass,constructor.prototype.constructor=constructor,constructor.prototype.parent=SuperClass.prototype,constructor.prototype=$.extend(constructor.prototype,methods),constructor}if(window.Select2===undefined){var AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer,$document,scrollBarDimensions,lastMousePosition={x:0,y:0},KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(k){switch(k=k.which?k.which:k){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return!0}return!1},isControl:function(e){var k=e.which;switch(k){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return!0}return!!e.metaKey},isFunctionKey:function(k){return k=k.which?k.which:k,k>=112&&k<=123}},MEASURE_SCROLLBAR_TEMPLATE="<div class='select2-measure-scrollbar'></div>",DIACRITICS={"":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"A","":"AA","":"AE","":"AE","":"AE","":"AO","":"AU","":"AV","":"AV","":"AY","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"B","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"C","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"D","":"DZ","":"DZ","":"Dz","":"Dz","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"E","":"F","":"F","":"F","":"F","":"F","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"G","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"H","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"I","":"J","":"J","":"J","":"J","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"K","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"L","":"LJ","":"Lj","":"M","":"M","":"M","":"M","":"M","":"M","":"M","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"N","":"NJ","":"Nj","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"O","":"OI","":"OO","":"OU","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"P","":"Q","":"Q","":"Q","":"Q","":"Q","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"R","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"S","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"T","":"TZ","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"U","":"V","":"V","":"V","":"V","":"V","":"V","":"V","":"VY","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"W","":"X","":"X","":"X","":"X","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Y","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"Z","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"a","":"aa","":"ae","":"ae","":"ae","":"ao","":"au","":"av","":"av","":"ay","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"b","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"c","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"d","":"dz","":"dz","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"e","":"f","":"f","":"f","":"f","":"f","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"g","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"h","":"hv","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"i","":"j","":"j","":"j","":"j","":"j","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"k","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"l","":"lj","":"m","":"m","":"m","":"m","":"m","":"m","":"m","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"n","":"nj","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"o","":"oi","":"ou","":"oo","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"p","":"q","":"q","":"q","":"q","":"q","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"r","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"s","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"t","":"tz","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"u","":"v","":"v","":"v","":"v","":"v","":"v","":"v","":"vy","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"w","":"x","":"x","":"x","":"x","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"y","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"z","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};$document=$(document),nextUid=function(){var counter=1;return function(){return counter++}}(),AbstractSelect2=clazz(Object,{bind:function(func){var self=this;return function(){func.apply(self,arguments)}},init:function(opts){var results,search,resultsSelector=".select2-results";this.opts=opts=this.prepareOpts(opts),this.id=opts.id,opts.element.data("select2")!==undefined&&null!==opts.element.data("select2")&&opts.element.data("select2").destroy(),this.container=this.createContainer(),this.liveRegion=$(".select2-hidden-accessible"),0==this.liveRegion.length&&(this.liveRegion=$("<span>",{role:"status","aria-live":"polite"}).addClass("select2-hidden-accessible").appendTo(document.body)),this.containerId="s2id_"+(opts.element.attr("id")||"autogen"+nextUid()),this.containerEventName=this.containerId.replace(/([.])/g,"_").replace(/([;&,\-\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.container.attr("title",opts.element.attr("title")),this.body=$(document.body),syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.attr("style",opts.element.attr("style")),this.container.css(evaluate(opts.containerCss,this.opts.element)),this.container.addClass(evaluate(opts.containerCssClass,this.opts.element)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container).on("click.select2",killEvent),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(evaluate(opts.dropdownCssClass,this.opts.element)),this.dropdown.data("select2",this),this.dropdown.on("click",killEvent),this.results=results=this.container.find(resultsSelector),this.search=search=this.container.find("input.select2-input"),this.queryCount=0,this.resultsPage=0,this.context=null,this.initContainer(),this.container.on("click",killEvent),installFilteredMouseMove(this.results),this.dropdown.on("mousemove-filtered",resultsSelector,this.bind(this.highlightUnderEvent)),this.dropdown.on("touchstart touchmove touchend",resultsSelector,this.bind(function(event){this._touchEvent=!0,this.highlightUnderEvent(event)})),this.dropdown.on("touchmove",resultsSelector,this.bind(this.touchMoved)),this.dropdown.on("touchstart touchend",resultsSelector,this.bind(this.clearTouchMoved)),this.dropdown.on("click",this.bind(function(event){this._touchEvent&&(this._touchEvent=!1,this.selectHighlighted())})),installDebouncedScroll(80,this.results),this.dropdown.on("scroll-debounced",resultsSelector,this.bind(this.loadMoreIfNeeded)),$(this.container).on("change",".select2-input",function(e){e.stopPropagation()}),$(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation()}),$.fn.mousewheel&&results.mousewheel(function(e,delta,deltaX,deltaY){var top=results.scrollTop();deltaY>0&&top-deltaY<=0?(results.scrollTop(0),killEvent(e)):deltaY<0&&results.get(0).scrollHeight-results.scrollTop()+deltaY<=results.height()&&(results.scrollTop(results.get(0).scrollHeight-results.height()),killEvent(e))}),installKeyUpChangeEvent(search),search.on("keyup-change input paste",this.bind(this.updateResults)),search.on("focus",function(){search.addClass("select2-focused")}),search.on("blur",function(){search.removeClass("select2-focused")}),this.dropdown.on("mouseup",resultsSelector,this.bind(function(e){$(e.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(e),this.selectHighlighted(e))})),this.dropdown.on("click mouseup mousedown touchstart touchend focusin",function(e){e.stopPropagation()}),this.lastSearchTerm=undefined,$.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==opts.maximumInputLength&&this.search.attr("maxlength",opts.maximumInputLength);var disabled=opts.element.prop("disabled");disabled===undefined&&(disabled=!1),this.enable(!disabled);var readonly=opts.element.prop("readonly");readonly===undefined&&(readonly=!1),this.readonly(readonly),scrollBarDimensions=scrollBarDimensions||measureScrollbar(),this.autofocus=opts.element.prop("autofocus"),opts.element.prop("autofocus",!1),this.autofocus&&this.focus(),this.search.attr("placeholder",opts.searchInputPlaceholder)},destroy:function(){var element=this.opts.element,select2=element.data("select2"),self=this;this.close(),element.length&&element[0].detachEvent&&self._sync&&element.each(function(){self._sync&&this.detachEvent("onpropertychange",self._sync)}),this.propertyObserver&&(this.propertyObserver.disconnect(),this.propertyObserver=null),this._sync=null,select2!==undefined&&(select2.container.remove(),select2.liveRegion.remove(),select2.dropdown.remove(),element.removeData("select2").off(".select2"),element.is("input[type='hidden']")?element.css("display",""):(element.show().prop("autofocus",this.autofocus||!1),this.elementTabIndex?element.attr({tabindex:this.elementTabIndex}):element.removeAttr("tabindex"),element.show())),cleanupJQueryElements.call(this,"container","liveRegion","dropdown","results","search")},optionToData:function(element){return element.is("option")?{id:element.prop("value"),text:element.text(),element:element.get(),css:element.attr("class"),disabled:element.prop("disabled"),locked:equal(element.attr("locked"),"locked")||equal(element.data("locked"),!0)}:element.is("optgroup")?{text:element.attr("label"),children:[],element:element.get(),css:element.attr("class")}:void 0},prepareOpts:function(opts){var element,select,idKey,ajaxUrl,self=this;if(element=opts.element,"select"===element.get(0).tagName.toLowerCase()&&(this.select=select=opts.element),select&&$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in opts)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),opts.debug=opts.debug||$.fn.select2.defaults.debug,opts.debug&&console&&console.warn&&(null!=opts.id&&console.warn("Select2: The `id` option has been removed in Select2 4.0.0, consider renaming your `id` property or mapping the property before your data makes it to Select2. You can read more at https://select2.github.io/announcements-4.0.html#changed-id"),null!=opts.text&&console.warn("Select2: The `text` option has been removed in Select2 4.0.0, consider renaming your `text` property or mapping the property before your data makes it to Select2. You can read more at https://select2.github.io/announcements-4.0.html#changed-id"),null!=opts.sortResults&&console.warn("Select2: the `sortResults` option has been renamed to `sorter` in Select2 4.0.0. "),null!=opts.selectOnBlur&&console.warn("Select2: The `selectOnBlur` option has been renamed to `selectOnClose` in Select2 4.0.0."),null!=opts.ajax&&null!=opts.ajax.results&&console.warn("Select2: The `ajax.results` option has been renamed to `ajax.processResults` in Select2 4.0.0."),null!=opts.formatNoResults&&console.warn("Select2: The `formatNoResults` option has been renamed to `language.noResults` in Select2 4.0.0."),null!=opts.formatSearching&&console.warn("Select2: The `formatSearching` option has been renamed to `language.searching` in Select2 4.0.0."),null!=opts.formatInputTooShort&&console.warn("Select2: The `formatInputTooShort` option has been renamed to `language.inputTooShort` in Select2 4.0.0."),null!=opts.formatInputTooLong&&console.warn("Select2: The `formatInputTooLong` option has been renamed to `language.inputTooLong` in Select2 4.0.0."),null!=opts.formatLoading&&console.warn("Select2: The `formatLoading` option has been renamed to `language.loadingMore` in Select2 4.0.0."),null!=opts.formatSelectionTooBig&&console.warn("Select2: The `formatSelectionTooBig` option has been renamed to `language.maximumSelected` in Select2 4.0.0."),opts.element.data("select2Tags")&&console.warn("Select2: The `data-select2-tags` attribute has been renamed to `data-tags` in Select2 4.0.0.")),null!=opts.element.data("tags")){var elemTags=opts.element.data("tags");$.isArray(elemTags)||(elemTags=[]),opts.element.data("select2Tags",elemTags)}if(null!=opts.sorter&&(opts.sortResults=opts.sorter),null!=opts.selectOnClose&&(opts.selectOnBlur=opts.selectOnClose),null!=opts.ajax&&$.isFunction(opts.ajax.processResults)&&(opts.ajax.results=opts.ajax.processResults),null!=opts.language){var lang=opts.language;$.isFunction(lang.noMatches)&&(opts.formatNoMatches=lang.noMatches),$.isFunction(lang.searching)&&(opts.formatSearching=lang.searching),$.isFunction(lang.inputTooShort)&&(opts.formatInputTooShort=lang.inputTooShort),$.isFunction(lang.inputTooLong)&&(opts.formatInputTooLong=lang.inputTooLong),$.isFunction(lang.loadingMore)&&(opts.formatLoading=lang.loadingMore),$.isFunction(lang.maximumSelected)&&(opts.formatSelectionTooBig=lang.maximumSelected)}if(opts=$.extend({},{populateResults:function(container,results,query){var populate,id=this.opts.id,liveRegion=this.liveRegion;(populate=function(results,container,depth){var i,l,result,selectable,disabled,compound,node,label,innerContainer,formatted;results=opts.sortResults(results,container,query);var nodes=[];for(i=0,l=results.length;i<l;i+=1)result=results[i],disabled=result.disabled===!0,selectable=!disabled&&id(result)!==undefined,compound=result.children&&result.children.length>0,node=$("<li></li>"),node.addClass("select2-results-dept-"+depth),node.addClass("select2-result"),node.addClass(selectable?"select2-result-selectable":"select2-result-unselectable"),disabled&&node.addClass("select2-disabled"),compound&&node.addClass("select2-result-with-children"),node.addClass(self.opts.formatResultCssClass(result)),node.attr("role","presentation"),label=$(document.createElement("div")),label.addClass("select2-result-label"),label.attr("id","select2-result-label-"+nextUid()),label.attr("role","option"),formatted=opts.formatResult(result,label,query,self.opts.escapeMarkup),formatted!==undefined&&(label.html(formatted),node.append(label)),compound&&(innerContainer=$("<ul></ul>"),innerContainer.addClass("select2-result-sub"),populate(result.children,innerContainer,depth+1),node.append(innerContainer)),node.data("select2-data",result),nodes.push(node[0]);container.append(nodes),liveRegion.text(opts.formatMatches(results.length))})(results,container,0)}},$.fn.select2.defaults,opts),"function"!=typeof opts.id&&(idKey=opts.id,opts.id=function(e){return e[idKey]}),$.isArray(opts.element.data("select2Tags"))){if("tags"in opts)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+opts.element.attr("id");opts.tags=opts.element.data("select2Tags")}if(select?(opts.query=this.bind(function(query){var children,placeholderOption,process,data={results:[],more:!1},term=query.term;process=function(element,collection){var group;element.is("option")?query.matcher(term,element.text(),element)&&collection.push(self.optionToData(element)):element.is("optgroup")&&(group=self.optionToData(element),element.children().each2(function(i,elm){process(elm,group.children)}),group.children.length>0&&collection.push(group))},children=element.children(),this.getPlaceholder()!==undefined&&children.length>0&&(placeholderOption=this.getPlaceholderOption(),placeholderOption&&(children=children.not(placeholderOption))),children.each2(function(i,elm){process(elm,data.results)}),query.callback(data)}),opts.id=function(e){return e.id}):"query"in opts||("ajax"in opts?(ajaxUrl=opts.element.data("ajax-url"),ajaxUrl&&ajaxUrl.length>0&&(opts.ajax.url=ajaxUrl),opts.query=ajax.call(opts.element,opts.ajax)):"data"in opts?opts.query=local(opts.data):"tags"in opts&&(opts.query=tags(opts.tags),opts.createSearchChoice===undefined&&(opts.createSearchChoice=function(term){return{id:$.trim(term),text:$.trim(term)}}),opts.initSelection===undefined&&(opts.initSelection=function(element,callback){var data=[];$(splitVal(element.val(),opts.separator,opts.transformVal)).each(function(){var obj={id:this,text:this},tags=opts.tags;$.isFunction(tags)&&(tags=tags()),$(tags).each(function(){if(equal(this.id,obj.id))return obj=this,!1}),data.push(obj)}),callback(data)}))),"function"!=typeof opts.query)throw"query function not defined for Select2 "+opts.element.attr("id");if("top"===opts.createSearchChoicePosition)opts.createSearchChoicePosition=function(list,item){
list.unshift(item)};else if("bottom"===opts.createSearchChoicePosition)opts.createSearchChoicePosition=function(list,item){list.push(item)};else if("function"!=typeof opts.createSearchChoicePosition)throw"invalid createSearchChoicePosition option must be 'top', 'bottom' or a custom function";return opts},monitorSource:function(){var observer,el=this.opts.element,self=this;el.on("change.select2",this.bind(function(e){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()})),this._sync=this.bind(function(){var disabled=el.prop("disabled");disabled===undefined&&(disabled=!1),this.enable(!disabled);var readonly=el.prop("readonly");readonly===undefined&&(readonly=!1),this.readonly(readonly),this.container&&(syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(evaluate(this.opts.containerCssClass,this.opts.element))),this.dropdown&&(syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(evaluate(this.opts.dropdownCssClass,this.opts.element)))}),el.length&&el[0].attachEvent&&el.each(function(){this.attachEvent("onpropertychange",self._sync)}),observer=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,observer!==undefined&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new observer(function(mutations){$.each(mutations,self._sync)}),this.propertyObserver.observe(el.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(data){var evt=$.Event("select2-selecting",{val:this.id(data),object:data,choice:data});return this.opts.element.trigger(evt),!evt.isDefaultPrevented()},triggerChange:function(details){details=details||{},details=$.extend({},details,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(details),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return this.enabledInterface===!0},enableInterface:function(){var enabled=this._enabled&&!this._readonly,disabled=!enabled;return enabled!==this.enabledInterface&&(this.container.toggleClass("select2-container-disabled",disabled),this.close(),this.enabledInterface=enabled,!0)},enable:function(enabled){enabled===undefined&&(enabled=!0),this._enabled!==enabled&&(this._enabled=enabled,this.opts.element.prop("disabled",!enabled),this.enableInterface())},disable:function(){this.enable(!1)},readonly:function(enabled){enabled===undefined&&(enabled=!1),this._readonly!==enabled&&(this._readonly=enabled,this.opts.element.prop("readonly",enabled),this.enableInterface())},opened:function(){return!!this.container&&this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var bodyOffset,above,changeDirection,css,resultsListNode,$dropdown=this.dropdown,container=this.container,offset=container.offset(),height=container.outerHeight(!1),width=container.outerWidth(!1),dropHeight=$dropdown.outerHeight(!1),$window=$(window),windowWidth=$window.width(),windowHeight=$window.height(),viewPortRight=$window.scrollLeft()+windowWidth,viewportBottom=$window.scrollTop()+windowHeight,dropTop=offset.top+height,dropLeft=offset.left,enoughRoomBelow=dropTop+dropHeight<=viewportBottom,enoughRoomAbove=offset.top-dropHeight>=$window.scrollTop(),dropWidth=$dropdown.outerWidth(!1),enoughRoomOnRight=function(){return dropLeft+dropWidth<=viewPortRight},enoughRoomOnLeft=function(){return offset.left+viewPortRight+container.outerWidth(!1)>dropWidth},aboveNow=$dropdown.hasClass("select2-drop-above");aboveNow?(above=!0,!enoughRoomAbove&&enoughRoomBelow&&(changeDirection=!0,above=!1)):(above=!1,!enoughRoomBelow&&enoughRoomAbove&&(changeDirection=!0,above=!0)),changeDirection&&($dropdown.hide(),offset=this.container.offset(),height=this.container.outerHeight(!1),width=this.container.outerWidth(!1),dropHeight=$dropdown.outerHeight(!1),viewPortRight=$window.scrollLeft()+windowWidth,viewportBottom=$window.scrollTop()+windowHeight,dropTop=offset.top+height,dropLeft=offset.left,dropWidth=$dropdown.outerWidth(!1),$dropdown.show(),this.focusSearch()),this.opts.dropdownAutoWidth?(resultsListNode=$(".select2-results",$dropdown)[0],$dropdown.addClass("select2-drop-auto-width"),$dropdown.css("width",""),dropWidth=$dropdown.outerWidth(!1)+(resultsListNode.scrollHeight===resultsListNode.clientHeight?0:scrollBarDimensions.width),dropWidth>width?width=dropWidth:dropWidth=width,dropHeight=$dropdown.outerHeight(!1)):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body.css("position")&&(bodyOffset=this.body.offset(),dropTop-=bodyOffset.top,dropLeft-=bodyOffset.left),!enoughRoomOnRight()&&enoughRoomOnLeft()&&(dropLeft=offset.left+this.container.outerWidth(!1)-dropWidth),css={left:dropLeft,width:width},above?(this.container.addClass("select2-drop-above"),$dropdown.addClass("select2-drop-above"),dropHeight=$dropdown.outerHeight(!1),css.top=offset.top-dropHeight,css.bottom="auto"):(css.top=dropTop,css.bottom="auto",this.container.removeClass("select2-drop-above"),$dropdown.removeClass("select2-drop-above")),css=$.extend(css,evaluate(this.opts.dropdownCss,this.opts.element)),$dropdown.css(css)},shouldOpen:function(){var event;return!this.opened()&&(this._enabled!==!1&&this._readonly!==!0&&(event=$.Event("select2-opening"),this.opts.element.trigger(event),!event.isDefaultPrevented()))},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return!!this.shouldOpen()&&(this.opening(),$document.on("mousemove.select2Event",function(e){lastMousePosition.x=e.pageX,lastMousePosition.y=e.pageY}),!0)},opening:function(){var mask,cid=this.containerEventName,scroll="scroll."+cid,resize="resize."+cid,orient="orientationchange."+cid;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body.children().last()[0]&&this.dropdown.detach().appendTo(this.body),mask=$("#select2-drop-mask"),0===mask.length&&(mask=$(document.createElement("div")),mask.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),mask.hide(),mask.appendTo(this.body),mask.on("mousedown touchstart click",function(e){reinsertElement(mask);var self,dropdown=$("#select2-drop");dropdown.length>0&&(self=dropdown.data("select2"),self.opts.selectOnBlur&&self.selectHighlighted({noFocus:!0}),self.close(),e.preventDefault(),e.stopPropagation())})),this.dropdown.prev()[0]!==mask[0]&&this.dropdown.before(mask),$("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),mask.show(),this.positionDropdown(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var that=this;this.container.parents().add(window).each(function(){$(this).on(resize+" "+scroll+" "+orient,function(e){that.opened()&&that.positionDropdown()})})},close:function(){if(this.opened()){var cid=this.containerEventName,scroll="scroll."+cid,resize="resize."+cid,orient="orientationchange."+cid;this.container.parents().add(window).each(function(){$(this).off(scroll).off(resize).off(orient)}),this.clearDropdownAlignmentPreference(),$("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open").removeClass("select2-container-active"),this.results.empty(),$document.off("mousemove.select2Event"),this.clearSearch(),this.search.removeClass("select2-active"),this.search.removeAttr("aria-activedescendant"),this.opts.element.trigger($.Event("select2-close"))}},externalSearch:function(term){this.open(),this.search.val(term),this.updateResults(!1)},clearSearch:function(){},prefillNextSearchTerm:function(){if(""!==this.search.val())return!1;var nextSearchTerm=this.opts.nextSearchTerm(this.data(),this.lastSearchTerm);return nextSearchTerm!==undefined&&(this.search.val(nextSearchTerm),this.search.select(),!0)},getMaximumSelectionSize:function(){return evaluate(this.opts.maximumSelectionSize,this.opts.element)},ensureHighlightVisible:function(){var children,index,child,hb,rb,y,more,topOffset,results=this.results;if(index=this.highlight(),!(index<0)){if(0==index)return void results.scrollTop(0);children=this.findHighlightableChoices().find(".select2-result-label"),child=$(children[index]),topOffset=(child.offset()||{}).top||0,hb=topOffset+child.outerHeight(!0),index===children.length-1&&(more=results.find("li.select2-more-results"),more.length>0&&(hb=more.offset().top+more.outerHeight(!0))),rb=results.offset().top+results.outerHeight(!1),hb>rb&&results.scrollTop(results.scrollTop()+(hb-rb)),y=topOffset-results.offset().top,y<0&&"none"!=child.css("display")&&results.scrollTop(results.scrollTop()+y)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-disabled):not(.select2-selected)")},moveHighlight:function(delta){for(var choices=this.findHighlightableChoices(),index=this.highlight();index>-1&&index<choices.length;){index+=delta;var choice=$(choices[index]);if(choice.hasClass("select2-result-selectable")&&!choice.hasClass("select2-disabled")&&!choice.hasClass("select2-selected")){this.highlight(index);break}}},highlight:function(index){var choice,data,choices=this.findHighlightableChoices();return 0===arguments.length?indexOf(choices.filter(".select2-highlighted")[0],choices.get()):(index>=choices.length&&(index=choices.length-1),index<0&&(index=0),this.removeHighlight(),choice=$(choices[index]),choice.addClass("select2-highlighted"),this.search.attr("aria-activedescendant",choice.find(".select2-result-label").attr("id")),this.ensureHighlightVisible(),this.liveRegion.text(choice.text()),data=choice.data("select2-data"),void(data&&this.opts.element.trigger({type:"select2-highlight",val:this.id(data),choice:data})))},removeHighlight:function(){this.results.find(".select2-highlighted").removeClass("select2-highlighted")},touchMoved:function(){this._touchMoved=!0},clearTouchMoved:function(){this._touchMoved=!1},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(event){var el=$(event.target).closest(".select2-result-selectable");if(el.length>0&&!el.is(".select2-highlighted")){var choices=this.findHighlightableChoices();this.highlight(choices.index(el))}else 0==el.length&&this.removeHighlight()},loadMoreIfNeeded:function(){var below,results=this.results,more=results.find("li.select2-more-results"),page=this.resultsPage+1,self=this,term=this.search.val(),context=this.context;0!==more.length&&(below=more.offset().top-results.offset().top-results.height(),below<=this.opts.loadMorePadding&&(more.addClass("select2-active"),this.opts.query({element:this.opts.element,term:term,page:page,context:context,matcher:this.opts.matcher,callback:this.bind(function(data){self.opened()&&(self.opts.populateResults.call(this,results,data.results,{term:term,page:page,context:context}),self.postprocessResults(data,!1,!1),data.more===!0?(more.detach().appendTo(results).html(self.opts.escapeMarkup(evaluate(self.opts.formatLoadMore,self.opts.element,page+1))),window.setTimeout(function(){self.loadMoreIfNeeded()},10)):more.remove(),self.positionDropdown(),self.resultsPage=page,self.context=data.context,this.opts.element.trigger({type:"select2-loaded",items:data}))})})))},tokenize:function(){},updateResults:function(initial){function postRender(){search.removeClass("select2-active"),self.positionDropdown(),results.find(".select2-no-results,.select2-selection-limit,.select2-searching").length?self.liveRegion.text(results.text()):self.liveRegion.text(self.opts.formatMatches(results.find('.select2-result-selectable:not(".select2-selected")').length))}function render(html){results.html(html),postRender()}var data,input,queryNumber,search=this.search,results=this.results,opts=this.opts,self=this,term=search.val(),lastTerm=$.data(this.container,"select2-last-term");if((initial===!0||!lastTerm||!equal(term,lastTerm))&&($.data(this.container,"select2-last-term",term),initial===!0||this.showSearchInput!==!1&&this.opened())){queryNumber=++this.queryCount;var maxSelSize=this.getMaximumSelectionSize();if(maxSelSize>=1&&(data=this.data(),$.isArray(data)&&data.length>=maxSelSize&&checkFormatter(opts.formatSelectionTooBig,"formatSelectionTooBig")))return void render("<li class='select2-selection-limit'>"+evaluate(opts.formatSelectionTooBig,opts.element,maxSelSize)+"</li>");if(search.val().length<opts.minimumInputLength)return render(checkFormatter(opts.formatInputTooShort,"formatInputTooShort")?"<li class='select2-no-results'>"+evaluate(opts.formatInputTooShort,opts.element,search.val(),opts.minimumInputLength)+"</li>":""),void(initial&&this.showSearch&&this.showSearch(!0));if(opts.maximumInputLength&&search.val().length>opts.maximumInputLength)return void render(checkFormatter(opts.formatInputTooLong,"formatInputTooLong")?"<li class='select2-no-results'>"+evaluate(opts.formatInputTooLong,opts.element,search.val(),opts.maximumInputLength)+"</li>":"");opts.formatSearching&&0===this.findHighlightableChoices().length&&render("<li class='select2-searching'>"+evaluate(opts.formatSearching,opts.element)+"</li>"),search.addClass("select2-active"),this.removeHighlight(),input=this.tokenize(),input!=undefined&&null!=input&&search.val(input),this.resultsPage=1,opts.query({element:opts.element,term:search.val(),page:this.resultsPage,context:null,matcher:opts.matcher,callback:this.bind(function(data){var def;if(queryNumber==this.queryCount){if(!this.opened())return void this.search.removeClass("select2-active");if(data.hasError!==undefined&&checkFormatter(opts.formatAjaxError,"formatAjaxError"))return void render("<li class='select2-ajax-error'>"+evaluate(opts.formatAjaxError,opts.element,data.jqXHR,data.textStatus,data.errorThrown)+"</li>");if(this.context=data.context===undefined?null:data.context,this.opts.createSearchChoice&&""!==search.val()&&(def=this.opts.createSearchChoice.call(self,search.val(),data.results),def!==undefined&&null!==def&&self.id(def)!==undefined&&null!==self.id(def)&&0===$(data.results).filter(function(){return equal(self.id(this),self.id(def))}).length&&this.opts.createSearchChoicePosition(data.results,def)),0===data.results.length&&checkFormatter(opts.formatNoMatches,"formatNoMatches"))return render("<li class='select2-no-results'>"+evaluate(opts.formatNoMatches,opts.element,search.val())+"</li>"),void(this.showSearch&&this.showSearch(search.val()));results.empty(),self.opts.populateResults.call(this,results,data.results,{term:search.val(),page:this.resultsPage,context:null}),data.more===!0&&checkFormatter(opts.formatLoadMore,"formatLoadMore")&&(results.append("<li class='select2-more-results'>"+opts.escapeMarkup(evaluate(opts.formatLoadMore,opts.element,this.resultsPage))+"</li>"),window.setTimeout(function(){self.loadMoreIfNeeded()},10)),this.postprocessResults(data,initial),postRender(),this.opts.element.trigger({type:"select2-loaded",items:data})}})})}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){focus(this.search)},selectHighlighted:function(options){if(this._touchMoved)return void this.clearTouchMoved();var index=this.highlight(),highlighted=this.results.find(".select2-highlighted"),data=highlighted.closest(".select2-result").data("select2-data");data?(this.highlight(index),this.onSelect(data,options)):options&&options.noFocus&&this.close()},getPlaceholder:function(){var placeholderOption;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((placeholderOption=this.getPlaceholderOption())!==undefined?placeholderOption.text():undefined)},getPlaceholderOption:function(){if(this.select){var firstOption=this.select.children("option").first();if(this.opts.placeholderOption!==undefined)return"first"===this.opts.placeholderOption&&firstOption||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===$.trim(firstOption.text())&&""===firstOption.val())return firstOption}},initContainerWidth:function(){function resolveContainerWidth(){var style,attrs,matches,i,l,attr;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if(style=this.opts.element.attr("style"),"string"==typeof style)for(attrs=style.split(";"),i=0,l=attrs.length;i<l;i+=1)if(attr=attrs[i].replace(/\s/g,""),matches=attr.match(/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==matches&&matches.length>=1)return matches[1];return"resolve"===this.opts.width?(style=this.opts.element.css("width"),style.indexOf("%")>0?style:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return $.isFunction(this.opts.width)?this.opts.width():this.opts.width}var width=resolveContainerWidth.call(this);null!==width&&this.container.css("width",width)}}),SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&#160;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow' role='presentation'><b role='presentation'></b></span>","</a>","<label for='' class='select2-offscreen'></label>","<input class='select2-focusser select2-offscreen' type='text' aria-haspopup='true' role='button' />","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <label for='' class='select2-offscreen'></label>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input' role='combobox' aria-expanded='true'","       aria-autocomplete='list' />","   </div>","   <ul class='select2-results' role='listbox'>","   </ul>","</div>"].join(""));return container},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var el,range,len;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),this.showSearchInput!==!1&&this.search.val(this.focusser.val()),this.opts.shouldFocusInput(this)&&(this.search.focus(),el=this.search.get(0),el.createTextRange?(range=el.createTextRange(),range.collapse(!1),range.select()):el.setSelectionRange&&(len=this.search.val().length,el.setSelectionRange(len,len))),this.prefillNextSearchTerm(),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger($.Event("select2-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.prop("disabled",!1),this.opts.shouldFocusInput(this)&&this.focusser.focus()},destroy:function(){$("label[for='"+this.focusser.attr("id")+"']").attr("for",this.opts.element.attr("id")),this.parent.destroy.apply(this,arguments),cleanupJQueryElements.call(this,"selection","focusser")},initContainer:function(){var selection,elementLabel,container=this.container,dropdown=this.dropdown,idSuffix=nextUid();this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=selection=container.find(".select2-choice"),this.focusser=container.find(".select2-focusser"),selection.find(".select2-chosen").attr("id","select2-chosen-"+idSuffix),this.focusser.attr("aria-labelledby","select2-chosen-"+idSuffix),this.results.attr("id","select2-results-"+idSuffix),this.search.attr("aria-owns","select2-results-"+idSuffix),this.focusser.attr("id","s2id_autogen"+idSuffix),elementLabel=$("label[for='"+this.opts.element.attr("id")+"']"),this.opts.element.on("focus.select2",this.bind(function(){this.focus()})),this.focusser.prev().text(elementLabel.text()).attr("for",this.focusser.attr("id"));var originalTitle=this.opts.element.attr("title");this.opts.element.attr("title",originalTitle||elementLabel.text()),this.focusser.attr("tabindex",this.elementTabIndex),this.search.attr("id",this.focusser.attr("id")+"_search"),this.search.prev().text($("label[for='"+this.focusser.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&229!=e.keyCode){if(e.which===KEY.PAGE_UP||e.which===KEY.PAGE_DOWN)return void killEvent(e);switch(e.which){case KEY.UP:case KEY.DOWN:return this.moveHighlight(e.which===KEY.UP?-1:1),void killEvent(e);case KEY.ENTER:return this.selectHighlighted(),void killEvent(e);case KEY.TAB:return void this.selectHighlighted({noFocus:!0});case KEY.ESC:return this.cancel(e),void killEvent(e)}}})),this.search.on("blur",this.bind(function(e){document.activeElement===this.body.get(0)&&window.setTimeout(this.bind(function(){this.opened()&&this.results&&this.results.length>1&&this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.ESC){if(this.opts.openOnEnter===!1&&e.which===KEY.ENTER)return void killEvent(e);if(e.which==KEY.DOWN||e.which==KEY.UP||e.which==KEY.ENTER&&this.opts.openOnEnter){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;return this.open(),void killEvent(e)}return e.which==KEY.DELETE||e.which==KEY.BACKSPACE?(this.opts.allowClear&&this.clear(),void killEvent(e)):void 0}})),installKeyUpChangeEvent(this.focusser),this.focusser.on("keyup-change input",this.bind(function(e){if(this.opts.minimumResultsForSearch>=0){if(e.stopPropagation(),this.opened())return;this.open()}})),selection.on("mousedown touchstart","abbr",this.bind(function(e){this.isInterfaceEnabled()&&(this.clear(),killEventImmediately(e),this.close(),this.selection&&this.selection.focus())})),selection.on("mousedown touchstart",this.bind(function(e){reinsertElement(selection),this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),killEvent(e)})),dropdown.on("mousedown touchstart",this.bind(function(){this.opts.shouldFocusInput(this)&&this.search.focus()})),selection.on("focus",this.bind(function(e){killEvent(e)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger($.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.hide(),this.setPlaceholder()},clear:function(triggerChange){var data=this.selection.data("select2-data");if(data){var evt=$.Event("select2-clearing");if(this.opts.element.trigger(evt),evt.isDefaultPrevented())return;var placeholderOption=this.getPlaceholderOption();this.opts.element.val(placeholderOption?placeholderOption.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),triggerChange!==!1&&(this.opts.element.trigger({type:"select2-removed",val:this.id(data),choice:data}),this.triggerChange({removed:data}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection(null),this.close(),this.setPlaceholder();else{var self=this;this.opts.initSelection.call(null,this.opts.element,function(selected){selected!==undefined&&null!==selected&&(self.updateSelection(selected),self.close(),self.setPlaceholder(),self.lastSearchTerm=self.search.val())})}},isPlaceholderOptionSelected:function(){var placeholderOption;return this.getPlaceholder()!==undefined&&((placeholderOption=this.getPlaceholderOption())!==undefined&&placeholderOption.prop("selected")||""===this.opts.element.val()||this.opts.element.val()===undefined||null===this.opts.element.val())},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments),self=this;return"select"===opts.element.get(0).tagName.toLowerCase()?opts.initSelection=function(element,callback){var selected=element.find("option").filter(function(){return this.selected&&!this.disabled});callback(self.optionToData(selected))}:"data"in opts&&(opts.initSelection=opts.initSelection||function(element,callback){var id=element.val(),match=null;opts.query({matcher:function(term,text,el){var is_match=equal(id,opts.id(el));return is_match&&(match=el),is_match},callback:$.isFunction(callback)?function(){callback(match)}:$.noop})}),opts},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===undefined?undefined:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var placeholder=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&placeholder!==undefined){if(this.select&&this.getPlaceholderOption()===undefined)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(placeholder)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(data,initial,noHighlightUpdate){var selected=0,self=this;if(this.findHighlightableChoices().each2(function(i,elm){if(equal(self.id(elm.data("select2-data")),self.opts.element.val()))return selected=i,!1}),noHighlightUpdate!==!1&&(initial===!0&&selected>=0?this.highlight(selected):this.highlight(0)),initial===!0){var min=this.opts.minimumResultsForSearch;min>=0&&this.showSearch(countResults(data.results)>=min)}},showSearch:function(showSearchInput){this.showSearchInput!==showSearchInput&&(this.showSearchInput=showSearchInput,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!showSearchInput),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!showSearchInput),$(this.dropdown,this.container).toggleClass("select2-with-searchbox",showSearchInput))},onSelect:function(data,options){if(this.triggerSelect(data)){var old=this.opts.element.val(),oldData=this.data();this.opts.element.val(this.id(data)),this.updateSelection(data),this.opts.element.trigger({type:"select2-selected",val:this.id(data),choice:data}),this.lastSearchTerm=this.search.val(),this.close(),options&&options.noFocus||!this.opts.shouldFocusInput(this)||this.focusser.focus(),equal(old,this.id(data))||this.triggerChange({added:data,removed:oldData})}},updateSelection:function(data){var formatted,cssClass,container=this.selection.find(".select2-chosen");this.selection.data("select2-data",data),container.empty(),null!==data&&(formatted=this.opts.formatSelection(data,container,this.opts.escapeMarkup)),formatted!==undefined&&container.append(formatted),cssClass=this.opts.formatSelectionCssClass(data,container),cssClass!==undefined&&container.addClass(cssClass),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==undefined&&this.container.addClass("select2-allowclear")},val:function(){var val,triggerChange=!1,data=null,self=this,oldData=this.data();if(0===arguments.length)return this.opts.element.val();if(val=arguments[0],arguments.length>1&&(triggerChange=arguments[1],this.opts.debug&&console&&console.warn&&console.warn('Select2: The second option to `select2("val")` is not supported in Select2 4.0.0. The `change` event will always be triggered in 4.0.0.')),this.select)this.opts.debug&&console&&console.warn&&console.warn('Select2: Setting the value on a <select> using `select2("val")` is no longer supported in 4.0.0. You can use the `.val(newValue).trigger("change")` method provided by jQuery instead.'),this.select.val(val).find("option").filter(function(){return this.selected}).each2(function(i,elm){return data=self.optionToData(elm),!1}),this.updateSelection(data),this.setPlaceholder(),triggerChange&&this.triggerChange({added:data,removed:oldData});else{if(!val&&0!==val)return void this.clear(triggerChange);if(this.opts.initSelection===undefined)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(val),this.opts.initSelection(this.opts.element,function(data){self.opts.element.val(data?self.id(data):""),self.updateSelection(data),self.setPlaceholder(),triggerChange&&self.triggerChange({added:data,removed:oldData})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(value){var data,triggerChange=!1;return 0===arguments.length?(data=this.selection.data("select2-data"),data==undefined&&(data=null),data):(this.opts.debug&&console&&console.warn&&console.warn('Select2: The `select2("data")` method can no longer set selected values in 4.0.0, consider using the `.val()` method instead.'),arguments.length>1&&(triggerChange=arguments[1]),value?(data=this.data(),this.opts.element.val(value?this.id(value):""),this.updateSelection(value),triggerChange&&this.triggerChange({added:value,removed:data})):this.clear(triggerChange),void 0)}}),MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){var container=$(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <label for='' class='select2-offscreen'></label>","    <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return container},prepareOpts:function(){var opts=this.parent.prepareOpts.apply(this,arguments),self=this;return"select"===opts.element.get(0).tagName.toLowerCase()?opts.initSelection=function(element,callback){var data=[];element.find("option").filter(function(){return this.selected&&!this.disabled}).each2(function(i,elm){data.push(self.optionToData(elm))}),callback(data)}:"data"in opts&&(opts.initSelection=opts.initSelection||function(element,callback){var ids=splitVal(element.val(),opts.separator,opts.transformVal),matches=[];opts.query({matcher:function(term,text,el){var is_match=$.grep(ids,function(id){return equal(id,opts.id(el))}).length;return is_match&&matches.push(el),is_match},callback:$.isFunction(callback)?function(){for(var ordered=[],i=0;i<ids.length;i++)for(var id=ids[i],j=0;j<matches.length;j++){var match=matches[j];if(equal(id,opts.id(match))){ordered.push(match),matches.splice(j,1);break}}callback(ordered)}:$.noop})}),opts},selectChoice:function(choice){var selected=this.container.find(".select2-search-choice-focus");selected.length&&choice&&choice[0]==selected[0]||(selected.length&&this.opts.element.trigger("choice-deselected",selected),selected.removeClass("select2-search-choice-focus"),choice&&choice.length&&(this.close(),choice.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",choice)))},destroy:function(){$("label[for='"+this.search.attr("id")+"']").attr("for",this.opts.element.attr("id")),
this.parent.destroy.apply(this,arguments),cleanupJQueryElements.call(this,"searchContainer","selection")},initContainer:function(){var selection,selector=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=selection=this.container.find(selector);var _this=this;this.selection.on("click",".select2-container:not(.select2-container-disabled) .select2-search-choice:not(.select2-locked)",function(e){_this.search[0].focus(),_this.selectChoice($(this))}),this.search.attr("id","s2id_autogen"+nextUid()),this.search.prev().text($("label[for='"+this.opts.element.attr("id")+"']").text()).attr("for",this.search.attr("id")),this.opts.element.on("focus.select2",this.bind(function(){this.focus()})),this.search.on("input paste",this.bind(function(){this.search.attr("placeholder")&&0==this.search.val().length||this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var selected=selection.find(".select2-search-choice-focus"),prev=selected.prev(".select2-search-choice:not(.select2-locked)"),next=selected.next(".select2-search-choice:not(.select2-locked)"),pos=getCursorInfo(this.search);if(selected.length&&(e.which==KEY.LEFT||e.which==KEY.RIGHT||e.which==KEY.BACKSPACE||e.which==KEY.DELETE||e.which==KEY.ENTER)){var selectedChoice=selected;return e.which==KEY.LEFT&&prev.length?selectedChoice=prev:e.which==KEY.RIGHT?selectedChoice=next.length?next:null:e.which===KEY.BACKSPACE?this.unselect(selected.first())&&(this.search.width(10),selectedChoice=prev.length?prev:next):e.which==KEY.DELETE?this.unselect(selected.first())&&(this.search.width(10),selectedChoice=next.length?next:null):e.which==KEY.ENTER&&(selectedChoice=null),this.selectChoice(selectedChoice),killEvent(e),void(selectedChoice&&selectedChoice.length||this.open())}if((e.which===KEY.BACKSPACE&&1==this.keydowns||e.which==KEY.LEFT)&&0==pos.offset&&!pos.length)return this.selectChoice(selection.find(".select2-search-choice:not(.select2-locked)").last()),void killEvent(e);if(this.selectChoice(null),this.opened())switch(e.which){case KEY.UP:case KEY.DOWN:return this.moveHighlight(e.which===KEY.UP?-1:1),void killEvent(e);case KEY.ENTER:return this.selectHighlighted(),void killEvent(e);case KEY.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case KEY.ESC:return this.cancel(e),void killEvent(e)}if(e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.BACKSPACE&&e.which!==KEY.ESC){if(e.which===KEY.ENTER){if(this.opts.openOnEnter===!1)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),e.which!==KEY.PAGE_UP&&e.which!==KEY.PAGE_DOWN||killEvent(e),e.which===KEY.ENTER&&killEvent(e)}}})),this.search.on("keyup",this.bind(function(e){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(e){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),e.stopImmediatePropagation(),this.opts.element.trigger($.Event("select2-blur"))})),this.container.on("click",selector,this.bind(function(e){this.isInterfaceEnabled()&&($(e.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.open(),this.focusSearch(),e.preventDefault()))})),this.container.on("focus",selector,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.hide(),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var self=this;this.opts.initSelection.call(null,this.opts.element,function(data){data!==undefined&&null!==data&&(self.updateSelection(data),self.close(),self.clearSearch())})}},clearSearch:function(){var placeholder=this.getPlaceholder(),maxWidth=this.getMaxSearchWidth();placeholder!==undefined&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1?(this.search.val(placeholder).addClass("select2-default"),this.search.width(maxWidth>0?maxWidth:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.prefillNextSearchTerm(),this.updateResults(!0),this.opts.shouldFocusInput(this)&&this.search.focus(),this.opts.element.trigger($.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(data){var ids={},filtered=[],self=this;$(data).each(function(){self.id(this)in ids||(ids[self.id(this)]=0,filtered.push(this))}),this.selection.find(".select2-search-choice").remove(),this.addSelectedChoice(filtered),self.postprocessResults()},tokenize:function(){var input=this.search.val();input=this.opts.tokenizer.call(this,input,this.data(),this.bind(this.onSelect),this.opts),null!=input&&input!=undefined&&(this.search.val(input),input.length>0&&this.open())},onSelect:function(data,options){this.triggerSelect(data)&&""!==data.text&&(this.addSelectedChoice(data),this.opts.element.trigger({type:"selected",val:this.id(data),choice:data}),this.lastSearchTerm=this.search.val(),this.clearSearch(),this.updateResults(),!this.select&&this.opts.closeOnSelect||this.postprocessResults(data,!1,this.opts.closeOnSelect===!0),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()?this.updateResults(!0):this.prefillNextSearchTerm()&&this.updateResults(),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:data}),options&&options.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(data){var val=this.getVal(),self=this;$(data).each(function(){val.push(self.createChoice(this))}),this.setVal(val)},createChoice:function(data){var formatted,cssClass,enableChoice=!data.locked,enabledItem=$("<li class='select2-search-choice'>    <div></div>    <a href='#' class='select2-search-choice-close' tabindex='-1'></a></li>"),disabledItem=$("<li class='select2-search-choice select2-locked'><div></div></li>"),choice=enableChoice?enabledItem:disabledItem,id=this.id(data);return formatted=this.opts.formatSelection(data,choice.find("div"),this.opts.escapeMarkup),formatted!=undefined&&choice.find("div").replaceWith($("<div></div>").html(formatted)),cssClass=this.opts.formatSelectionCssClass(data,choice.find("div")),cssClass!=undefined&&choice.addClass(cssClass),enableChoice&&choice.find(".select2-search-choice-close").on("mousedown",killEvent).on("click dblclick",this.bind(function(e){this.isInterfaceEnabled()&&(this.unselect($(e.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),killEvent(e),this.close(),this.focusSearch())})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),choice.data("select2-data",data),choice.insertBefore(this.searchContainer),id},unselect:function(selected){var data,index,val=this.getVal();if(selected=selected.closest(".select2-search-choice"),0===selected.length)throw"Invalid argument: "+selected+". Must be .select2-search-choice";if(data=selected.data("select2-data")){var evt=$.Event("select2-removing");if(evt.val=this.id(data),evt.choice=data,this.opts.element.trigger(evt),evt.isDefaultPrevented())return!1;for(;(index=indexOf(this.id(data),val))>=0;)val.splice(index,1),this.setVal(val),this.select&&this.postprocessResults();return selected.remove(),this.opts.element.trigger({type:"select2-removed",val:this.id(data),choice:data}),this.triggerChange({removed:data}),!0}},postprocessResults:function(data,initial,noHighlightUpdate){var val=this.getVal(),choices=this.results.find(".select2-result"),compound=this.results.find(".select2-result-with-children"),self=this;choices.each2(function(i,choice){var id=self.id(choice.data("select2-data"));indexOf(id,val)>=0&&(choice.addClass("select2-selected"),choice.find(".select2-result-selectable").addClass("select2-selected"))}),compound.each2(function(i,choice){choice.is(".select2-result-selectable")||0!==choice.find(".select2-result-selectable:not(.select2-selected)").length||choice.addClass("select2-selected")}),this.highlight()==-1&&noHighlightUpdate!==!1&&this.opts.closeOnSelect===!0&&self.highlight(0),!this.opts.createSearchChoice&&!choices.filter(".select2-result:not(.select2-selected)").length>0&&(!data||data&&!data.more&&0===this.results.find(".select2-no-results").length)&&checkFormatter(self.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+evaluate(self.opts.formatNoMatches,self.opts.element,self.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-getSideBorderPadding(this.search)},resizeSearch:function(){var minimumWidth,left,maxWidth,containerLeft,searchWidth,sideBorderPadding=getSideBorderPadding(this.search);minimumWidth=measureTextWidth(this.search)+10,left=this.search.offset().left,maxWidth=this.selection.width(),containerLeft=this.selection.offset().left,searchWidth=maxWidth-(left-containerLeft)-sideBorderPadding,searchWidth<minimumWidth&&(searchWidth=maxWidth-sideBorderPadding),searchWidth<40&&(searchWidth=maxWidth-sideBorderPadding),searchWidth<=0&&(searchWidth=minimumWidth),this.search.width(Math.floor(searchWidth))},getVal:function(){var val;return this.select?(val=this.select.val(),null===val?[]:val):(val=this.opts.element.val(),splitVal(val,this.opts.separator,this.opts.transformVal))},setVal:function(val){if(this.select)this.select.val(val);else{var unique=[],valMap={};$(val).each(function(){this in valMap||(unique.push(this),valMap[this]=0)}),this.opts.element.val(0===unique.length?"":unique.join(this.opts.separator))}},buildChangeDetails:function(old,current){for(var current=current.slice(0),old=old.slice(0),i=0;i<current.length;i++)for(var j=0;j<old.length;j++)if(equal(this.opts.id(current[i]),this.opts.id(old[j]))){current.splice(i,1),i--,old.splice(j,1);break}return{added:current,removed:old}},val:function(val,triggerChange){var oldData,self=this;if(0===arguments.length)return this.getVal();if(oldData=this.data(),oldData.length||(oldData=[]),!val&&0!==val)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(triggerChange&&this.triggerChange({added:this.data(),removed:oldData}));if(this.setVal(val),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),triggerChange&&this.triggerChange(this.buildChangeDetails(oldData,this.data()));else{if(this.opts.initSelection===undefined)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(data){var ids=$.map(data,self.id);self.setVal(ids),self.updateSelection(data),self.clearSearch(),triggerChange&&self.triggerChange(self.buildChangeDetails(oldData,self.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var val=[],self=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){val.push(self.opts.id($(this).data("select2-data")))}),this.setVal(val),this.triggerChange()},data:function(values,triggerChange){var ids,old,self=this;return 0===arguments.length?this.selection.children(".select2-search-choice").map(function(){return $(this).data("select2-data")}).get():(old=this.data(),values||(values=[]),ids=$.map(values,function(e){return self.opts.id(e)}),this.setVal(ids),this.updateSelection(values),this.clearSearch(),triggerChange&&this.triggerChange(this.buildChangeDetails(old,this.data())),void 0)}}),$.fn.select2=function(){var opts,select2,method,value,multiple,args=Array.prototype.slice.call(arguments,0),allowedMethods=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","disable","readonly","positionDropdown","data","search"],valueMethods=["opened","isFocused","container","dropdown"],propertyMethods=["val","data"],methodsMap={search:"externalSearch"};return this.each(function(){if(0===args.length||"object"==typeof args[0])opts=0===args.length?{}:$.extend({},args[0]),opts.element=$(this),"select"===opts.element.get(0).tagName.toLowerCase()?multiple=opts.element.prop("multiple"):(multiple=opts.multiple||!1,"tags"in opts&&(opts.multiple=multiple=!0)),select2=multiple?new window.Select2["class"].multi:new window.Select2["class"].single,select2.init(opts);else{if("string"!=typeof args[0])throw"Invalid arguments to select2 plugin: "+args;if(indexOf(args[0],allowedMethods)<0)throw"Unknown method: "+args[0];if(value=undefined,select2=$(this).data("select2"),select2===undefined)return;if(method=args[0],"container"===method?value=select2.container:"dropdown"===method?value=select2.dropdown:(methodsMap[method]&&(method=methodsMap[method]),value=select2[method].apply(select2,args.slice(1))),indexOf(args[0],valueMethods)>=0||indexOf(args[0],propertyMethods)>=0&&1==args.length)return!1}}),value===undefined?this:value},$.fn.select2.defaults={debug:!1,width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(result,container,query,escapeMarkup){var markup=[];return markMatch(this.text(result),query.term,markup,escapeMarkup),markup.join("")},transformVal:function(val){return $.trim(val)},formatSelection:function(data,container,escapeMarkup){return data?escapeMarkup(this.text(data)):undefined},sortResults:function(results,container,query){return results},formatResultCssClass:function(data){return data.css},formatSelectionCssClass:function(data,container){return undefined},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e==undefined?null:e.id},text:function(e){return e&&this.data&&this.data.text?$.isFunction(this.data.text)?this.data.text(e):e[this.data.text]:e.text},matcher:function(term,text){return stripDiacritics(""+text).toUpperCase().indexOf(stripDiacritics(""+term).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:defaultEscapeMarkup,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(c){return c},adaptDropdownCssClass:function(c){return null},nextSearchTerm:function(selectedObject,currentSearchTerm){return undefined},searchInputPlaceholder:"",createSearchChoicePosition:"top",shouldFocusInput:function(instance){var supportsTouchEvents="ontouchstart"in window||navigator.msMaxTouchPoints>0;return!supportsTouchEvents||!(instance.opts.minimumResultsForSearch<0)}},$.fn.select2.locales=[],$.fn.select2.locales.en={formatMatches:function(matches){return 1===matches?"One result is available, press enter to select it.":matches+" results are available, use up and down arrow keys to navigate."},formatNoMatches:function(){return"No matches found"},formatAjaxError:function(jqXHR,textStatus,errorThrown){return"Loading failed"},formatInputTooShort:function(input,min){var n=min-input.length;return"Please enter "+n+" or more character"+(1==n?"":"s")},formatInputTooLong:function(input,max){var n=input.length-max;return"Please delete "+n+" character"+(1==n?"":"s")},formatSelectionTooBig:function(limit){return"You can only select "+limit+" item"+(1==limit?"":"s")},formatLoadMore:function(pageNumber){return"Loading more results"},formatSearching:function(){return"Searching"}},$.extend($.fn.select2.defaults,$.fn.select2.locales.en),$.fn.select2.ajaxDefaults={transport:$.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch,escapeMarkup:defaultEscapeMarkup,stripDiacritics:stripDiacritics},"class":{"abstract":AbstractSelect2,single:SingleSelect2,multi:MultiSelect2}}}}(jQuery)}.apply(root,arguments)})}(this),function(root){define("jquery.event.drag",["jquery"],function(){return function(){!function($){$.fn.drag=function(str,arg,opts){var type="string"==typeof str?str:"",fn=$.isFunction(str)?str:$.isFunction(arg)?arg:null;return 0!==type.indexOf("drag")&&(type="drag"+type),opts=(str==fn?arg:opts)||{},fn?this.bind(type,opts,fn):this.trigger(type)};var $event=$.event,$special=$event.special,drag=$special.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(obj){var data=$.data(this,drag.datakey),opts=obj.data||{};data.related+=1,$.each(drag.defaults,function(key,def){void 0!==opts[key]&&(data[key]=opts[key])})},remove:function(){$.data(this,drag.datakey).related-=1},setup:function(){if(!$.data(this,drag.datakey)){var data=$.extend({related:0},drag.defaults);$.data(this,drag.datakey,data),$event.add(this,"touchstart mousedown",drag.init,data),this.attachEvent&&this.attachEvent("ondragstart",drag.dontstart)}},teardown:function(){var data=$.data(this,drag.datakey)||{};data.related||($.removeData(this,drag.datakey),$event.remove(this,"touchstart mousedown",drag.init),drag.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",drag.dontstart))},init:function(event){if(!drag.touched){var results,dd=event.data;if(!(0!=event.which&&dd.which>0&&event.which!=dd.which)&&!$(event.target).is(dd.not)&&(!dd.handle||$(event.target).closest(dd.handle,event.currentTarget).length)&&(drag.touched="touchstart"==event.type?this:null,dd.propagates=1,dd.mousedown=this,dd.interactions=[drag.interaction(this,dd)],dd.target=event.target,dd.pageX=event.pageX,dd.pageY=event.pageY,dd.dragging=null,results=drag.hijack(event,"draginit",dd),dd.propagates))return results=drag.flatten(results),results&&results.length&&(dd.interactions=[],$.each(results,function(){dd.interactions.push(drag.interaction(this,dd))})),dd.propagates=dd.interactions.length,dd.drop!==!1&&$special.drop&&$special.drop.handler(event,dd),drag.textselect(!1),drag.touched?$event.add(drag.touched,"touchmove touchend",drag.handler,dd):$event.add(document,"mousemove mouseup",drag.handler,dd),!(!drag.touched||dd.live)&&void 0}},interaction:function(elem,dd){var offset=$(elem)[dd.relative?"position":"offset"]()||{top:0,left:0};return{drag:elem,callback:new drag.callback,droppable:[],offset:offset}},handler:function(event){var dd=event.data;switch(event.type){case!dd.dragging&&"touchmove":event.preventDefault();case!dd.dragging&&"mousemove":if(Math.pow(event.pageX-dd.pageX,2)+Math.pow(event.pageY-dd.pageY,2)<Math.pow(dd.distance,2))break;event.target=dd.target,drag.hijack(event,"dragstart",dd),dd.propagates&&(dd.dragging=!0);case"touchmove":event.preventDefault();case"mousemove":if(dd.dragging){if(drag.hijack(event,"drag",dd),dd.propagates){dd.drop!==!1&&$special.drop&&$special.drop.handler(event,dd);break}event.type="mouseup"}case"touchend":case"mouseup":default:drag.touched?$event.remove(drag.touched,"touchmove touchend",drag.handler):$event.remove(document,"mousemove mouseup",drag.handler),dd.dragging&&(dd.drop!==!1&&$special.drop&&$special.drop.handler(event,dd),drag.hijack(event,"dragend",dd)),drag.textselect(!0),dd.click===!1&&dd.dragging&&$.data(dd.mousedown,"suppress.click",(new Date).getTime()+5),dd.dragging=drag.touched=!1}},hijack:function(event,type,dd,x,elem){if(dd){var result,ia,callback,orig={event:event.originalEvent,type:event.type},mode=type.indexOf("drop")?"drag":"drop",i=x||0,len=isNaN(x)?dd.interactions.length:x;event.type=type,event.originalEvent=null,dd.results=[];do if(ia=dd.interactions[i]){if("dragend"!==type&&ia.cancelled)continue;callback=drag.properties(event,dd,ia),ia.results=[],$(elem||ia[mode]||dd.droppable).each(function(p,subject){if(callback.target=subject,event.isPropagationStopped=function(){return!1},result=subject?$event.dispatch.call(subject,event,callback):null,result===!1?("drag"==mode&&(ia.cancelled=!0,dd.propagates-=1),"drop"==type&&(ia[mode][p]=null)):"dropinit"==type&&ia.droppable.push(drag.element(result)||subject),"dragstart"==type&&(ia.proxy=$(drag.element(result)||ia.drag)[0]),ia.results.push(result),delete event.result,"dropinit"!==type)return result}),dd.results[i]=drag.flatten(ia.results),"dropinit"==type&&(ia.droppable=drag.flatten(ia.droppable)),"dragstart"!=type||ia.cancelled||callback.update()}while(++i<len);return event.type=orig.type,event.originalEvent=orig.event,drag.flatten(dd.results)}},properties:function(event,dd,ia){var obj=ia.callback;return obj.drag=ia.drag,obj.proxy=ia.proxy||ia.drag,obj.startX=dd.pageX,obj.startY=dd.pageY,obj.deltaX=event.pageX-dd.pageX,obj.deltaY=event.pageY-dd.pageY,obj.originalX=ia.offset.left,obj.originalY=ia.offset.top,obj.offsetX=obj.originalX+obj.deltaX,obj.offsetY=obj.originalY+obj.deltaY,obj.drop=drag.flatten((ia.drop||[]).slice()),obj.available=drag.flatten((ia.droppable||[]).slice()),obj},element:function(arg){if(arg&&(arg.jquery||1==arg.nodeType))return arg},flatten:function(arr){return $.map(arr,function(member){return member&&member.jquery?$.makeArray(member):member&&member.length?drag.flatten(member):member})},textselect:function(bool){$(document)[bool?"unbind":"bind"]("selectstart",drag.dontstart).css("MozUserSelect",bool?"":"none"),document.unselectable=bool?"off":"on"},dontstart:function(){return!1},callback:function(){}};drag.callback.prototype={update:function(){$special.drop&&this.available.length&&$.each(this.available,function(i){$special.drop.locate(this,i)})}};var $dispatch=$event.dispatch;$event.dispatch=function(event){return $.data(this,"suppress."+event.type)-(new Date).getTime()>0?void $.removeData(this,"suppress."+event.type):$dispatch.apply(this,arguments)};var touchHooks=$event.fixHooks.touchstart=$event.fixHooks.touchmove=$event.fixHooks.touchend=$event.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(event,orig){if(orig){var touched=orig.touches&&orig.touches[0]||orig.changedTouches&&orig.changedTouches[0]||null;touched&&$.each(touchHooks.props,function(i,prop){event[prop]=touched[prop]})}return event}};$special.draginit=$special.dragstart=$special.dragend=drag}(jQuery)}.apply(root,arguments)})}(this),function(root){define("jquery.event.drop",["jquery"],function(){return function(){return function($){$.fn.drop=function(str,arg,opts){var type="string"==typeof str?str:"",fn=$.isFunction(str)?str:$.isFunction(arg)?arg:null;return 0!==type.indexOf("drop")&&(type="drop"+type),opts=(str==fn?arg:opts)||{},fn?this.bind(type,opts,fn):this.trigger(type)},$.drop=function(opts){opts=opts||{},drop.multi=opts.multi===!0?1/0:opts.multi===!1?1:isNaN(opts.multi)?drop.multi:opts.multi,drop.delay=opts.delay||drop.delay,drop.tolerance=$.isFunction(opts.tolerance)?opts.tolerance:null===opts.tolerance?null:drop.tolerance,drop.mode=opts.mode||drop.mode||"intersect"};var $event=$.event,$special=$event.special,drop=$.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(obj){var data=$.data(this,drop.datakey);data.related+=1},remove:function(){$.data(this,drop.datakey).related-=1},setup:function(){if(!$.data(this,drop.datakey)){var data={related:0,active:[],anyactive:0,winner:0,location:{}};$.data(this,drop.datakey,data),drop.targets.push(this)}},teardown:function(){var data=$.data(this,drop.datakey)||{};if(!data.related){$.removeData(this,drop.datakey);var element=this;drop.targets=$.grep(drop.targets,function(target){return target!==element})}},handler:function(event,dd){var $targets;if(dd)switch(event.type){case"mousedown":case"touchstart":$targets=$(drop.targets),"string"==typeof dd.drop&&($targets=$targets.filter(dd.drop)),$targets.each(function(){var data=$.data(this,drop.datakey);data.active=[],data.anyactive=0,data.winner=0}),dd.droppable=$targets,$special.drag.hijack(event,"dropinit",dd);break;case"mousemove":case"touchmove":drop.event=event,drop.timer||drop.tolerate(dd);break;case"mouseup":case"touchend":drop.timer=clearTimeout(drop.timer),dd.propagates&&($special.drag.hijack(event,"drop",dd),$special.drag.hijack(event,"dropend",dd))}},locate:function(elem,index){var data=$.data(elem,drop.datakey),$elem=$(elem),posi=$elem.offset()||{},height=$elem.outerHeight(),width=$elem.outerWidth(),location={elem:elem,width:width,height:height,top:posi.top,left:posi.left,right:posi.left+width,bottom:posi.top+height};return data&&(data.location=location,data.index=index,data.elem=elem),location},contains:function(target,test){return(test[0]||test.left)>=target.left&&(test[0]||test.right)<=target.right&&(test[1]||test.top)>=target.top&&(test[1]||test.bottom)<=target.bottom},modes:{intersect:function(event,proxy,target){return this.contains(target,[event.pageX,event.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(event,proxy,target){return Math.max(0,Math.min(target.bottom,proxy.bottom)-Math.max(target.top,proxy.top))*Math.max(0,Math.min(target.right,proxy.right)-Math.max(target.left,proxy.left))},fit:function(event,proxy,target){return this.contains(target,proxy)?1:0},middle:function(event,proxy,target){return this.contains(target,[proxy.left+.5*proxy.width,proxy.top+.5*proxy.height])?1:0}},sort:function(a,b){return b.winner-a.winner||a.index-b.index},tolerate:function(dd){var i,drp,drg,data,arr,len,elem,ia,x=0,end=dd.interactions.length,xy=[drop.event.pageX,drop.event.pageY],tolerance=drop.tolerance||drop.modes[drop.mode];do if(ia=dd.interactions[x]){if(!ia)return;ia.drop=[],arr=[],len=ia.droppable.length,tolerance&&(drg=drop.locate(ia.proxy)),i=0;do if(elem=ia.droppable[i]){if(data=$.data(elem,drop.datakey),drp=data.location,!drp)continue;data.winner=tolerance?tolerance.call(drop,drop.event,drg,drp):drop.contains(drp,xy)?1:0,arr.push(data)}while(++i<len);arr.sort(drop.sort),i=0;do(data=arr[i])&&(data.winner&&ia.drop.length<drop.multi?(data.active[x]||data.anyactive||($special.drag.hijack(drop.event,"dropstart",dd,x,data.elem)[0]!==!1?(data.active[x]=1,data.anyactive+=1):data.winner=0),data.winner&&ia.drop.push(data.elem)):data.active[x]&&1==data.anyactive&&($special.drag.hijack(drop.event,"dropend",dd,x,data.elem),data.active[x]=0,data.anyactive-=1));while(++i<len)}while(++x<end);drop.last&&xy[0]==drop.last.pageX&&xy[1]==drop.last.pageY?delete drop.timer:drop.timer=setTimeout(function(){drop.tolerate(dd)},drop.delay),drop.last=drop.event}};$special.dropinit=$special.dropstart=$special.dropend=drop}(jQuery),$.drop}.apply(root,arguments)})}(this),define("mockup-patterns-select2",["jquery","pat-base","mockup-utils","select2","jquery.event.drag","jquery.event.drop"],function($,Base,utils){"use strict";var Select2=Base.extend({name:"select2",trigger:".pat-select2",parser:"mockup",defaults:{separator:","},initializeValues:function(){var self=this;self.options.initialValues&&(self.options.id=function(term){return term.id},self.options.initSelection=function($el,callback){var data=[],value=$el.val(),seldefaults=self.options.initialValues;"string"==typeof self.options.initialValues&&""!==self.options.initialValues&&("{"===self.options.initialValues[0]?seldefaults=JSON.parse(self.options.initialValues):(seldefaults={},$(self.options.initialValues.split(self.options.separator)).each(function(){var selection=this.split(":"),id=$.trim(selection[0]),text=$.trim(selection[1]);seldefaults[id]=text}))),$(value.split(self.options.separator)).each(function(){var text=this;seldefaults[this]&&(text=seldefaults[this]),data.push({id:utils.escapeHTML(this),text:utils.escapeHTML(text)})}),callback(data)})},initializeTags:function(){var self=this;self.options.tags&&"string"==typeof self.options.tags&&("["===self.options.tags.substr(0,1)?self.options.tags=JSON.parse(self.options.tags):self.options.tags=self.options.tags.split(self.options.separator)),self.options.tags&&!self.options.allowNewItems&&(self.options.data=$.map(self.options.tags,function(value,i){return{id:value,text:value}}),self.options.multiple=!0,delete self.options.tags)},initializeOrdering:function(){var self=this;if(self.options.orderable){var formatSelection=function(data,$container){return data?data.text:void 0};self.options.formatSelection&&(formatSelection=self.options.formatSelection),self.options.formatSelection=function(data,$container){return $container.parents("li").drag("start",function(e,dd){return $(this).addClass("select2-choice-dragging"),self.$el.select2("onSortStart"),$.drop({tolerance:function(event,proxy,target){var test=event.pageY>target.top+target.height/2;return $.data(target.elem,"drop+reorder",test?"insertAfter":"insertBefore"),this.contains(target,[event.pageX,event.pageY])}}),$(this).clone().addClass("dragging").css({opacity:.75,position:"absolute"}).appendTo(document.body)}).drag(function(e,dd){$(dd.proxy).css({top:dd.offsetY,left:dd.offsetX});var drop=dd.drop[0],method=$.data(drop||{},"drop+reorder");!drop||drop==dd.current&&method==dd.method||($(this)[method](drop),dd.current=drop,dd.method=method,dd.update())}).drag("end",function(e,dd){$(this).removeClass("select2-choice-dragging"),self.$el.select2("onSortEnd"),$(dd.proxy).remove()}).drop("init",function(e,dd){return this!=dd.drag}),formatSelection(data,$container)}}},initializeSelect2:function(){var self=this;self.$el.select2(self.options),self.$select2=self.$el.parent().find(".select2-container"),self.$el.parent().off("close.plone-modal.patterns"),self.options.orderable&&self.$select2.addClass("select2-orderable")},init:function(){var self=this;if(self.options.allowNewItems=!self.options.hasOwnProperty("allowNewItems")||JSON.parse(self.options.allowNewItems),self.options.ajax||self.options.vocabularyUrl){self.options.vocabularyUrl&&(self.options.multiple=void 0===self.options.multiple||self.options.multiple,self.options.ajax=self.options.ajax||{},self.options.ajax.url=self.options.vocabularyUrl,self.options.initSelection=function($el,callback){var data=[],value=$el.val();$(value.split(self.options.separator)).each(function(){var val=utils.escapeHTML(this);data.push({id:val,text:val})}),callback(data)});var queryTerm="";self.options.ajax=$.extend({quietMillis:300,data:function(term,page){return queryTerm=term,{query:term,page_limit:10,page:page}},results:function(data,page){var results=data.results;if(self.options.vocabularyUrl){var dataIds=[];$.each(data.results,function(i,item){dataIds.push(item.id)}),results=[];var haveResult=""===queryTerm||$.inArray(queryTerm,dataIds)>=0;self.options.allowNewItems&&!haveResult&&(queryTerm=utils.escapeHTML(queryTerm),results.push({id:queryTerm,text:queryTerm})),$.each(data.results,function(i,item){results.push(item)})}return{results:results}}},self.options.ajax)}else if(self.options.multiple&&self.$el.is("select")){var vals=self.$el.val()||[],options=$.map(self.$el.find("option"),function(o){return{text:$(o).html(),id:o.value
}}),$hidden=$('<input type="hidden" />');$hidden.val(vals.join(self.options.separator)),$hidden.attr("class",self.$el.attr("class")),$hidden.attr("name",self.$el.attr("name")),$hidden.attr("id",self.$el.attr("id")),self.$orig=self.$el,self.$el.replaceWith($hidden),self.$el=$hidden,self.options.data=options}self.initializeValues(),self.initializeTags(),self.initializeOrdering(),self.initializeSelect2()}});return Select2}),define("mockup-patterns-passwordstrength",["jquery","pat-base"],function($,Base){"use strict";function loadScript(src){var s,i,scripts=document.getElementsByTagName("script");for(i=0;i<scripts.length;i++)if(scripts[i].src.indexOf(src)!==-1)return;s=document.createElement("script"),s.type="text/javascript",s.async=!0,s.src=src,scripts[0].parentNode.insertBefore(s,scripts[0])}function jsDiv(){return $(document.createElement("div"))}var PasswordStrength=Base.extend({name:"passwordstrength",trigger:".pat-passwordstrength",parser:"mockup",defaults:{zxcvbn:"//cdnjs.cloudflare.com/ajax/libs/zxcvbn/1.0/zxcvbn.js"},init:function(){function setLevel(){var score=0;"function"!=typeof window.zxcvbn?loadScript(self.options.zxcvbn):$pwfield[0].value.length>0&&(score=Math.max(1,window.zxcvbn($pwfield[0].value,[].map.call(($pwfield[0].form||{elements:[]}).elements,function(inp){return inp===$pwfield[0]?null:inp.value||null}).filter(function(x){return x})).score)),$pwmeter.attr("class","pat-passwordstrength-meter level-"+score)}var self=this,$pwfield=this.$el,$pwmeter=jsDiv().append([jsDiv(),jsDiv(),jsDiv(),jsDiv()]);$pwfield.after($pwmeter),$pwfield.on("keyup",function(e){var timeoutId=0;clearTimeout(timeoutId),timeoutId=setTimeout(setLevel,500)}),setLevel()}});return PasswordStrength}),define("mockup-i18n",["jquery"],function($){"use strict";var I18N=function(){var self=this;self.baseUrl=$("body").attr("data-i18ncatalogurl"),self.baseUrl||(self.baseUrl="/plonejsi18n"),self.currentLanguage=$("html").attr("lang")||"en-us",self.storage=null,self.catalogs={},self.ttl=864e5,Date.now||(Date.now=function(){return(new Date).valueOf()});try{"localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&(self.storage=window.localStorage)}catch(e){}self.configure=function(config){for(var key in config)self[key]=config[key]},self._setCatalog=function(domain,language,catalog){domain in self.catalogs?self.catalogs[domain][language]=catalog:(self.catalogs[domain]={},self.catalogs[domain][language]=catalog)},self._storeCatalog=function(domain,language,catalog){var key=domain+"-"+language;null!==self.storage&&null!==catalog&&(self.storage.setItem(key,JSON.stringify(catalog)),self.storage.setItem(key+"-updated",Date.now()))},self.getUrl=function(domain,language){return self.baseUrl+"?domain="+domain+"&language="+language},self.loadCatalog=function(domain,language){if(void 0===language&&(language=self.currentLanguage),null!==self.storage){var key=domain+"-"+language;if(key in self.storage&&Date.now()-parseInt(self.storage.getItem(key+"-updated"),10)<self.ttl){var catalog=JSON.parse(self.storage.getItem(key));return void self._setCatalog(domain,language,catalog)}}$.getJSON(self.getUrl(domain,language),function(catalog){null!==catalog&&(self._setCatalog(domain,language,catalog),self._storeCatalog(domain,language,catalog))})},self.MessageFactory=function(domain,language){return language=language||self.currentLanguage,function(msgid,keywords){var msgstr;if(msgstr=domain in self.catalogs&&language in self.catalogs[domain]&&msgid in self.catalogs[domain][language]?self.catalogs[domain][language][msgid]:msgid,keywords){var regexp,keyword;for(keyword in keywords)keywords.hasOwnProperty(keyword)&&(regexp=new RegExp("\\$\\{"+keyword+"\\}","g"),msgstr=msgstr.replace(regexp,keywords[keyword]))}return msgstr}}};return I18N}),define("translate",["mockup-i18n"],function(I18N){"use strict";var _t=null;return function(msgid,keywords){if(null===_t){var i18n=new I18N;i18n.loadCatalog("widgets"),_t=i18n.MessageFactory("widgets")}return _t(msgid,keywords)}}),function(factory){"function"==typeof define&&define.amd?define("picker",["jquery"],factory):"object"==typeof exports?module.exports=factory(require("jquery")):this.Picker=factory(jQuery)}(function($){function PickerConstructor(ELEMENT,NAME,COMPONENT,OPTIONS){function createWrappedComponent(){return PickerConstructor._.node("div",PickerConstructor._.node("div",PickerConstructor._.node("div",PickerConstructor._.node("div",P.component.nodes(STATE.open),CLASSES.box),CLASSES.wrap),CLASSES.frame),CLASSES.holder,'tabindex="-1"')}function prepareElement(){$ELEMENT.data(NAME,P).addClass(CLASSES.input).val($ELEMENT.data("value")?P.get("select",SETTINGS.format):ELEMENT.value),SETTINGS.editable||$ELEMENT.on("focus."+STATE.id+" click."+STATE.id,function(event){event.preventDefault(),P.open()}).on("keydown."+STATE.id,handleKeydownEvent),aria(ELEMENT,{haspopup:!0,expanded:!1,readonly:!1,owns:ELEMENT.id+"_root"})}function prepareElementRoot(){aria(P.$root[0],"hidden",!0)}function prepareElementHolder(){P.$holder.on({keydown:handleKeydownEvent,"focus.toOpen":handleFocusToOpenEvent,blur:function(){$ELEMENT.removeClass(CLASSES.target)},focusin:function(event){P.$root.removeClass(CLASSES.focused),event.stopPropagation()},"mousedown click":function(event){var target=event.target;target!=P.$holder[0]&&(event.stopPropagation(),"mousedown"!=event.type||$(target).is("input, select, textarea, button, option")||(event.preventDefault(),P.$holder[0].focus()))}}).on("click","[data-pick], [data-nav], [data-clear], [data-close]",function(){var $target=$(this),targetData=$target.data(),targetDisabled=$target.hasClass(CLASSES.navDisabled)||$target.hasClass(CLASSES.disabled),activeElement=getActiveElement();activeElement=activeElement&&(activeElement.type||activeElement.href),(targetDisabled||activeElement&&!$.contains(P.$root[0],activeElement))&&P.$holder[0].focus(),!targetDisabled&&targetData.nav?P.set("highlight",P.component.item.highlight,{nav:targetData.nav}):!targetDisabled&&"pick"in targetData?(P.set("select",targetData.pick),SETTINGS.closeOnSelect&&P.close(!0)):targetData.clear?(P.clear(),SETTINGS.closeOnClear&&P.close(!0)):targetData.close&&P.close(!0)})}function prepareElementHidden(){var name;SETTINGS.hiddenName===!0?(name=ELEMENT.name,ELEMENT.name=""):(name=["string"==typeof SETTINGS.hiddenPrefix?SETTINGS.hiddenPrefix:"","string"==typeof SETTINGS.hiddenSuffix?SETTINGS.hiddenSuffix:"_submit"],name=name[0]+ELEMENT.name+name[1]),P._hidden=$('<input type=hidden name="'+name+'"'+($ELEMENT.data("value")||ELEMENT.value?' value="'+P.get("select",SETTINGS.formatSubmit)+'"':"")+">")[0],$ELEMENT.on("change."+STATE.id,function(){P._hidden.value=ELEMENT.value?P.get("select",SETTINGS.formatSubmit):""})}function focusPickerOnceOpened(){IS_DEFAULT_THEME&&supportsTransitions?P.$holder.find("."+CLASSES.frame).one("transitionend",function(){P.$holder[0].focus()}):P.$holder[0].focus()}function handleFocusToOpenEvent(event){event.stopPropagation(),$ELEMENT.addClass(CLASSES.target),P.$root.addClass(CLASSES.focused),P.open()}function handleKeydownEvent(event){var keycode=event.keyCode,isKeycodeDelete=/^(8|46)$/.test(keycode);return 27==keycode?(P.close(!0),!1):void((32==keycode||isKeycodeDelete||!STATE.open&&P.component.key[keycode])&&(event.preventDefault(),event.stopPropagation(),isKeycodeDelete?P.clear().close():P.open()))}if(!ELEMENT)return PickerConstructor;var IS_DEFAULT_THEME=!1,STATE={id:ELEMENT.id||"P"+Math.abs(~~(Math.random()*new Date))},SETTINGS=COMPONENT?$.extend(!0,{},COMPONENT.defaults,OPTIONS):OPTIONS||{},CLASSES=$.extend({},PickerConstructor.klasses(),SETTINGS.klass),$ELEMENT=$(ELEMENT),PickerInstance=function(){return this.start()},P=PickerInstance.prototype={constructor:PickerInstance,$node:$ELEMENT,start:function(){return STATE&&STATE.start?P:(STATE.methods={},STATE.start=!0,STATE.open=!1,STATE.type=ELEMENT.type,ELEMENT.autofocus=ELEMENT==getActiveElement(),ELEMENT.readOnly=!SETTINGS.editable,ELEMENT.id=ELEMENT.id||STATE.id,"text"!=ELEMENT.type&&(ELEMENT.type="text"),P.component=new COMPONENT(P,SETTINGS),P.$root=$('<div class="'+CLASSES.picker+'" id="'+ELEMENT.id+'_root" />'),prepareElementRoot(),P.$holder=$(createWrappedComponent()).appendTo(P.$root),prepareElementHolder(),SETTINGS.formatSubmit&&prepareElementHidden(),prepareElement(),SETTINGS.containerHidden?$(SETTINGS.containerHidden).append(P._hidden):$ELEMENT.after(P._hidden),SETTINGS.container?$(SETTINGS.container).append(P.$root):$ELEMENT.after(P.$root),P.on({start:P.component.onStart,render:P.component.onRender,stop:P.component.onStop,open:P.component.onOpen,close:P.component.onClose,set:P.component.onSet}).on({start:SETTINGS.onStart,render:SETTINGS.onRender,stop:SETTINGS.onStop,open:SETTINGS.onOpen,close:SETTINGS.onClose,set:SETTINGS.onSet}),IS_DEFAULT_THEME=isUsingDefaultTheme(P.$holder[0]),ELEMENT.autofocus&&P.open(),P.trigger("start").trigger("render"))},render:function(entireComponent){return entireComponent?(P.$holder=$(createWrappedComponent()),prepareElementHolder(),P.$root.html(P.$holder)):P.$root.find("."+CLASSES.box).html(P.component.nodes(STATE.open)),P.trigger("render")},stop:function(){return STATE.start?(P.close(),P._hidden&&P._hidden.parentNode.removeChild(P._hidden),P.$root.remove(),$ELEMENT.removeClass(CLASSES.input).removeData(NAME),setTimeout(function(){$ELEMENT.off("."+STATE.id)},0),ELEMENT.type=STATE.type,ELEMENT.readOnly=!1,P.trigger("stop"),STATE.methods={},STATE.start=!1,P):P},open:function(dontGiveFocus){return STATE.open?P:($ELEMENT.addClass(CLASSES.active),aria(ELEMENT,"expanded",!0),setTimeout(function(){P.$root.addClass(CLASSES.opened),aria(P.$root[0],"hidden",!1)},0),dontGiveFocus!==!1&&(STATE.open=!0,IS_DEFAULT_THEME&&$html.css("overflow","hidden").css("padding-right","+="+getScrollbarWidth()),focusPickerOnceOpened(),$document.on("click."+STATE.id+" focusin."+STATE.id,function(event){var target=event.target;target!=ELEMENT&&target!=document&&3!=event.which&&P.close(target===P.$holder[0])}).on("keydown."+STATE.id,function(event){var keycode=event.keyCode,keycodeToMove=P.component.key[keycode],target=event.target;27==keycode?P.close(!0):target!=P.$holder[0]||!keycodeToMove&&13!=keycode?$.contains(P.$root[0],target)&&13==keycode&&(event.preventDefault(),target.click()):(event.preventDefault(),keycodeToMove?PickerConstructor._.trigger(P.component.key.go,P,[PickerConstructor._.trigger(keycodeToMove)]):P.$root.find("."+CLASSES.highlighted).hasClass(CLASSES.disabled)||(P.set("select",P.component.item.highlight),SETTINGS.closeOnSelect&&P.close(!0)))})),P.trigger("open"))},close:function(giveFocus){return giveFocus&&(SETTINGS.editable?ELEMENT.focus():(P.$holder.off("focus.toOpen").focus(),setTimeout(function(){P.$holder.on("focus.toOpen",handleFocusToOpenEvent)},0))),$ELEMENT.removeClass(CLASSES.active),aria(ELEMENT,"expanded",!1),setTimeout(function(){P.$root.removeClass(CLASSES.opened+" "+CLASSES.focused),aria(P.$root[0],"hidden",!0)},0),STATE.open?(STATE.open=!1,IS_DEFAULT_THEME&&$html.css("overflow","").css("padding-right","-="+getScrollbarWidth()),$document.off("."+STATE.id),P.trigger("close")):P},clear:function(options){return P.set("clear",null,options)},set:function(thing,value,options){var thingItem,thingValue,thingIsObject=$.isPlainObject(thing),thingObject=thingIsObject?thing:{};if(options=thingIsObject&&$.isPlainObject(value)?value:options||{},thing){thingIsObject||(thingObject[thing]=value);for(thingItem in thingObject)thingValue=thingObject[thingItem],thingItem in P.component.item&&(void 0===thingValue&&(thingValue=null),P.component.set(thingItem,thingValue,options)),"select"!=thingItem&&"clear"!=thingItem||$ELEMENT.val("clear"==thingItem?"":P.get(thingItem,SETTINGS.format)).trigger("change");P.render()}return options.muted?P:P.trigger("set",thingObject)},get:function(thing,format){if(thing=thing||"value",null!=STATE[thing])return STATE[thing];if("valueSubmit"==thing){if(P._hidden)return P._hidden.value;thing="value"}if("value"==thing)return ELEMENT.value;if(thing in P.component.item){if("string"==typeof format){var thingValue=P.component.get(thing);return thingValue?PickerConstructor._.trigger(P.component.formats.toString,P.component,[format,thingValue]):""}return P.component.get(thing)}},on:function(thing,method,internal){var thingName,thingMethod,thingIsObject=$.isPlainObject(thing),thingObject=thingIsObject?thing:{};if(thing){thingIsObject||(thingObject[thing]=method);for(thingName in thingObject)thingMethod=thingObject[thingName],internal&&(thingName="_"+thingName),STATE.methods[thingName]=STATE.methods[thingName]||[],STATE.methods[thingName].push(thingMethod)}return P},off:function(){var i,thingName,names=arguments;for(i=0,namesCount=names.length;i<namesCount;i+=1)thingName=names[i],thingName in STATE.methods&&delete STATE.methods[thingName];return P},trigger:function(name,data){var _trigger=function(name){var methodList=STATE.methods[name];methodList&&methodList.map(function(method){PickerConstructor._.trigger(method,P,[data])})};return _trigger("_"+name),_trigger(name),P}};return new PickerInstance}function isUsingDefaultTheme(element){var theme,prop="position";return element.currentStyle?theme=element.currentStyle[prop]:window.getComputedStyle&&(theme=getComputedStyle(element)[prop]),"fixed"==theme}function getScrollbarWidth(){if($html.height()<=$window.height())return 0;var $outer=$('<div style="visibility:hidden;width:100px" />').appendTo("body"),widthWithoutScroll=$outer[0].offsetWidth;$outer.css("overflow","scroll");var $inner=$('<div style="width:100%" />').appendTo($outer),widthWithScroll=$inner[0].offsetWidth;return $outer.remove(),widthWithoutScroll-widthWithScroll}function aria(element,attribute,value){if($.isPlainObject(attribute))for(var key in attribute)ariaSet(element,key,attribute[key]);else ariaSet(element,attribute,value)}function ariaSet(element,attribute,value){element.setAttribute(("role"==attribute?"":"aria-")+attribute,value)}function ariaAttr(attribute,data){$.isPlainObject(attribute)||(attribute={attribute:data}),data="";for(var key in attribute){var attr=("role"==key?"":"aria-")+key,attrVal=attribute[key];data+=null==attrVal?"":attr+'="'+attribute[key]+'"'}return data}function getActiveElement(){try{return document.activeElement}catch(err){}}var $window=$(window),$document=$(document),$html=$(document.documentElement),supportsTransitions=null!=document.documentElement.style.transition;return PickerConstructor.klasses=function(prefix){return prefix=prefix||"picker",{picker:prefix,opened:prefix+"--opened",focused:prefix+"--focused",input:prefix+"__input",active:prefix+"__input--active",target:prefix+"__input--target",holder:prefix+"__holder",frame:prefix+"__frame",wrap:prefix+"__wrap",box:prefix+"__box"}},PickerConstructor._={group:function(groupObject){for(var loopObjectScope,nodesList="",counter=PickerConstructor._.trigger(groupObject.min,groupObject);counter<=PickerConstructor._.trigger(groupObject.max,groupObject,[counter]);counter+=groupObject.i)loopObjectScope=PickerConstructor._.trigger(groupObject.item,groupObject,[counter]),nodesList+=PickerConstructor._.node(groupObject.node,loopObjectScope[0],loopObjectScope[1],loopObjectScope[2]);return nodesList},node:function(wrapper,item,klass,attribute){return item?(item=$.isArray(item)?item.join(""):item,klass=klass?' class="'+klass+'"':"",attribute=attribute?" "+attribute:"","<"+wrapper+klass+attribute+">"+item+"</"+wrapper+">"):""},lead:function(number){return(number<10?"0":"")+number},trigger:function(callback,scope,args){return"function"==typeof callback?callback.apply(scope,args||[]):callback},digits:function(string){return/\d/.test(string[1])?2:1},isDate:function(value){return{}.toString.call(value).indexOf("Date")>-1&&this.isInteger(value.getDate())},isInteger:function(value){return{}.toString.call(value).indexOf("Number")>-1&&value%1===0},ariaAttr:ariaAttr},PickerConstructor.extend=function(name,Component){$.fn[name]=function(options,action){var componentData=this.data(name);return"picker"==options?componentData:componentData&&"string"==typeof options?PickerConstructor._.trigger(componentData[options],componentData,[action]):this.each(function(){var $this=$(this);$this.data(name)||new PickerConstructor(this,name,Component,options)})},$.fn[name].defaults=Component.defaults},PickerConstructor}),function(factory){"function"==typeof define&&define.amd?define("picker.date",["picker","jquery"],factory):"object"==typeof exports?module.exports=factory(require("./picker.js"),require("jquery")):factory(Picker,jQuery)}(function(Picker,$){function DatePicker(picker,settings){var calendar=this,element=picker.$node[0],elementValue=element.value,elementDataValue=picker.$node.data("value"),valueString=elementDataValue||elementValue,formatString=elementDataValue?settings.formatSubmit:settings.format,isRTL=function(){return element.currentStyle?"rtl"==element.currentStyle.direction:"rtl"==getComputedStyle(picker.$root[0]).direction};calendar.settings=settings,calendar.$node=picker.$node,calendar.queue={min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse navigate create validate",view:"parse create validate viewset",disable:"deactivate",enable:"activate"},calendar.item={},calendar.item.clear=null,calendar.item.disable=(settings.disable||[]).slice(0),calendar.item.enable=-function(collectionDisabled){return collectionDisabled[0]===!0?collectionDisabled.shift():-1}(calendar.item.disable),calendar.set("min",settings.min).set("max",settings.max).set("now"),valueString?calendar.set("select",valueString,{format:formatString,defaultValue:!0}):calendar.set("select",null).set("highlight",calendar.item.now),calendar.key={40:7,38:-7,39:function(){return isRTL()?-1:1},37:function(){return isRTL()?1:-1},go:function(timeChange){var highlightedObject=calendar.item.highlight,targetDate=new Date(highlightedObject.year,highlightedObject.month,highlightedObject.date+timeChange);calendar.set("highlight",targetDate,{interval:timeChange}),this.render()}},picker.on("render",function(){picker.$root.find("."+settings.klass.selectMonth).on("change",function(){var value=this.value;value&&(picker.set("highlight",[picker.get("view").year,value,picker.get("highlight").date]),picker.$root.find("."+settings.klass.selectMonth).trigger("focus"))}),picker.$root.find("."+settings.klass.selectYear).on("change",function(){var value=this.value;value&&(picker.set("highlight",[value,picker.get("view").month,picker.get("highlight").date]),picker.$root.find("."+settings.klass.selectYear).trigger("focus"))})},1).on("open",function(){var includeToday="";calendar.disabled(calendar.get("now"))&&(includeToday=":not(."+settings.klass.buttonToday+")"),picker.$root.find("button"+includeToday+", select").attr("disabled",!1)},1).on("close",function(){picker.$root.find("button, select").attr("disabled",!0)},1)}var DAYS_IN_WEEK=7,WEEKS_IN_CALENDAR=6,_=Picker._;DatePicker.prototype.set=function(type,value,options){var calendar=this,calendarItem=calendar.item;return null===value?("clear"==type&&(type="select"),calendarItem[type]=value,calendar):(calendarItem["enable"==type?"disable":"flip"==type?"enable":type]=calendar.queue[type].split(" ").map(function(method){return value=calendar[method](type,value,options)}).pop(),"select"==type?calendar.set("highlight",calendarItem.select,options):"highlight"==type?calendar.set("view",calendarItem.highlight,options):type.match(/^(flip|min|max|disable|enable)$/)&&(calendarItem.select&&calendar.disabled(calendarItem.select)&&calendar.set("select",calendarItem.select,options),calendarItem.highlight&&calendar.disabled(calendarItem.highlight)&&calendar.set("highlight",calendarItem.highlight,options)),calendar)},DatePicker.prototype.get=function(type){return this.item[type]},DatePicker.prototype.create=function(type,value,options){var isInfiniteValue,calendar=this;return value=void 0===value?type:value,value==-(1/0)||value==1/0?isInfiniteValue=value:$.isPlainObject(value)&&_.isInteger(value.pick)?value=value.obj:$.isArray(value)?(value=new Date(value[0],value[1],value[2]),value=_.isDate(value)?value:calendar.create().obj):value=_.isInteger(value)||_.isDate(value)?calendar.normalize(new Date(value),options):calendar.now(type,value,options),{year:isInfiniteValue||value.getFullYear(),month:isInfiniteValue||value.getMonth(),date:isInfiniteValue||value.getDate(),day:isInfiniteValue||value.getDay(),obj:isInfiniteValue||value,pick:isInfiniteValue||value.getTime()}},DatePicker.prototype.createRange=function(from,to){var calendar=this,createDate=function(date){return date===!0||$.isArray(date)||_.isDate(date)?calendar.create(date):date};return _.isInteger(from)||(from=createDate(from)),_.isInteger(to)||(to=createDate(to)),_.isInteger(from)&&$.isPlainObject(to)?from=[to.year,to.month,to.date+from]:_.isInteger(to)&&$.isPlainObject(from)&&(to=[from.year,from.month,from.date+to]),{from:createDate(from),to:createDate(to)}},DatePicker.prototype.withinRange=function(range,dateUnit){return range=this.createRange(range.from,range.to),dateUnit.pick>=range.from.pick&&dateUnit.pick<=range.to.pick},DatePicker.prototype.overlapRanges=function(one,two){var calendar=this;return one=calendar.createRange(one.from,one.to),two=calendar.createRange(two.from,two.to),calendar.withinRange(one,two.from)||calendar.withinRange(one,two.to)||calendar.withinRange(two,one.from)||calendar.withinRange(two,one.to)},DatePicker.prototype.now=function(type,value,options){return value=new Date,options&&options.rel&&value.setDate(value.getDate()+options.rel),this.normalize(value,options)},DatePicker.prototype.navigate=function(type,value,options){var targetDateObject,targetYear,targetMonth,targetDate,isTargetArray=$.isArray(value),isTargetObject=$.isPlainObject(value),viewsetObject=this.item.view;if(isTargetArray||isTargetObject){for(isTargetObject?(targetYear=value.year,targetMonth=value.month,targetDate=value.date):(targetYear=+value[0],targetMonth=+value[1],targetDate=+value[2]),options&&options.nav&&viewsetObject&&viewsetObject.month!==targetMonth&&(targetYear=viewsetObject.year,targetMonth=viewsetObject.month),targetDateObject=new Date(targetYear,targetMonth+(options&&options.nav?options.nav:0),1),targetYear=targetDateObject.getFullYear(),targetMonth=targetDateObject.getMonth();new Date(targetYear,targetMonth,targetDate).getMonth()!==targetMonth;)targetDate-=1;value=[targetYear,targetMonth,targetDate]}return value},DatePicker.prototype.normalize=function(value){return value.setHours(0,0,0,0),value},DatePicker.prototype.measure=function(type,value){var calendar=this;return value?"string"==typeof value?value=calendar.parse(type,value):_.isInteger(value)&&(value=calendar.now(type,value,{rel:value})):value="min"==type?-(1/0):1/0,value},DatePicker.prototype.viewset=function(type,dateObject){return this.create([dateObject.year,dateObject.month,1])},DatePicker.prototype.validate=function(type,dateObject,options){var hasEnabledBeforeTarget,hasEnabledAfterTarget,reachedMin,reachedMax,calendar=this,originalDateObject=dateObject,interval=options&&options.interval?options.interval:1,isFlippedBase=calendar.item.enable===-1,minLimitObject=calendar.item.min,maxLimitObject=calendar.item.max,hasEnabledWeekdays=isFlippedBase&&calendar.item.disable.filter(function(value){if($.isArray(value)){var dateTime=calendar.create(value).pick;dateTime<dateObject.pick?hasEnabledBeforeTarget=!0:dateTime>dateObject.pick&&(hasEnabledAfterTarget=!0)}return _.isInteger(value)}).length;if((!options||!options.nav&&!options.defaultValue)&&(!isFlippedBase&&calendar.disabled(dateObject)||isFlippedBase&&calendar.disabled(dateObject)&&(hasEnabledWeekdays||hasEnabledBeforeTarget||hasEnabledAfterTarget)||!isFlippedBase&&(dateObject.pick<=minLimitObject.pick||dateObject.pick>=maxLimitObject.pick)))for(isFlippedBase&&!hasEnabledWeekdays&&(!hasEnabledAfterTarget&&interval>0||!hasEnabledBeforeTarget&&interval<0)&&(interval*=-1);calendar.disabled(dateObject)&&(Math.abs(interval)>1&&(dateObject.month<originalDateObject.month||dateObject.month>originalDateObject.month)&&(dateObject=originalDateObject,interval=interval>0?1:-1),dateObject.pick<=minLimitObject.pick?(reachedMin=!0,interval=1,dateObject=calendar.create([minLimitObject.year,minLimitObject.month,minLimitObject.date+(dateObject.pick===minLimitObject.pick?0:-1)])):dateObject.pick>=maxLimitObject.pick&&(reachedMax=!0,interval=-1,dateObject=calendar.create([maxLimitObject.year,maxLimitObject.month,maxLimitObject.date+(dateObject.pick===maxLimitObject.pick?0:1)])),!reachedMin||!reachedMax);)dateObject=calendar.create([dateObject.year,dateObject.month,dateObject.date+interval]);return dateObject},DatePicker.prototype.disabled=function(dateToVerify){var calendar=this,isDisabledMatch=calendar.item.disable.filter(function(dateToDisable){return _.isInteger(dateToDisable)?dateToVerify.day===(calendar.settings.firstDay?dateToDisable:dateToDisable-1)%7:$.isArray(dateToDisable)||_.isDate(dateToDisable)?dateToVerify.pick===calendar.create(dateToDisable).pick:$.isPlainObject(dateToDisable)?calendar.withinRange(dateToDisable,dateToVerify):void 0});return isDisabledMatch=isDisabledMatch.length&&!isDisabledMatch.filter(function(dateToDisable){return $.isArray(dateToDisable)&&"inverted"==dateToDisable[3]||$.isPlainObject(dateToDisable)&&dateToDisable.inverted}).length,calendar.item.enable===-1?!isDisabledMatch:isDisabledMatch||dateToVerify.pick<calendar.item.min.pick||dateToVerify.pick>calendar.item.max.pick},DatePicker.prototype.parse=function(type,value,options){var calendar=this,parsingObject={};return value&&"string"==typeof value?(options&&options.format||(options=options||{},options.format=calendar.settings.format),calendar.formats.toArray(options.format).map(function(label){var formattingLabel=calendar.formats[label],formatLength=formattingLabel?_.trigger(formattingLabel,calendar,[value,parsingObject]):label.replace(/^!/,"").length;formattingLabel&&(parsingObject[label]=value.substr(0,formatLength)),value=value.substr(formatLength)}),[parsingObject.yyyy||parsingObject.yy,+(parsingObject.mm||parsingObject.m)-1,parsingObject.dd||parsingObject.d]):value},DatePicker.prototype.formats=function(){function getWordLengthFromCollection(string,collection,dateObject){var word=string.match(/[^\x00-\x7F]+|\w+/)[0];return dateObject.mm||dateObject.m||(dateObject.m=collection.indexOf(word)+1),word.length}function getFirstWordLength(string){return string.match(/\w+/)[0].length}return{d:function(string,dateObject){return string?_.digits(string):dateObject.date},dd:function(string,dateObject){return string?2:_.lead(dateObject.date)},ddd:function(string,dateObject){return string?getFirstWordLength(string):this.settings.weekdaysShort[dateObject.day]},dddd:function(string,dateObject){return string?getFirstWordLength(string):this.settings.weekdaysFull[dateObject.day]},m:function(string,dateObject){return string?_.digits(string):dateObject.month+1},mm:function(string,dateObject){return string?2:_.lead(dateObject.month+1)},mmm:function(string,dateObject){var collection=this.settings.monthsShort;return string?getWordLengthFromCollection(string,collection,dateObject):collection[dateObject.month]},mmmm:function(string,dateObject){var collection=this.settings.monthsFull;return string?getWordLengthFromCollection(string,collection,dateObject):collection[dateObject.month]},yy:function(string,dateObject){return string?2:(""+dateObject.year).slice(2)},yyyy:function(string,dateObject){return string?4:dateObject.year},toArray:function(formatString){return formatString.split(/(d{1,4}|m{1,4}|y{4}|yy|!.)/g)},toString:function(formatString,itemObject){var calendar=this;return calendar.formats.toArray(formatString).map(function(label){return _.trigger(calendar.formats[label],calendar,[0,itemObject])||label.replace(/^!/,"")}).join("")}}}(),DatePicker.prototype.isDateExact=function(one,two){var calendar=this;return _.isInteger(one)&&_.isInteger(two)||"boolean"==typeof one&&"boolean"==typeof two?one===two:(_.isDate(one)||$.isArray(one))&&(_.isDate(two)||$.isArray(two))?calendar.create(one).pick===calendar.create(two).pick:!(!$.isPlainObject(one)||!$.isPlainObject(two))&&(calendar.isDateExact(one.from,two.from)&&calendar.isDateExact(one.to,two.to))},DatePicker.prototype.isDateOverlap=function(one,two){var calendar=this,firstDay=calendar.settings.firstDay?1:0;return _.isInteger(one)&&(_.isDate(two)||$.isArray(two))?(one=one%7+firstDay,one===calendar.create(two).day+1):_.isInteger(two)&&(_.isDate(one)||$.isArray(one))?(two=two%7+firstDay,two===calendar.create(one).day+1):!(!$.isPlainObject(one)||!$.isPlainObject(two))&&calendar.overlapRanges(one,two)},DatePicker.prototype.flipEnable=function(val){var itemObject=this.item;itemObject.enable=val||(itemObject.enable==-1?1:-1)},DatePicker.prototype.deactivate=function(type,datesToDisable){var calendar=this,disabledItems=calendar.item.disable.slice(0);return"flip"==datesToDisable?calendar.flipEnable():datesToDisable===!1?(calendar.flipEnable(1),disabledItems=[]):datesToDisable===!0?(calendar.flipEnable(-1),disabledItems=[]):datesToDisable.map(function(unitToDisable){for(var matchFound,index=0;index<disabledItems.length;index+=1)if(calendar.isDateExact(unitToDisable,disabledItems[index])){matchFound=!0;break}matchFound||(_.isInteger(unitToDisable)||_.isDate(unitToDisable)||$.isArray(unitToDisable)||$.isPlainObject(unitToDisable)&&unitToDisable.from&&unitToDisable.to)&&disabledItems.push(unitToDisable)}),disabledItems},DatePicker.prototype.activate=function(type,datesToEnable){var calendar=this,disabledItems=calendar.item.disable,disabledItemsCount=disabledItems.length;return"flip"==datesToEnable?calendar.flipEnable():datesToEnable===!0?(calendar.flipEnable(1),disabledItems=[]):datesToEnable===!1?(calendar.flipEnable(-1),disabledItems=[]):datesToEnable.map(function(unitToEnable){var matchFound,disabledUnit,index,isExactRange;for(index=0;index<disabledItemsCount;index+=1){if(disabledUnit=disabledItems[index],calendar.isDateExact(disabledUnit,unitToEnable)){matchFound=disabledItems[index]=null,isExactRange=!0;break}if(calendar.isDateOverlap(disabledUnit,unitToEnable)){$.isPlainObject(unitToEnable)?(unitToEnable.inverted=!0,matchFound=unitToEnable):$.isArray(unitToEnable)?(matchFound=unitToEnable,matchFound[3]||matchFound.push("inverted")):_.isDate(unitToEnable)&&(matchFound=[unitToEnable.getFullYear(),unitToEnable.getMonth(),unitToEnable.getDate(),"inverted"]);break}}if(matchFound)for(index=0;index<disabledItemsCount;index+=1)if(calendar.isDateExact(disabledItems[index],unitToEnable)){disabledItems[index]=null;break}if(isExactRange)for(index=0;index<disabledItemsCount;index+=1)if(calendar.isDateOverlap(disabledItems[index],unitToEnable)){disabledItems[index]=null;break}matchFound&&disabledItems.push(matchFound)}),disabledItems.filter(function(val){return null!=val})},DatePicker.prototype.nodes=function(isOpen){var calendar=this,settings=calendar.settings,calendarItem=calendar.item,nowObject=calendarItem.now,selectedObject=calendarItem.select,highlightedObject=calendarItem.highlight,viewsetObject=calendarItem.view,disabledCollection=calendarItem.disable,minLimitObject=calendarItem.min,maxLimitObject=calendarItem.max,tableHead=function(collection,fullCollection){return settings.firstDay&&(collection.push(collection.shift()),fullCollection.push(fullCollection.shift())),_.node("thead",_.node("tr",_.group({min:0,max:DAYS_IN_WEEK-1,i:1,node:"th",item:function(counter){return[collection[counter],settings.klass.weekdays,'scope=col title="'+fullCollection[counter]+'"']}})))}((settings.showWeekdaysFull?settings.weekdaysFull:settings.weekdaysShort).slice(0),settings.weekdaysFull.slice(0)),createMonthNav=function(next){return _.node("div"," ",settings.klass["nav"+(next?"Next":"Prev")]+(next&&viewsetObject.year>=maxLimitObject.year&&viewsetObject.month>=maxLimitObject.month||!next&&viewsetObject.year<=minLimitObject.year&&viewsetObject.month<=minLimitObject.month?" "+settings.klass.navDisabled:""),"data-nav="+(next||-1)+" "+_.ariaAttr({
role:"button",controls:calendar.$node[0].id+"_table"})+' title="'+(next?settings.labelMonthNext:settings.labelMonthPrev)+'"')},createMonthLabel=function(){var monthsCollection=settings.showMonthsShort?settings.monthsShort:settings.monthsFull;return settings.selectMonths?_.node("select",_.group({min:0,max:11,i:1,node:"option",item:function(loopedMonth){return[monthsCollection[loopedMonth],0,"value="+loopedMonth+(viewsetObject.month==loopedMonth?" selected":"")+(viewsetObject.year==minLimitObject.year&&loopedMonth<minLimitObject.month||viewsetObject.year==maxLimitObject.year&&loopedMonth>maxLimitObject.month?" disabled":"")]}}),settings.klass.selectMonth,(isOpen?"":"disabled")+" "+_.ariaAttr({controls:calendar.$node[0].id+"_table"})+' title="'+settings.labelMonthSelect+'"'):_.node("div",monthsCollection[viewsetObject.month],settings.klass.month)},createYearLabel=function(){var focusedYear=viewsetObject.year,numberYears=settings.selectYears===!0?5:~~(settings.selectYears/2);if(numberYears){var minYear=minLimitObject.year,maxYear=maxLimitObject.year,lowestYear=focusedYear-numberYears,highestYear=focusedYear+numberYears;if(minYear>lowestYear&&(highestYear+=minYear-lowestYear,lowestYear=minYear),maxYear<highestYear){var availableYears=lowestYear-minYear,neededYears=highestYear-maxYear;lowestYear-=availableYears>neededYears?neededYears:availableYears,highestYear=maxYear}return _.node("select",_.group({min:lowestYear,max:highestYear,i:1,node:"option",item:function(loopedYear){return[loopedYear,0,"value="+loopedYear+(focusedYear==loopedYear?" selected":"")]}}),settings.klass.selectYear,(isOpen?"":"disabled")+" "+_.ariaAttr({controls:calendar.$node[0].id+"_table"})+' title="'+settings.labelYearSelect+'"')}return _.node("div",focusedYear,settings.klass.year)};return _.node("div",(settings.selectYears?createYearLabel()+createMonthLabel():createMonthLabel()+createYearLabel())+createMonthNav()+createMonthNav(1),settings.klass.header)+_.node("table",tableHead+_.node("tbody",_.group({min:0,max:WEEKS_IN_CALENDAR-1,i:1,node:"tr",item:function(rowCounter){var shiftDateBy=settings.firstDay&&0===calendar.create([viewsetObject.year,viewsetObject.month,1]).day?-7:0;return[_.group({min:DAYS_IN_WEEK*rowCounter-viewsetObject.day+shiftDateBy+1,max:function(){return this.min+DAYS_IN_WEEK-1},i:1,node:"td",item:function(targetDate){targetDate=calendar.create([viewsetObject.year,viewsetObject.month,targetDate+(settings.firstDay?1:0)]);var isSelected=selectedObject&&selectedObject.pick==targetDate.pick,isHighlighted=highlightedObject&&highlightedObject.pick==targetDate.pick,isDisabled=disabledCollection&&calendar.disabled(targetDate)||targetDate.pick<minLimitObject.pick||targetDate.pick>maxLimitObject.pick,formattedDate=_.trigger(calendar.formats.toString,calendar,[settings.format,targetDate]);return[_.node("div",targetDate.date,function(klasses){return klasses.push(viewsetObject.month==targetDate.month?settings.klass.infocus:settings.klass.outfocus),nowObject.pick==targetDate.pick&&klasses.push(settings.klass.now),isSelected&&klasses.push(settings.klass.selected),isHighlighted&&klasses.push(settings.klass.highlighted),isDisabled&&klasses.push(settings.klass.disabled),klasses.join(" ")}([settings.klass.day]),"data-pick="+targetDate.pick+" "+_.ariaAttr({role:"gridcell",label:formattedDate,selected:!(!isSelected||calendar.$node.val()!==formattedDate)||null,activedescendant:!!isHighlighted||null,disabled:!!isDisabled||null})),"",_.ariaAttr({role:"presentation"})]}})]}})),settings.klass.table,'id="'+calendar.$node[0].id+'_table" '+_.ariaAttr({role:"grid",controls:calendar.$node[0].id,readonly:!0}))+_.node("div",_.node("button",settings.today,settings.klass.buttonToday,"type=button data-pick="+nowObject.pick+(isOpen&&!calendar.disabled(nowObject)?"":" disabled")+" "+_.ariaAttr({controls:calendar.$node[0].id}))+_.node("button",settings.clear,settings.klass.buttonClear,"type=button data-clear=1"+(isOpen?"":" disabled")+" "+_.ariaAttr({controls:calendar.$node[0].id}))+_.node("button",settings.close,settings.klass.buttonClose,"type=button data-close=true "+(isOpen?"":" disabled")+" "+_.ariaAttr({controls:calendar.$node[0].id})),settings.klass.footer)},DatePicker.defaults=function(prefix){return{labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdaysFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],today:"Today",clear:"Clear",close:"Close",closeOnSelect:!0,closeOnClear:!0,format:"d mmmm, yyyy",klass:{table:prefix+"table",header:prefix+"header",navPrev:prefix+"nav--prev",navNext:prefix+"nav--next",navDisabled:prefix+"nav--disabled",month:prefix+"month",year:prefix+"year",selectMonth:prefix+"select--month",selectYear:prefix+"select--year",weekdays:prefix+"weekday",day:prefix+"day",disabled:prefix+"day--disabled",selected:prefix+"day--selected",highlighted:prefix+"day--highlighted",now:prefix+"day--today",infocus:prefix+"day--infocus",outfocus:prefix+"day--outfocus",footer:prefix+"footer",buttonClear:prefix+"button--clear",buttonToday:prefix+"button--today",buttonClose:prefix+"button--close"}}}(Picker.klasses().picker+"__"),Picker.extend("pickadate",DatePicker)}),function(factory){"function"==typeof define&&define.amd?define("picker.time",["picker","jquery"],factory):"object"==typeof exports?module.exports=factory(require("./picker.js"),require("jquery")):factory(Picker,jQuery)}(function(Picker,$){function TimePicker(picker,settings){var clock=this,elementValue=picker.$node[0].value,elementDataValue=picker.$node.data("value"),valueString=elementDataValue||elementValue,formatString=elementDataValue?settings.formatSubmit:settings.format;clock.settings=settings,clock.$node=picker.$node,clock.queue={interval:"i",min:"measure create",max:"measure create",now:"now create",select:"parse create validate",highlight:"parse create validate",view:"parse create validate",disable:"deactivate",enable:"activate"},clock.item={},clock.item.clear=null,clock.item.interval=settings.interval||30,clock.item.disable=(settings.disable||[]).slice(0),clock.item.enable=-function(collectionDisabled){return collectionDisabled[0]===!0?collectionDisabled.shift():-1}(clock.item.disable),clock.set("min",settings.min).set("max",settings.max).set("now"),valueString?clock.set("select",valueString,{format:formatString}):clock.set("select",null).set("highlight",clock.item.now),clock.key={40:1,38:-1,39:1,37:-1,go:function(timeChange){clock.set("highlight",clock.item.highlight.pick+timeChange*clock.item.interval,{interval:timeChange*clock.item.interval}),this.render()}},picker.on("render",function(){var $pickerHolder=picker.$root.children(),$viewset=$pickerHolder.find("."+settings.klass.viewset),vendors=function(prop){return["webkit","moz","ms","o",""].map(function(vendor){return(vendor?"-"+vendor+"-":"")+prop})},animations=function($el,state){vendors("transform").map(function(prop){$el.css(prop,state)}),vendors("transition").map(function(prop){$el.css(prop,state)})};$viewset.length&&(animations($pickerHolder,"none"),$pickerHolder[0].scrollTop=~~$viewset.position().top-2*$viewset[0].clientHeight,animations($pickerHolder,""))},1).on("open",function(){picker.$root.find("button").attr("disabled",!1)},1).on("close",function(){picker.$root.find("button").attr("disabled",!0)},1)}var HOURS_IN_DAY=24,MINUTES_IN_HOUR=60,HOURS_TO_NOON=12,MINUTES_IN_DAY=HOURS_IN_DAY*MINUTES_IN_HOUR,_=Picker._;TimePicker.prototype.set=function(type,value,options){var clock=this,clockItem=clock.item;return null===value?("clear"==type&&(type="select"),clockItem[type]=value,clock):(clockItem["enable"==type?"disable":"flip"==type?"enable":type]=clock.queue[type].split(" ").map(function(method){return value=clock[method](type,value,options)}).pop(),"select"==type?clock.set("highlight",clockItem.select,options):"highlight"==type?clock.set("view",clockItem.highlight,options):"interval"==type?clock.set("min",clockItem.min,options).set("max",clockItem.max,options):type.match(/^(flip|min|max|disable|enable)$/)&&(clockItem.select&&clock.disabled(clockItem.select)&&clock.set("select",value,options),clockItem.highlight&&clock.disabled(clockItem.highlight)&&clock.set("highlight",value,options),"min"==type&&clock.set("max",clockItem.max,options)),clock)},TimePicker.prototype.get=function(type){return this.item[type]},TimePicker.prototype.create=function(type,value,options){var clock=this;return value=void 0===value?type:value,_.isDate(value)&&(value=[value.getHours(),value.getMinutes()]),$.isPlainObject(value)&&_.isInteger(value.pick)?value=value.pick:$.isArray(value)?value=+value[0]*MINUTES_IN_HOUR+ +value[1]:_.isInteger(value)||(value=clock.now(type,value,options)),"max"==type&&value<clock.item.min.pick&&(value+=MINUTES_IN_DAY),"min"!=type&&"max"!=type&&(value-clock.item.min.pick)%clock.item.interval!==0&&(value+=clock.item.interval),value=clock.normalize(type,value,options),{hour:~~(HOURS_IN_DAY+value/MINUTES_IN_HOUR)%HOURS_IN_DAY,mins:(MINUTES_IN_HOUR+value%MINUTES_IN_HOUR)%MINUTES_IN_HOUR,time:(MINUTES_IN_DAY+value)%MINUTES_IN_DAY,pick:value%MINUTES_IN_DAY}},TimePicker.prototype.createRange=function(from,to){var clock=this,createTime=function(time){return time===!0||$.isArray(time)||_.isDate(time)?clock.create(time):time};return _.isInteger(from)||(from=createTime(from)),_.isInteger(to)||(to=createTime(to)),_.isInteger(from)&&$.isPlainObject(to)?from=[to.hour,to.mins+from*clock.settings.interval]:_.isInteger(to)&&$.isPlainObject(from)&&(to=[from.hour,from.mins+to*clock.settings.interval]),{from:createTime(from),to:createTime(to)}},TimePicker.prototype.withinRange=function(range,timeUnit){return range=this.createRange(range.from,range.to),timeUnit.pick>=range.from.pick&&timeUnit.pick<=range.to.pick},TimePicker.prototype.overlapRanges=function(one,two){var clock=this;return one=clock.createRange(one.from,one.to),two=clock.createRange(two.from,two.to),clock.withinRange(one,two.from)||clock.withinRange(one,two.to)||clock.withinRange(two,one.from)||clock.withinRange(two,one.to)},TimePicker.prototype.now=function(type,value){var isBelowInterval,interval=this.item.interval,date=new Date,nowMinutes=date.getHours()*MINUTES_IN_HOUR+date.getMinutes(),isValueInteger=_.isInteger(value);return nowMinutes-=nowMinutes%interval,isBelowInterval=value<0&&interval*value+nowMinutes<=-interval,nowMinutes+="min"==type&&isBelowInterval?0:interval,isValueInteger&&(nowMinutes+=interval*(isBelowInterval&&"max"!=type?value+1:value)),nowMinutes},TimePicker.prototype.normalize=function(type,value){var interval=this.item.interval,minTime=this.item.min&&this.item.min.pick||0;return value-="min"==type?0:(value-minTime)%interval},TimePicker.prototype.measure=function(type,value,options){var clock=this;return value||(value="min"==type?[0,0]:[HOURS_IN_DAY-1,MINUTES_IN_HOUR-1]),"string"==typeof value?value=clock.parse(type,value):value===!0||_.isInteger(value)?value=clock.now(type,value,options):$.isPlainObject(value)&&_.isInteger(value.pick)&&(value=clock.normalize(type,value.pick,options)),value},TimePicker.prototype.validate=function(type,timeObject,options){var clock=this,interval=options&&options.interval?options.interval:clock.item.interval;return clock.disabled(timeObject)&&(timeObject=clock.shift(timeObject,interval)),timeObject=clock.scope(timeObject),clock.disabled(timeObject)&&(timeObject=clock.shift(timeObject,interval*-1)),timeObject},TimePicker.prototype.disabled=function(timeToVerify){var clock=this,isDisabledMatch=clock.item.disable.filter(function(timeToDisable){return _.isInteger(timeToDisable)?timeToVerify.hour==timeToDisable:$.isArray(timeToDisable)||_.isDate(timeToDisable)?timeToVerify.pick==clock.create(timeToDisable).pick:$.isPlainObject(timeToDisable)?clock.withinRange(timeToDisable,timeToVerify):void 0});return isDisabledMatch=isDisabledMatch.length&&!isDisabledMatch.filter(function(timeToDisable){return $.isArray(timeToDisable)&&"inverted"==timeToDisable[2]||$.isPlainObject(timeToDisable)&&timeToDisable.inverted}).length,clock.item.enable===-1?!isDisabledMatch:isDisabledMatch||timeToVerify.pick<clock.item.min.pick||timeToVerify.pick>clock.item.max.pick},TimePicker.prototype.shift=function(timeObject,interval){var clock=this,minLimit=clock.item.min.pick,maxLimit=clock.item.max.pick;for(interval=interval||clock.item.interval;clock.disabled(timeObject)&&(timeObject=clock.create(timeObject.pick+=interval),!(timeObject.pick<=minLimit||timeObject.pick>=maxLimit)););return timeObject},TimePicker.prototype.scope=function(timeObject){var minLimit=this.item.min.pick,maxLimit=this.item.max.pick;return this.create(timeObject.pick>maxLimit?maxLimit:timeObject.pick<minLimit?minLimit:timeObject)},TimePicker.prototype.parse=function(type,value,options){var hour,minutes,isPM,item,parseValue,clock=this,parsingObject={};if(!value||"string"!=typeof value)return value;options&&options.format||(options=options||{},options.format=clock.settings.format),clock.formats.toArray(options.format).map(function(label){var substring,formattingLabel=clock.formats[label],formatLength=formattingLabel?_.trigger(formattingLabel,clock,[value,parsingObject]):label.replace(/^!/,"").length;formattingLabel&&(substring=value.substr(0,formatLength),parsingObject[label]=substring.match(/^\d+$/)?+substring:substring),value=value.substr(formatLength)});for(item in parsingObject)parseValue=parsingObject[item],_.isInteger(parseValue)?item.match(/^(h|hh)$/i)?(hour=parseValue,"h"!=item&&"hh"!=item||(hour%=12)):"i"==item&&(minutes=parseValue):item.match(/^a$/i)&&parseValue.match(/^p/i)&&("h"in parsingObject||"hh"in parsingObject)&&(isPM=!0);return(isPM?hour+12:hour)*MINUTES_IN_HOUR+minutes},TimePicker.prototype.formats={h:function(string,timeObject){return string?_.digits(string):timeObject.hour%HOURS_TO_NOON||HOURS_TO_NOON},hh:function(string,timeObject){return string?2:_.lead(timeObject.hour%HOURS_TO_NOON||HOURS_TO_NOON)},H:function(string,timeObject){return string?_.digits(string):""+timeObject.hour%24},HH:function(string,timeObject){return string?_.digits(string):_.lead(timeObject.hour%24)},i:function(string,timeObject){return string?2:_.lead(timeObject.mins)},a:function(string,timeObject){return string?4:MINUTES_IN_DAY/2>timeObject.time%MINUTES_IN_DAY?"a.m.":"p.m."},A:function(string,timeObject){return string?2:MINUTES_IN_DAY/2>timeObject.time%MINUTES_IN_DAY?"AM":"PM"},toArray:function(formatString){return formatString.split(/(h{1,2}|H{1,2}|i|a|A|!.)/g)},toString:function(formatString,itemObject){var clock=this;return clock.formats.toArray(formatString).map(function(label){return _.trigger(clock.formats[label],clock,[0,itemObject])||label.replace(/^!/,"")}).join("")}},TimePicker.prototype.isTimeExact=function(one,two){var clock=this;return _.isInteger(one)&&_.isInteger(two)||"boolean"==typeof one&&"boolean"==typeof two?one===two:(_.isDate(one)||$.isArray(one))&&(_.isDate(two)||$.isArray(two))?clock.create(one).pick===clock.create(two).pick:!(!$.isPlainObject(one)||!$.isPlainObject(two))&&(clock.isTimeExact(one.from,two.from)&&clock.isTimeExact(one.to,two.to))},TimePicker.prototype.isTimeOverlap=function(one,two){var clock=this;return _.isInteger(one)&&(_.isDate(two)||$.isArray(two))?one===clock.create(two).hour:_.isInteger(two)&&(_.isDate(one)||$.isArray(one))?two===clock.create(one).hour:!(!$.isPlainObject(one)||!$.isPlainObject(two))&&clock.overlapRanges(one,two)},TimePicker.prototype.flipEnable=function(val){var itemObject=this.item;itemObject.enable=val||(itemObject.enable==-1?1:-1)},TimePicker.prototype.deactivate=function(type,timesToDisable){var clock=this,disabledItems=clock.item.disable.slice(0);return"flip"==timesToDisable?clock.flipEnable():timesToDisable===!1?(clock.flipEnable(1),disabledItems=[]):timesToDisable===!0?(clock.flipEnable(-1),disabledItems=[]):timesToDisable.map(function(unitToDisable){for(var matchFound,index=0;index<disabledItems.length;index+=1)if(clock.isTimeExact(unitToDisable,disabledItems[index])){matchFound=!0;break}matchFound||(_.isInteger(unitToDisable)||_.isDate(unitToDisable)||$.isArray(unitToDisable)||$.isPlainObject(unitToDisable)&&unitToDisable.from&&unitToDisable.to)&&disabledItems.push(unitToDisable)}),disabledItems},TimePicker.prototype.activate=function(type,timesToEnable){var clock=this,disabledItems=clock.item.disable,disabledItemsCount=disabledItems.length;return"flip"==timesToEnable?clock.flipEnable():timesToEnable===!0?(clock.flipEnable(1),disabledItems=[]):timesToEnable===!1?(clock.flipEnable(-1),disabledItems=[]):timesToEnable.map(function(unitToEnable){var matchFound,disabledUnit,index,isRangeMatched;for(index=0;index<disabledItemsCount;index+=1){if(disabledUnit=disabledItems[index],clock.isTimeExact(disabledUnit,unitToEnable)){matchFound=disabledItems[index]=null,isRangeMatched=!0;break}if(clock.isTimeOverlap(disabledUnit,unitToEnable)){$.isPlainObject(unitToEnable)?(unitToEnable.inverted=!0,matchFound=unitToEnable):$.isArray(unitToEnable)?(matchFound=unitToEnable,matchFound[2]||matchFound.push("inverted")):_.isDate(unitToEnable)&&(matchFound=[unitToEnable.getFullYear(),unitToEnable.getMonth(),unitToEnable.getDate(),"inverted"]);break}}if(matchFound)for(index=0;index<disabledItemsCount;index+=1)if(clock.isTimeExact(disabledItems[index],unitToEnable)){disabledItems[index]=null;break}if(isRangeMatched)for(index=0;index<disabledItemsCount;index+=1)if(clock.isTimeOverlap(disabledItems[index],unitToEnable)){disabledItems[index]=null;break}matchFound&&disabledItems.push(matchFound)}),disabledItems.filter(function(val){return null!=val})},TimePicker.prototype.i=function(type,value){return _.isInteger(value)&&value>0?value:this.item.interval},TimePicker.prototype.nodes=function(isOpen){var clock=this,settings=clock.settings,selectedObject=clock.item.select,highlightedObject=clock.item.highlight,viewsetObject=clock.item.view,disabledCollection=clock.item.disable;return _.node("ul",_.group({min:clock.item.min.pick,max:clock.item.max.pick,i:clock.item.interval,node:"li",item:function(loopedTime){loopedTime=clock.create(loopedTime);var timeMinutes=loopedTime.pick,isSelected=selectedObject&&selectedObject.pick==timeMinutes,isHighlighted=highlightedObject&&highlightedObject.pick==timeMinutes,isDisabled=disabledCollection&&clock.disabled(loopedTime),formattedTime=_.trigger(clock.formats.toString,clock,[settings.format,loopedTime]);return[_.trigger(clock.formats.toString,clock,[_.trigger(settings.formatLabel,clock,[loopedTime])||settings.format,loopedTime]),function(klasses){return isSelected&&klasses.push(settings.klass.selected),isHighlighted&&klasses.push(settings.klass.highlighted),viewsetObject&&viewsetObject.pick==timeMinutes&&klasses.push(settings.klass.viewset),isDisabled&&klasses.push(settings.klass.disabled),klasses.join(" ")}([settings.klass.listItem]),"data-pick="+loopedTime.pick+" "+_.ariaAttr({role:"option",label:formattedTime,selected:!(!isSelected||clock.$node.val()!==formattedTime)||null,activedescendant:!!isHighlighted||null,disabled:!!isDisabled||null})]}})+_.node("li",_.node("button",settings.clear,settings.klass.buttonClear,"type=button data-clear=1"+(isOpen?"":" disabled")+" "+_.ariaAttr({controls:clock.$node[0].id})),"",_.ariaAttr({role:"presentation"})),settings.klass.list,_.ariaAttr({role:"listbox",controls:clock.$node[0].id}))},TimePicker.defaults=function(prefix){return{clear:"Clear",format:"h:i A",interval:30,closeOnSelect:!0,closeOnClear:!0,klass:{picker:prefix+" "+prefix+"--time",holder:prefix+"__holder",list:prefix+"__list",listItem:prefix+"__list-item",disabled:prefix+"__list-item--disabled",selected:prefix+"__list-item--selected",highlighted:prefix+"__list-item--highlighted",viewset:prefix+"__list-item--viewset",now:prefix+"__list-item--now",buttonClear:prefix+"__button--clear"}}}(Picker.klasses().picker),Picker.extend("pickatime",TimePicker)}),define("mockup-patterns-pickadate",["jquery","pat-base","translate","picker","picker.date","picker.time","mockup-patterns-select2"],function($,Base,_t){"use strict";var PickADate=Base.extend({name:"pickadate",trigger:".pat-pickadate",parser:"mockup",defaults:{separator:" ",date:{selectYears:!0,selectMonths:!0,formatSubmit:"yyyy-mm-dd",format:"yyyy-mm-dd",clear:_t("Clear"),close:_t("Close"),today:_t("Today"),labelMonthNext:_t("Next month"),labelMonthPrev:_t("Previous month"),labelMonthSelect:_t("Select a month"),labelYearSelect:_t("Select a year")},time:{},timezone:null,classWrapperName:"pattern-pickadate-wrapper",classSeparatorName:"pattern-pickadate-separator",classDateName:"pattern-pickadate-date",classDateWrapperName:"pattern-pickadate-date-wrapper",classTimeName:"pattern-pickadate-time",classTimeWrapperName:"pattern-pickadate-time-wrapper",classTimezoneName:"pattern-pickadate-timezone",classTimezoneWrapperName:"pattern-pickadate-timezone-wrapper",classClearName:"pattern-pickadate-clear",placeholderDate:_t("Enter date..."),placeholderTime:_t("Enter time..."),placeholderTimezone:_t("Enter timezone...")},isFalse:function(value){return("string"!=typeof value||"false"!==value)&&value},init:function(){var self=this,value=self.$el.val().split(" "),dateValue=value[0]||"",timeValue=value[1]||"";if(self.options.date=self.isFalse(self.options.date),self.options.time=self.isFalse(self.options.time),self.options.date===!1&&(timeValue=value[0]),self.$el.hide(),self.$wrapper=$("<div/>").addClass(self.options.classWrapperName).insertAfter(self.$el),self.options.date!==!1&&(self.$date=$('<input type="text"/>').attr("placeholder",self.options.placeholderDate).attr("data-value",dateValue).addClass(self.options.classDateName).appendTo($("<div/>").addClass(self.options.classDateWrapperName).appendTo(self.$wrapper)).pickadate($.extend(!0,{},self.options.date,{onSet:function(e){void 0!==e.select&&(self.$date.attr("data-value",e.select),self.options.time!==!1&&""===self.$time.attr("data-value")||self.updateValue.call(self)),e.hasOwnProperty("clear")&&(self.$el.val(""),self.$date.attr("data-value",""))}}))),self.options.date!==!1&&self.options.time!==!1&&(self.$separator=$("<span/>").addClass(self.options.classSeparatorName).html(" "===self.options.separator?"&nbsp;":self.options.separator).appendTo(self.$wrapper)),self.options.time!==!1&&(self.options.time.formatSubmit="HH:i",self.$time=$('<input type="text"/>').attr("placeholder",self.options.placeholderTime).attr("data-value",timeValue).addClass(self.options.classTimeName).appendTo($("<div/>").addClass(self.options.classTimeWrapperName).appendTo(self.$wrapper)).pickatime($.extend(!0,{},self.options.time,{onSet:function(e){void 0!==e.select&&(self.$time.attr("data-value",e.select),self.options.date!==!1&&""===self.$date.attr("data-value")||self.updateValue.call(self)),e.hasOwnProperty("clear")&&(self.$el.val(""),self.$time.attr("data-value",""))}})),"string"==typeof timeValue&&"00"===timeValue.substring(0,2)&&(self.$time.pickatime("picker").set("select",timeValue.split(":")),self.$time.attr("data-value",timeValue))),self.options.date!==!1&&self.options.time!==!1&&self.options.timezone&&(self.$separator=$("<span/>").addClass(self.options.classSeparatorName).html(" "===self.options.separator?"&nbsp;":self.options.separator).appendTo(self.$wrapper)),null!==self.options.timezone){self.$timezone=$('<input type="text"/>').addClass(self.options.classTimezoneName).appendTo($("<div/>").addClass(self.options.classTimezoneWrapperName).appendTo(self.$wrapper)).patternSelect2($.extend(!0,{placeholder:self.options.placeholderTimezone,width:"10em"},self.options.timezone,{multiple:!1})).on("change",function(e){void 0!==e.val&&(self.$timezone.attr("data-value",e.val),self.options.date!==!1&&""===self.$date.attr("data-value")||self.options.time!==!1&&""===self.$time.attr("data-value")||self.updateValue.call(self))});var defaultTimezone=self.options.timezone["default"];if(defaultTimezone){var isInList;self.options.timezone.data.some(function(obj){return isInList=obj.text===self.options.timezone["default"]}),isInList&&(self.$timezone.attr("data-value",defaultTimezone),self.$timezone.parent().find(".select2-chosen").text(defaultTimezone))}1===self.options.timezone.data.length&&(self.$timezone.attr("data-value",self.options.timezone.data[0].text),self.$timezone.parent().find(".select2-chosen").text(self.options.timezone.data[0].text),self.$timezone.select2("enable",!1))}self.$clear=$("<div/>").addClass(self.options.classClearName).appendTo(self.$wrapper)},updateValue:function(){var self=this,value="";if(self.options.date!==!1){var date=self.$date.data("pickadate").component,dateValue=self.$date.data("pickadate").get("select"),formatDate=date.formats.toString;dateValue&&(value+=formatDate.apply(date,[self.options.date.formatSubmit,dateValue]))}if(self.options.date!==!1&&self.options.time!==!1&&(value+=" "),self.options.time!==!1){var time=self.$time.data("pickatime").component,timeValue=self.$time.data("pickatime").get("select"),formatTime=time.formats.toString;timeValue&&(value+=formatTime.apply(time,["HH:i",timeValue]))}if(null!==self.options.timezone){var timezone=" "+self.$timezone.attr("data-value");timezone&&(value+=timezone)}self.$el.val(value),self.emit("updated")}});return PickADate}),function(root){define("jquery.tools.overlay",["jquery"],function(){return function(){!function($){function Overlay(trigger,conf){var closers,overlay,opened,self=this,fire=trigger.add(self),w=$(window),maskConf=$.tools.expose&&(conf.mask||conf.expose),uid=Math.random().toString().slice(10);maskConf&&("string"==typeof maskConf&&(maskConf={color:maskConf}),maskConf.closeOnClick=maskConf.closeOnEsc=!1);var jq=conf.target||trigger.attr("rel");if(overlay=jq?$(jq):trigger,!overlay.length)throw"Could not find Overlay: "+jq;trigger&&trigger.index(overlay)==-1&&trigger.click(function(e){return self.load(e),e.preventDefault()}),$.extend(self,{load:function(e){if(self.isOpened())return self;var eff=effects[conf.effect];if(!eff)throw'Overlay: cannot find effect : "'+conf.effect+'"';if(conf.oneInstance&&$.each(instances,function(){this.close(e)}),e=e||$.Event(),e.type="onBeforeLoad",fire.trigger(e),e.isDefaultPrevented())return self;opened=!0,maskConf&&$(overlay).expose(maskConf);var top=conf.top,left=conf.left,oWidth=overlay.outerWidth(!0),oHeight=overlay.outerHeight(!0);return"string"==typeof top&&(top="center"==top?Math.max((w.height()-oHeight)/2,0):parseInt(top,10)/100*w.height()),"center"==left&&(left=Math.max((w.width()-oWidth)/2,0)),eff[0].call(self,{top:top,left:left},function(){opened&&(e.type="onLoad",fire.trigger(e))}),maskConf&&conf.closeOnClick&&$.mask.getMask().one("click",self.close),conf.closeOnClick&&$(document).on("click."+uid,function(e){$(e.target).parents(overlay).length||self.close(e)}),conf.closeOnEsc&&$(document).on("keydown."+uid,function(e){27==e.keyCode&&self.close(e)}),self},close:function(e){return self.isOpened()?(e=e||$.Event(),e.type="onBeforeClose",fire.trigger(e),e.isDefaultPrevented()?void 0:(opened=!1,effects[conf.effect][1].call(self,function(){e.type="onClose",fire.trigger(e)}),$(document).off("click."+uid+" keydown."+uid),maskConf&&$.mask.close(),self)):self},getOverlay:function(){return overlay},getTrigger:function(){return trigger},getClosers:function(){return closers},isOpened:function(){return opened},getConf:function(){return conf}}),$.each("onBeforeLoad,onStart,onLoad,onBeforeClose,onClose".split(","),function(i,name){$.isFunction(conf[name])&&$(self).on(name,conf[name]),self[name]=function(fn){return fn&&$(self).on(name,fn),self}}),closers=overlay.find(conf.close||".close"),closers.length||conf.close||(closers=$('<a class="close"></a>'),overlay.prepend(closers)),closers.click(function(e){self.close(e)}),conf.load&&self.load()}$.tools=$.tools||{version:"@VERSION"},$.tools.overlay={addEffect:function(name,loadFn,closeFn){effects[name]=[loadFn,closeFn]},conf:{close:null,closeOnClick:!0,closeOnEsc:!0,closeSpeed:"fast",effect:"default",fixed:!/msie/.test(navigator.userAgent.toLowerCase())||navigator.appVersion>6,left:"center",load:!1,mask:null,oneInstance:!0,speed:"normal",target:null,top:"10%"}};var instances=[],effects={};$.tools.overlay.addEffect("default",function(pos,onLoad){var conf=this.getConf(),w=$(window);conf.fixed||(pos.top+=w.scrollTop(),pos.left+=w.scrollLeft()),pos.position=conf.fixed?"fixed":"absolute",this.getOverlay().css(pos).fadeIn(conf.speed,onLoad)},function(onClose){this.getOverlay().fadeOut(this.getConf().closeSpeed,onClose)}),$.fn.overlay=function(conf){var el=this.data("overlay");return el?el:($.isFunction(conf)&&(conf={onBeforeLoad:conf}),conf=$.extend(!0,{},$.tools.overlay.conf,conf),this.each(function(){el=new Overlay($(this),conf),instances.push(el),$(this).data("overlay",el)}),conf.api?el:this)}}(jQuery),function($){function find(root,query){var el=$(query);return el.length<2?el:root.parent().find(query)}function Scrollable(root,conf){var self=this,fire=root.add(self),itemWrap=root.children(),index=0,vertical=conf.vertical;if(current||(current=self),itemWrap.length>1&&(itemWrap=$(conf.items,root)),conf.size>1&&(conf.circular=!1),$.extend(self,{getConf:function(){return conf},getIndex:function(){return index},getSize:function(){return self.getItems().size()},getNaviButtons:function(){return prev.add(next)},getRoot:function(){return root},getItemWrap:function(){return itemWrap},getItems:function(){return itemWrap.find(conf.item).not("."+conf.clonedClass)},move:function(offset,time){return self.seekTo(index+offset,time)},next:function(time){return self.move(conf.size,time)},prev:function(time){return self.move(-conf.size,time)},begin:function(time){return self.seekTo(0,time)},end:function(time){return self.seekTo(self.getSize()-1,time)},focus:function(){return current=self,self},addItem:function(item){return item=$(item),conf.circular?(itemWrap.children().last().before(item),itemWrap.children().first().replaceWith(item.clone().addClass(conf.clonedClass))):(itemWrap.append(item),next.removeClass("disabled")),fire.trigger("onAddItem",[item]),self},seekTo:function(i,time,fn){if(i.jquery||(i*=1),conf.circular&&0===i&&index==-1&&0!==time)return self;if(!conf.circular&&i<0||i>self.getSize()||i<-1)return self;var item=i;i.jquery?i=self.getItems().index(i):item=self.getItems().eq(i);var e=$.Event("onBeforeSeek");if(!fn&&(fire.trigger(e,[i,time]),e.isDefaultPrevented()||!item.length))return self;var props=vertical?{top:-item.position().top}:{left:-item.position().left};return index=i,current=self,void 0===time&&(time=conf.speed),itemWrap.animate(props,time,conf.easing,fn||function(){fire.trigger("onSeek",[i])}),self}}),$.each(["onBeforeSeek","onSeek","onAddItem"],function(i,name){$.isFunction(conf[name])&&$(self).on(name,conf[name]),self[name]=function(fn){return fn&&$(self).on(name,fn),self}}),conf.circular){var cloned1=self.getItems().slice(-1).clone().prependTo(itemWrap),cloned2=self.getItems().eq(1).clone().appendTo(itemWrap);cloned1.add(cloned2).addClass(conf.clonedClass),self.onBeforeSeek(function(e,i,time){if(!e.isDefaultPrevented())return i==-1?(self.seekTo(cloned1,time,function(){self.end(0)}),e.preventDefault()):void(i==self.getSize()&&self.seekTo(cloned2,time,function(){self.begin(0)}))});var hidden_parents=root.parents().add(root).filter(function(){if("none"===$(this).css("display"))return!0});hidden_parents.length?(hidden_parents.show(),self.seekTo(0,0,function(){}),hidden_parents.hide()):self.seekTo(0,0,function(){})}var prev=find(root,conf.prev).click(function(e){e.stopPropagation(),self.prev()}),next=find(root,conf.next).click(function(e){e.stopPropagation(),self.next()});if(conf.circular||(self.onBeforeSeek(function(e,i){setTimeout(function(){e.isDefaultPrevented()||(prev.toggleClass(conf.disabledClass,i<=0),next.toggleClass(conf.disabledClass,i>=self.getSize()-1))},1)}),conf.initialIndex||prev.addClass(conf.disabledClass)),
self.getSize()<2&&prev.add(next).addClass(conf.disabledClass),conf.mousewheel&&$.fn.mousewheel&&root.mousewheel(function(e,delta){if(conf.mousewheel)return self.move(delta<0?1:-1,conf.wheelSpeed||50),!1}),conf.touch){var touch={};itemWrap[0].ontouchstart=function(e){var t=e.touches[0];touch.x=t.clientX,touch.y=t.clientY},itemWrap[0].ontouchmove=function(e){if(1==e.touches.length&&!itemWrap.is(":animated")){var t=e.touches[0],deltaX=touch.x-t.clientX,deltaY=touch.y-t.clientY;self[vertical&&deltaY>0||!vertical&&deltaX>0?"next":"prev"](),e.preventDefault()}}}conf.keyboard&&$(document).on("keydown.scrollable",function(evt){if(!(!conf.keyboard||evt.altKey||evt.ctrlKey||evt.metaKey||$(evt.target).is(":input")||"static"!=conf.keyboard&&current!=self)){var key=evt.keyCode;return!vertical||38!=key&&40!=key?vertical||37!=key&&39!=key?void 0:(self.move(37==key?-1:1),evt.preventDefault()):(self.move(38==key?-1:1),evt.preventDefault())}}),conf.initialIndex&&self.seekTo(conf.initialIndex,0,function(){})}$.tools=$.tools||{version:"@VERSION"},$.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}};var current;$.fn.scrollable=function(conf){var el=this.data("scrollable");return el?el:(conf=$.extend({},$.tools.scrollable.conf,conf),this.each(function(){el=new Scrollable($(this),conf),$(this).data("scrollable",el)}),conf.api?el:this)}}(jQuery),function($){function Tabs(root,paneSelector,conf){var current,self=this,trigger=root.add(this),tabs=root.find(conf.tabs),panes=paneSelector.jquery?paneSelector:root.children(paneSelector);tabs.length||(tabs=root.children()),panes.length||(panes=root.parent().find(paneSelector)),panes.length||(panes=$(paneSelector)),$.extend(this,{click:function(i,e){var tab=tabs.eq(i),firstRender=!root.data("tabs");if("string"==typeof i&&i.replace("#","")&&(tab=tabs.filter('[href*="'+i.replace("#","")+'"]'),i=Math.max(tabs.index(tab),0)),conf.rotate){var last=tabs.length-1;if(i<0)return self.click(last,e);if(i>last)return self.click(0,e)}if(!tab.length){if(current>=0)return self;i=conf.initialIndex,tab=tabs.eq(i)}if(i===current)return self;if(e=e||$.Event(),e.type="onBeforeClick",trigger.trigger(e,[i]),!e.isDefaultPrevented()){var effect=firstRender?conf.initialEffect&&conf.effect||"default":conf.effect;return effects[effect].call(self,i,function(){current=i,e.type="onClick",trigger.trigger(e,[i])}),tabs.removeClass(conf.current),tab.addClass(conf.current),self}},getConf:function(){return conf},getTabs:function(){return tabs},getPanes:function(){return panes},getCurrentPane:function(){return panes.eq(current)},getCurrentTab:function(){return tabs.eq(current)},getIndex:function(){return current},next:function(){return self.click(current+1)},prev:function(){return self.click(current-1)},destroy:function(){return tabs.off(conf.event).removeClass(conf.current),panes.find('a[href^="#"]').off("click.T"),self}}),$.each("onBeforeClick,onClick".split(","),function(i,name){$.isFunction(conf[name])&&$(self).on(name,conf[name]),self[name]=function(fn){return fn&&$(self).on(name,fn),self}}),conf.history&&$.fn.history&&($.tools.history.init(tabs),conf.event="history"),tabs.each(function(i){$(this).on(conf.event,function(e){return self.click(i,e),e.preventDefault()})}),panes.find('a[href^="#"]').on("click.T",function(e){self.click($(this).attr("href"),e)}),location.hash&&"a"==conf.tabs&&root.find('[href="'+location.hash+'"]').length?self.click(location.hash):(0===conf.initialIndex||conf.initialIndex>0)&&self.click(conf.initialIndex)}$.tools=$.tools||{version:"@VERSION"},$.tools.tabs={conf:{tabs:"a",current:"current",onBeforeClick:null,onClick:null,effect:"default",initialEffect:!1,initialIndex:0,event:"click",rotate:!1,slideUpSpeed:400,slideDownSpeed:400,history:!1},addEffect:function(name,fn){effects[name]=fn}};var animating,w,effects={"default":function(i,done){this.getPanes().hide().eq(i).show(),done.call()},fade:function(i,done){var conf=this.getConf(),speed=conf.fadeOutSpeed,panes=this.getPanes();speed?panes.fadeOut(speed):panes.hide(),panes.eq(i).fadeIn(conf.fadeInSpeed,done)},slide:function(i,done){var conf=this.getConf();this.getPanes().slideUp(conf.slideUpSpeed),this.getPanes().eq(i).slideDown(conf.slideDownSpeed,done)},ajax:function(i,done){this.getPanes().eq(0).load(this.getTabs().eq(i).attr("href"),done)}};$.tools.tabs.addEffect("horizontal",function(i,done){if(!animating){var nextPane=this.getPanes().eq(i),currentPane=this.getCurrentPane();w||(w=this.getPanes().eq(0).width()),animating=!0,nextPane.show(),currentPane.animate({width:0},{step:function(now){nextPane.css("width",w-now)},complete:function(){$(this).hide(),done.call(),animating=!1}}),currentPane.length||(done.call(),animating=!1)}}),$.fn.tabs=function(paneSelector,conf){var el=this.data("tabs");return el&&(el.destroy(),this.removeData("tabs")),$.isFunction(conf)&&(conf={onBeforeClick:conf}),conf=$.extend({},$.tools.tabs.conf,conf),this.each(function(){el=new Tabs($(this),paneSelector,conf),$(this).data("tabs",el)}),conf.api?el:this}}(jQuery),function($){function setIframeLocation(h){if(h){var doc=iframe.contentWindow.document;doc.open().close(),doc.location.hash=h}}var hash,iframe,links,inited;$.tools=$.tools||{version:"@VERSION"},$.tools.history={init:function(els){inited||($.browser.msie&&$.browser.version<"8"?iframe||(iframe=$("<iframe/>").attr("src","javascript:false;").hide().get(0),$("body").append(iframe),setInterval(function(){var idoc=iframe.contentWindow.document,h=idoc.location.hash;hash!==h&&$(window).trigger("hash",h)},100),setIframeLocation(location.hash||"#")):setInterval(function(){var h=location.hash;h!==hash&&$(window).trigger("hash",h)},100),links=links?links.add(els):els,els.click(function(e){var href=$(this).attr("href");if(iframe&&setIframeLocation(href),"#"!=href.slice(0,1))return location.href="#"+href,e.preventDefault()}),inited=!0)}},$(window).on("hash",function(e,h){h?links.filter(function(){var href=$(this).attr("href");return href==h||href==h.replace("#","")}).trigger("history",[h]):links.eq(0).trigger("history",[h]),hash=h}),$.fn.history=function(fn){return $.tools.history.init(this),this.on("history",fn)}}(jQuery),function($){function viewport(){if(/msie/.test(navigator.userAgent.toLowerCase())){var d=$(document).height(),w=$(window).height();return[window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,d-w<20?w:d]}return[$(document).width(),$(document).height()]}function call(fn){if(fn)return fn.call($.mask)}$.tools=$.tools||{version:"@VERSION"};var tool;tool=$.tools.expose={conf:{maskId:"exposeMask",loadSpeed:"slow",closeSpeed:"fast",closeOnClick:!0,closeOnEsc:!0,zIndex:9998,opacity:.8,startOpacity:0,color:"#fff",onLoad:null,onClose:null}};var mask,exposed,loaded,config,overlayIndex;$.mask={load:function(conf,els){if(loaded)return this;"string"==typeof conf&&(conf={color:conf}),conf=conf||config,config=conf=$.extend($.extend({},tool.conf),conf),mask=$("#"+conf.maskId),mask.length||(mask=$("<div/>").attr("id",conf.maskId),$("body").append(mask));var size=viewport();return mask.css({position:"absolute",top:0,left:0,width:size[0],height:size[1],display:"none",opacity:conf.startOpacity,zIndex:conf.zIndex}),conf.color&&mask.css("backgroundColor",conf.color),call(conf.onBeforeLoad)===!1?this:(conf.closeOnEsc&&$(document).on("keydown.mask",function(e){27==e.keyCode&&$.mask.close(e)}),conf.closeOnClick&&mask.on("click.mask",function(e){$.mask.close(e)}),$(window).on("resize.mask",function(){$.mask.fit()}),els&&els.length&&(overlayIndex=els.eq(0).css("zIndex"),$.each(els,function(){var el=$(this);/relative|absolute|fixed/i.test(el.css("position"))||el.css("position","relative")}),exposed=els.css({zIndex:Math.max(conf.zIndex+1,"auto"==overlayIndex?0:overlayIndex)})),mask.css({display:"block"}).fadeTo(conf.loadSpeed,conf.opacity,function(){$.mask.fit(),call(conf.onLoad),loaded="full"}),loaded=!0,this)},close:function(){if(loaded){if(call(config.onBeforeClose)===!1)return this;mask.fadeOut(config.closeSpeed,function(){exposed&&exposed.css({zIndex:overlayIndex}),loaded=!1,call(config.onClose)}),$(document).off("keydown.mask"),mask.off("click.mask"),$(window).off("resize.mask")}return this},fit:function(){if(loaded){var size=viewport();mask.css({width:size[0],height:size[1]})}},getMask:function(){return mask},isLoaded:function(fully){return fully?"full"==loaded:loaded},getConf:function(){return config},getExposed:function(){return exposed}},$.fn.mask=function(conf){return $.mask.load(conf),this},$.fn.expose=function(conf){return $.mask.load(conf,this),this}}(jQuery),function($){function getPosition(trigger,tip,conf){var top=conf.relative?trigger.position().top:trigger.offset().top,left=conf.relative?trigger.position().left:trigger.offset().left,pos=conf.position[0];top-=tip.outerHeight()-conf.offset[0],left+=trigger.outerWidth()+conf.offset[1],/iPad/i.test(navigator.userAgent)&&(top-=$(window).scrollTop());var height=tip.outerHeight()+trigger.outerHeight();"center"==pos&&(top+=height/2),"bottom"==pos&&(top+=height),pos=conf.position[1];var width=tip.outerWidth()+trigger.outerWidth();return"center"==pos&&(left-=width/2),"left"==pos&&(left-=width),{top:top,left:left}}function Tooltip(trigger,conf){var tip,shown,self=this,fire=trigger.add(self),timer=0,pretimer=0,title=trigger.attr("title"),tipAttr=trigger.attr("data-tooltip"),effect=effects[conf.effect],isInput=trigger.is(":input"),isWidget=isInput&&trigger.is(":checkbox, :radio, select, :button, :submit"),type=trigger.attr("type"),evt=conf.events[type]||conf.events[isInput?isWidget?"widget":"input":"def"];if(!effect)throw'Nonexistent effect "'+conf.effect+'"';if(evt=evt.split(/,\s*/),2!=evt.length)throw"Tooltip: bad events configuration for "+type;trigger.on(evt[0],function(e){clearTimeout(timer),conf.predelay?pretimer=setTimeout(function(){self.show(e)},conf.predelay):self.show(e)}).on(evt[1],function(e){clearTimeout(pretimer),conf.delay?timer=setTimeout(function(){self.hide(e)},conf.delay):self.hide(e)}),title&&conf.cancelDefault&&(trigger.removeAttr("title"),trigger.data("title",title)),$.extend(self,{show:function(e){if(!tip&&(tipAttr?tip=$(tipAttr):conf.tip?tip=$(conf.tip).eq(0):title?tip=$(conf.layout).addClass(conf.tipClass).appendTo(document.body).hide().append(title):(tip=trigger.find("."+conf.tipClass),tip.length||(tip=trigger.next()),tip.length||(tip=trigger.parent().next())),!tip.length))throw"Cannot find tooltip for "+trigger;if(self.isShown())return self;tip.stop(!0,!0);var pos=getPosition(trigger,tip,conf);if(conf.tip&&tip.html(trigger.data("title")),e=$.Event(),e.type="onBeforeShow",fire.trigger(e,[pos]),e.isDefaultPrevented())return self;pos=getPosition(trigger,tip,conf),tip.css({position:"absolute",top:pos.top,left:pos.left}),shown=!0,effect[0].call(self,function(){e.type="onShow",shown="full",fire.trigger(e)});var event=conf.events.tooltip.split(/,\s*/);return tip.data("__set")||(tip.off(event[0]).on(event[0],function(){clearTimeout(timer),clearTimeout(pretimer)}),event[1]&&!trigger.is("input:not(:checkbox, :radio), textarea")&&tip.off(event[1]).on(event[1],function(e){e.relatedTarget!=trigger[0]&&trigger.trigger(evt[1].split(" ")[0])}),conf.tip||tip.data("__set",!0)),self},hide:function(e){return tip&&self.isShown()?(e=$.Event(),e.type="onBeforeHide",fire.trigger(e),e.isDefaultPrevented()?void 0:(shown=!1,effects[conf.effect][1].call(self,function(){e.type="onHide",fire.trigger(e)}),self)):self},isShown:function(fully){return fully?"full"==shown:shown},getConf:function(){return conf},getTip:function(){return tip},getTrigger:function(){return trigger}}),$.each("onHide,onBeforeShow,onShow,onBeforeHide".split(","),function(i,name){$.isFunction(conf[name])&&$(self).on(name,conf[name]),self[name]=function(fn){return fn&&$(self).on(name,fn),self}})}$.tools=$.tools||{version:"@VERSION"},$.tools.tooltip={conf:{effect:"toggle",fadeOutSpeed:"fast",predelay:0,delay:30,opacity:1,tip:0,fadeIE:!1,position:["top","center"],offset:[0,0],relative:!1,cancelDefault:!0,events:{def:"mouseenter,mouseleave",input:"focus,blur",widget:"focus mouseenter,blur mouseleave",tooltip:"mouseenter,mouseleave"},layout:"<div/>",tipClass:"tooltip"},addEffect:function(name,loadFn,hideFn){effects[name]=[loadFn,hideFn]}};var effects={toggle:[function(done){var conf=this.getConf(),tip=this.getTip(),o=conf.opacity;o<1&&tip.css({opacity:o}),tip.show(),done.call()},function(done){this.getTip().hide(),done.call()}],fade:[function(done){var conf=this.getConf();!/msie/.test(navigator.userAgent.toLowerCase())||conf.fadeIE?this.getTip().fadeTo(conf.fadeInSpeed,conf.opacity,done):(this.getTip().show(),done())},function(done){var conf=this.getConf();!/msie/.test(navigator.userAgent.toLowerCase())||conf.fadeIE?this.getTip().fadeOut(conf.fadeOutSpeed,done):(this.getTip().hide(),done())}]};$.fn.tooltip=function(conf){var api=this.data("tooltip");return api?api:(conf=$.extend(!0,{},$.tools.tooltip.conf,conf),"string"==typeof conf.position&&(conf.position=conf.position.split(/,?\s/)),this.each(function(){api=new Tooltip($(this),conf),$(this).data("tooltip",api)}),conf.api?api:this)}}(jQuery)}.apply(root,arguments)})}(this),function(root){define("jquery.tools.dateinput",["jquery"],function(){return function(){!function($,undefined){function dayAm(year,month){return new Date(year,month+1,0).getDate()}function zeropad(val,len){for(val=""+val,len=len||2;val.length<len;)val="0"+val;return val}function format(formatter,date,text,lang){var d=date.getDate(),D=date.getDay(),m=date.getMonth(),y=date.getFullYear(),flags={d:d,dd:zeropad(d),ddd:LABELS[lang].shortDays[D],dddd:LABELS[lang].days[D],m:m+1,mm:zeropad(m+1),mmm:LABELS[lang].shortMonths[m],mmmm:LABELS[lang].months[m],yy:String(y).slice(2),yyyy:y},ret=formatters[formatter](text,date,flags,lang);return tmpTag.html(ret).html()}function integer(val){return parseInt(val,10)}function isSameDay(d1,d2){return d1.getFullYear()===d2.getFullYear()&&d1.getMonth()==d2.getMonth()&&d1.getDate()==d2.getDate()}function parseDate(val){if(val!==undefined){if(val.constructor==Date)return val;if("string"==typeof val){var els=val.split("-");if(3==els.length)return new Date(integer(els[0]),integer(els[1])-1,integer(els[2]));if(!/^-?\d+$/.test(val))return;val=integer(val)}var date=new Date;return date.setDate(date.getDate()+val),date}}function Dateinput(input,conf){function select(date,conf,e){return input.attr("readonly")?void self.hide(e):(value=date,currYear=date.getFullYear(),currMonth=date.getMonth(),currDay=date.getDate(),e||(e=$.Event("api")),"click"!=e.type||/msie/.test(navigator.userAgent.toLowerCase())||input.focus(),e.type="beforeChange",fire.trigger(e,[date]),void(e.isDefaultPrevented()||(input.val(format(conf.formatter,date,conf.format,conf.lang)),e.type="change",e.target=input[0],fire.trigger(e),input.data("date",date),self.hide(e))))}function onShow(ev){ev.type="onShow",fire.trigger(ev),$(document).on("keydown.d",function(e){if(e.ctrlKey)return!0;var key=e.keyCode;if(8==key||46==key)return input.val(""),self.hide(e);if(27==key||9==key)return self.hide(e);if($(KEYS).index(key)>=0){if(!opened)return self.show(e),e.preventDefault();var days=$("#"+css.weeks+" a"),el=$("."+css.focus),index=days.index(el);return el.removeClass(css.focus),74==key||40==key?index+=7:75==key||38==key?index-=7:76==key||39==key?index+=1:(72==key||37==key)&&(index-=1),index>41?(self.addMonth(),el=$("#"+css.weeks+" a:eq("+(index-42)+")")):0>index?(self.addMonth(-1),el=$("#"+css.weeks+" a:eq("+(index+42)+")")):el=days.eq(index),el.addClass(css.focus),e.preventDefault()}return 34==key?self.addMonth():33==key?self.addMonth(-1):36==key?self.today():(13==key&&($(e.target).is("select")||$("."+css.focus).click()),$([16,17,18,9]).index(key)>=0)}),$(document).on("click.d",function(e){var el=e.target;el.id==css.root||$(el).parents("#"+css.root).length||el==input[0]||trigger&&el==trigger[0]||self.hide(e)})}var trigger,pm,nm,currYear,currMonth,currDay,opened,original,self=this,now=new Date,yearNow=now.getFullYear(),css=conf.css,labels=LABELS[conf.lang],root=$("#"+css.root),title=root.find("#"+css.title),value=input.attr("data-value")||conf.value||input.val(),min=input.attr("min")||conf.min,max=input.attr("max")||conf.max;if(0===min&&(min="0"),value=parseDate(value)||now,min=parseDate(min||new Date(yearNow+conf.yearRange[0],1,1)),max=parseDate(max||new Date(yearNow+conf.yearRange[1]+1,1,(-1))),!labels)throw"Dateinput: invalid language: "+conf.lang;if("date"==input.attr("type")){var original=input.clone(),def=original.wrap("<div/>").parent().html(),clone=$(def.replace(/type/i,"type=text data-orig-type"));conf.value&&clone.val(conf.value),input.replaceWith(clone),input=clone}input.addClass(css.input);var fire=input.add(self);if(!root.length){if(root=$("<div><div><a/><div/><a/></div><div><div/><div/></div></div>").hide().css({position:"absolute"}).attr("id",css.root),root.children().eq(0).attr("id",css.head).end().eq(1).attr("id",css.body).children().eq(0).attr("id",css.days).end().eq(1).attr("id",css.weeks).end().end().end().find("a").eq(0).attr("id",css.prev).end().eq(1).attr("id",css.next),title=root.find("#"+css.head).find("div").attr("id",css.title),conf.selectors){var monthSelector=$("<select/>").attr("id",css.month),yearSelector=$("<select/>").attr("id",css.year);title.html(monthSelector.add(yearSelector))}for(var days=root.find("#"+css.days),d=0;7>d;d++)days.append($("<span/>").text(labels.shortDays[(d+conf.firstDay)%7]));$("body").append(root)}conf.trigger&&(trigger=$("<a/>").attr("href","#").addClass(css.trigger).click(function(e){return conf.toggle?self.toggle():self.show(),e.preventDefault()}).insertAfter(input));var weeks=root.find("#"+css.weeks);yearSelector=root.find("#"+css.year),monthSelector=root.find("#"+css.month),$.extend(self,{show:function(e){if(!input.attr("disabled")&&!opened&&(e=e||$.Event(),e.type="onBeforeShow",fire.trigger(e),!e.isDefaultPrevented())){$.each(instances,function(){this.hide()}),opened=!0,monthSelector.off("change").change(function(){self.setValue(integer(yearSelector.val()),integer($(this).val()))}),yearSelector.off("change").change(function(){self.setValue(integer($(this).val()),integer(monthSelector.val()))}),pm=root.find("#"+css.prev).off("click").click(function(){return pm.hasClass(css.disabled)||self.addMonth(-1),!1}),nm=root.find("#"+css.next).off("click").click(function(){return nm.hasClass(css.disabled)||self.addMonth(),!1}),self.setValue(value);var pos=input.offset();return/iPad/i.test(navigator.userAgent)&&(pos.top-=$(window).scrollTop()),root.css({top:pos.top+input.outerHeight(!0)+conf.offset[0],left:pos.left+conf.offset[1]}),conf.speed?root.show(conf.speed,function(){onShow(e)}):(root.show(),onShow(e)),self}},setValue:function(year,month,day){var date=integer(month)>=-1?new Date(integer(year),integer(month),integer(day==undefined||isNaN(day)?1:day)):year||value;if(min>date?date=min:date>max&&(date=max),"string"==typeof year&&(date=parseDate(year)),year=date.getFullYear(),month=date.getMonth(),day=date.getDate(),-1==month?(month=11,year--):12==month&&(month=0,year++),!opened)return select(date,conf),self;currMonth=month,currYear=year,currDay=day;var week,tmp=new Date(year,month,1-conf.firstDay),begin=tmp.getDay(),days=dayAm(year,month),prevDays=dayAm(year,month-1);if(conf.selectors){monthSelector.empty(),$.each(labels.months,function(i,m){min<new Date(year,i+1,1)&&max>new Date(year,i,0)&&monthSelector.append($("<option/>").html(m).attr("value",i))}),yearSelector.empty();for(var yearNow=now.getFullYear(),i=yearNow+conf.yearRange[0];i<yearNow+conf.yearRange[1];i++)min<new Date(i+1,0,1)&&max>new Date(i,0,0)&&yearSelector.append($("<option/>").text(i));monthSelector.val(month),yearSelector.val(year)}else title.html(labels.months[month]+" "+year);weeks.empty(),pm.add(nm).removeClass(css.disabled);for(var a,num,j=begin?0:-7;(begin?42:35)>j;j++)a=$("<a/>"),j%7===0&&(week=$("<div/>").addClass(css.week),weeks.append(week)),begin>j?(a.addClass(css.off),num=prevDays-begin+j+1,date=new Date(year,month-1,num)):j>=begin+days?(a.addClass(css.off),num=j-days-begin+1,date=new Date(year,month+1,num)):(num=j-begin+1,date=new Date(year,month,num),isSameDay(value,date)?a.attr("id",css.current).addClass(css.focus):isSameDay(now,date)&&a.attr("id",css.today)),min&&min>date&&a.add(pm).addClass(css.disabled),max&&date>max&&a.add(nm).addClass(css.disabled),a.attr("href","#"+num).text(num).data("date",date),week.append(a);return weeks.find("a").click(function(e){var el=$(this);return el.hasClass(css.disabled)||($("#"+css.current).removeAttr("id"),el.attr("id",css.current),select(el.data("date"),conf,e)),!1}),css.sunday&&weeks.find("."+css.week).each(function(){var beg=conf.firstDay?7-conf.firstDay:0;$(this).children().slice(beg,beg+1).addClass(css.sunday)}),self},setMin:function(val,fit){return min=parseDate(val),fit&&min>value&&self.setValue(min),self},setMax:function(val,fit){return max=parseDate(val),fit&&value>max&&self.setValue(max),self},today:function(){return self.setValue(now)},addDay:function(amount){return this.setValue(currYear,currMonth,currDay+(amount||1))},addMonth:function(amount){var targetMonth=currMonth+(amount||1),daysInTargetMonth=dayAm(currYear,targetMonth),targetDay=daysInTargetMonth>=currDay?currDay:daysInTargetMonth;return this.setValue(currYear,targetMonth,targetDay)},addYear:function(amount){return this.setValue(currYear+(amount||1),currMonth,currDay)},destroy:function(){input.add(document).off("click.d keydown.d"),root.add(trigger).remove(),input.removeData("dateinput").removeClass(css.input),original&&input.replaceWith(original)},hide:function(e){if(opened){if(e=$.Event(),e.type="onHide",fire.trigger(e),e.isDefaultPrevented())return;$(document).off("click.d keydown.d"),root.hide(),opened=!1}return self},toggle:function(){return self.isOpen()?self.hide():self.show()},getConf:function(){return conf},getInput:function(){return input},getCalendar:function(){return root},getValue:function(dateFormat){return dateFormat?format(conf.formatter,value,dateFormat,conf.lang):value},isOpen:function(){return opened}}),$.each(["onBeforeShow","onShow","change","onHide"],function(i,name){$.isFunction(conf[name])&&$(self).on(name,conf[name]),self[name]=function(fn){return fn&&$(self).on(name,fn),self}}),conf.editable||input.on("focus.d click.d",self.show).keydown(function(e){var key=e.keyCode;return!opened&&$(KEYS).index(key)>=0?(self.show(e),e.preventDefault()):((8==key||46==key)&&input.val(""),!!(e.shiftKey||e.ctrlKey||e.altKey||9==key)||e.preventDefault())}),parseDate(input.val())&&select(value,conf)}$.tools=$.tools||{version:"@VERSION"};var tool,instances=[],formatters={},KEYS=[75,76,38,39,74,72,40,37],LABELS={};tool=$.tools.dateinput={conf:{format:"mm/dd/yy",formatter:"default",selectors:!1,yearRange:[-5,5],lang:"en",offset:[0,0],speed:0,firstDay:0,min:undefined,max:undefined,trigger:0,toggle:0,editable:0,css:{prefix:"cal",input:"date",root:0,head:0,title:0,prev:0,next:0,month:0,year:0,days:0,body:0,weeks:0,today:0,current:0,week:0,off:0,sunday:0,focus:0,disabled:0,trigger:0}},addFormatter:function(name,fn){formatters[name]=fn},localize:function(language,labels){$.each(labels,function(key,val){labels[key]=val.split(",")}),LABELS[language]=labels}},tool.localize("en",{months:"January,February,March,April,May,June,July,August,September,October,November,December",shortMonths:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec",days:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",shortDays:"Sun,Mon,Tue,Wed,Thu,Fri,Sat"});var tmpTag=$("<a/>");tool.addFormatter("default",function(text,date,flags){return text.replace(/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g,function($0){return $0 in flags?flags[$0]:$0})}),tool.addFormatter("prefixed",function(text,date,flags){return text.replace(/%(d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*')/g,function($0,$1){return $1 in flags?flags[$1]:$0})}),$.expr[":"].date=function(el){var type=el.getAttribute("type");return type&&"date"==type||!!$(el).data("dateinput")},$.fn.dateinput=function(conf){if(this.data("dateinput"))return this;conf=$.extend(!0,{},tool.conf,conf),$.each(conf.css,function(key,val){val||"prefix"==key||(conf.css[key]=(conf.css.prefix||"")+(val||key))});var els;return this.each(function(){var el=new Dateinput($(this),conf);instances.push(el);var input=el.getInput().data("dateinput",el);els=els?els.add(input):input}),els?els:this}}(jQuery)}.apply(root,arguments)})}(this),function(root){define("jquery.tmpl",["jquery"],function(){return function(){!function(jQuery,undefined){function newTmplItem(options,parentItem,fn,data){var newItem={data:data||(parentItem?parentItem.data:{}),_wrap:parentItem?parentItem._wrap:null,tmpl:null,parent:parentItem||null,nodes:[],calls:tiCalls,nest:tiNest,wrap:tiWrap,html:tiHtml,update:tiUpdate};return options&&jQuery.extend(newItem,options,{nodes:[],parent:parentItem}),fn&&(newItem.tmpl=fn,newItem._ctnt=newItem._ctnt||newItem.tmpl(jQuery,newItem),newItem.key=++itemKey,(stack.length?wrappedItems:newTmplItems)[itemKey]=newItem),newItem}function build(tmplItem,nested,content){var frag,ret=content?jQuery.map(content,function(item){return"string"==typeof item?tmplItem.key?item.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+tmplItmAtt+'="'+tmplItem.key+'" $2'):item:build(item,tmplItem,item._ctnt)}):tmplItem;return nested?ret:(ret=ret.join(""),ret.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(all,before,middle,after){frag=jQuery(middle).get(),storeTmplItems(frag),before&&(frag=unencode(before).concat(frag)),after&&(frag=frag.concat(unencode(after)))}),frag?frag:unencode(ret))}function unencode(text){var el=document.createElement("div");return el.innerHTML=text,jQuery.makeArray(el.childNodes)}function buildTmplFn(markup){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+jQuery.trim(markup).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(all,slash,type,fnargs,target,parens,args){var def,expr,exprAutoFnDetect,tag=jQuery.tmpl.tag[type];if(!tag)throw"Template command not found: "+type;return def=tag._default||[],parens&&!/\w$/.test(target)&&(target+=parens,parens=""),target?(target=unescape(target),args=args?","+unescape(args)+")":parens?")":"",expr=parens?target.indexOf(".")>-1?target+parens:"("+target+").call($item"+args:target,exprAutoFnDetect=parens?expr:"(typeof("+target+")==='function'?("+target+").call($item):("+target+"))"):exprAutoFnDetect=expr=def.$1||"null",fnargs=unescape(fnargs),"');"+tag[slash?"close":"open"].split("$notnull_1").join(target?"typeof("+target+")!=='undefined' && ("+target+")!=null":"true").split("$1a").join(exprAutoFnDetect).split("$1").join(expr).split("$2").join(fnargs?fnargs.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(all,name,parens,params){return params=params?","+params+")":parens?")":"",params?"("+name+").call($item"+params:all}):def.$2||"")+"_.push('"})+"');}return _;")}function updateWrapped(options,wrapped){options._wrap=build(options,!0,jQuery.isArray(wrapped)?wrapped:[htmlExpr.test(wrapped)?wrapped:jQuery(wrapped).html()]).join("")}function unescape(args){return args?args.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function outerHtml(elem){var div=document.createElement("div");return div.appendChild(elem.cloneNode(!0)),div.innerHTML}function storeTmplItems(content){function processItemKey(el){function cloneTmplItem(key){key+=keySuffix,tmplItem=newClonedItems[key]=newClonedItems[key]||newTmplItem(tmplItem,newTmplItems[tmplItem.parent.key+keySuffix]||tmplItem.parent,null,!0)}var pntKey,pntItem,tmplItem,key,pntNode=el;if(key=el.getAttribute(tmplItmAtt)){for(;pntNode.parentNode&&1===(pntNode=pntNode.parentNode).nodeType&&!(pntKey=pntNode.getAttribute(tmplItmAtt)););pntKey!==key&&(pntNode=pntNode.parentNode?11===pntNode.nodeType?0:pntNode.getAttribute(tmplItmAtt)||0:0,(tmplItem=newTmplItems[key])||(tmplItem=wrappedItems[key],tmplItem=newTmplItem(tmplItem,newTmplItems[pntNode]||wrappedItems[pntNode],null,!0),tmplItem.key=++itemKey,newTmplItems[itemKey]=tmplItem),cloneIndex&&cloneTmplItem(key)),el.removeAttribute(tmplItmAtt)}else cloneIndex&&(tmplItem=jQuery.data(el,"tmplItem"))&&(cloneTmplItem(tmplItem.key),newTmplItems[tmplItem.key]=tmplItem,pntNode=jQuery.data(el.parentNode,"tmplItem"),pntNode=pntNode?pntNode.key:0);if(tmplItem){for(pntItem=tmplItem;pntItem&&pntItem.key!=pntNode;)pntItem.nodes.push(el),pntItem=pntItem.parent;delete tmplItem._ctnt,delete tmplItem._wrap,jQuery.data(el,"tmplItem",tmplItem)}}var elem,elems,i,l,m,keySuffix="_"+cloneIndex,newClonedItems={};for(i=0,l=content.length;i<l;i++)if(1===(elem=content[i]).nodeType){for(elems=elem.getElementsByTagName("*"),m=elems.length-1;m>=0;m--)processItemKey(elems[m]);processItemKey(elem)}}function tiCalls(content,tmpl,data,options){return content?void stack.push({_:content,tmpl:tmpl,item:this,data:data,options:options}):stack.pop()}function tiNest(tmpl,data,options){return jQuery.tmpl(jQuery.template(tmpl),data,options,this)}function tiWrap(call,wrapped){var options=call.options||{};return options.wrapped=wrapped,jQuery.tmpl(jQuery.template(call.tmpl),call.data,options,call.item)}function tiHtml(filter,textOnly){var wrapped=this._wrap;return jQuery.map(jQuery(jQuery.isArray(wrapped)?wrapped.join(""):wrapped).filter(filter||"*"),function(e){return textOnly?e.innerText||e.textContent:e.outerHTML||outerHtml(e)})}function tiUpdate(){var coll=this.nodes;jQuery.tmpl(null,null,null,this).insertBefore(coll[0]),jQuery(coll).remove()}var appendToTmplItems,oldManip=jQuery.fn.domManip,tmplItmAtt="_tmplitem",htmlExpr=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,newTmplItems={},wrappedItems={},topTmplItem={key:0,data:{}},itemKey=0,cloneIndex=0,stack=[];jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i,l,tmplItems,ret=[],insert=jQuery(selector),parent=1===this.length&&this[0].parentNode;if(appendToTmplItems=newTmplItems||{},parent&&11===parent.nodeType&&1===parent.childNodes.length&&1===insert.length)insert[original](this[0]),ret=this;else{for(i=0,l=insert.length;i<l;i++)cloneIndex=i,elems=(i>0?this.clone(!0):this).get(),jQuery.fn[original].apply(jQuery(insert[i]),elems),ret=ret.concat(elems);cloneIndex=0,ret=this.pushStack(ret,name,insert.selector)}return tmplItems=appendToTmplItems,appendToTmplItems=null,jQuery.tmpl.complete(tmplItems),ret}}),jQuery.fn.extend({tmpl:function(data,options,parentItem){return jQuery.tmpl(this[0],data,options,parentItem)},tmplItem:function(){return jQuery.tmplItem(this[0])},template:function(name){return jQuery.template(name,this[0])},domManip:function(args,table,callback,options){if(args[0]&&args[0].nodeType){for(var tmplItem,dmArgs=jQuery.makeArray(arguments),argsLength=args.length,i=0;i<argsLength&&!(tmplItem=jQuery.data(args[i++],"tmplItem")););argsLength>1&&(dmArgs[0]=[jQuery.makeArray(args)]),tmplItem&&cloneIndex&&(dmArgs[2]=function(fragClone){jQuery.tmpl.afterManip(this,fragClone,callback)}),oldManip.apply(this,dmArgs)}else oldManip.apply(this,arguments);return cloneIndex=0,appendToTmplItems||jQuery.tmpl.complete(newTmplItems),this}}),jQuery.extend({tmpl:function(tmpl,data,options,parentItem){var ret,topLevel=!parentItem;if(topLevel)parentItem=topTmplItem,tmpl=jQuery.template[tmpl]||jQuery.template(null,tmpl),wrappedItems={};else if(!tmpl)return tmpl=parentItem.tmpl,newTmplItems[parentItem.key]=parentItem,parentItem.nodes=[],parentItem.wrapped&&updateWrapped(parentItem,parentItem.wrapped),jQuery(build(parentItem,null,parentItem.tmpl(jQuery,parentItem)));return tmpl?("function"==typeof data&&(data=data.call(parentItem||{})),options&&options.wrapped&&updateWrapped(options,options.wrapped),
ret=jQuery.isArray(data)?jQuery.map(data,function(dataItem){return dataItem?newTmplItem(options,parentItem,tmpl,dataItem):null}):[newTmplItem(options,parentItem,tmpl,data)],topLevel?jQuery(build(parentItem,null,ret)):ret):[]},tmplItem:function(elem){var tmplItem;for(elem instanceof jQuery&&(elem=elem[0]);elem&&1===elem.nodeType&&!(tmplItem=jQuery.data(elem,"tmplItem"))&&(elem=elem.parentNode););return tmplItem||topTmplItem},template:function(name,tmpl){return tmpl?("string"==typeof tmpl?tmpl=buildTmplFn(tmpl):tmpl instanceof jQuery&&(tmpl=tmpl[0]||{}),tmpl.nodeType&&(tmpl=jQuery.data(tmpl,"tmpl")||jQuery.data(tmpl,"tmpl",buildTmplFn(tmpl.innerHTML))),"string"==typeof name?jQuery.template[name]=tmpl:tmpl):name?"string"!=typeof name?jQuery.template(null,name):jQuery.template[name]||jQuery.template(null,htmlExpr.test(name)?name:jQuery(name)):null},encode:function(text){return(""+text).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),jQuery.extend(jQuery.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(items){newTmplItems={}},afterManip:function(elem,fragClone,callback){var content=11===fragClone.nodeType?jQuery.makeArray(fragClone.childNodes):1===fragClone.nodeType?[fragClone]:[];callback.call(elem,fragClone),storeTmplItems(content),cloneIndex++}})}(jQuery)}.apply(root,arguments)})}(this),function(root){define("jquery.recurrenceinput",["jquery","jquery.tools.overlay","jquery.tools.dateinput","jquery.tmpl"],function(){return function(){!function($){function zeropad(val,len){for(val=val.toString(),len=len||2;val.length<len;)val="0"+val;return val}function format(date,fmt,conf){var d=date.getDate(),D=date.getDay(),m=date.getMonth(),y=date.getFullYear(),flags={d:d,dd:zeropad(d),ddd:conf.i18n.shortWeekdays[D],dddd:conf.i18n.weekdays[D],m:m+1,mm:zeropad(m+1),mmm:conf.i18n.shortMonths[m],mmmm:conf.i18n.months[m],yy:String(y).slice(2),yyyy:y},result=fmt.replace(Re,function($0){return flags.hasOwnProperty($0)?flags[$0]:$0.slice(1,$0.length-1)});return result}function widgetSaveToRfc5545(form,conf,tz){var field,input,weekdays,i18nweekdays,i,j,index,tmp,day,month,year,interval,yearlyType,occurrences,date,value=form.find("select[name=rirtemplate]").val(),rtemplate=conf.rtemplate[value],result=rtemplate.rrule,human=conf.i18n.rtemplate[value];for(i=0;i<rtemplate.fields.length;i++)switch(field=form.find("#"+rtemplate.fields[i]),field.attr("id")){case"ridailyinterval":interval=field.find("input[name=ridailyinterval]").val(),"1"!==interval&&(result+=";INTERVAL="+interval),human=interval+" "+conf.i18n.dailyInterval2;break;case"riweeklyinterval":interval=field.find("input[name=riweeklyinterval]").val(),"1"!==interval&&(result+=";INTERVAL="+interval),human=interval+" "+conf.i18n.weeklyInterval2;break;case"riweeklyweekdays":for(weekdays="",i18nweekdays="",j=0;j<conf.weekdays.length;j++)input=field.find("input[name=riweeklyweekdays"+conf.weekdays[j]+"]"),input.is(":checked")&&(weekdays&&(weekdays+=",",i18nweekdays+=", "),weekdays+=conf.weekdays[j],i18nweekdays+=conf.i18n.weekdays[j]);weekdays&&(result+=";BYDAY="+weekdays,human+=" "+conf.i18n.weeklyWeekdaysHuman+" "+i18nweekdays);break;case"rimonthlyinterval":interval=field.find("input[name=rimonthlyinterval]").val(),"1"!==interval&&(result+=";INTERVAL="+interval),human=interval+" "+conf.i18n.monthlyInterval2;break;case"rimonthlyoptions":var monthlyType=$("input[name=rimonthlytype]:checked",form).val();switch(monthlyType){case"DAYOFMONTH":day=$("select[name=rimonthlydayofmonthday]",form).val(),result+=";BYMONTHDAY="+day,human+=", "+conf.i18n.monthlyDayOfMonth1Human+" "+day+" "+conf.i18n.monthlyDayOfMonth2;break;case"WEEKDAYOFMONTH":index=$("select[name=rimonthlyweekdayofmonthindex]",form).val(),day=$("select[name=rimonthlyweekdayofmonth]",form).val(),$.inArray(day,["MO","TU","WE","TH","FR","SA","SU"])>-1&&(result+=";BYDAY="+index+day,human+=", "+conf.i18n.monthlyWeekdayOfMonth1Human+" ",human+=" "+conf.i18n.orderIndexes[$.inArray(index,conf.orderIndexes)],human+=" "+conf.i18n.monthlyWeekdayOfMonth2,human+=" "+conf.i18n.weekdays[$.inArray(day,conf.weekdays)],human+=" "+conf.i18n.monthlyDayOfMonth2)}break;case"riyearlyinterval":interval=field.find("input[name=riyearlyinterval]").val(),"1"!==interval&&(result+=";INTERVAL="+interval),human=interval+" "+conf.i18n.yearlyInterval2;break;case"riyearlyoptions":switch(yearlyType=$("input[name=riyearlyType]:checked",form).val()){case"DAYOFMONTH":month=$("select[name=riyearlydayofmonthmonth]",form).val(),day=$("select[name=riyearlydayofmonthday]",form).val(),result+=";BYMONTH="+month,result+=";BYMONTHDAY="+day,human+=", "+conf.i18n.yearlyDayOfMonth1Human+" "+conf.i18n.months[month-1]+" "+day;break;case"WEEKDAYOFMONTH":index=$("select[name=riyearlyweekdayofmonthindex]",form).val(),day=$("select[name=riyearlyweekdayofmonthday]",form).val(),month=$("select[name=riyearlyweekdayofmonthmonth]",form).val(),result+=";BYMONTH="+month,$.inArray(day,["MO","TU","WE","TH","FR","SA","SU"])>-1&&(result+=";BYDAY="+index+day,human+=", "+conf.i18n.yearlyWeekdayOfMonth1Human,human+=" "+conf.i18n.orderIndexes[$.inArray(index,conf.orderIndexes)],human+=" "+conf.i18n.yearlyWeekdayOfMonth2,human+=" "+conf.i18n.weekdays[$.inArray(day,conf.weekdays)],human+=" "+conf.i18n.yearlyWeekdayOfMonth3,human+=" "+conf.i18n.months[month-1],human+=" "+conf.i18n.yearlyWeekdayOfMonth4)}break;case"rirangeoptions":var rangeType=form.find("input[name=rirangetype]:checked").val();switch(rangeType){case"BYOCCURRENCES":occurrences=form.find("input[name=rirangebyoccurrencesvalue]").val(),result+=";COUNT="+occurrences,human+=", "+conf.i18n.rangeByOccurrences1Human,human+=" "+occurrences,human+=" "+conf.i18n.rangeByOccurrences2;break;case"BYENDDATE":field=form.find("input[name=rirangebyenddatecalendar]"),date=field.data("dateinput").getValue("yyyymmdd"),result+=";UNTIL="+date+"T000000",tz===!0&&(result+="Z"),human+=", "+conf.i18n.rangeByEndDateHuman,human+=" "+field.data("dateinput").getValue(conf.i18n.longDateFormat)}}if(void 0!==form.ical.RDATE&&form.ical.RDATE.length>0){for(form.ical.RDATE.sort(),tmp=[],i=0;i<form.ical.RDATE.length;i++)""!==form.ical.RDATE[i]&&(year=parseInt(form.ical.RDATE[i].substring(0,4),10),month=parseInt(form.ical.RDATE[i].substring(4,6),10)-1,day=parseInt(form.ical.RDATE[i].substring(6,8),10),tmp.push(format(new Date(year,month,day),conf.i18n.longDateFormat,conf)));0!==tmp.length&&(human=human+conf.i18n.including+" "+tmp.join("; "))}if(void 0!==form.ical.EXDATE&&form.ical.EXDATE.length>0){for(form.ical.EXDATE.sort(),tmp=[],i=0;i<form.ical.EXDATE.length;i++)""!==form.ical.EXDATE[i]&&(year=parseInt(form.ical.EXDATE[i].substring(0,4),10),month=parseInt(form.ical.EXDATE[i].substring(4,6),10)-1,day=parseInt(form.ical.EXDATE[i].substring(6,8),10),tmp.push(format(new Date(year,month,day),conf.i18n.longDateFormat,conf)));0!==tmp.length&&(human=human+conf.i18n.except+" "+tmp.join("; "))}return result="RRULE:"+result,void 0!==form.ical.EXDATE&&""!==form.ical.EXDATE.join()&&(tmp=$.map(form.ical.EXDATE,function(x){return 8===x.length&&(x+="T000000"),tz===!0&&(x+="Z"),x}),result=result+"\nEXDATE:"+tmp),void 0!==form.ical.RDATE&&""!==form.ical.RDATE.join()&&(tmp=$.map(form.ical.RDATE,function(x){return 8===x.length&&(x+="T000000"),tz===!0&&(x+="Z"),x}),result=result+"\nRDATE:"+tmp),{result:result,description:human}}function parseLine(icalline){var result={},pos=icalline.indexOf(":"),property=icalline.substring(0,pos);return result.value=icalline.substring(pos+1),property.indexOf(";")!==-1?(pos=property.indexOf(";"),result.parameters=property.substring(pos+1),result.property=property.substring(0,pos)):(result.parameters=null,result.property=property),result}function cleanDates(dates){var date,result=[],splitDates=dates.split(",");for(date in splitDates)splitDates.hasOwnProperty(date)&&(splitDates[date].indexOf("Z")!==-1?result.push(splitDates[date].substring(0,15)):result.push(splitDates[date]));return result}function parseIcal(icaldata){var nextline,lines=[],result={},line=null;for(lines=icaldata.split("\n"),lines.reverse();;){if(lines.length>0){if(nextline=lines.pop()," "===nextline.charAt(0)||"\t"===nextline.charAt(0)){line+=nextline;continue}}else nextline="";if(null!==line&&(line=parseLine(line),"RDATE"===line.property||"EXDATE"===line.property?result[line.property]=cleanDates(line.value):result[line.property]=line.value),line=nextline,""===line)break}return result}function widgetLoadFromRfc5545(form,conf,icaldata,force){var i,matches,match,matchIndex,rtemplate,d,input,index,selector,selectors,field,radiobutton,interval,byday,bymonth,bymonthday,count,until,day,month,year,weekday,unsupportedFeatures=[];if(form.ical=parseIcal(icaldata),void 0===form.ical.RRULE){if(unsupportedFeatures.push(conf.i18n.noRule),!force)return-1}else{matches=/INTERVAL=([0-9]+);?/.exec(form.ical.RRULE),interval=matches?matches[1]:"1",matches=/BYDAY=([^;]+);?/.exec(form.ical.RRULE),byday=matches?matches[1]:"",matches=/BYMONTHDAY=([^;]+);?/.exec(form.ical.RRULE),bymonthday=matches?matches[1].split(","):null,matches=/BYMONTH=([^;]+);?/.exec(form.ical.RRULE),bymonth=matches?matches[1].split(","):null,matches=/COUNT=([0-9]+);?/.exec(form.ical.RRULE),count=matches?matches[1]:null,matches=/UNTIL=([0-9T]+);?/.exec(form.ical.RRULE),until=matches?matches[1]:null,matches=/BYSETPOS=([^;]+);?/.exec(form.ical.RRULE),matches&&unsupportedFeatures.push(conf.i18n.bysetpos),match="",matchIndex=null;for(i in conf.rtemplate)conf.rtemplate.hasOwnProperty(i)&&(rtemplate=conf.rtemplate[i],0===form.ical.RRULE.indexOf(rtemplate.rrule)&&form.ical.RRULE.length>match.length&&(match=form.ical.RRULE,matchIndex=i));if(match)rtemplate=conf.rtemplate[matchIndex],selector=form.find("select[name=rirtemplate]").val(matchIndex);else{for(rtemplate in conf.rtemplate)if(conf.rtemplate.hasOwnProperty(rtemplate)){rtemplate=conf.rtemplate[rtemplate];break}unsupportedFeatures.push(conf.i18n.noTemplateMatch)}for(i=0;i<rtemplate.fields.length;i++)switch(field=form.find("#"+rtemplate.fields[i]),field.attr("id")){case"ridailyinterval":field.find("input[name=ridailyinterval]").val(interval);break;case"riweeklyinterval":field.find("input[name=riweeklyinterval]").val(interval);break;case"riweeklyweekdays":for(byday=byday.split(","),d=0;d<conf.weekdays.length;d++)day=conf.weekdays[d],input=field.find("input[name=riweeklyweekdays"+day+"]"),input.attr("checked",$.inArray(day,byday)!==-1);break;case"rimonthlyinterval":field.find("input[name=rimonthlyinterval]").val(interval);break;case"rimonthlyoptions":var monthlyType="DAYOFMONTH";for(bymonthday&&(monthlyType="DAYOFMONTH",bymonthday.length>1&&(unsupportedFeatures.push(conf.i18n.multipleDayOfMonth),bymonthday=bymonthday[0]),field.find("select[name=rimonthlydayofmonthday]").val(bymonthday)),byday&&(monthlyType="WEEKDAYOFMONTH",byday.indexOf(",")!==-1&&(unsupportedFeatures.push(conf.i18n.multipleDayOfMonth),byday=byday.split(",")[0]),index=byday.slice(0,-2),"+"!==index.charAt(0)&&"-"!==index.charAt(0)&&(index="+"+index),weekday=byday.slice(-2),field.find("select[name=rimonthlyweekdayofmonthindex]").val(index),field.find("select[name=rimonthlyweekdayofmonth]").val(weekday)),selectors=field.find("input[name=rimonthlytype]"),index=0;index<selectors.length;index++)radiobutton=selectors[index],$(radiobutton).attr("checked",radiobutton.value===monthlyType);break;case"riyearlyinterval":field.find("input[name=riyearlyinterval]").val(interval);break;case"riyearlyoptions":var yearlyType="DAYOFMONTH";for(bymonthday&&(yearlyType="DAYOFMONTH",bymonthday.length>1&&(unsupportedFeatures.push(conf.i18n.multipleDayOfMonth),bymonthday=bymonthday[0]),field.find("select[name=riyearlydayofmonthmonth]").val(bymonth),field.find("select[name=riyearlydayofmonthday]").val(bymonthday)),byday&&(yearlyType="WEEKDAYOFMONTH",byday.indexOf(",")!==-1&&(unsupportedFeatures.push(conf.i18n.multipleDayOfMonth),byday=byday.split(",")[0]),index=byday.slice(0,-2),"+"!==index.charAt(0)&&"-"!==index.charAt(0)&&(index="+"+index),weekday=byday.slice(-2),field.find("select[name=riyearlyweekdayofmonthindex]").val(index),field.find("select[name=riyearlyweekdayofmonthday]").val(weekday),field.find("select[name=riyearlyweekdayofmonthmonth]").val(bymonth)),selectors=field.find("input[name=riyearlyType]"),index=0;index<selectors.length;index++)radiobutton=selectors[index],$(radiobutton).attr("checked",radiobutton.value===yearlyType);break;case"rirangeoptions":var rangeType="NOENDDATE";for(count&&(rangeType="BYOCCURRENCES",field.find("input[name=rirangebyoccurrencesvalue]").val(count)),until&&(rangeType="BYENDDATE",input=field.find("input[name=rirangebyenddatecalendar]"),year=until.slice(0,4),month=until.slice(4,6),month=parseInt(month,10)-1,day=until.slice(6,8),input.data("dateinput").setValue(new Date(year,month,day))),selectors=field.find("input[name=rirangetype]"),index=0;index<selectors.length;index++)radiobutton=selectors[index],$(radiobutton).attr("checked",radiobutton.value===rangeType)}}var messagearea=form.find("#messagearea");return 0!==unsupportedFeatures.length?(messagearea.text(conf.i18n.unsupportedFeatures+" "+unsupportedFeatures.join("; ")),messagearea.show(),1):(messagearea.text(""),messagearea.hide(),0)}function RecurrenceInput(conf,textarea){function displayFields(selector){var i;form.find(".rifield").hide();var value=selector.val();if(value){var rtemplate=conf.rtemplate[value];for(i=0;i<rtemplate.fields.length;i++)form.find("#"+rtemplate.fields[i]).show()}}function occurrenceExclude(event){event.preventDefault(),void 0===form.ical.EXDATE&&(form.ical.EXDATE=[]),form.ical.EXDATE.push(this.attributes.date.value);var $this=$(this);$this.attr("class","exdate"),$this.parent().parent().addClass("exdate"),$this.unbind(event),$this.click(occurrenceInclude)}function occurrenceInclude(event){event.preventDefault(),form.ical.EXDATE.splice($.inArray(this.attributes.date.value,form.ical.EXDATE),1);var $this=$(this);$this.attr("class","rrule"),$this.parent().parent().removeClass("exdate"),$this.unbind(event),$this.click(occurrenceExclude)}function occurrenceDelete(event){event.preventDefault(),form.ical.RDATE.splice($.inArray(this.attributes.date.value,form.ical.RDATE),1),$(this).parent().parent().hide("slow",function(){$(this).remove()})}function occurrenceAdd(event){event.preventDefault();var dateinput=form.find(".riaddoccurrence input#adddate").data("dateinput"),datevalue=dateinput.getValue("yyyymmddT000000");void 0===form.ical.RDATE&&(form.ical.RDATE=[]);var errorarea=form.find(".riaddoccurrence div.errorarea");if(errorarea.text(""),errorarea.hide(),$.inArray(datevalue,form.ical.RDATE)===-1){form.ical.RDATE.push(datevalue);var html=['<div class="occurrence rdate" style="display: none;">','<span class="rdate">',dateinput.getValue(conf.i18n.longDateFormat),'<span class="rlabel">'+conf.i18n.additionalDate+"</span>","</span>",'<span class="action">','<a date="'+datevalue+'" href="#" class="rdate" >',"Include","</a>","</span>","</div>"].join("\n");form.find("div.rioccurrences").prepend(html),$(form.find("div.rioccurrences div")[0]).slideDown(),$(form.find("div.rioccurrences .action a.rdate")[0]).click(occurrenceDelete)}else errorarea.text(conf.i18n.alreadyAdded).show()}function loadOccurrences(startdate,rfc5545,start,readonly){var element,occurrenceDiv;element=readonly?display:form,occurrenceDiv=element.find(".rioccurrences"),occurrenceDiv.hide();var year,month,day;year=startdate.getFullYear(),month=startdate.getMonth()+1,day=startdate.getDate();var data={year:year,month:month,day:day,rrule:rfc5545,format:conf.i18n.longDateFormat,start:start},dict={url:conf.ajaxURL,async:!1,type:"post",dataType:"json",contentType:conf.ajaxContentType,cache:!1,data:data,success:function(data,status,jqXHR){var result,element;element=readonly?display:form,data.readOnly=readonly,data.i18n=conf.i18n;var occurrence,date,y,m,d,each;for(each in data.occurrences)data.occurrences.hasOwnProperty(each)&&(occurrence=data.occurrences[each],date=occurrence.date,y=parseInt(date.substring(0,4),10),m=parseInt(date.substring(4,6),10)-1,d=parseInt(date.substring(6,8),10),occurrence.formattedDate=format(new Date(y,m,d),conf.i18n.longDateFormat,conf));result=$.tmpl("occurrenceTmpl",data),occurrenceDiv=element.find(".rioccurrences"),occurrenceDiv.replaceWith(result),element.find(".rioccurrences .batching a").click(function(event){event.preventDefault(),loadOccurrences(startdate,rfc5545,this.attributes.start.value,readonly)}),readonly||(element.find(".rioccurrences .action a.rrule").click(occurrenceExclude),element.find(".rioccurrences .action a.exdate").click(occurrenceInclude),element.find(".rioccurrences .action a.rdate").click(occurrenceDelete)),element.find(".rioccurrences").show()},error:function(jqXHR,textStatus,errorThrown){alert(textStatus)}};$.ajax(dict)}function getField(field){var realField=$(field);return realField.length||(realField=$("#"+field)),realField.length||(realField=$("input[name='"+field+"']")),realField}function findStartDate(){var startField,startFieldYear,startFieldMonth,startFieldDay,startdate=null;if(conf.startField){if(startField=getField(conf.startField),!startField.length)return null;startdate=startField.data("dateinput"),startdate?startdate=startdate.getValue():(startdate=startField.val(),""===startdate&&(startdate=startField.text())),"string"==typeof startdate&&(startdate=startdate.replace(" ","T")),startdate=new Date(startdate)}else if(conf.startFieldYear&&conf.startFieldMonth&&conf.startFieldDay){if(startFieldYear=getField(conf.startFieldYear),startFieldMonth=getField(conf.startFieldMonth),startFieldDay=getField(conf.startFieldDay),!startFieldYear.length&&!startFieldMonth.length&&!startFieldDay.length)return null;startdate=new Date(startFieldYear.val(),startFieldMonth.val()-1,startFieldDay.val())}return null===startdate?null:isNaN(startdate)?null:startdate}function findEndDate(form){var endField,enddate;return endField=form.find("input[name=rirangebyenddatecalendar]"),enddate=endField.data("dateinput"),enddate=enddate?enddate.getValue():endField.val(),enddate=new Date(enddate),isNaN(enddate)||""===endField.val()?null:enddate}function findIntField(fieldName,form){var field,num;return field=form.find("input[name="+fieldName+"]"),num=field.val(),isNaN(num)||num.toString().indexOf(".")!==-1||""===field.val()?null:num}function loadData(rfc5545){var selector,startdate,dayindex,day;rfc5545&&widgetLoadFromRfc5545(form,conf,rfc5545,!0),startdate=findStartDate(),null!==startdate?(form.find("select[name=rimonthlydayofmonthday]").val(startdate.getDate()),dayindex=conf.orderIndexes[Math.floor((startdate.getDate()-1)/7)],day=conf.weekdays[startdate.getDay()],form.find("select[name=rimonthlyweekdayofmonthindex]").val(dayindex),form.find("select[name=rimonthlyweekdayofmonth]").val(day),form.find("select[name=riyearlydayofmonthmonth]").val(startdate.getMonth()+1),form.find("select[name=riyearlydayofmonthday]").val(startdate.getDate()),form.find("select[name=riyearlyweekdayofmonthindex]").val(dayindex),form.find("select[name=riyearlyweekdayofmonthday]").val(day),form.find("select[name=riyearlyweekdayofmonthmonth]").val(startdate.getMonth()+1),loadOccurrences(startdate,widgetSaveToRfc5545(form,conf,!1).result,0,!1),form.find("div.rioccurrencesactions").show()):form.find("div.rioccurrencesactions").hide(),selector=form.find("select[name=rirtemplate]"),displayFields(selector)}function recurrenceOn(){var RFC5545=widgetSaveToRfc5545(form,conf,!1),label=display.find("label[class=ridisplay]");label.text(conf.i18n.displayActivate+" "+RFC5545.description),textarea.val(RFC5545.result).change();var startdate=findStartDate();null!==startdate&&loadOccurrences(startdate,widgetSaveToRfc5545(form,conf,!1).result,0,!0),display.find('button[name="riedit"]').text(conf.i18n.edit_rules),display.find('button[name="ridelete"]').show()}function recurrenceOff(){var label=display.find("label[class=ridisplay]");label.text(conf.i18n.displayUnactivate),textarea.val("").change(),display.find(".rioccurrences").hide(),display.find('button[name="riedit"]').text(conf.i18n.add_rules),display.find('button[name="ridelete"]').hide()}function checkFields(form){var startDate,endDate,num,messagearea;if(startDate=findStartDate(),messagearea=form.find("#messagearea"),messagearea.text(""),messagearea.hide(),form.find(".riaddoccurrence div.errorarea").text("").hide(),"block"===form.find("#ridailyinterval").css("display")&&(num=findIntField("ridailyinterval",form),!num||num<1||num>1e3))return messagearea.text(conf.i18n.noRepeatEvery).show(),!1;if("block"===form.find("#riweeklyinterval").css("display")&&(num=findIntField("riweeklyinterval",form),!num||num<1||num>1e3))return messagearea.text(conf.i18n.noRepeatEvery).show(),!1;if("block"===form.find("#rimonthlyinterval").css("display")){if(num=findIntField("rimonthlyinterval",form),!num||num<1||num>1e3)return messagearea.text(conf.i18n.noRepeatEvery).show(),!1;if(0===form.find("#rimonthlyoptions input:checked").length)return messagearea.text(conf.i18n.noRepeatOn).show(),!1}if("block"===form.find("#riyearlyinterval").css("display")){if(num=findIntField("riyearlyinterval",form),!num||num<1||num>1e3)return messagearea.text(conf.i18n.noRepeatEvery).show(),!1;if(0===form.find("#riyearlyoptions input:checked").length)return messagearea.text(conf.i18n.noRepeatOn).show(),!1}if(form.find('input[value="BYOCCURRENCES"]:visible:checked').length>0&&(num=findIntField("rirangebyoccurrencesvalue",form),!num||num<1||num>1e3))return messagearea.text(conf.i18n.noEndAfterNOccurrences).show(),!1;if(form.find('input[value="BYENDDATE"]:visible:checked').length>0){if(endDate=findEndDate(form),!endDate)return messagearea.text(conf.i18n.noEndDate).show(),!1;if(endDate<startDate)return messagearea.text(conf.i18n.pastEndDate).show(),!1}return!0}function save(event){event.preventDefault(),checkFields(form)&&(form.overlay().close(),recurrenceOn())}function cancel(event){event.preventDefault(),form.overlay().close()}function updateOccurances(){var startDate;startDate=findStartDate(),checkFields(form)&&loadOccurrences(startDate,widgetSaveToRfc5545(form,conf,!1).result,0,!1)}var form,display,index,i,self=this,orderedWeekdays=[];for(i=0;i<7;i++)index=i+conf.firstDay,index>6&&(index-=7),orderedWeekdays.push(index);if($.extend(conf,{orderIndexes:["+1","+2","+3","+4","-1"],weekdays:["SU","MO","TU","WE","TH","FR","SA"],orderedWeekdays:orderedWeekdays}),display=$.tmpl("displayTmpl",conf),form=$.tmpl("formTmpl",conf),form.overlay(conf.formOverlay).hide(),form.ical={RDATE:[],EXDATE:[]},$.tools.dateinput.localize(conf.lang,{months:LABELS[conf.lang].months.join(),shortMonths:LABELS[conf.lang].shortMonths.join(),days:LABELS[conf.lang].weekdays.join(),shortDays:LABELS[conf.lang].shortWeekdays.join()}),form.find("input[name=rirangebyenddatecalendar]").dateinput({selectors:!0,lang:conf.lang,format:conf.i18n.shortDateFormat,firstDay:conf.firstDay,yearRange:[-5,10]}).data("dateinput").setValue(new Date),textarea.val()){var result=widgetLoadFromRfc5545(form,conf,textarea.val(),!1);if(result===-1){var label=display.find("label[class=ridisplay]");label.text(conf.i18n.noRule)}else recurrenceOn()}display.find("button[name=ridelete]").click(function(e){e.preventDefault(),recurrenceOff()}),display.find("button[name=riedit]").click(function(e){loadData(textarea.val()),e.preventDefault(),form.overlay().load()}),form.find("div.riaddoccurrence input#adddate").dateinput({selectors:!0,lang:conf.lang,format:conf.i18n.shortDateFormat,firstDay:conf.firstDay,yearRange:[-5,10]}).data("dateinput").setValue(new Date),form.find("input#addaction").click(occurrenceAdd),form.find("a.rirefreshbutton").click(function(event){event.preventDefault(),updateOccurances()}),form.find("select[name=rirtemplate]").change(function(e){displayFields($(this))}),form.find("select").change(function(e){$(this).parent().find("> input").click().change()}),form.find("input[name=rirangebyoccurrencesvalue]").change(function(e){$(this).parent().find("input[name=rirangetype]").click().change()}),form.find("input[name=rirangebyenddatecalendar]").change(function(){$(this).parent().find("input[name=rirangetype]").click(),0!==form.find(".rioccurrencesactions:visible").length&&updateOccurances()}),form.find("input:radio, .riweeklyweekday > input, input[name=ridailyinterval], input[name=riweeklyinterval], input[name=rimonthlyinterval], input[name=riyearlyinterval]").change(function(e){0!==form.find(".rioccurrencesactions:visible").length&&updateOccurances()}),form.find(".ricancelbutton").click(cancel),form.find(".risavebutton").click(save),$.extend(self,{display:display,form:form,loadData:loadData,save:save})}$.tools=$.tools||{version:"@VERSION"};var tool,LABELS={};tool=$.tools.recurrenceinput={conf:{lang:"en",readOnly:!1,firstDay:0,startField:null,startFieldYear:null,startFieldMonth:null,startFieldDay:null,ajaxURL:null,ajaxContentType:"application/json; charset=utf8",ributtonExtraClass:"",hasRepeatForeverButton:!0,formOverlay:{speed:"fast",fixed:!1},template:{form:"#jquery-recurrenceinput-form-tmpl",display:"#jquery-recurrenceinput-display-tmpl"},rtemplate:{daily:{rrule:"FREQ=DAILY",fields:["ridailyinterval","rirangeoptions"]},mondayfriday:{rrule:"FREQ=WEEKLY;BYDAY=MO,FR",fields:["rirangeoptions"]},weekdays:{rrule:"FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR",fields:["rirangeoptions"]},weekly:{rrule:"FREQ=WEEKLY",fields:["riweeklyinterval","riweeklyweekdays","rirangeoptions"]},monthly:{rrule:"FREQ=MONTHLY",fields:["rimonthlyinterval","rimonthlyoptions","rirangeoptions"]},yearly:{rrule:"FREQ=YEARLY",fields:["riyearlyinterval","riyearlyoptions","rirangeoptions"]}}},localize:function(language,labels){LABELS[language]=labels},setTemplates:function(templates,titles){var lang,template;tool.conf.rtemplate=templates;for(lang in titles)if(titles.hasOwnProperty(lang))for(template in titles[lang])titles[lang].hasOwnProperty(template)&&(LABELS[lang].rtemplate[template]=titles[lang][template])}},tool.localize("en",{displayUnactivate:"Does not repeat",displayActivate:"Repeats every",add_rules:"Add",edit_rules:"Edit",delete_rules:"Delete",add:"Add",refresh:"Refresh",title:"Repeat",preview:"Selected dates",addDate:"Add date",recurrenceType:"Repeats:",dailyInterval1:"Repeat every:",dailyInterval2:"days",weeklyInterval1:"Repeat every:",weeklyInterval2:"week(s)",weeklyWeekdays:"Repeat on:",weeklyWeekdaysHuman:"on:",monthlyInterval1:"Repeat every:",monthlyInterval2:"month(s)",monthlyDayOfMonth1:"Day",monthlyDayOfMonth1Human:"on day",monthlyDayOfMonth2:"of the month",monthlyDayOfMonth3:"month(s)",monthlyWeekdayOfMonth1:"The",monthlyWeekdayOfMonth1Human:"on the",monthlyWeekdayOfMonth2:"",monthlyWeekdayOfMonth3:"of the month",monthlyRepeatOn:"Repeat on:",yearlyInterval1:"Repeat every:",yearlyInterval2:"year(s)",yearlyDayOfMonth1:"Every",yearlyDayOfMonth1Human:"on",yearlyDayOfMonth2:"",yearlyDayOfMonth3:"",yearlyWeekdayOfMonth1:"The",yearlyWeekdayOfMonth1Human:"on the",yearlyWeekdayOfMonth2:"",yearlyWeekdayOfMonth3:"of",yearlyWeekdayOfMonth4:"",yearlyRepeatOn:"Repeat on:",range:"End recurrence:",rangeNoEnd:"Never",rangeByOccurrences1:"After",rangeByOccurrences1Human:"ends after",rangeByOccurrences2:"occurrence(s)",rangeByEndDate:"On",rangeByEndDateHuman:"ends on",including:", and also",except:", except for",cancel:"Cancel",save:"Save",recurrenceStart:"Start of the recurrence",additionalDate:"Additional date",include:"Include",exclude:"Exclude",remove:"Remove",orderIndexes:["first","second","third","fourth","last"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortWeekdays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longDateFormat:"mmmm dd, yyyy",shortDateFormat:"mm/dd/yyyy",unsupportedFeatures:"Warning: This event uses recurrence features not supported by this widget. Saving the recurrence may change the recurrence in unintended ways:",noTemplateMatch:"No matching recurrence template",multipleDayOfMonth:"This widget does not support multiple days in monthly or yearly recurrence",bysetpos:"BYSETPOS is not supported",noRule:"No RRULE in RRULE data",noRepeatEvery:'Error: The "Repeat every"-field must be between 1 and 1000',noEndDate:"Error: End date is not set. Please set a correct value",noRepeatOn:'Error: "Repeat on"-value must be selected',pastEndDate:"Error: End date cannot be before start date",noEndAfterNOccurrences:'Error: The "After N occurrences"-field must be between 1 and 1000',alreadyAdded:"This date was already added",rtemplate:{daily:"Daily",mondayfriday:"Monday and Friday",weekdays:"Weekday",weekly:"Weekly",monthly:"Monthly",yearly:"Yearly"}});var OCCURRENCETMPL=['<div class="rioccurrences">',"{{each occurrences}}",'<div class="occurrence ${occurrences[$index].type}">',"<span>","${occurrences[$index].formattedDate}",'{{if occurrences[$index].type === "start"}}','<span class="rlabel">${i18n.recurrenceStart}</span>',"{{/if}}",'{{if occurrences[$index].type === "rdate"}}','<span class="rlabel">${i18n.additionalDate}</span>',"{{/if}}","</span>","{{if !readOnly}}",'<span class="action">','{{if occurrences[$index].type === "rrule"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.exclude}">',"${i18n.exclude}","</a>","{{/if}}",'{{if occurrences[$index].type === "rdate"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.remove}" >',"${i18n.remove}","</a>","{{/if}}",'{{if occurrences[$index].type === "exdate"}}','<a date="${occurrences[$index].date}" href="#"','class="${occurrences[$index].type}" title="${i18n.include}">',"${i18n.include}","</a>","{{/if}}","</span>","{{/if}}","</div>","{{/each}}",'<div class="batching">',"{{each batch.batches}}",'{{if $index === batch.currentBatch}}<span class="current">{{/if}}','<a href="#" start="${batch.batches[$index][0]}">[${batch.batches[$index][0]} - ${batch.batches[$index][1]}]</a>',"{{if $index === batch.currentBatch}}</span>{{/if}}","{{/each}}","</div></div>"].join("\n");$.template("occurrenceTmpl",OCCURRENCETMPL);var DISPLAYTMPL=['<div class="ridisplay">','<div class="rimain">',"{{if !readOnly}}",'<button name="riedit">${i18n.add_rules}</button>','<button name="ridelete" style="display:none">${i18n.delete_rules}</button>',"{{/if}}",'<label class="ridisplay">${i18n.displayUnactivate}</label>',"</div>",'<div class="rioccurrences" style="display:none" /></div>'].join("\n");$.template("displayTmpl",DISPLAYTMPL);var FORMTMPL=['<div class="riform">',"<form>","<h1>${i18n.title}</h1>",'<div id="messagearea" style="display: none;">',"</div>",'<div id="rirtemplate">','<label for="${name}rtemplate" class="label">',"${i18n.recurrenceType}","</label>",'<select id="rirtemplate" name="rirtemplate" class="field">',"{{each rtemplate}}",'<option value="${$index}">${i18n.rtemplate[$index]}</value>',"{{/each}}","</select>","<div>",'<div id="riformfields">','<div id="ridailyinterval" class="rifield">','<label for="${name}dailyinterval" class="label">',"${i18n.dailyInterval1}","</label>",'<div class="field">','<input type="text" size="2"','value="1"','name="ridailyinterval"','id="${name}dailyinterval" />',"${i18n.dailyInterval2}","</div>","</div>",'<div id="riweeklyinterval" class="rifield">','<label for="${name}weeklyinterval" class="label">',"${i18n.weeklyInterval1}","</label>",'<div class="field">','<input type="text" size="2"','value="1"','name="riweeklyinterval"','id="${name}weeklyinterval"/>',"${i18n.weeklyInterval2}","</div>","</div>",'<div id="riweeklyweekdays" class="rifield">','<label for="${name}weeklyinterval" class="label">${i18n.weeklyWeekdays}</label>','<div class="field">',"{{each orderedWeekdays}}",'<div class="riweeklyweekday">','<input type="checkbox"','name="riweeklyweekdays${weekdays[$value]}"','id="${name}weeklyWeekdays${weekdays[$value]}"','value="${weekdays[$value]}" />','<label for="${name}weeklyWeekdays${weekdays[$value]}">${i18n.shortWeekdays[$value]}</label>',"</div>","{{/each}}","</div>","</div>",'<div id="rimonthlyinterval" class="rifield">','<label for="rimonthlyinterval" class="label">${i18n.monthlyInterval1}</label>','<div class="field">','<input type="text" size="2"','value="1" ','name="rimonthlyinterval"/>',"${i18n.monthlyInterval2}","</div>","</div>",'<div id="rimonthlyoptions" class="rifield">','<label for="rimonthlytype" class="label">${i18n.monthlyRepeatOn}</label>','<div class="field">',"<div>","<input",'type="radio"','value="DAYOFMONTH"','name="rimonthlytype"','id="${name}monthlytype:DAYOFMONTH" />','<label for="${name}monthlytype:DAYOFMONTH">',"${i18n.monthlyDayOfMonth1}","</label>",'<select name="rimonthlydayofmonthday"','id="${name}monthlydayofmonthday">',"{{each [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,","18,19,20,21,22,23,24,25,26,27,28,29,30,31]}}",'<option value="${$value}">${$value}</option>',"{{/each}}","</select>","${i18n.monthlyDayOfMonth2}","</div>","<div>","<input",'type="radio"','value="WEEKDAYOFMONTH"','name="rimonthlytype"','id="${name}monthlytype:WEEKDAYOFMONTH" />','<label for="${name}monthlytype:WEEKDAYOFMONTH">',"${i18n.monthlyWeekdayOfMonth1}","</label>",'<select name="rimonthlyweekdayofmonthindex">',"{{each i18n.orderIndexes}}",'<option value="${orderIndexes[$index]}">${$value}</option>',"{{/each}}","</select>","${i18n.monthlyWeekdayOfMonth2}",'<select name="rimonthlyweekdayofmonth">',"{{each orderedWeekdays}}",'<option value="${weekdays[$value]}">${i18n.weekdays[$value]}</option>',"{{/each}}","</select>","${i18n.monthlyWeekdayOfMonth3}","</div>","</div>","</div>",'<div id="riyearlyinterval" class="rifield">','<label for="riyearlyinterval" class="label">${i18n.yearlyInterval1}</label>','<div class="field">','<input type="text" size="2"','value="1" ','name="riyearlyinterval"/>',"${i18n.yearlyInterval2}","</div>","</div>",'<div id="riyearlyoptions" class="rifield">','<label for="riyearlyType" class="label">${i18n.yearlyRepeatOn}</label>','<div class="field">',"<div>","<input",'type="radio"','value="DAYOFMONTH"','name="riyearlyType"','id="${name}yearlytype:DAYOFMONTH" />','<label for="${name}yearlytype:DAYOFMONTH">',"${i18n.yearlyDayOfMonth1}","</label>",'<select name="riyearlydayofmonthmonth">',"{{each i18n.months}}",'<option value="${$index+1}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyDayOfMonth2}",'<select name="riyearlydayofmonthday">',"{{each [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,","18,19,20,21,22,23,24,25,26,27,28,29,30,31]}}",'<option value="${$value}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyDayOfMonth3}","</div>","<div>","<input",'type="radio"','value="WEEKDAYOFMONTH"','name="riyearlyType"','id="${name}yearlytype:WEEKDAYOFMONTH"/>','<label for="${name}yearlytype:WEEKDAYOFMONTH">',"${i18n.yearlyWeekdayOfMonth1}","</label>",'<select name="riyearlyweekdayofmonthindex">',"{{each i18n.orderIndexes}}",'<option value="${orderIndexes[$index]}">${$value}</option>',"{{/each}}","</select>",'<label for="${name}yearlytype:WEEKDAYOFMONTH">',"${i18n.yearlyWeekdayOfMonth2}","</label>",'<select name="riyearlyweekdayofmonthday">',"{{each orderedWeekdays}}",'<option value="${weekdays[$value]}">${i18n.weekdays[$value]}</option>',"{{/each}}","</select>","${i18n.yearlyWeekdayOfMonth3}",'<select name="riyearlyweekdayofmonthmonth">',"{{each i18n.months}}",'<option value="${$index+1}">${$value}</option>',"{{/each}}","</select>","${i18n.yearlyWeekdayOfMonth4}","</div>","</div>","</div>",'<div id="rirangeoptions" class="rifield">','<label class="label">${i18n.range}</label>','<div class="field">',"{{if hasRepeatForeverButton}}","<div>","<input",'type="radio"','value="NOENDDATE"','name="rirangetype"','id="${name}rangetype:NOENDDATE"/>','<label for="${name}rangetype:NOENDDATE">',"${i18n.rangeNoEnd}","</label>","</div>","{{/if}}","<div>","<input",'type="radio"','checked="checked"','value="BYOCCURRENCES"','name="rirangetype"','id="${name}rangetype:BYOCCURRENCES"/>','<label for="${name}rangetype:BYOCCURRENCES">',"${i18n.rangeByOccurrences1}","</label>","<input",'type="text" size="3"','value="7"','name="rirangebyoccurrencesvalue" />',"${i18n.rangeByOccurrences2}","</div>","<div>","<input",'type="radio"','value="BYENDDATE"','name="rirangetype"','id="${name}rangetype:BYENDDATE"/>','<label for="${name}rangetype:BYENDDATE">',"${i18n.rangeByEndDate}","</label>","<input",'type="date"','name="rirangebyenddatecalendar" />',"</div>","</div>","</div>","</div>",'<div class="rioccurrencesactions">','<div class="rioccurancesheader">',"<h2>${i18n.preview}</h2>",'<span class="refreshbutton action">','<a class="rirefreshbutton" href="#" title="${i18n.refresh}">',"${i18n.refresh}","</a>","</span>","</div>","</div>",'<div class="rioccurrences">',"</div>",'<div class="rioccurrencesactions">','<div class="rioccurancesheader">',"<h2>${i18n.addDate}</h2>","</div>",'<div class="riaddoccurrence">','<div class="errorarea"></div>','<input type="date" name="adddate" id="adddate" />','<input type="button" name="addaction" id="addaction" value="${i18n.add}">',"</div>","</div>",'<div class="ributtons">',"<input",'type="submit"','class="ricancelbutton ${ributtonExtraClass}"','value="${i18n.cancel}" />',"<input",'type="submit"','class="risavebutton ${ributtonExtraClass}"','value="${i18n.save}" />',"</div>","</form></div>"].join("\n");
$.template("formTmpl",FORMTMPL);var Re=/d{1,4}|m{1,4}|yy(?:yy)?|"[^"]*"|'[^']*'/g;$.fn.recurrenceinput=function(conf){if(this.data("recurrenceinput"))return this.data("recurrenceinput");var config=$.extend({},tool.conf);$.extend(config,conf),$.extend(config,{i18n:LABELS[config.lang],name:this.attr("name")});var recurrenceinput=new RecurrenceInput(config,this);return recurrenceinput.form.appendTo("body"),this.after(recurrenceinput.display),this.hide(),this.data("recurrenceinput",recurrenceinput),recurrenceinput}}(jQuery)}.apply(root,arguments)})}(this),define("mockup-patterns-recurrence",["jquery","pat-base","jquery.recurrenceinput"],function($,Base){"use strict";var Recurrence=Base.extend({name:"recurrence",trigger:".pat-recurrence",parser:"mockup",defaults:{language:"en",localization:null,configuration:{}},init:function(){this.$el.addClass("recurrence-widget"),this.options.localization&&$.tools.recurrenceinput.localize(this.options.language,this.options.localization),this.$el.recurrenceinput(this.options.configuration)}});return Recurrence}),function(root){define("jqtree",["jquery"],function(){return function(){!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var $,DragAndDropHandler,DragElement,HitAreasGenerator,Position,VisibleNodeIterator,node_module,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;node_module=require("./node"),Position=node_module.Position,$=jQuery,DragAndDropHandler=function(){function DragAndDropHandler(tree_widget){this.tree_widget=tree_widget,this.hovered_area=null,this.$ghost=null,this.hit_areas=[],this.is_dragging=!1,this.current_item=null}return DragAndDropHandler.prototype.mouseCapture=function(position_info){var $element,node_element;return $element=$(position_info.target),this.mustCaptureElement($element)?this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle($element)?null:(node_element=this.tree_widget._getNodeElement($element),node_element&&this.tree_widget.options.onCanMove&&(this.tree_widget.options.onCanMove(node_element.node)||(node_element=null)),this.current_item=node_element,null!==this.current_item):null},DragAndDropHandler.prototype.mouseStart=function(position_info){var offset;return this.refresh(),offset=$(position_info.target).offset(),this.drag_element=new DragElement(this.current_item.node,position_info.page_x-offset.left,position_info.page_y-offset.top,this.tree_widget.element),this.is_dragging=!0,this.current_item.$element.addClass("jqtree-moving"),!0},DragAndDropHandler.prototype.mouseDrag=function(position_info){var area,can_move_to;return this.drag_element.move(position_info.page_x,position_info.page_y),area=this.findHoveredArea(position_info.page_x,position_info.page_y),can_move_to=this.canMoveToArea(area),can_move_to&&area?(area.node.isFolder()||this.stopOpenFolderTimer(),this.hovered_area!==area&&(this.hovered_area=area,this.mustOpenFolderTimer(area)?this.startOpenFolderTimer(area.node):this.stopOpenFolderTimer(),this.updateDropHint())):(this.removeHover(),this.removeDropHint(),this.stopOpenFolderTimer()),area||null!=this.tree_widget.options.onDragMove&&this.tree_widget.options.onDragMove(this.current_item.node,position_info.original_event),!0},DragAndDropHandler.prototype.mustCaptureElement=function($element){return!$element.is("input,select")},DragAndDropHandler.prototype.canMoveToArea=function(area){var position_name;return!!area&&(!this.tree_widget.options.onCanMoveTo||(position_name=Position.getName(area.position),this.tree_widget.options.onCanMoveTo(this.current_item.node,area.node,position_name)))},DragAndDropHandler.prototype.mouseStop=function(position_info){var current_item;return this.moveItem(position_info),this.clear(),this.removeHover(),this.removeDropHint(),this.removeHitAreas(),current_item=this.current_item,this.current_item&&(this.current_item.$element.removeClass("jqtree-moving"),this.current_item=null),this.is_dragging=!1,!this.hovered_area&&current_item&&null!=this.tree_widget.options.onDragStop&&this.tree_widget.options.onDragStop(current_item.node,position_info.original_event),!1},DragAndDropHandler.prototype.refresh=function(){if(this.removeHitAreas(),this.current_item&&(this.generateHitAreas(),this.current_item=this.tree_widget._getNodeElementForNode(this.current_item.node),this.is_dragging))return this.current_item.$element.addClass("jqtree-moving")},DragAndDropHandler.prototype.removeHitAreas=function(){return this.hit_areas=[]},DragAndDropHandler.prototype.clear=function(){return this.drag_element.remove(),this.drag_element=null},DragAndDropHandler.prototype.removeDropHint=function(){if(this.previous_ghost)return this.previous_ghost.remove()},DragAndDropHandler.prototype.removeHover=function(){return this.hovered_area=null},DragAndDropHandler.prototype.generateHitAreas=function(){var hit_areas_generator;return hit_areas_generator=new HitAreasGenerator(this.tree_widget.tree,this.current_item.node,this.getTreeDimensions().bottom),this.hit_areas=hit_areas_generator.generate()},DragAndDropHandler.prototype.findHoveredArea=function(x,y){var area,dimensions,high,low,mid;if(dimensions=this.getTreeDimensions(),x<dimensions.left||y<dimensions.top||x>dimensions.right||y>dimensions.bottom)return null;for(low=0,high=this.hit_areas.length;low<high;)if(mid=low+high>>1,area=this.hit_areas[mid],y<area.top)high=mid;else{if(!(y>area.bottom))return area;low=mid+1}return null},DragAndDropHandler.prototype.mustOpenFolderTimer=function(area){var node;return node=area.node,node.isFolder()&&!node.is_open&&area.position===Position.INSIDE},DragAndDropHandler.prototype.updateDropHint=function(){var node_element;if(this.hovered_area)return this.removeDropHint(),node_element=this.tree_widget._getNodeElementForNode(this.hovered_area.node),this.previous_ghost=node_element.addDropHint(this.hovered_area.position)},DragAndDropHandler.prototype.startOpenFolderTimer=function(folder){var openFolder;return openFolder=function(_this){return function(){return _this.tree_widget._openNode(folder,_this.tree_widget.options.slide,function(){return _this.refresh(),_this.updateDropHint()})}}(this),this.stopOpenFolderTimer(),this.open_folder_timer=setTimeout(openFolder,this.tree_widget.options.openFolderDelay)},DragAndDropHandler.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer)return clearTimeout(this.open_folder_timer),this.open_folder_timer=null},DragAndDropHandler.prototype.moveItem=function(position_info){var doMove,event,moved_node,position,previous_parent,target_node;if(this.hovered_area&&this.hovered_area.position!==Position.NONE&&this.canMoveToArea(this.hovered_area)&&(moved_node=this.current_item.node,target_node=this.hovered_area.node,position=this.hovered_area.position,previous_parent=moved_node.parent,position===Position.INSIDE&&(this.hovered_area.node.is_open=!0),doMove=function(_this){return function(){return _this.tree_widget.tree.moveNode(moved_node,target_node,position),_this.tree_widget.element.empty(),_this.tree_widget._refreshElements()}}(this),event=this.tree_widget._triggerEvent("tree.move",{move_info:{moved_node:moved_node,target_node:target_node,position:Position.getName(position),previous_parent:previous_parent,do_move:doMove,original_event:position_info.original_event}}),!event.isDefaultPrevented()))return doMove()},DragAndDropHandler.prototype.getTreeDimensions=function(){var offset;return offset=this.tree_widget.element.offset(),{left:offset.left,top:offset.top,right:offset.left+this.tree_widget.element.width(),bottom:offset.top+this.tree_widget.element.height()+16}},DragAndDropHandler}(),VisibleNodeIterator=function(){function VisibleNodeIterator(tree){this.tree=tree}return VisibleNodeIterator.prototype.iterate=function(){var _iterateNode,is_first_node;return is_first_node=!0,(_iterateNode=function(_this){return function(node,next_node){var $element,child,children_length,i,j,len,must_iterate_inside,ref;if(must_iterate_inside=(node.is_open||!node.element)&&node.hasChildren(),node.element){if($element=$(node.element),!$element.is(":visible"))return;is_first_node&&(_this.handleFirstNode(node,$element),is_first_node=!1),node.hasChildren()?node.is_open?_this.handleOpenFolder(node,$element)||(must_iterate_inside=!1):_this.handleClosedFolder(node,next_node,$element):_this.handleNode(node,next_node,$element)}if(must_iterate_inside){for(children_length=node.children.length,ref=node.children,i=j=0,len=ref.length;j<len;i=++j)child=ref[i],i===children_length-1?_iterateNode(node.children[i],null):_iterateNode(node.children[i],node.children[i+1]);if(node.is_open)return _this.handleAfterOpenFolder(node,next_node,$element)}}}(this))(this.tree,null)},VisibleNodeIterator.prototype.handleNode=function(node,next_node,$element){},VisibleNodeIterator.prototype.handleOpenFolder=function(node,$element){},VisibleNodeIterator.prototype.handleClosedFolder=function(node,next_node,$element){},VisibleNodeIterator.prototype.handleAfterOpenFolder=function(node,next_node,$element){},VisibleNodeIterator.prototype.handleFirstNode=function(node,$element){},VisibleNodeIterator}(),HitAreasGenerator=function(superClass){function HitAreasGenerator(tree,current_node,tree_bottom){HitAreasGenerator.__super__.constructor.call(this,tree),this.current_node=current_node,this.tree_bottom=tree_bottom}return extend(HitAreasGenerator,superClass),HitAreasGenerator.prototype.generate=function(){return this.positions=[],this.last_top=0,this.iterate(),this.generateHitAreas(this.positions)},HitAreasGenerator.prototype.getTop=function($element){return $element.offset().top},HitAreasGenerator.prototype.addPosition=function(node,position,top){var area;return area={top:top,node:node,position:position},this.positions.push(area),this.last_top=top},HitAreasGenerator.prototype.handleNode=function(node,next_node,$element){var top;return top=this.getTop($element),node===this.current_node?this.addPosition(node,Position.NONE,top):this.addPosition(node,Position.INSIDE,top),next_node===this.current_node||node===this.current_node?this.addPosition(node,Position.NONE,top):this.addPosition(node,Position.AFTER,top)},HitAreasGenerator.prototype.handleOpenFolder=function(node,$element){return node!==this.current_node&&(node.children[0]!==this.current_node&&this.addPosition(node,Position.INSIDE,this.getTop($element)),!0)},HitAreasGenerator.prototype.handleClosedFolder=function(node,next_node,$element){var top;return top=this.getTop($element),node===this.current_node?this.addPosition(node,Position.NONE,top):(this.addPosition(node,Position.INSIDE,top),next_node!==this.current_node?this.addPosition(node,Position.AFTER,top):void 0)},HitAreasGenerator.prototype.handleFirstNode=function(node,$element){if(node!==this.current_node)return this.addPosition(node,Position.BEFORE,this.getTop($(node.element)))},HitAreasGenerator.prototype.handleAfterOpenFolder=function(node,next_node,$element){return node===this.current_node.node||next_node===this.current_node.node?this.addPosition(node,Position.NONE,this.last_top):this.addPosition(node,Position.AFTER,this.last_top)},HitAreasGenerator.prototype.generateHitAreas=function(positions){var group,hit_areas,j,len,position,previous_top;for(previous_top=-1,group=[],hit_areas=[],j=0,len=positions.length;j<len;j++)position=positions[j],position.top!==previous_top&&group.length&&(group.length&&this.generateHitAreasForGroup(hit_areas,group,previous_top,position.top),previous_top=position.top,group=[]),group.push(position);return this.generateHitAreasForGroup(hit_areas,group,previous_top,this.tree_bottom),hit_areas},HitAreasGenerator.prototype.generateHitAreasForGroup=function(hit_areas,positions_in_group,top,bottom){var area_height,area_top,i,position,position_count;for(position_count=Math.min(positions_in_group.length,4),area_height=Math.round((bottom-top)/position_count),area_top=top,i=0;i<position_count;)position=positions_in_group[i],hit_areas.push({top:area_top,bottom:area_top+area_height,node:position.node,position:position.position}),area_top+=area_height,i+=1;return null},HitAreasGenerator}(VisibleNodeIterator),DragElement=function(){function DragElement(node,offset_x,offset_y,$tree){this.offset_x=offset_x,this.offset_y=offset_y,this.$element=$('<span class="jqtree-title jqtree-dragging">'+node.name+"</span>"),this.$element.css("position","absolute"),$tree.append(this.$element)}return DragElement.prototype.move=function(page_x,page_y){return this.$element.offset({left:page_x-this.offset_x,top:page_y-this.offset_y})},DragElement.prototype.remove=function(){return this.$element.remove()},DragElement}(),module.exports={DragAndDropHandler:DragAndDropHandler,DragElement:DragElement,HitAreasGenerator:HitAreasGenerator}},{"./node":5}],2:[function(require,module,exports){var $,ElementsRenderer,NodeElement,html_escape,node_element,util;node_element=require("./node_element"),NodeElement=node_element.NodeElement,util=require("./util"),html_escape=util.html_escape,$=jQuery,ElementsRenderer=function(){function ElementsRenderer(tree_widget){this.tree_widget=tree_widget,this.opened_icon_element=this.createButtonElement(tree_widget.options.openedIcon),this.closed_icon_element=this.createButtonElement(tree_widget.options.closedIcon)}return ElementsRenderer.prototype.render=function(from_node){return from_node&&from_node.parent?this.renderFromNode(from_node):this.renderFromRoot()},ElementsRenderer.prototype.renderFromRoot=function(){var $element;return $element=this.tree_widget.element,$element.empty(),this.createDomElements($element[0],this.tree_widget.tree.children,!0,!0,1)},ElementsRenderer.prototype.renderFromNode=function(node){var $previous_li,li;if($previous_li=$(node.element),li=this.createLi(node,node.getLevel()),this.attachNodeData(node,li),$previous_li.after(li),$previous_li.remove(),node.children)return this.createDomElements(li,node.children,!1,!1,node.getLevel()+1)},ElementsRenderer.prototype.createDomElements=function(element,children,is_root_node,is_open,level){var child,i,len,li,ul;for(ul=this.createUl(is_root_node),element.appendChild(ul),i=0,len=children.length;i<len;i++)child=children[i],li=this.createLi(child,level),ul.appendChild(li),this.attachNodeData(child,li),child.hasChildren()&&this.createDomElements(li,child.children,!1,child.is_open,level+1);return null},ElementsRenderer.prototype.attachNodeData=function(node,li){return node.element=li,$(li).data("node",node)},ElementsRenderer.prototype.createUl=function(is_root_node){var class_string,role,ul;return is_root_node?(class_string="jqtree-tree",role="tree",this.tree_widget.options.rtl&&(class_string+=" jqtree-rtl")):(class_string="",role="group"),ul=document.createElement("ul"),ul.className="jqtree_common "+class_string,ul.setAttribute("role",role),ul},ElementsRenderer.prototype.createLi=function(node,level){var is_selected,li;return is_selected=this.tree_widget.select_node_handler&&this.tree_widget.select_node_handler.isNodeSelected(node),li=node.isFolder()?this.createFolderLi(node,level,is_selected):this.createNodeLi(node,level,is_selected),this.tree_widget.options.onCreateLi&&this.tree_widget.options.onCreateLi(node,$(li)),li},ElementsRenderer.prototype.createFolderLi=function(node,level,is_selected){var button_classes,button_link,div,folder_classes,icon_element,is_folder,li;return button_classes=this.getButtonClasses(node),folder_classes=this.getFolderClasses(node,is_selected),icon_element=node.is_open?this.opened_icon_element:this.closed_icon_element,li=document.createElement("li"),li.className="jqtree_common "+folder_classes,li.setAttribute("role","presentation"),div=document.createElement("div"),div.className="jqtree-element jqtree_common",div.setAttribute("role","presentation"),li.appendChild(div),button_link=document.createElement("a"),button_link.className=button_classes,button_link.appendChild(icon_element.cloneNode(!1)),button_link.setAttribute("role","presentation"),button_link.setAttribute("aria-hidden","true"),this.tree_widget.options.buttonLeft&&div.appendChild(button_link),div.appendChild(this.createTitleSpan(node.name,level,is_selected,node.is_open,is_folder=!0)),this.tree_widget.options.buttonLeft||div.appendChild(button_link),li},ElementsRenderer.prototype.createNodeLi=function(node,level,is_selected){var class_string,div,is_folder,li,li_classes;return li_classes=["jqtree_common"],is_selected&&li_classes.push("jqtree-selected"),class_string=li_classes.join(" "),li=document.createElement("li"),li.className=class_string,li.setAttribute("role","presentation"),div=document.createElement("div"),div.className="jqtree-element jqtree_common",div.setAttribute("role","presentation"),li.appendChild(div),div.appendChild(this.createTitleSpan(node.name,level,is_selected,node.is_open,is_folder=!1)),li},ElementsRenderer.prototype.createTitleSpan=function(node_name,level,is_selected,is_open,is_folder){var classes,title_span;return title_span=document.createElement("span"),classes="jqtree-title jqtree_common",is_folder&&(classes+=" jqtree-title-folder"),title_span.className=classes,title_span.setAttribute("role","treeitem"),title_span.setAttribute("aria-level",level),title_span.setAttribute("aria-selected",util.getBoolString(is_selected)),title_span.setAttribute("aria-expanded",util.getBoolString(is_open)),is_selected&&title_span.setAttribute("tabindex",0),title_span.innerHTML=this.escapeIfNecessary(node_name),title_span},ElementsRenderer.prototype.getButtonClasses=function(node){var classes;return classes=["jqtree-toggler","jqtree_common"],node.is_open||classes.push("jqtree-closed"),this.tree_widget.options.buttonLeft?classes.push("jqtree-toggler-left"):classes.push("jqtree-toggler-right"),classes.join(" ")},ElementsRenderer.prototype.getFolderClasses=function(node,is_selected){var classes;return classes=["jqtree-folder"],node.is_open||classes.push("jqtree-closed"),is_selected&&classes.push("jqtree-selected"),node.is_loading&&classes.push("jqtree-loading"),classes.join(" ")},ElementsRenderer.prototype.escapeIfNecessary=function(value){return this.tree_widget.options.autoEscape?html_escape(value):value},ElementsRenderer.prototype.createButtonElement=function(value){var div;return"string"==typeof value?(div=document.createElement("div"),div.innerHTML=value,document.createTextNode(div.innerHTML)):$(value)[0]},ElementsRenderer}(),module.exports=ElementsRenderer},{"./node_element":6,"./util":12}],3:[function(require,module,exports){var $,KeyHandler,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};$=jQuery,KeyHandler=function(){function KeyHandler(tree_widget){this.selectNode=bind(this.selectNode,this),this.tree_widget=tree_widget,tree_widget.options.keyboardSupport&&$(document).bind("keydown.jqtree",$.proxy(this.handleKeyDown,this))}var DOWN,LEFT,RIGHT,UP;return LEFT=37,UP=38,RIGHT=39,DOWN=40,KeyHandler.prototype.deinit=function(){return $(document).unbind("keydown.jqtree")},KeyHandler.prototype.moveDown=function(){var node;return node=this.tree_widget.getSelectedNode(),!!node&&this.selectNode(node.getNextNode())},KeyHandler.prototype.moveUp=function(){var node;return node=this.tree_widget.getSelectedNode(),!!node&&this.selectNode(node.getPreviousNode())},KeyHandler.prototype.moveRight=function(){var node;return node=this.tree_widget.getSelectedNode(),!node||(!node.isFolder()||(node.is_open?this.selectNode(node.getNextNode()):(this.tree_widget.openNode(node),!1)))},KeyHandler.prototype.moveLeft=function(){var node;return node=this.tree_widget.getSelectedNode(),!node||(node.isFolder()&&node.is_open?(this.tree_widget.closeNode(node),!1):this.selectNode(node.getParent()))},KeyHandler.prototype.handleKeyDown=function(e){var key;if(!this.tree_widget.options.keyboardSupport)return!0;if($(document.activeElement).is("textarea,input,select"))return!0;if(!this.tree_widget.getSelectedNode())return!0;switch(key=e.which){case DOWN:return this.moveDown();case UP:return this.moveUp();case RIGHT:return this.moveRight();case LEFT:return this.moveLeft()}return!0},KeyHandler.prototype.selectNode=function(node){return!node||(this.tree_widget.selectNode(node),this.tree_widget.scroll_handler&&!this.tree_widget.scroll_handler.isScrolledIntoView($(node.element).find(".jqtree-element"))&&this.tree_widget.scrollToNode(node),!1)},KeyHandler}(),module.exports=KeyHandler},{}],4:[function(require,module,exports){var $,MouseWidget,SimpleWidget,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;SimpleWidget=require("./simple.widget"),$=jQuery,MouseWidget=function(superClass){function MouseWidget(){return MouseWidget.__super__.constructor.apply(this,arguments)}return extend(MouseWidget,superClass),MouseWidget.is_mouse_handled=!1,MouseWidget.prototype._init=function(){return this.$el.bind("mousedown.mousewidget",$.proxy(this._mouseDown,this)),this.$el.bind("touchstart.mousewidget",$.proxy(this._touchStart,this)),this.is_mouse_started=!1,this.mouse_delay=0,this._mouse_delay_timer=null,this._is_mouse_delay_met=!0,this.mouse_down_info=null},MouseWidget.prototype._deinit=function(){var $document;return this.$el.unbind("mousedown.mousewidget"),this.$el.unbind("touchstart.mousewidget"),$document=$(document),$document.unbind("mousemove.mousewidget"),$document.unbind("mouseup.mousewidget")},MouseWidget.prototype._mouseDown=function(e){var result;if(1===e.which)return result=this._handleMouseDown(e,this._getPositionInfo(e)),result&&e.preventDefault(),result},MouseWidget.prototype._handleMouseDown=function(e,position_info){if(!MouseWidget.is_mouse_handled&&(this.is_mouse_started&&this._handleMouseUp(position_info),this.mouse_down_info=position_info,this._mouseCapture(position_info)))return this._handleStartMouse(),this.is_mouse_handled=!0,!0},MouseWidget.prototype._handleStartMouse=function(){var $document;if($document=$(document),$document.bind("mousemove.mousewidget",$.proxy(this._mouseMove,this)),$document.bind("touchmove.mousewidget",$.proxy(this._touchMove,this)),$document.bind("mouseup.mousewidget",$.proxy(this._mouseUp,this)),$document.bind("touchend.mousewidget",$.proxy(this._touchEnd,this)),this.mouse_delay)return this._startMouseDelayTimer()},MouseWidget.prototype._startMouseDelayTimer=function(){return this._mouse_delay_timer&&clearTimeout(this._mouse_delay_timer),this._mouse_delay_timer=setTimeout(function(_this){return function(){return _this._is_mouse_delay_met=!0}}(this),this.mouse_delay),this._is_mouse_delay_met=!1},MouseWidget.prototype._mouseMove=function(e){return this._handleMouseMove(e,this._getPositionInfo(e))},MouseWidget.prototype._handleMouseMove=function(e,position_info){return this.is_mouse_started?(this._mouseDrag(position_info),e.preventDefault()):!(!this.mouse_delay||this._is_mouse_delay_met)||(this.is_mouse_started=this._mouseStart(this.mouse_down_info)!==!1,this.is_mouse_started?this._mouseDrag(position_info):this._handleMouseUp(position_info),!this.is_mouse_started)},MouseWidget.prototype._getPositionInfo=function(e){return{page_x:e.pageX,page_y:e.pageY,target:e.target,original_event:e}},MouseWidget.prototype._mouseUp=function(e){return this._handleMouseUp(this._getPositionInfo(e))},MouseWidget.prototype._handleMouseUp=function(position_info){var $document;$document=$(document),$document.unbind("mousemove.mousewidget"),$document.unbind("touchmove.mousewidget"),$document.unbind("mouseup.mousewidget"),$document.unbind("touchend.mousewidget"),this.is_mouse_started&&(this.is_mouse_started=!1,this._mouseStop(position_info))},MouseWidget.prototype._mouseCapture=function(position_info){return!0},MouseWidget.prototype._mouseStart=function(position_info){return null},MouseWidget.prototype._mouseDrag=function(position_info){return null},MouseWidget.prototype._mouseStop=function(position_info){return null},MouseWidget.prototype.setMouseDelay=function(mouse_delay){return this.mouse_delay=mouse_delay},MouseWidget.prototype._touchStart=function(e){var touch;if(!(e.originalEvent.touches.length>1))return touch=e.originalEvent.changedTouches[0],this._handleMouseDown(e,this._getPositionInfo(touch))},MouseWidget.prototype._touchMove=function(e){var touch;if(!(e.originalEvent.touches.length>1))return touch=e.originalEvent.changedTouches[0],this._handleMouseMove(e,this._getPositionInfo(touch))},MouseWidget.prototype._touchEnd=function(e){var touch;if(!(e.originalEvent.touches.length>1))return touch=e.originalEvent.changedTouches[0],this._handleMouseUp(this._getPositionInfo(touch))},MouseWidget}(SimpleWidget),module.exports=MouseWidget},{"./simple.widget":10}],5:[function(require,module,exports){var $,Node,Position;$=jQuery,Position={getName:function(position){return Position.strings[position-1]},nameToIndex:function(name){var i,j,ref;for(i=j=1,ref=Position.strings.length;1<=ref?j<=ref:j>=ref;i=1<=ref?++j:--j)if(Position.strings[i-1]===name)return i;return 0}},Position.BEFORE=1,Position.AFTER=2,Position.INSIDE=3,Position.NONE=4,Position.strings=["before","after","inside","none"],Node=function(){function Node(o,is_root,node_class){null==is_root&&(is_root=!1),null==node_class&&(node_class=Node),this.name="",this.setData(o),this.children=[],this.parent=null,is_root&&(this.id_mapping={},this.tree=this,this.node_class=node_class)}return Node.prototype.setData=function(o){var key,setName,value;if(setName=function(_this){return function(name){if(null!==name)return _this.name=name}}(this),"object"!=typeof o)setName(o);else for(key in o)value=o[key],"label"===key?setName(value):"children"!==key&&(this[key]=value);return null},Node.prototype.initFromData=function(data){var addChildren,addNode;return addNode=function(_this){return function(node_data){if(_this.setData(node_data),node_data.children)return addChildren(node_data.children)}}(this),addChildren=function(_this){return function(children_data){var child,j,len,node;for(j=0,len=children_data.length;j<len;j++)child=children_data[j],node=new _this.tree.node_class(""),node.initFromData(child),_this.addChild(node);return null}}(this),addNode(data),null},Node.prototype.loadFromData=function(data){var j,len,node,o;for(this.removeChildren(),j=0,len=data.length;j<len;j++)o=data[j],node=new this.tree.node_class(o),this.addChild(node),"object"==typeof o&&o.children&&node.loadFromData(o.children);return null},Node.prototype.addChild=function(node){return this.children.push(node),node._setParent(this)},Node.prototype.addChildAtPosition=function(node,index){return this.children.splice(index,0,node),node._setParent(this)},Node.prototype._setParent=function(parent){return this.parent=parent,this.tree=parent.tree,this.tree.addNodeToIndex(this)},Node.prototype.removeChild=function(node){return node.removeChildren(),this._removeChild(node)},Node.prototype._removeChild=function(node){return this.children.splice(this.getChildIndex(node),1),this.tree.removeNodeFromIndex(node)},Node.prototype.getChildIndex=function(node){return $.inArray(node,this.children)},Node.prototype.hasChildren=function(){return 0!==this.children.length},Node.prototype.isFolder=function(){return this.hasChildren()||this.load_on_demand},Node.prototype.iterate=function(callback){var _iterate;return _iterate=function(node,level){var child,j,len,ref,result;if(node.children){for(ref=node.children,j=0,len=ref.length;j<len;j++)child=ref[j],result=callback(child,level),result&&child.hasChildren()&&_iterate(child,level+1);return null}},_iterate(this,0),null},Node.prototype.moveNode=function(moved_node,target_node,position){if(!moved_node.isParentOf(target_node))return moved_node.parent._removeChild(moved_node),position===Position.AFTER?target_node.parent.addChildAtPosition(moved_node,target_node.parent.getChildIndex(target_node)+1):position===Position.BEFORE?target_node.parent.addChildAtPosition(moved_node,target_node.parent.getChildIndex(target_node)):position===Position.INSIDE?target_node.addChildAtPosition(moved_node,0):void 0},Node.prototype.getData=function(include_parent){var getDataFromNodes;return null==include_parent&&(include_parent=!1),(getDataFromNodes=function(nodes){var data,j,k,len,node,tmp_node,v;for(data=[],j=0,len=nodes.length;j<len;j++){node=nodes[j],tmp_node={};for(k in node)v=node[k],"parent"!==k&&"children"!==k&&"element"!==k&&"tree"!==k&&Object.prototype.hasOwnProperty.call(node,k)&&(tmp_node[k]=v);node.hasChildren()&&(tmp_node.children=getDataFromNodes(node.children)),data.push(tmp_node)}return data})(include_parent?[this]:this.children)},Node.prototype.getNodeByName=function(name){var result;return result=null,this.iterate(function(node){return node.name!==name||(result=node,!1)}),result},Node.prototype.addAfter=function(node_info){var child_index,node;return this.parent?(node=new this.tree.node_class(node_info),child_index=this.parent.getChildIndex(this),this.parent.addChildAtPosition(node,child_index+1),"object"==typeof node_info&&node_info.children&&node_info.children.length&&node.loadFromData(node_info.children),node):null},Node.prototype.addBefore=function(node_info){var child_index,node;return this.parent?(node=new this.tree.node_class(node_info),child_index=this.parent.getChildIndex(this),this.parent.addChildAtPosition(node,child_index),"object"==typeof node_info&&node_info.children&&node_info.children.length&&node.loadFromData(node_info.children),node):null},Node.prototype.addParent=function(node_info){var child,j,len,new_parent,original_parent,ref;if(this.parent){for(new_parent=new this.tree.node_class(node_info),new_parent._setParent(this.tree),original_parent=this.parent,ref=original_parent.children,j=0,len=ref.length;j<len;j++)child=ref[j],new_parent.addChild(child);return original_parent.children=[],original_parent.addChild(new_parent),new_parent}return null},Node.prototype.remove=function(){if(this.parent)return this.parent.removeChild(this),this.parent=null},Node.prototype.append=function(node_info){var node;return node=new this.tree.node_class(node_info),this.addChild(node),"object"==typeof node_info&&node_info.children&&node_info.children.length&&node.loadFromData(node_info.children),node},Node.prototype.prepend=function(node_info){var node;return node=new this.tree.node_class(node_info),this.addChildAtPosition(node,0),"object"==typeof node_info&&node_info.children&&node_info.children.length&&node.loadFromData(node_info.children),node},Node.prototype.isParentOf=function(node){var parent;for(parent=node.parent;parent;){if(parent===this)return!0;parent=parent.parent}return!1},Node.prototype.getLevel=function(){var level,node;for(level=0,node=this;node.parent;)level+=1,node=node.parent;return level},Node.prototype.getNodeById=function(node_id){return this.id_mapping[node_id]},Node.prototype.addNodeToIndex=function(node){if(null!=node.id)return this.id_mapping[node.id]=node},Node.prototype.removeNodeFromIndex=function(node){if(null!=node.id)return delete this.id_mapping[node.id]},Node.prototype.removeChildren=function(){return this.iterate(function(_this){return function(child){return _this.tree.removeNodeFromIndex(child),!0}}(this)),this.children=[]},Node.prototype.getPreviousSibling=function(){var previous_index;return this.parent?(previous_index=this.parent.getChildIndex(this)-1,previous_index>=0?this.parent.children[previous_index]:null):null},Node.prototype.getNextSibling=function(){var next_index;return this.parent?(next_index=this.parent.getChildIndex(this)+1,next_index<this.parent.children.length?this.parent.children[next_index]:null):null;
},Node.prototype.getNodesByProperty=function(key,value){return this.filter(function(node){return node[key]===value})},Node.prototype.filter=function(f){var result;return result=[],this.iterate(function(node){return f(node)&&result.push(node),!0}),result},Node.prototype.getNextNode=function(include_children){var next_sibling;return null==include_children&&(include_children=!0),include_children&&this.hasChildren()&&this.is_open?this.children[0]:this.parent?(next_sibling=this.getNextSibling(),next_sibling?next_sibling:this.parent.getNextNode(!1)):null},Node.prototype.getPreviousNode=function(){var previous_sibling;return this.parent?(previous_sibling=this.getPreviousSibling(),previous_sibling?previous_sibling.hasChildren()&&previous_sibling.is_open?previous_sibling.getLastChild():previous_sibling:this.getParent()):null},Node.prototype.getParent=function(){return this.parent&&this.parent.parent?this.parent:null},Node.prototype.getLastChild=function(){var last_child;return this.hasChildren()?(last_child=this.children[this.children.length-1],last_child.hasChildren()&&last_child.is_open?last_child.getLastChild():last_child):null},Node}(),module.exports={Node:Node,Position:Position}},{}],6:[function(require,module,exports){var $,BorderDropHint,FolderElement,GhostDropHint,NodeElement,Position,node,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;node=require("./node"),Position=node.Position,$=jQuery,NodeElement=function(){function NodeElement(node,tree_widget){this.init(node,tree_widget)}return NodeElement.prototype.init=function(node,tree_widget){return this.node=node,this.tree_widget=tree_widget,node.element||(node.element=this.tree_widget.element),this.$element=$(node.element)},NodeElement.prototype.getUl=function(){return this.$element.children("ul:first")},NodeElement.prototype.getSpan=function(){return this.$element.children(".jqtree-element").find("span.jqtree-title")},NodeElement.prototype.getLi=function(){return this.$element},NodeElement.prototype.addDropHint=function(position){return position===Position.INSIDE?new BorderDropHint(this.$element):new GhostDropHint(this.node,this.$element,position)},NodeElement.prototype.select=function(){var $li,$span;return $li=this.getLi(),$li.addClass("jqtree-selected"),$li.attr("aria-selected","true"),$span=this.getSpan(),$span.attr("tabindex",0)},NodeElement.prototype.deselect=function(){var $li,$span;return $li=this.getLi(),$li.removeClass("jqtree-selected"),$li.attr("aria-selected","false"),$span=this.getSpan(),$span.attr("tabindex",-1)},NodeElement}(),FolderElement=function(superClass){function FolderElement(){return FolderElement.__super__.constructor.apply(this,arguments)}return extend(FolderElement,superClass),FolderElement.prototype.open=function(on_finished,slide){var $button,doOpen;if(null==slide&&(slide=!0),!this.node.is_open)return this.node.is_open=!0,$button=this.getButton(),$button.removeClass("jqtree-closed"),$button.html(""),$button.append(this.tree_widget.renderer.opened_icon_element.cloneNode(!1)),doOpen=function(_this){return function(){var $li,$span;return $li=_this.getLi(),$li.removeClass("jqtree-closed"),$span=_this.getSpan(),$span.attr("aria-expanded","true"),on_finished&&on_finished(),_this.tree_widget._triggerEvent("tree.open",{node:_this.node})}}(this),slide?this.getUl().slideDown("fast",doOpen):(this.getUl().show(),doOpen())},FolderElement.prototype.close=function(slide){var $button,doClose;if(null==slide&&(slide=!0),this.node.is_open)return this.node.is_open=!1,$button=this.getButton(),$button.addClass("jqtree-closed"),$button.html(""),$button.append(this.tree_widget.renderer.closed_icon_element.cloneNode(!1)),doClose=function(_this){return function(){var $li,$span;return $li=_this.getLi(),$li.addClass("jqtree-closed"),$span=_this.getSpan(),$span.attr("aria-expanded","false"),_this.tree_widget._triggerEvent("tree.close",{node:_this.node})}}(this),slide?this.getUl().slideUp("fast",doClose):(this.getUl().hide(),doClose())},FolderElement.prototype.getButton=function(){return this.$element.children(".jqtree-element").find("a.jqtree-toggler")},FolderElement.prototype.addDropHint=function(position){return this.node.is_open||position!==Position.INSIDE?new GhostDropHint(this.node,this.$element,position):new BorderDropHint(this.$element)},FolderElement}(NodeElement),BorderDropHint=function(){function BorderDropHint($element){var $div,width;$div=$element.children(".jqtree-element"),width=$element.width()-4,this.$hint=$('<span class="jqtree-border"></span>'),$div.append(this.$hint),this.$hint.css({width:width,height:$div.outerHeight()-4})}return BorderDropHint.prototype.remove=function(){return this.$hint.remove()},BorderDropHint}(),GhostDropHint=function(){function GhostDropHint(node,$element,position){this.$element=$element,this.node=node,this.$ghost=$('<li class="jqtree_common jqtree-ghost"><span class="jqtree_common jqtree-circle"></span><span class="jqtree_common jqtree-line"></span></li>'),position===Position.AFTER?this.moveAfter():position===Position.BEFORE?this.moveBefore():position===Position.INSIDE&&(node.isFolder()&&node.is_open?this.moveInsideOpenFolder():this.moveInside())}return GhostDropHint.prototype.remove=function(){return this.$ghost.remove()},GhostDropHint.prototype.moveAfter=function(){return this.$element.after(this.$ghost)},GhostDropHint.prototype.moveBefore=function(){return this.$element.before(this.$ghost)},GhostDropHint.prototype.moveInsideOpenFolder=function(){return $(this.node.children[0].element).before(this.$ghost)},GhostDropHint.prototype.moveInside=function(){return this.$element.after(this.$ghost),this.$ghost.addClass("jqtree-inside")},GhostDropHint}(),module.exports={BorderDropHint:BorderDropHint,FolderElement:FolderElement,GhostDropHint:GhostDropHint,NodeElement:NodeElement}},{"./node":5}],7:[function(require,module,exports){var $,SaveStateHandler,indexOf,isInt,util;util=require("./util"),indexOf=util.indexOf,isInt=util.isInt,$=jQuery,SaveStateHandler=function(){function SaveStateHandler(tree_widget){this.tree_widget=tree_widget}return SaveStateHandler.prototype.saveState=function(){var state;return state=JSON.stringify(this.getState()),this.tree_widget.options.onSetStateFromStorage?this.tree_widget.options.onSetStateFromStorage(state):this.supportsLocalStorage()?localStorage.setItem(this.getCookieName(),state):$.cookie?($.cookie.raw=!0,$.cookie(this.getCookieName(),state,{path:"/"})):void 0},SaveStateHandler.prototype.getStateFromStorage=function(){var json_data;return json_data=this._loadFromStorage(),json_data?this._parseState(json_data):null},SaveStateHandler.prototype._parseState=function(json_data){var state;return state=$.parseJSON(json_data),state&&state.selected_node&&isInt(state.selected_node)&&(state.selected_node=[state.selected_node]),state},SaveStateHandler.prototype._loadFromStorage=function(){return this.tree_widget.options.onGetStateFromStorage?this.tree_widget.options.onGetStateFromStorage():this.supportsLocalStorage()?localStorage.getItem(this.getCookieName()):$.cookie?($.cookie.raw=!0,$.cookie(this.getCookieName())):null},SaveStateHandler.prototype.getState=function(){var getOpenNodeIds,getSelectedNodeIds;return getOpenNodeIds=function(_this){return function(){var open_nodes;return open_nodes=[],_this.tree_widget.tree.iterate(function(node){return node.is_open&&node.id&&node.hasChildren()&&open_nodes.push(node.id),!0}),open_nodes}}(this),getSelectedNodeIds=function(_this){return function(){var n;return function(){var i,len,ref,results;for(ref=this.tree_widget.getSelectedNodes(),results=[],i=0,len=ref.length;i<len;i++)n=ref[i],results.push(n.id);return results}.call(_this)}}(this),{open_nodes:getOpenNodeIds(),selected_node:getSelectedNodeIds()}},SaveStateHandler.prototype.setInitialState=function(state){var must_load_on_demand;return!!state&&(must_load_on_demand=this._openInitialNodes(state.open_nodes),this._selectInitialNodes(state.selected_node),must_load_on_demand)},SaveStateHandler.prototype._openInitialNodes=function(node_ids){var i,len,must_load_on_demand,node,node_id;for(must_load_on_demand=!1,i=0,len=node_ids.length;i<len;i++)node_id=node_ids[i],node=this.tree_widget.getNodeById(node_id),node&&(node.load_on_demand?must_load_on_demand=!0:node.is_open=!0);return must_load_on_demand},SaveStateHandler.prototype._selectInitialNodes=function(node_ids){var i,len,node,node_id,select_count;for(select_count=0,i=0,len=node_ids.length;i<len;i++)node_id=node_ids[i],node=this.tree_widget.getNodeById(node_id),node&&(select_count+=1,this.tree_widget.select_node_handler.addToSelection(node));return 0!==select_count},SaveStateHandler.prototype.setInitialStateOnDemand=function(state,cb_finished){return state?this._setInitialStateOnDemand(state.open_nodes,state.selected_node,cb_finished):cb_finished()},SaveStateHandler.prototype._setInitialStateOnDemand=function(node_ids,selected_nodes,cb_finished){var loadAndOpenNode,loading_count,openNodes;return loading_count=0,openNodes=function(_this){return function(){var i,len,new_nodes_ids,node,node_id;for(new_nodes_ids=[],i=0,len=node_ids.length;i<len;i++)node_id=node_ids[i],node=_this.tree_widget.getNodeById(node_id),node?node.is_loading||(node.load_on_demand?loadAndOpenNode(node):_this.tree_widget._openNode(node,!1)):new_nodes_ids.push(node_id);if(node_ids=new_nodes_ids,_this._selectInitialNodes(selected_nodes)&&_this.tree_widget._refreshElements(),0===loading_count)return cb_finished()}}(this),loadAndOpenNode=function(_this){return function(node){return loading_count+=1,_this.tree_widget._openNode(node,!1,function(){return loading_count-=1,openNodes()})}}(this),openNodes()},SaveStateHandler.prototype.getCookieName=function(){return"string"==typeof this.tree_widget.options.saveState?this.tree_widget.options.saveState:"tree"},SaveStateHandler.prototype.supportsLocalStorage=function(){var testSupport;return testSupport=function(){var error,error1,key;if("undefined"==typeof localStorage||null===localStorage)return!1;try{key="_storage_test",sessionStorage.setItem(key,!0),sessionStorage.removeItem(key)}catch(error1){return error=error1,!1}return!0},null==this._supportsLocalStorage&&(this._supportsLocalStorage=testSupport()),this._supportsLocalStorage},SaveStateHandler.prototype.getNodeIdToBeSelected=function(){var state;return state=this.getStateFromStorage(),state&&state.selected_node?state.selected_node[0]:null},SaveStateHandler}(),module.exports=SaveStateHandler},{"./util":12}],8:[function(require,module,exports){var $,ScrollHandler;$=jQuery,ScrollHandler=function(){function ScrollHandler(tree_widget){this.tree_widget=tree_widget,this.previous_top=-1,this.is_initialized=!1,this._initScrollParent()}return ScrollHandler.prototype._initScrollParent=function(){var $scroll_parent,getParentWithOverflow,setDocumentAsScrollParent;return getParentWithOverflow=function(_this){return function(){var css_values,el,hasOverFlow,i,len,ref;if(css_values=["overflow","overflow-y"],(hasOverFlow=function(el){var css_value,i,len,ref;for(i=0,len=css_values.length;i<len;i++)if(css_value=css_values[i],"auto"===(ref=$.css(el,css_value))||"scroll"===ref)return!0;return!1})(_this.tree_widget.$el[0]))return _this.tree_widget.$el;for(ref=_this.tree_widget.$el.parents(),i=0,len=ref.length;i<len;i++)if(el=ref[i],hasOverFlow(el))return $(el);return null}}(this),setDocumentAsScrollParent=function(_this){return function(){return _this.scroll_parent_top=0,_this.$scroll_parent=null}}(this),"fixed"===this.tree_widget.$el.css("position")&&setDocumentAsScrollParent(),$scroll_parent=getParentWithOverflow(),$scroll_parent&&$scroll_parent.length&&"HTML"!==$scroll_parent[0].tagName?(this.$scroll_parent=$scroll_parent,this.scroll_parent_top=this.$scroll_parent.offset().top):setDocumentAsScrollParent(),this.is_initialized=!0},ScrollHandler.prototype._ensureInit=function(){if(!this.is_initialized)return this._initScrollParent()},ScrollHandler.prototype.checkScrolling=function(){var hovered_area;if(this._ensureInit(),hovered_area=this.tree_widget.dnd_handler.hovered_area,hovered_area&&hovered_area.top!==this.previous_top)return this.previous_top=hovered_area.top,this.$scroll_parent?this._handleScrollingWithScrollParent(hovered_area):this._handleScrollingWithDocument(hovered_area)},ScrollHandler.prototype._handleScrollingWithScrollParent=function(area){var distance_bottom;return distance_bottom=this.scroll_parent_top+this.$scroll_parent[0].offsetHeight-area.bottom,distance_bottom<20?(this.$scroll_parent[0].scrollTop+=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1):area.top-this.scroll_parent_top<20?(this.$scroll_parent[0].scrollTop-=20,this.tree_widget.refreshHitAreas(),this.previous_top=-1):void 0},ScrollHandler.prototype._handleScrollingWithDocument=function(area){var distance_top;return distance_top=area.top-$(document).scrollTop(),distance_top<20?$(document).scrollTop($(document).scrollTop()-20):$(window).height()-(area.bottom-$(document).scrollTop())<20?$(document).scrollTop($(document).scrollTop()+20):void 0},ScrollHandler.prototype.scrollTo=function(top){var tree_top;return this._ensureInit(),this.$scroll_parent?this.$scroll_parent[0].scrollTop=top:(tree_top=this.tree_widget.$el.offset().top,$(document).scrollTop(top+tree_top))},ScrollHandler.prototype.isScrolledIntoView=function(element){var $element,element_bottom,element_top,view_bottom,view_top;return this._ensureInit(),$element=$(element),this.$scroll_parent?(view_top=0,view_bottom=this.$scroll_parent.height(),element_top=$element.offset().top-this.scroll_parent_top,element_bottom=element_top+$element.height()):(view_top=$(window).scrollTop(),view_bottom=view_top+$(window).height(),element_top=$element.offset().top,element_bottom=element_top+$element.height()),element_bottom<=view_bottom&&element_top>=view_top},ScrollHandler}(),module.exports=ScrollHandler},{}],9:[function(require,module,exports){var $,SelectNodeHandler;$=jQuery,SelectNodeHandler=function(){function SelectNodeHandler(tree_widget){this.tree_widget=tree_widget,this.clear()}return SelectNodeHandler.prototype.getSelectedNode=function(){var selected_nodes;return selected_nodes=this.getSelectedNodes(),!!selected_nodes.length&&selected_nodes[0]},SelectNodeHandler.prototype.getSelectedNodes=function(){var id,node,selected_nodes;if(this.selected_single_node)return[this.selected_single_node];selected_nodes=[];for(id in this.selected_nodes)node=this.tree_widget.getNodeById(id),node&&selected_nodes.push(node);return selected_nodes},SelectNodeHandler.prototype.getSelectedNodesUnder=function(parent){var id,node,selected_nodes;if(this.selected_single_node)return parent.isParentOf(this.selected_single_node)?[this.selected_single_node]:[];selected_nodes=[];for(id in this.selected_nodes)node=this.tree_widget.getNodeById(id),node&&parent.isParentOf(node)&&selected_nodes.push(node);return selected_nodes},SelectNodeHandler.prototype.isNodeSelected=function(node){return node.id?this.selected_nodes[node.id]:!!this.selected_single_node&&this.selected_single_node.element===node.element},SelectNodeHandler.prototype.clear=function(){return this.selected_nodes={},this.selected_single_node=null},SelectNodeHandler.prototype.removeFromSelection=function(node,include_children){if(null==include_children&&(include_children=!1),node.id){if(delete this.selected_nodes[node.id],include_children)return node.iterate(function(_this){return function(n){return delete _this.selected_nodes[node.id],!0}}(this))}else if(this.selected_single_node&&node.element===this.selected_single_node.element)return this.selected_single_node=null},SelectNodeHandler.prototype.addToSelection=function(node){return node.id?this.selected_nodes[node.id]=!0:this.selected_single_node=node},SelectNodeHandler}(),module.exports=SelectNodeHandler},{}],10:[function(require,module,exports){var $,SimpleWidget,slice=[].slice;$=jQuery,SimpleWidget=function(){function SimpleWidget(el,options){this.$el=$(el),this.options=$.extend({},this.defaults,options)}return SimpleWidget.prototype.defaults={},SimpleWidget.prototype.destroy=function(){return this._deinit()},SimpleWidget.prototype._init=function(){return null},SimpleWidget.prototype._deinit=function(){return null},SimpleWidget.register=function(widget_class,widget_name){var callFunction,createWidget,destroyWidget,getDataKey,getWidgetData;return getDataKey=function(){return"simple_widget_"+widget_name},getWidgetData=function(el,data_key){var widget;return widget=$.data(el,data_key),widget&&widget instanceof SimpleWidget?widget:null},createWidget=function($el,options){var data_key,el,existing_widget,i,len,widget;for(data_key=getDataKey(),i=0,len=$el.length;i<len;i++)el=$el[i],existing_widget=getWidgetData(el,data_key),existing_widget||(widget=new widget_class(el,options),$.data(el,data_key)||$.data(el,data_key,widget),widget._init());return $el},destroyWidget=function($el){var data_key,el,i,len,results,widget;for(data_key=getDataKey(),results=[],i=0,len=$el.length;i<len;i++)el=$el[i],widget=getWidgetData(el,data_key),widget&&widget.destroy(),results.push($.removeData(el,data_key));return results},callFunction=function($el,function_name,args){var el,i,len,result,widget,widget_function;for(result=null,i=0,len=$el.length;i<len;i++)el=$el[i],widget=$.data(el,getDataKey()),widget&&widget instanceof SimpleWidget&&(widget_function=widget[function_name],widget_function&&"function"==typeof widget_function&&(result=widget_function.apply(widget,args)));return result},$.fn[widget_name]=function(){var $el,args,argument1,function_name,options;return argument1=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],$el=this,void 0===argument1||"object"==typeof argument1?(options=argument1,createWidget($el,options)):"string"==typeof argument1&&"_"!==argument1[0]?(function_name=argument1,"destroy"===function_name?destroyWidget($el):"get_widget_class"===function_name?widget_class:callFunction($el,function_name,args)):void 0}},SimpleWidget}(),module.exports=SimpleWidget},{}],11:[function(require,module,exports){var $,BorderDropHint,DragAndDropHandler,DragElement,ElementsRenderer,FolderElement,GhostDropHint,HitAreasGenerator,JqTreeWidget,KeyHandler,MouseWidget,Node,NodeElement,Position,SaveStateHandler,ScrollHandler,SelectNodeHandler,SimpleWidget,__version__,node_module,ref,ref1,util_module,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;__version__=require("./version"),ref=require("./drag_and_drop_handler"),DragAndDropHandler=ref.DragAndDropHandler,DragElement=ref.DragElement,HitAreasGenerator=ref.HitAreasGenerator,ElementsRenderer=require("./elements_renderer"),KeyHandler=require("./key_handler"),MouseWidget=require("./mouse.widget"),SaveStateHandler=require("./save_state_handler"),ScrollHandler=require("./scroll_handler"),SelectNodeHandler=require("./select_node_handler"),SimpleWidget=require("./simple.widget"),node_module=require("./node"),Node=node_module.Node,Position=node_module.Position,util_module=require("./util"),ref1=require("./node_element"),BorderDropHint=ref1.BorderDropHint,FolderElement=ref1.FolderElement,GhostDropHint=ref1.GhostDropHint,NodeElement=ref1.NodeElement,$=jQuery,JqTreeWidget=function(superClass){function JqTreeWidget(){return JqTreeWidget.__super__.constructor.apply(this,arguments)}return extend(JqTreeWidget,superClass),JqTreeWidget.prototype.BorderDropHint=BorderDropHint,JqTreeWidget.prototype.DragElement=DragElement,JqTreeWidget.prototype.DragAndDropHandler=DragAndDropHandler,JqTreeWidget.prototype.ElementsRenderer=ElementsRenderer,JqTreeWidget.prototype.GhostDropHint=GhostDropHint,JqTreeWidget.prototype.HitAreasGenerator=HitAreasGenerator,JqTreeWidget.prototype.Node=Node,JqTreeWidget.prototype.SaveStateHandler=SaveStateHandler,JqTreeWidget.prototype.ScrollHandler=ScrollHandler,JqTreeWidget.prototype.SelectNodeHandler=SelectNodeHandler,JqTreeWidget.prototype.defaults={autoOpen:!1,saveState:!1,dragAndDrop:!1,selectable:!0,useContextMenu:!0,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,onLoadFailed:null,autoEscape:!0,dataUrl:null,closedIcon:null,openedIcon:"&#x25bc;",slide:!0,nodeClass:Node,dataFilter:null,keyboardSupport:!0,openFolderDelay:500,rtl:null,onDragMove:null,onDragStop:null,buttonLeft:!0,onLoading:null},JqTreeWidget.prototype.toggle=function(node,slide){return null==slide&&(slide=null),null===slide&&(slide=this.options.slide),node.is_open?this.closeNode(node,slide):this.openNode(node,slide),this.element},JqTreeWidget.prototype.getTree=function(){return this.tree},JqTreeWidget.prototype.selectNode=function(node){return this._selectNode(node,!1),this.element},JqTreeWidget.prototype._selectNode=function(node,must_toggle){var canSelect,deselected_node,openParents,saveState;if(null==must_toggle&&(must_toggle=!1),this.select_node_handler){if(canSelect=function(_this){return function(){return _this.options.onCanSelectNode?_this.options.selectable&&_this.options.onCanSelectNode(node):_this.options.selectable}}(this),openParents=function(_this){return function(){var parent;if(parent=node.parent,parent&&parent.parent&&!parent.is_open)return _this.openNode(parent,!1)}}(this),saveState=function(_this){return function(){if(_this.options.saveState)return _this.save_state_handler.saveState()}}(this),!node)return this._deselectCurrentNode(),void saveState();if(canSelect())return this.select_node_handler.isNodeSelected(node)?must_toggle&&(this._deselectCurrentNode(),this._triggerEvent("tree.select",{node:null,previous_node:node})):(deselected_node=this.getSelectedNode(),this._deselectCurrentNode(),this.addToSelection(node),this._triggerEvent("tree.select",{node:node,deselected_node:deselected_node}),openParents()),saveState()}},JqTreeWidget.prototype.getSelectedNode=function(){return this.select_node_handler?this.select_node_handler.getSelectedNode():null},JqTreeWidget.prototype.toJson=function(){return JSON.stringify(this.tree.getData())},JqTreeWidget.prototype.loadData=function(data,parent_node){return this._loadData(data,parent_node),this.element},JqTreeWidget.prototype.loadDataFromUrl=function(param1,param2,param3){return"string"===$.type(param1)?this._loadDataFromUrl(param1,param2,param3):this._loadDataFromUrl(null,param1,param2),this.element},JqTreeWidget.prototype.reload=function(on_finished){return this._loadDataFromUrl(null,null,on_finished),this.element},JqTreeWidget.prototype._loadDataFromUrl=function(url_info,parent_node,on_finished){var $el,addLoadingClass,handeLoadData,handleError,handleSuccess,loadDataFromUrlInfo,parseUrlInfo,removeLoadingClass;$el=null,addLoadingClass=function(_this){return function(){return $el=parent_node?$(parent_node.element):_this.element,$el.addClass("jqtree-loading"),_this._notifyLoading(!0,parent_node,$el)}}(this),removeLoadingClass=function(_this){return function(){if($el)return $el.removeClass("jqtree-loading"),_this._notifyLoading(!1,parent_node,$el)}}(this),parseUrlInfo=function(){return"string"===$.type(url_info)?{url:url_info}:(url_info.method||(url_info.method="get"),url_info)},handeLoadData=function(_this){return function(data){if(removeLoadingClass(),_this._loadData(data,parent_node),on_finished&&$.isFunction(on_finished))return on_finished()}}(this),handleSuccess=function(_this){return function(response){var data;return data=$.isArray(response)||"object"==typeof response?response:null!=data?$.parseJSON(response):[],_this.options.dataFilter&&(data=_this.options.dataFilter(data)),handeLoadData(data)}}(this),handleError=function(_this){return function(response){if(removeLoadingClass(),_this.options.onLoadFailed)return _this.options.onLoadFailed(response)}}(this),loadDataFromUrlInfo=function(){return url_info=parseUrlInfo(),$.ajax($.extend({},url_info,{method:null!=url_info.method?url_info.method.toUpperCase():"GET",cache:!1,dataType:"json",success:handleSuccess,error:handleError}))},url_info||(url_info=this._getDataUrlInfo(parent_node)),addLoadingClass(),url_info?$.isArray(url_info)?handeLoadData(url_info):loadDataFromUrlInfo():removeLoadingClass()},JqTreeWidget.prototype._loadData=function(data,parent_node){var deselectNodes,loadSubtree;if(null==parent_node&&(parent_node=null),deselectNodes=function(_this){return function(){var i,len,n,selected_nodes_under_parent;if(_this.select_node_handler)for(selected_nodes_under_parent=_this.select_node_handler.getSelectedNodesUnder(parent_node),i=0,len=selected_nodes_under_parent.length;i<len;i++)n=selected_nodes_under_parent[i],_this.select_node_handler.removeFromSelection(n);return null}}(this),loadSubtree=function(_this){return function(){return parent_node.loadFromData(data),parent_node.load_on_demand=!1,parent_node.is_loading=!1,_this._refreshElements(parent_node)}}(this),data)return this._triggerEvent("tree.load_data",{tree_data:data}),parent_node?(deselectNodes(),loadSubtree()):this._initTree(data),this.isDragging()?this.dnd_handler.refresh():void 0},JqTreeWidget.prototype.getNodeById=function(node_id){return this.tree.getNodeById(node_id)},JqTreeWidget.prototype.getNodeByName=function(name){return this.tree.getNodeByName(name)},JqTreeWidget.prototype.getNodesByProperty=function(key,value){return this.tree.getNodesByProperty(key,value)},JqTreeWidget.prototype.openNode=function(node,slide){return null==slide&&(slide=null),null===slide&&(slide=this.options.slide),this._openNode(node,slide),this.element},JqTreeWidget.prototype._openNode=function(node,slide,on_finished){var doOpenNode,parent;if(null==slide&&(slide=!0),doOpenNode=function(_this){return function(_node,_slide,_on_finished){var folder_element;return folder_element=new FolderElement(_node,_this),folder_element.open(_on_finished,_slide)}}(this),node.isFolder()){if(node.load_on_demand)return this._loadFolderOnDemand(node,slide,on_finished);for(parent=node.parent;parent;)parent.parent&&doOpenNode(parent,!1,null),parent=parent.parent;return doOpenNode(node,slide,on_finished),this._saveState()}},JqTreeWidget.prototype._loadFolderOnDemand=function(node,slide,on_finished){return null==slide&&(slide=!0),node.is_loading=!0,this._loadDataFromUrl(null,node,function(_this){return function(){return _this._openNode(node,slide,on_finished)}}(this))},JqTreeWidget.prototype.closeNode=function(node,slide){return null==slide&&(slide=null),null===slide&&(slide=this.options.slide),node.isFolder()&&(new FolderElement(node,this).close(slide),this._saveState()),this.element},JqTreeWidget.prototype.isDragging=function(){return!!this.dnd_handler&&this.dnd_handler.is_dragging},JqTreeWidget.prototype.refreshHitAreas=function(){return this.dnd_handler.refresh(),this.element},JqTreeWidget.prototype.addNodeAfter=function(new_node_info,existing_node){var new_node;return new_node=existing_node.addAfter(new_node_info),this._refreshElements(existing_node.parent),new_node},JqTreeWidget.prototype.addNodeBefore=function(new_node_info,existing_node){var new_node;return new_node=existing_node.addBefore(new_node_info),this._refreshElements(existing_node.parent),new_node},JqTreeWidget.prototype.addParentNode=function(new_node_info,existing_node){var new_node;return new_node=existing_node.addParent(new_node_info),this._refreshElements(new_node.parent),new_node},JqTreeWidget.prototype.removeNode=function(node){var parent;return parent=node.parent,parent&&(this.select_node_handler.removeFromSelection(node,!0),node.remove(),this._refreshElements(parent)),this.element},JqTreeWidget.prototype.appendNode=function(new_node_info,parent_node){var node;return parent_node=parent_node||this.tree,node=parent_node.append(new_node_info),this._refreshElements(parent_node),node},JqTreeWidget.prototype.prependNode=function(new_node_info,parent_node){var node;return parent_node||(parent_node=this.tree),node=parent_node.prepend(new_node_info),this._refreshElements(parent_node),node},JqTreeWidget.prototype.updateNode=function(node,data){var id_is_changed;return id_is_changed=data.id&&data.id!==node.id,id_is_changed&&this.tree.removeNodeFromIndex(node),node.setData(data),id_is_changed&&this.tree.addNodeToIndex(node),"object"==typeof data&&data.children&&data.children.length&&(node.removeChildren(),node.loadFromData(data.children)),this.renderer.renderFromNode(node),this._selectCurrentNode(),this.element},JqTreeWidget.prototype.moveNode=function(node,target_node,position){var position_index;return position_index=Position.nameToIndex(position),this.tree.moveNode(node,target_node,position_index),this._refreshElements(),this.element},JqTreeWidget.prototype.getStateFromStorage=function(){return this.save_state_handler.getStateFromStorage()},JqTreeWidget.prototype.addToSelection=function(node){return node&&(this.select_node_handler.addToSelection(node),this._getNodeElementForNode(node).select(),this._saveState()),this.element},JqTreeWidget.prototype.getSelectedNodes=function(){return this.select_node_handler.getSelectedNodes()},JqTreeWidget.prototype.isNodeSelected=function(node){return this.select_node_handler.isNodeSelected(node)},JqTreeWidget.prototype.removeFromSelection=function(node){return this.select_node_handler.removeFromSelection(node),this._getNodeElementForNode(node).deselect(),this._saveState(),this.element},JqTreeWidget.prototype.scrollToNode=function(node){var $element,top;return $element=$(node.element),top=$element.offset().top-this.$el.offset().top,this.scroll_handler.scrollTo(top),this.element},JqTreeWidget.prototype.getState=function(){return this.save_state_handler.getState()},JqTreeWidget.prototype.setState=function(state){return this.save_state_handler.setInitialState(state),this._refreshElements(),this.element},JqTreeWidget.prototype.setOption=function(option,value){return this.options[option]=value,this.element},JqTreeWidget.prototype.moveDown=function(){return this.key_handler&&this.key_handler.moveDown(),this.element},JqTreeWidget.prototype.moveUp=function(){return this.key_handler&&this.key_handler.moveUp(),this.element},JqTreeWidget.prototype.getVersion=function(){return __version__},JqTreeWidget.prototype._init=function(){if(JqTreeWidget.__super__._init.call(this),this.element=this.$el,this.mouse_delay=300,this.is_initialized=!1,this.options.rtl=this._getRtlOption(),this.options.closedIcon||(this.options.closedIcon=this._getDefaultClosedIcon()),this.renderer=new ElementsRenderer(this),null!=SaveStateHandler?this.save_state_handler=new SaveStateHandler(this):this.options.saveState=!1,null!=SelectNodeHandler&&(this.select_node_handler=new SelectNodeHandler(this)),null!=DragAndDropHandler?this.dnd_handler=new DragAndDropHandler(this):this.options.dragAndDrop=!1,null!=ScrollHandler&&(this.scroll_handler=new ScrollHandler(this)),null!=KeyHandler&&null!=SelectNodeHandler&&(this.key_handler=new KeyHandler(this)),this._initData(),this.element.click($.proxy(this._click,this)),this.element.dblclick($.proxy(this._dblclick,this)),this.options.useContextMenu)return this.element.bind("contextmenu",$.proxy(this._contextmenu,this))},JqTreeWidget.prototype._deinit=function(){return this.element.empty(),this.element.unbind(),this.key_handler&&this.key_handler.deinit(),this.tree=null,JqTreeWidget.__super__._deinit.call(this)},JqTreeWidget.prototype._initData=function(){return this.options.data?this._loadData(this.options.data):this._loadDataFromUrl(this._getDataUrlInfo())},JqTreeWidget.prototype._getDataUrlInfo=function(node){var data_url,getUrlFromString;return data_url=this.options.dataUrl||this.element.data("url"),getUrlFromString=function(_this){return function(){var data,selected_node_id,url_info;return url_info={url:data_url},node&&node.id?(data={node:node.id},url_info.data=data):(selected_node_id=_this._getNodeIdToBeSelected(),selected_node_id&&(data={
selected_node:selected_node_id},url_info.data=data)),url_info}}(this),$.isFunction(data_url)?data_url(node):"string"===$.type(data_url)?getUrlFromString():data_url},JqTreeWidget.prototype._getNodeIdToBeSelected=function(){return this.options.saveState?this.save_state_handler.getNodeIdToBeSelected():null},JqTreeWidget.prototype._initTree=function(data){var doInit,must_load_on_demand;return doInit=function(_this){return function(){if(!_this.is_initialized)return _this.is_initialized=!0,_this._triggerEvent("tree.init")}}(this),this.tree=new this.options.nodeClass(null,(!0),this.options.nodeClass),this.select_node_handler&&this.select_node_handler.clear(),this.tree.loadFromData(data),must_load_on_demand=this._setInitialState(),this._refreshElements(),must_load_on_demand?this._setInitialStateOnDemand(doInit):doInit()},JqTreeWidget.prototype._setInitialState=function(){var autoOpenNodes,is_restored,must_load_on_demand,ref2,restoreState;return restoreState=function(_this){return function(){var must_load_on_demand,state;return _this.options.saveState&&_this.save_state_handler?(state=_this.save_state_handler.getStateFromStorage(),state?(must_load_on_demand=_this.save_state_handler.setInitialState(state),[!0,must_load_on_demand]):[!1,!1]):[!1,!1]}}(this),autoOpenNodes=function(_this){return function(){var max_level,must_load_on_demand;return _this.options.autoOpen!==!1&&(max_level=_this._getAutoOpenMaxLevel(),must_load_on_demand=!1,_this.tree.iterate(function(node,level){return node.load_on_demand?(must_load_on_demand=!0,!1):!!node.hasChildren()&&(node.is_open=!0,level!==max_level)}),must_load_on_demand)}}(this),ref2=restoreState(),is_restored=ref2[0],must_load_on_demand=ref2[1],is_restored||(must_load_on_demand=autoOpenNodes()),must_load_on_demand},JqTreeWidget.prototype._setInitialStateOnDemand=function(cb_finished){var autoOpenNodes,restoreState;if(restoreState=function(_this){return function(){var state;return!(!_this.options.saveState||!_this.save_state_handler)&&(state=_this.save_state_handler.getStateFromStorage(),!!state&&(_this.save_state_handler.setInitialStateOnDemand(state,cb_finished),!0))}}(this),autoOpenNodes=function(_this){return function(){var loadAndOpenNode,loading_count,max_level,openNodes;return max_level=_this._getAutoOpenMaxLevel(),loading_count=0,loadAndOpenNode=function(node){return loading_count+=1,_this._openNode(node,!1,function(){return loading_count-=1,openNodes()})},(openNodes=function(){if(_this.tree.iterate(function(node,level){return node.load_on_demand?(node.is_loading||loadAndOpenNode(node),!1):(_this._openNode(node,!1),level!==max_level)}),0===loading_count)return cb_finished()})()}}(this),!restoreState())return autoOpenNodes()},JqTreeWidget.prototype._getAutoOpenMaxLevel=function(){return this.options.autoOpen===!0?-1:parseInt(this.options.autoOpen)},JqTreeWidget.prototype._refreshElements=function(from_node){return null==from_node&&(from_node=null),this.renderer.render(from_node),this._triggerEvent("tree.refresh")},JqTreeWidget.prototype._click=function(e){var click_target,event,node;if(click_target=this._getClickTarget(e.target)){if("button"===click_target.type)return this.toggle(click_target.node,this.options.slide),e.preventDefault(),e.stopPropagation();if("label"===click_target.type&&(node=click_target.node,event=this._triggerEvent("tree.click",{node:node,click_event:e}),!event.isDefaultPrevented()))return this._selectNode(node,!0)}},JqTreeWidget.prototype._dblclick=function(e){var click_target;if(click_target=this._getClickTarget(e.target),click_target&&"label"===click_target.type)return this._triggerEvent("tree.dblclick",{node:click_target.node,click_event:e})},JqTreeWidget.prototype._getClickTarget=function(element){var $button,$el,$target,node;if($target=$(element),$button=$target.closest(".jqtree-toggler"),$button.length){if(node=this._getNode($button))return{type:"button",node:node}}else if($el=$target.closest(".jqtree-element"),$el.length&&(node=this._getNode($el)))return{type:"label",node:node};return null},JqTreeWidget.prototype._getNode=function($element){var $li;return $li=$element.closest("li.jqtree_common"),0===$li.length?null:$li.data("node")},JqTreeWidget.prototype._getNodeElementForNode=function(node){return node.isFolder()?new FolderElement(node,this):new NodeElement(node,this)},JqTreeWidget.prototype._getNodeElement=function($element){var node;return node=this._getNode($element),node?this._getNodeElementForNode(node):null},JqTreeWidget.prototype._contextmenu=function(e){var $div,node;if($div=$(e.target).closest("ul.jqtree-tree .jqtree-element"),$div.length&&(node=this._getNode($div)))return e.preventDefault(),e.stopPropagation(),this._triggerEvent("tree.contextmenu",{node:node,click_event:e}),!1},JqTreeWidget.prototype._saveState=function(){if(this.options.saveState)return this.save_state_handler.saveState()},JqTreeWidget.prototype._mouseCapture=function(position_info){return!!this.options.dragAndDrop&&this.dnd_handler.mouseCapture(position_info)},JqTreeWidget.prototype._mouseStart=function(position_info){return!!this.options.dragAndDrop&&this.dnd_handler.mouseStart(position_info)},JqTreeWidget.prototype._mouseDrag=function(position_info){var result;return!!this.options.dragAndDrop&&(result=this.dnd_handler.mouseDrag(position_info),this.scroll_handler&&this.scroll_handler.checkScrolling(),result)},JqTreeWidget.prototype._mouseStop=function(position_info){return!!this.options.dragAndDrop&&this.dnd_handler.mouseStop(position_info)},JqTreeWidget.prototype._triggerEvent=function(event_name,values){var event;return event=$.Event(event_name),$.extend(event,values),this.element.trigger(event),event},JqTreeWidget.prototype.testGenerateHitAreas=function(moving_node){return this.dnd_handler.current_item=this._getNodeElementForNode(moving_node),this.dnd_handler.generateHitAreas(),this.dnd_handler.hit_areas},JqTreeWidget.prototype._selectCurrentNode=function(){var node,node_element;if(node=this.getSelectedNode(),node&&(node_element=this._getNodeElementForNode(node)))return node_element.select()},JqTreeWidget.prototype._deselectCurrentNode=function(){var node;if(node=this.getSelectedNode())return this.removeFromSelection(node)},JqTreeWidget.prototype._getDefaultClosedIcon=function(){return this.options.rtl?"&#x25c0;":"&#x25ba;"},JqTreeWidget.prototype._getRtlOption=function(){var data_rtl;return null!==this.options.rtl?this.options.rtl:(data_rtl=this.element.data("rtl"),null!=data_rtl&&data_rtl!==!1)},JqTreeWidget.prototype._notifyLoading=function(is_loading,node,$el){if(this.options.onLoading)return this.options.onLoading(is_loading,node,$el)},JqTreeWidget}(MouseWidget),JqTreeWidget.getModule=function(name){var modules;return modules={node:node_module,util:util_module},modules[name]},SimpleWidget.register(JqTreeWidget,"tree")},{"./drag_and_drop_handler":1,"./elements_renderer":2,"./key_handler":3,"./mouse.widget":4,"./node":5,"./node_element":6,"./save_state_handler":7,"./scroll_handler":8,"./select_node_handler":9,"./simple.widget":10,"./util":12,"./version":13}],12:[function(require,module,exports){var _indexOf,getBoolString,html_escape,indexOf,isInt;_indexOf=function(array,item){var i,j,len,value;for(i=j=0,len=array.length;j<len;i=++j)if(value=array[i],value===item)return i;return-1},indexOf=function(array,item){return array.indexOf?array.indexOf(item):_indexOf(array,item)},isInt=function(n){return"number"==typeof n&&n%1===0},html_escape=function(string){return(""+string).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},getBoolString=function(value){return value?"true":"false"},module.exports={_indexOf:_indexOf,getBoolString:getBoolString,html_escape:html_escape,indexOf:indexOf,isInt:isInt}},{}],13:[function(require,module,exports){module.exports="1.3.3"},{}]},{},[11])}.apply(root,arguments)})}(this),define("mockup-patterns-tree",["jquery","pat-base","mockup-utils","jqtree"],function($,Base,utils){"use strict";var Tree=Base.extend({name:"tree",trigger:".pat-tree",parser:"mockup",defaults:{dragAndDrop:!1,autoOpen:!1,selectable:!0,keyboardSupport:!0,onLoad:null},init:function(){var self=this;for(var optionKey in self.options){var def=self.defaults[optionKey];void 0!==def&&"boolean"==typeof def&&(self.options[optionKey]=utils.bool(self.options[optionKey]))}if(self.options.dragAndDrop&&void 0===self.options.onCanMoveTo&&(self.options.onCanMoveTo=function(moved,target,position){return void 0===target.folder||target.folder===!0}),self.options.data&&"string"==typeof self.options.data&&(self.options.data=$.parseJSON(self.options.data)),null!==self.options.onLoad){var options=$.extend({},self.options);$.getJSON(options.dataUrl,function(data){options.data=data,delete options.dataUrl,self.tree=self.$el.tree(options),self.options.onLoad(self)})}else self.tree=self.$el.tree(self.options)}});return Tree}),define("mockup-patterns-relateditems",["jquery","underscore","pat-base","mockup-patterns-select2","mockup-utils","mockup-patterns-tree","translate"],function($,_,Base,Select2,utils,Tree,_t){"use strict";var RelatedItems=Base.extend({name:"relateditems",trigger:".pat-relateditems",parser:"mockup",browsing:!1,currentPath:null,defaults:{vocabularyUrl:null,width:"100%",multiple:!0,tokenSeparators:[","," "],separator:",",orderable:!0,cache:!0,mode:"search",closeOnSelect:!1,basePath:"/",rootPath:"/",homeText:_t("home"),selectableTypes:null,attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],dropdownCssClass:"pattern-relateditems-dropdown",maximumSelectionSize:-1,treeVocabularyUrl:null,resultTemplate:'<div class="   pattern-relateditems-result  <% if (selected) { %>pattern-relateditems-active<% } %>">  <a href="#" class=" pattern-relateditems-result-select <% if (selectable) { %>selectable<% } %>">    <% if (typeof getIcon !== "undefined" && getIcon) { %><img src="<%- getURL %>/@@images/image/icon "> <% } %>    <span class="pattern-relateditems-result-title  <% if (typeof review_state !== "undefined") { %> state-<%- review_state %> <% } %>  " /span>    <span class="pattern-relateditems contenttype-<%- portal_type.toLowerCase() %>"><%- Title %></span>    <span class="pattern-relateditems-result-path"><%- path %></span>  </a>  <span class="pattern-relateditems-buttons">  <% if (is_folderish) { %>     <a class="pattern-relateditems-result-browse" href="#" data-path="<%- path %>"></a>   <% } %> </span></div>',resultTemplateSelector:null,selectionTemplate:'<span class="pattern-relateditems-item"> <% if (typeof getIcon !== "undefined" && getIcon) { %> <img src="<%- getURL %>/@@images/image/icon"> <% } %> <span class="pattern-relateditems-item-title contenttype-<%- portal_type.toLowerCase() %> <% if (typeof review_state !== "undefined") { %> state-<%- review_state  %> <% } %>" ><%- Title %></span> <span class="pattern-relateditems-item-path"><%- path %></span></span>',selectionTemplateSelector:null,breadCrumbsTemplate:'<span><span class="pattern-relateditems-tree"><a href="#" class="pattern-relateditems-tree-select"><span class="glyphicon glyphicon-indent-left"></span></a> <div class="tree-container"><div class="title-container"><a href="#" class="btn close pattern-relateditems-tree-cancel"><span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span></a><span class="select-folder-label">Select folder</span></div><div class="pat-tree" /></div></span><span class="pattern-relateditems-path-label"><%- searchText %></span><a class="crumb" href="<%- rootPath %>"><span class="glyphicon glyphicon-home"></span></a><%= items %></span></span>',breadCrumbsTemplateSelector:null,breadCrumbTemplate:'/<a href="<%- path %>" class="crumb"><%- text %></a>',breadCrumbTemplateSelector:null,escapeMarkup:function(text){return text},setupAjax:function(){var self=this;return self.query.valid?self.query.selectAjax():{}}},applyTemplate:function(tpl,item){var template,self=this;self.options[tpl+"TemplateSelector"]?(template=$(self.options[tpl+"TemplateSelector"]).html(),template||(template=self.options[tpl+"Template"])):template=self.options[tpl+"Template"];var options=$.extend(!0,{},self.options,item);return options._item=item,_.template(template)(options)},activateBrowsing:function(){var self=this;self.browsing=!0,self.setBreadCrumbs()},deactivateBrowsing:function(){var self=this;self.browsing=!1,self.setBreadCrumbs()},browseTo:function(path){var self=this;self.emit("before-browse"),self.currentPath=path,"/"===path&&"search"===self.options.mode?self.deactivateBrowsing():self.activateBrowsing(),self.$el.select2("close"),self.$el.select2("open"),self.emit("after-browse")},setBreadCrumbs:function(){var html,self=this,path=self.currentPath?self.currentPath:self.options.basePath,root=self.options.rootPath.replace(/\/$/,"");if(path=0===path.indexOf(root)?path.slice(root.length):path,"/"===path){var searchText="";"search"===self.options.mode&&(searchText="<em>"+_t("entire site")+"</em>"),html=self.applyTemplate("breadCrumbs",{items:searchText,searchText:_t("Search:"),rootPath:self.options.rootPath})}else{var paths=path.split("/"),itemPath=root,itemsHtml="";_.each(paths,function(node){if(""!==node){var item={};itemPath=itemPath+"/"+node,item.text=node,item.path=itemPath,itemsHtml+=self.applyTemplate("breadCrumb",item)}}),html=self.applyTemplate("breadCrumbs",{items:itemsHtml,searchText:_t("Search:"),rootPath:self.options.rootPath})}var $crumbs=$(html);$("a.crumb",$crumbs).on("click",function(e){return e.preventDefault(),self.browseTo($(this).attr("href")),!1});var $treeSelect=$(".pattern-relateditems-tree-select",$crumbs),$container=$treeSelect.parent(),$treeContainer=$(".tree-container",$container),$tree=$(".pat-tree",$container),selectedNode=null,treePattern=new Tree($tree,{data:[],dataFilter:function(data){var nodes=[];return _.each(data.results,function(item){var node={label:item.Title,id:item.UID,path:item.path,folder:item.is_folderish};nodes.push(node)}),nodes},onCreateLi:function(node,$li){node._loaded&&0===node.children.length&&$li.find(".jqtree-title").append('<span class="tree-node-empty">'+_t("(empty)")+"</span>"),$li.append('<span class="pattern-relateditems-buttons"><a class="pattern-relateditems-result-browse" href="#"></a></span>'),$li.find(".pattern-relateditems-result-browse").click(function(e){e.preventDefault(),self.currentPath=node.path,self.browseTo(self.currentPath),$treeContainer.fadeOut()})}});treePattern.$el.bind("tree.select",function(e){var node=e.node;node&&!node._loaded&&(self.currentPath=node.path,selectedNode=node,treePattern.$el.tree("loadDataFromUrl",self.treeQuery.getUrl(),node,function(){treePattern.$el.tree("openNode",node)}),node._loaded=!0)}),treePattern.$el.bind("tree.dblclick",function(e){e.node&&(self.currentPath=e.node.path,self.browseTo(self.currentPath),$treeContainer.fadeOut())}),treePattern.$el.bind("tree.refresh",function(){selectedNode&&treePattern.$el.tree("selectNode",selectedNode)}),$("a.pattern-relateditems-tree-cancel",$treeContainer).click(function(e){return e.preventDefault(),$treeContainer.fadeOut(),!1}),$treeSelect.on("click",function(e){return e.preventDefault(),self.browsing=!0,self.currentPath="/",self.$el.select2("close"),$treeContainer.fadeIn(),treePattern.$el.tree("loadDataFromUrl",self.treeQuery.getUrl()),!1}),self.$el.on("select2-opening",function(){$treeContainer.fadeOut()}),self.$browsePath.html($crumbs)},selectItem:function(item){var self=this;self.emit("selecting");var data=self.$el.select2("data");data.push(item),self.$el.select2("data",data,!0),item.selected=!0,self.emit("selected")},deselectItem:function(item){var self=this;self.emit("deselecting");var data=self.$el.select2("data");_.each(data,function(obj,i){obj.UID===item.UID&&data.splice(i,1)}),self.$el.select2("data",data,!0),item.selected=!1,self.emit("deselected")},isSelectable:function(item){var self=this;return null===self.options.selectableTypes||_.indexOf(self.options.selectableTypes,item.portal_type)>-1},init:function(){var self=this;self.query=new utils.QueryHelper($.extend(!0,{},self.options,{pattern:self})),self.treeQuery=new utils.QueryHelper($.extend(!0,{},self.options,{pattern:self,vocabularyUrl:self.options.treeVocabularyUrl||self.options.vocabularyUrl,baseCriteria:[{i:"is_folderish",o:"plone.app.querystring.operation.selection.any",v:"True"}]})),self.options.ajax=self.options.setupAjax.apply(self),self.$el.wrap('<div class="pattern-relateditems-container" />'),self.$container=self.$el.parents(".pattern-relateditems-container"),self.$container.width(self.options.width),Select2.prototype.initializeValues.call(self),Select2.prototype.initializeTags.call(self),self.options.formatSelection=function(item,$container){return self.applyTemplate("selection",item)},Select2.prototype.initializeOrdering.call(self),self.options.formatResult=function(item){if(item.is_folderish?item.folderish=!0:item.folderish=!1,item.selectable=self.isSelectable(item),void 0===item.selected){var data=self.$el.select2("data");item.selected=!1,_.each(data,function(obj){obj.UID===item.UID&&(item.selected=!0)})}var result=$(self.applyTemplate("result",item));return $(".pattern-relateditems-result-select",result).on("click",function(event){if(event.preventDefault(),$(this).is(".selectable")){var $parent=$(this).parents(".pattern-relateditems-result");if($parent.is(".pattern-relateditems-active"))$parent.removeClass("pattern-relateditems-active"),self.deselectItem(item);else if(self.selectItem(item),$parent.addClass("pattern-relateditems-active"),self.options.maximumSelectionSize>0){var items=self.$select2.select2("data");items.length>=self.options.maximumSelectionSize&&self.$select2.select2("close")}}}),$(".pattern-relateditems-result-browse",result).on("click",function(event){event.preventDefault(),event.stopPropagation();var path=$(this).data("path");self.browseTo(path)}),$(result)},self.options.initSelection=function(element,callback){var value=$(element).val();if(""!==value){var ids=value.split(self.options.separator);self.query.search("UID","plone.app.querystring.operation.list.contains",ids,function(data){var results=data.results.reduce(function(prev,item){return prev[item.UID]=item,prev},{});callback(ids.map(function(uid){return results[uid]}).filter(function(item){return void 0!==item}))},!1)}},self.options.id=function(item){return item.UID},Select2.prototype.initializeSelect2.call(self),self.$browsePath=$('<span class="pattern-relateditems-path" />'),self.$container.prepend(self.$browsePath),"search"===self.options.mode?(self.deactivateBrowsing(),self.browsing=!1):(self.activateBrowsing(),self.browsing=!0),self.$el.on("select2-selecting",function(event){event.preventDefault()})}});return RelatedItems}),define("mockup-patterns-querystring",["jquery","pat-base","mockup-patterns-select2","mockup-patterns-pickadate","mockup-patterns-relateditems","select2","translate","underscore"],function($,Base,Select2,PickADate,relatedItems,undefined,_t,_){"use strict";var Criteria=function(){this.init.apply(this,arguments)};Criteria.prototype={defaults:{indexWidth:"20em",remove:"",classBetweenDtName:"querystring-criteria-betweendt",classWrapperName:"querystring-criteria-wrapper",classIndexName:"querystring-criteria-index",classOperatorName:"querystring-criteria-operator",classValueName:"querystring-criteria-value",classRemoveName:"querystring-criteria-remove",classResultsName:"querystring-criteria-results",classClearName:"querystring-criteria-clear",classDepthName:"querystring-criteria-depth"},init:function($el,options,indexes,index,operator,value,baseUrl){var self=this;self.options=$.extend(!0,{},self.defaults,options),self.indexes=indexes,self.indexGroups={},self.baseUrl=baseUrl,self.advanced=!1,self.initial=value,self.$wrapper=$("<div/>").addClass(self.options.classWrapperName).appendTo($el),self.$remove=$("<div>"+self.options.remove+"</div>").addClass(self.options.classRemoveName).appendTo(self.$wrapper).on("click",function(e){self.remove()}),self.$index=$("<select><option></option></select>").attr("placeholder",_t("Select criteria")),$.each(self.indexes,function(value,options){options.enabled&&(self.indexGroups[options.group]||(self.indexGroups[options.group]=$("<optgroup/>").attr("label",options.group).appendTo(self.$index)),self.indexGroups[options.group].append($("<option/>").attr("value",value).html(options.title)))}),self.$wrapper.append($("<div/>").addClass(self.options.classIndexName).append(self.$index)),self.$index.patternSelect2({width:self.options.indexWidth,placeholder:_t("Select criteria")}).on("change",function(e){self.removeValue(),self.createOperator(e.val),self.createClear(),self.trigger("index-changed")}),"undefined"!=typeof index&&(self.$index.select2("val",index),self.createOperator(index,operator,value),self.createClear()),self.trigger("create-criteria")},appendOperators:function(index){var self=this;self.$operator=$("<select/>"),self.indexes[index]&&_.each(self.indexes[index].operations,function(value){var options=self.indexes[index].operators[value];$("<option/>").attr("value",value).html(options.title).appendTo(self.$operator)}),self.$wrapper.append($("<div/>").addClass(self.options.classOperatorName).append(self.$operator)),self.$operator.patternSelect2({width:"10em"}).on("change",function(e){self.createValue(index),self.createClear(),self.trigger("operator-changed")})},convertPathOperators:function(oval){var self=this;return self.advanced?oval:oval=oval.replace("advanced","relativePath").replace("path","relativePath")},createPathOperators:function(){var self=this;if(self.advanced)return void self.resetPathOperators();var newOperator="plone.app.querystring.operation.string.advanced";self.indexes.path.operators[newOperator]===undefined&&(self.indexes.path.operations.push(newOperator),self.indexes.path.operators[newOperator]={title:"Advanced",widget:"AdvancedPathWidget",description:"Enter a custom path string",operation:"plone.app.querystring.queryparser._relativePath"}),$.each(self.indexes.path.operators,function(key,value){var options=value;key.indexOf("absolute")>0?options.title="Custom":key.indexOf("relative")>0?options.title="Parent (../)":key.indexOf("advanced")>0?options.title="Advanced Mode":(options.title="Current (./)",options.widget="RelativePathWidget")})},resetPathOperators:function(){var self=this;$.each(self.indexes.path.operators,function(key,value){var options=value;key.indexOf("absolute")>0?options.title="Absolute Path":key.indexOf("relative")>0?options.title="Relative Path":key.indexOf("advanced")>0?options.title="Simple Mode":(options.title="Navigation Path",options.widget="ReferenceWidget")})},createOperator:function(index,operator,value){var self=this;self.removeOperator(),self.createPathOperators(),"path"===index&&value&&".::1"!==value&&"..::1"!==value&&!value.match(/^[0-9a-f]{32}::-?[0-9]+$/)&&(self.advanced=!0,self.resetPathOperators()),self.appendOperators(index),operator===undefined&&(operator=self.$operator.select2("val")),self.$operator.select2("val",operator),self.createValue(index,value),self.trigger("create-operator")},createValue:function(index,value){var self=this,widget=self.indexes[index].operators[self.$operator.val()].widget,$wrapper=$("<div/>").addClass(self.options.classValueName).appendTo(self.$wrapper);self.removeValue();var createDepthSelect=function(selected){for(var select="<div class='depth-select-box'><label for='depth-select'>Depth</label><select name='depth-select' class='"+self.options.classDepthName+"'><option value='-1' selected='selected'>Unlimited</option>",i=0;i<=10;i+=1)select+="<option value="+i+" ",""+i===selected&&(select+="selected='selected' "),select+=">"+i+"</option>";return select+="</select></div>",$(select).change(function(){self.trigger("depth-changed")})};if("StringWidget"===widget)self.$value=$('<input type="text"/>').addClass(self.options.classValueName+"-"+widget).val(value).appendTo($wrapper).change(function(){self.trigger("value-changed")});else if("DateWidget"===widget)self.$value=$('<input type="text"/>').addClass(self.options.classValueName+"-"+widget).attr("data-pat-pickadate",'{"time": false, "date": {"format": "dd/mm/yyyy" }}').val(value).appendTo($wrapper).patternPickadate().on("updated.pickadate.patterns",function(){self.trigger("value-changed")});else if("DateRangeWidget"===widget){var startwrap=$("<span/>").appendTo($wrapper),val1="",val2="";value&&(val1=value[0]?value[0]:"",val2=value[1]?value[1]:"");var startdt=$('<input type="text"/>').addClass(self.options.classValueName+"-"+widget).addClass(self.options.classValueName+"-"+widget+"-start").attr("data-pat-pickadate",'{"time": false, "date": {"format": "dd/mm/yyyy" }}').val(val1).appendTo(startwrap).patternPickadate().on("updated.pickadate.patterns",function(){self.trigger("value-changed")});$wrapper.append($("<span/>").html(_t("to")).addClass(self.options.classBetweenDtName));var endwrap=$("<span/>").appendTo($wrapper),enddt=$('<input type="text"/>').addClass(self.options.classValueName+"-"+widget).addClass(self.options.classValueName+"-"+widget+"-end").attr("data-pat-pickadate",'{"time": false, "date": {"format": "dd/mm/yyyy" }}').val(val2).appendTo(endwrap).patternPickadate().on("updated.pickadate.patterns",function(){self.trigger("value-changed")});self.$value=[startdt,enddt]}else if("RelativeDateWidget"===widget)self.$value=$('<input type="text"/>').after($("<span/>").html(_t("days"))).addClass(self.options.classValueName+"-"+widget).appendTo($wrapper).change(function(){self.trigger("value-changed")});else if("AdvancedPathWidget"===widget)self.advanced?self.advanced=!1:self.advanced=!0,self.createPathOperators(),self.removeOperator(),self.appendOperators(index),self.createValue(index);else if("RelativePathWidget"===widget)self.advanced?self.$value=$('<input type="text"/>').addClass(self.options.classValueName+"-"+widget).appendTo($wrapper).val(value).change(function(){self.trigger("value-changed")}):(value?".::1"===value&&self.$operator.select2("val","plone.app.querystring.operation.string.path"):(value=".::1",self.$operator.val().indexOf("relativePath")>0&&(value="..::1")),self.$value=$('<input type="hidden"/>').addClass(self.options.classValueName+"-"+widget).appendTo($wrapper).val(value));else if("ReferenceWidget"===widget)if(self.advanced)self.$value=$('<input type="text"/>').addClass(self.options.classValueName+"-"+widget).val(value).appendTo($wrapper).change(function(){self.trigger("value-changed")});else{var pathAndDepth=["",-1];value!==undefined&&(pathAndDepth=value.split("::")),self.$value=$('<input type="text"/>').addClass(self.options.classValueName+"-"+widget).appendTo($wrapper).val(pathAndDepth[0]).patternRelateditems({vocabularyUrl:self.baseUrl+"@@getVocabulary?name=plone.app.vocabularies.Catalog&field=relatedItems",folderTypes:["Folder"],maximumSelectionSize:1,width:"400px"}).change(function(){self.trigger("value-changed")}),self.$value.parent().after(createDepthSelect(pathAndDepth[1])),self.$value.parents("."+self.options.classValueName).addClass("break-line")}else"MultipleSelectionWidget"===widget&&(self.$value=$("<select/>").prop("multiple",!0).addClass(self.options.classValueName+"-"+widget).appendTo($wrapper).change(function(){self.trigger("value-changed")}),self.indexes[index]&&$.each(self.indexes[index].values,function(value,options){$("<option/>").attr("value",value).html(options.title).appendTo(self.$value)}),self.$value.patternSelect2({width:"250px"}));if(value!==undefined&&"undefined"!=typeof self.$value)if($.isArray(self.$value))$.each(value,function(i,v){self.$value[i].select2("val",v)});else{var trimmedValue=value;"string"==typeof value&&"RelativePathWidget"!==widget&&(trimmedValue=value.replace(/::-?[0-9]+/,"")),self.$value.select2("val",trimmedValue)}self.trigger("create-value")},createClear:function(){var self=this;self.removeClear(),self.$clear=$("<div/>").addClass(self.options.classClearName).appendTo(self.$wrapper)},remove:function(){var self=this;self.trigger("remove"),self.$remove.remove(),self.$index.parent().remove(),self.removeOperator(),self.removeValue(),self.removeClear(),self.$wrapper.remove()},removeClear:function(){var self=this;self.trigger("remove-clear"),self.$clear&&self.$clear.remove()},removeOperator:function(){var self=this;self.trigger("remove-operator"),self.$operator&&self.$operator.parent().remove()},removeValue:function(){var self=this;self.trigger("remove-value"),self.$value&&($.isArray(self.$value)?self.$value[0].parents(".querystring-criteria-value").remove():self.$value.parents(".querystring-criteria-value").remove())},buildQueryPart:function(){var self=this,ival=self.$index.select2("val");if(""===ival)return"";var istr="query.i:records="+ival;if("undefined"==typeof self.$operator)return"";var oval=self.$operator.val();if("path"===ival){if(oval.indexOf("advanced")>0)return"";oval=self.convertPathOperators(oval)}var ostr="query.o:records="+oval,vstrbase="query.v:records=",vstrlistbase="query.v:records:list=",vstr=[];if("undefined"==typeof self.$value)vstr.push(vstrbase);else if($.isArray(self.$value))$.each(self.$value,function(i,v){vstr.push(vstrlistbase+$(this).val())});else if($.isArray(self.$value.val()))$.each(self.$value.val(),function(i,v){vstr.push(vstrlistbase+v)});else{var str=vstrbase+self.$value.val();"path"===ival&&""!==self.$value.val()?str+=self.getDepthString():self.initial!==undefined&&(str=vstrbase+self.initial,delete self.initial),vstr.push(str)}return istr+"&"+ostr+"&"+vstr.join("&")},getJSONListStr:function(){var self=this,ival=self.$index.select2("val");if(""===ival)return"";if("undefined"==typeof self.$operator)return"";var oval=self.$operator.val();if("path"===ival){if(oval.indexOf("advanced")>0)return"";oval=self.convertPathOperators(oval)}var varr=[];if($.isArray(self.$value))$.each(self.$value,function(i,v){varr.push($(this).val())});else if("undefined"!=typeof self.$value){var value=self.$value.val();if("string"==typeof value){var depth=self.getDepthString();depth&&(value+=depth)}varr.push(value)}var vval;return vval=varr.length>1?'["'+varr.join('","')+'"]':1===varr.length?JSON.stringify(varr[0]):'""',self.indexes[ival].operators[oval]!==undefined?'{"i":"'+ival+'", "o":"'+oval+'", "v":'+vval+"}":void 0},getDepthString:function(){var self=this,out="",depth=$("."+self.options.classDepthName).val();return""!==depth&&depth!==undefined&&(out+="::"+depth),out},trigger:function(name){this.$wrapper.trigger(name+"-criteria.querystring.patterns",[this])},on:function(name,callback){this.$wrapper.on(name+"-criteria.querystring.patterns",callback)}};var QueryString=Base.extend({name:"querystring",trigger:".pat-querystring",parser:"mockup",defaults:{indexes:[],classWrapperName:"querystring-wrapper",criteria:{},indexOptionsUrl:null,previewURL:"portal_factory/@@querybuilder_html_results",previewCountURL:"portal_factory/@@querybuildernumberofresults",classSortLabelName:"querystring-sort-label",classSortReverseName:"querystring-sortreverse",classSortReverseLabelName:"querystring-sortreverse-label",classPreviewCountWrapperName:"querystring-previewcount-wrapper",classPreviewResultsWrapperName:"querystring-previewresults-wrapper",classPreviewWrapperName:"querystring-preview-wrapper",classPreviewName:"querystring-preview",classPreviewTitleName:"querystring-preview-title",classPreviewDescriptionName:"querystring-preview-description",classSortWrapperName:"querystring-sort-wrapper",showPreviews:!0},init:function(){var self=this;self.$el.hide(),self.$wrapper=$("<div/>"),self.$el.after(self.$wrapper),self.initialized=!1,self.options.indexOptionsUrl?$.ajax({url:self.options.indexOptionsUrl,success:function(data){self.options.indexes=data.indexes,self.options.sortable_indexes=data.sortable_indexes,self._init()},error:function(xhr){}}):self._init()},_init:function(){var self=this;self.$criteriaWrapper=$("<div/>").addClass(self.options.classWrapperName).appendTo(self.$wrapper),self.$sortWrapper=$("<div/>").addClass(self.options.classSortWrapperName).appendTo(self.$wrapper),"false"===self.options.showPreviews&&(self.options.showPreviews=!1),
self.options.showPreviews&&(self.$previewWrapper=$("<div/>").addClass(self.options.classPreviewWrapperName).appendTo(self.$wrapper),$("<div/>").addClass(self.options.classPreviewTitleName).html(_t("Preview")).appendTo(self.$previewWrapper),$("<div/>").addClass(self.options.classPreviewDescriptionName).html(_t("Preview of at most 10 items")).appendTo(self.$previewWrapper)),self.criterias=[],self.$el.val()&&$.each(JSON.parse(self.$el.val()),function(i,item){self.createCriteria(item.i,item.o,item.v)}),self.createCriteria(),self.createSort(),self.options.showPreviews&&self.refreshPreviewEvent(),self.$el.trigger("initialized"),self.initialized=!0},createCriteria:function(index,operator,value){var self=this,baseUrl=self.options.indexOptionsUrl.replace(/(@@.*)/g,""),criteria=new Criteria(self.$criteriaWrapper,self.options.criteria,self.options.indexes,index,operator,value,baseUrl);criteria.on("remove",function(e){self.criterias[self.criterias.length-1]===criteria&&self.createCriteria()}),criteria.on("index-changed",function(e){self.criterias[self.criterias.length-1]===criteria&&self.createCriteria()});var _doupdates=function(){self.refreshPreviewEvent(),self.updateValue()},_updateTimeout=-1,doupdates=function(){clearTimeout(_updateTimeout),_updateTimeout=setTimeout(_doupdates,100)};criteria.on("remove",function(e,criteria){self.criterias.indexOf(criteria)!==-1&&self.criterias.splice(self.criterias.indexOf(criteria),1),doupdates(e,criteria)}),criteria.on("remove-clear",doupdates),criteria.on("remove-operator",doupdates),criteria.on("remove-value",doupdates),criteria.on("index-changed",doupdates),criteria.on("operator-changed",doupdates),criteria.on("create-criteria",doupdates),criteria.on("create-operator",doupdates),criteria.on("create-value",doupdates),criteria.on("value-changed",doupdates),criteria.on("depth-changed",doupdates),self.criterias.push(criteria)},createSort:function(){var self=this,existingSortOn=$('[id$="-sort_on"]').filter('[id^="formfield-"]'),existingSortOrder=$('[id$="-sort_reversed"]').filter('[id^="formfield-"]');$("<span/>").addClass(self.options.classSortLabelName).html(_t("Sort on")).appendTo(self.$sortWrapper),self.$sortOn=$("<select/>").attr("name","sort_on").appendTo(self.$sortWrapper).change(function(){self.refreshPreviewEvent.call(self),$('[id$="sort_on"]',existingSortOn).val($(this).val())}),self.$sortOn.append($('<option value="">No sorting</option>'));for(var key in self.options.sortable_indexes)self.$sortOn.append($("<option/>").attr("value",key).html(self.options.indexes[key].title));if(self.$sortOn.patternSelect2({width:150}),self.$sortOrder=$('<input type="checkbox" />').attr("name","sort_reversed:boolean").change(function(){self.refreshPreviewEvent.call(self),$(this).prop("checked")?$('.option input[type="checkbox"]',existingSortOrder).prop("checked",!0):$('.option input[type="checkbox"]',existingSortOrder).prop("checked",!1)}),$("<span/>").addClass(self.options.classSortReverseName).appendTo(self.$sortWrapper).append(self.$sortOrder).append($("<span/>").html(_t("Reversed Order")).addClass(self.options.classSortReverseLabelName)),existingSortOn.length>=1&&existingSortOrder.length>=1){var reversed=$('.option input[type="checkbox"]',existingSortOrder).prop("checked"),sortOn=$('[id$="-sort_on"]',existingSortOn).val();reversed&&self.$sortOrder.prop("checked",!0),self.$sortOn.select2("val",sortOn),$(existingSortOn).hide(),$(existingSortOrder).hide()}},refreshPreviewEvent:function(value){var self=this;if(self.options.showPreviews){"undefined"!=typeof self._previewXhr&&self._previewXhr.abort(),"undefined"!=typeof self.$previewPane&&self.$previewPane.remove();var query=[];if($.each(self.criterias,function(i,criteria){var querypart=criteria.buildQueryPart();""!==querypart&&query.push(querypart)}),self.$previewPane=$("<div/>").addClass(self.options.classPreviewName).appendTo(self.$previewWrapper),query.length<=0)return void $("<div/>").addClass(self.options.classPreviewCountWrapperName).html("No results to preview").prependTo(self.$previewPane);query.push("sort_on="+self.$sortOn.val()),self.$sortOrder.prop("checked")&&query.push("sort_order=reverse"),self._previewXhr=$.get(self.options.previewURL+"?"+query.join("&")).done(function(data,stat){$("<div/>").addClass(self.options.classPreviewResultsWrapperName).html(data).appendTo(self.$previewPane)})}},updateValue:function(){var self=this,criteriastrs=[];$.each(self.criterias,function(i,criteria){var jsonstr=criteria.getJSONListStr();""!==jsonstr&&criteriastrs.push(jsonstr)});var val=(self.$el.val(),"["+criteriastrs.join(",")+"]");self.$el.val(val),self.$el.trigger("change")}});return QueryString}),function(root){define("tinymce",[],function(){return function(){return function(exports,undefined){"use strict";function require(ids,callback){for(var module,defs=[],i=0;i<ids.length;++i){if(module=modules[ids[i]]||resolve(ids[i]),!module)throw"module definition dependecy not found: "+ids[i];defs.push(module)}callback.apply(null,defs)}function define(id,dependencies,definition){if("string"!=typeof id)throw"invalid module definition, module id must be defined and be a string";if(dependencies===undefined)throw"invalid module definition, dependencies must be specified";if(definition===undefined)throw"invalid module definition, definition function must be specified";require(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function resolve(id){for(var target=exports,fragments=id.split(/[.\/]/),fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]])return;target=target[fragments[fi]]}return target}function expose(ids){var i,target,id,fragments,privateModules;for(i=0;i<ids.length;i++){target=exports,id=ids[i],fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length-1;++fi)target[fragments[fi]]===undefined&&(target[fragments[fi]]={}),target=target[fragments[fi]];target[fragments[fragments.length-1]]=modules[id]}if(exports.AMDLC_TESTS){privateModules=exports.privateModules||{};for(id in modules)privateModules[id]=modules[id];for(i=0;i<ids.length;i++)delete privateModules[ids[i]];exports.privateModules=privateModules}}var modules={};define("tinymce/geom/Rect",[],function(){function relativePosition(rect,targetRect,rel){var x,y,w,h,targetW,targetH;return x=targetRect.x,y=targetRect.y,w=rect.w,h=rect.h,targetW=targetRect.w,targetH=targetRect.h,rel=(rel||"").split(""),"b"===rel[0]&&(y+=targetH),"r"===rel[1]&&(x+=targetW),"c"===rel[0]&&(y+=round(targetH/2)),"c"===rel[1]&&(x+=round(targetW/2)),"b"===rel[3]&&(y-=h),"r"===rel[4]&&(x-=w),"c"===rel[3]&&(y-=round(h/2)),"c"===rel[4]&&(x-=round(w/2)),create(x,y,w,h)}function findBestRelativePosition(rect,targetRect,constrainRect,rels){var pos,i;for(i=0;i<rels.length;i++)if(pos=relativePosition(rect,targetRect,rels[i]),pos.x>=constrainRect.x&&pos.x+pos.w<=constrainRect.w+constrainRect.x&&pos.y>=constrainRect.y&&pos.y+pos.h<=constrainRect.h+constrainRect.y)return rels[i];return null}function inflate(rect,w,h){return create(rect.x-w,rect.y-h,rect.w+2*w,rect.h+2*h)}function intersect(rect,cropRect){var x1,y1,x2,y2;return x1=max(rect.x,cropRect.x),y1=max(rect.y,cropRect.y),x2=min(rect.x+rect.w,cropRect.x+cropRect.w),y2=min(rect.y+rect.h,cropRect.y+cropRect.h),x2-x1<0||y2-y1<0?null:create(x1,y1,x2-x1,y2-y1)}function clamp(rect,clampRect,fixedSize){var underflowX1,underflowY1,overflowX2,overflowY2,x1,y1,x2,y2,cx2,cy2;return x1=rect.x,y1=rect.y,x2=rect.x+rect.w,y2=rect.y+rect.h,cx2=clampRect.x+clampRect.w,cy2=clampRect.y+clampRect.h,underflowX1=max(0,clampRect.x-x1),underflowY1=max(0,clampRect.y-y1),overflowX2=max(0,x2-cx2),overflowY2=max(0,y2-cy2),x1+=underflowX1,y1+=underflowY1,fixedSize&&(x2+=underflowX1,y2+=underflowY1,x1-=overflowX2,y1-=overflowY2),x2-=overflowX2,y2-=overflowY2,create(x1,y1,x2-x1,y2-y1)}function create(x,y,w,h){return{x:x,y:y,w:w,h:h}}function fromClientRect(clientRect){return create(clientRect.left,clientRect.top,clientRect.width,clientRect.height)}var min=Math.min,max=Math.max,round=Math.round;return{inflate:inflate,relativePosition:relativePosition,findBestRelativePosition:findBestRelativePosition,intersect:intersect,clamp:clamp,create:create,fromClientRect:fromClientRect}}),define("tinymce/util/Promise",[],function(){function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof fn)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],doResolve(fn,bind(resolve,this),bind(reject,this))}function handle(deferred){var me=this;return null===this._state?void this._deferreds.push(deferred):void asap(function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if(null===cb)return void(me._state?deferred.resolve:deferred.reject)(me._value);var ret;try{ret=cb(me._value)}catch(e){return void deferred.reject(e)}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===this)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"==typeof newValue||"function"==typeof newValue)){var then=newValue.then;if("function"==typeof then)return void doResolve(bind(then,newValue),bind(resolve,this),bind(reject,this))}this._state=!0,this._value=newValue,finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=!1,this._value=newValue,finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++)handle.call(this,this._deferreds[i]);this._deferreds=null}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled="function"==typeof onFulfilled?onFulfilled:null,this.onRejected="function"==typeof onRejected?onRejected:null,this.resolve=resolve,this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=!1;try{fn(function(value){done||(done=!0,onFulfilled(value))},function(reason){done||(done=!0,onRejected(reason))})}catch(ex){if(done)return;done=!0,onRejected(ex)}}if(window.Promise)return window.Promise;var asap=Promise.immediateFn||"function"==typeof setImmediate&&setImmediate||function(fn){setTimeout(fn,1)},isArray=Array.isArray||function(value){return"[object Array]"===Object.prototype.toString.call(value)};return Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)},Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,new Handler(onFulfilled,onRejected,resolve,reject))})},Promise.all=function(){var args=Array.prototype.slice.call(1===arguments.length&&isArray(arguments[0])?arguments[0]:arguments);return new Promise(function(resolve,reject){function res(i,val){try{if(val&&("object"==typeof val||"function"==typeof val)){var then=val.then;if("function"==typeof then)return void then.call(val,function(val){res(i,val)},reject)}args[i]=val,0===--remaining&&resolve(args)}catch(ex){reject(ex)}}if(0===args.length)return resolve([]);for(var remaining=args.length,i=0;i<args.length;i++)res(i,args[i])})},Promise.resolve=function(value){return value&&"object"==typeof value&&value.constructor===Promise?value:new Promise(function(resolve){resolve(value)})},Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})},Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++)values[i].then(resolve,reject)})},Promise}),define("tinymce/util/Delay",["tinymce/util/Promise"],function(Promise){function requestAnimationFrame(callback,element){function featurefill(callback){window.setTimeout(callback,0)}var i,requestAnimationFrameFunc=window.requestAnimationFrame,vendors=["ms","moz","webkit"];for(i=0;i<vendors.length&&!requestAnimationFrameFunc;i++)requestAnimationFrameFunc=window[vendors[i]+"RequestAnimationFrame"];requestAnimationFrameFunc||(requestAnimationFrameFunc=featurefill),requestAnimationFrameFunc(callback,element)}function wrappedSetTimeout(callback,time){return"number"!=typeof time&&(time=0),setTimeout(callback,time)}function wrappedSetInterval(callback,time){return"number"!=typeof time&&(time=0),setInterval(callback,time)}function wrappedClearTimeout(id){return clearTimeout(id)}function wrappedClearInterval(id){return clearInterval(id)}var requestAnimationFramePromise;return{requestAnimationFrame:function(callback,element){return requestAnimationFramePromise?void requestAnimationFramePromise.then(callback):void(requestAnimationFramePromise=new Promise(function(resolve){element||(element=document.body),requestAnimationFrame(resolve,element)}).then(callback))},setTimeout:wrappedSetTimeout,setInterval:wrappedSetInterval,setEditorTimeout:function(editor,callback,time){return wrappedSetTimeout(function(){editor.removed||callback()},time)},setEditorInterval:function(editor,callback,time){var timer;return timer=wrappedSetInterval(function(){editor.removed?clearInterval(timer):callback()},time)},throttle:function(callback,time){var timer,func;return func=function(){var args=arguments;clearTimeout(timer),timer=wrappedSetTimeout(function(){callback.apply(this,args)},time)},func.stop=function(){clearTimeout(timer)},func},clearInterval:wrappedClearInterval,clearTimeout:wrappedClearTimeout}}),define("tinymce/Env",[],function(){function matchMediaQuery(query){return"matchMedia"in window&&matchMedia(query).matches}var opera,webkit,ie,ie11,ie12,gecko,mac,iDevice,android,fileApi,phone,tablet,windowsPhone,nav=navigator,userAgent=nav.userAgent;opera=window.opera&&window.opera.buildNumber,android=/Android/.test(userAgent),webkit=/WebKit/.test(userAgent),ie=!webkit&&!opera&&/MSIE/gi.test(userAgent)&&/Explorer/gi.test(nav.appName),ie=ie&&/MSIE (\w+)\./.exec(userAgent)[1],ie11=userAgent.indexOf("Trident/")!=-1&&(userAgent.indexOf("rv:")!=-1||nav.appName.indexOf("Netscape")!=-1)&&11,ie12=userAgent.indexOf("Edge/")!=-1&&!ie&&!ie11&&12,ie=ie||ie11||ie12,gecko=!webkit&&!ie11&&/Gecko/.test(userAgent),mac=userAgent.indexOf("Mac")!=-1,iDevice=/(iPad|iPhone)/.test(userAgent),fileApi="FormData"in window&&"FileReader"in window&&"URL"in window&&!!URL.createObjectURL,phone=matchMediaQuery("only screen and (max-device-width: 480px)")&&(android||iDevice),tablet=matchMediaQuery("only screen and (min-width: 800px)")&&(android||iDevice),windowsPhone=userAgent.indexOf("Windows Phone")!=-1,ie12&&(webkit=!1);var contentEditable=!iDevice||fileApi||userAgent.match(/AppleWebKit\/(\d*)/)[1]>=534;return{opera:opera,webkit:webkit,ie:ie,gecko:gecko,mac:mac,iOS:iDevice,android:android,contentEditable:contentEditable,transparentSrc:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",caretAfter:8!=ie,range:window.getSelection&&"Range"in window,documentMode:ie&&!ie12?document.documentMode||7:10,fileApi:fileApi,ceFalse:ie===!1||ie>8,desktop:!phone&&!tablet,windowsPhone:windowsPhone}}),define("tinymce/dom/EventUtils",["tinymce/util/Delay","tinymce/Env"],function(Delay,Env){function addEvent(target,name,callback,capture){target.addEventListener?target.addEventListener(name,callback,capture||!1):target.attachEvent&&target.attachEvent("on"+name,callback)}function removeEvent(target,name,callback,capture){target.removeEventListener?target.removeEventListener(name,callback,capture||!1):target.detachEvent&&target.detachEvent("on"+name,callback)}function getTargetFromShadowDom(event,defaultTarget){var path,target=defaultTarget;return path=event.path,path&&path.length>0&&(target=path[0]),event.deepPath&&(path=event.deepPath(),path&&path.length>0&&(target=path[0])),target}function fix(originalEvent,data){function returnFalse(){return!1}function returnTrue(){return!0}var name,undef,event=data||{};for(name in originalEvent)deprecated[name]||(event[name]=originalEvent[name]);if(event.target||(event.target=event.srcElement||document),Env.experimentalShadowDom&&(event.target=getTargetFromShadowDom(originalEvent,event.target)),originalEvent&&mouseEventRe.test(originalEvent.type)&&originalEvent.pageX===undef&&originalEvent.clientX!==undef){var eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body;event.pageX=originalEvent.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=originalEvent.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}return event.preventDefault=function(){event.isDefaultPrevented=returnTrue,originalEvent&&(originalEvent.preventDefault?originalEvent.preventDefault():originalEvent.returnValue=!1)},event.stopPropagation=function(){event.isPropagationStopped=returnTrue,originalEvent&&(originalEvent.stopPropagation?originalEvent.stopPropagation():originalEvent.cancelBubble=!0)},event.stopImmediatePropagation=function(){event.isImmediatePropagationStopped=returnTrue,event.stopPropagation()},event.isDefaultPrevented||(event.isDefaultPrevented=returnFalse,event.isPropagationStopped=returnFalse,event.isImmediatePropagationStopped=returnFalse),"undefined"==typeof event.metaKey&&(event.metaKey=!1),event}function bindOnReady(win,callback,eventUtils){function readyHandler(){eventUtils.domLoaded||(eventUtils.domLoaded=!0,callback(event))}function waitForDomLoaded(){("complete"===doc.readyState||"interactive"===doc.readyState&&doc.body)&&(removeEvent(doc,"readystatechange",waitForDomLoaded),readyHandler())}function tryScroll(){try{doc.documentElement.doScroll("left")}catch(ex){return void Delay.setTimeout(tryScroll)}readyHandler()}var doc=win.document,event={type:"ready"};return eventUtils.domLoaded?void callback(event):(doc.addEventListener?"complete"===doc.readyState?readyHandler():addEvent(win,"DOMContentLoaded",readyHandler):(addEvent(doc,"readystatechange",waitForDomLoaded),doc.documentElement.doScroll&&win.self===win.top&&tryScroll()),void addEvent(win,"load",readyHandler))}function EventUtils(){function executeHandlers(evt,id){var callbackList,i,l,callback,container=events[id];if(callbackList=container&&container[evt.type])for(i=0,l=callbackList.length;i<l;i++)if(callback=callbackList[i],callback&&callback.func.call(callback.scope,evt)===!1&&evt.preventDefault(),evt.isImmediatePropagationStopped())return}var count,expando,hasFocusIn,hasMouseEnterLeave,mouseEnterLeave,self=this,events={};expando=eventExpandoPrefix+(+new Date).toString(32),hasMouseEnterLeave="onmouseenter"in document.documentElement,hasFocusIn="onfocusin"in document.documentElement,mouseEnterLeave={mouseenter:"mouseover",mouseleave:"mouseout"},count=1,self.domLoaded=!1,self.events=events,self.bind=function(target,names,callback,scope){function defaultNativeHandler(evt){executeHandlers(fix(evt||win.event),id)}var id,callbackList,i,name,fakeName,nativeHandler,capture,win=window;if(target&&3!==target.nodeType&&8!==target.nodeType){for(target[expando]?id=target[expando]:(id=count++,target[expando]=id,events[id]={}),scope=scope||target,names=names.split(" "),i=names.length;i--;)name=names[i],nativeHandler=defaultNativeHandler,fakeName=capture=!1,"DOMContentLoaded"===name&&(name="ready"),self.domLoaded&&"ready"===name&&"complete"==target.readyState?callback.call(scope,fix({type:name})):(hasMouseEnterLeave||(fakeName=mouseEnterLeave[name],fakeName&&(nativeHandler=function(evt){var current,related;if(current=evt.currentTarget,related=evt.relatedTarget,related&&current.contains)related=current.contains(related);else for(;related&&related!==current;)related=related.parentNode;related||(evt=fix(evt||win.event),evt.type="mouseout"===evt.type?"mouseleave":"mouseenter",evt.target=current,executeHandlers(evt,id))})),hasFocusIn||"focusin"!==name&&"focusout"!==name||(capture=!0,fakeName="focusin"===name?"focus":"blur",nativeHandler=function(evt){evt=fix(evt||win.event),evt.type="focus"===evt.type?"focusin":"focusout",executeHandlers(evt,id)}),callbackList=events[id][name],callbackList?"ready"===name&&self.domLoaded?callback({type:name}):callbackList.push({func:callback,scope:scope}):(events[id][name]=callbackList=[{func:callback,scope:scope}],callbackList.fakeName=fakeName,callbackList.capture=capture,callbackList.nativeHandler=nativeHandler,"ready"===name?bindOnReady(target,nativeHandler,self):addEvent(target,fakeName||name,nativeHandler,capture)));return target=callbackList=0,callback}},self.unbind=function(target,names,callback){var id,callbackList,i,ci,name,eventMap;if(!target||3===target.nodeType||8===target.nodeType)return self;if(id=target[expando]){if(eventMap=events[id],names){for(names=names.split(" "),i=names.length;i--;)if(name=names[i],callbackList=eventMap[name]){if(callback)for(ci=callbackList.length;ci--;)if(callbackList[ci].func===callback){var nativeHandler=callbackList.nativeHandler,fakeName=callbackList.fakeName,capture=callbackList.capture;callbackList=callbackList.slice(0,ci).concat(callbackList.slice(ci+1)),callbackList.nativeHandler=nativeHandler,callbackList.fakeName=fakeName,callbackList.capture=capture,eventMap[name]=callbackList}callback&&0!==callbackList.length||(delete eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture))}}else{for(name in eventMap)callbackList=eventMap[name],removeEvent(target,callbackList.fakeName||name,callbackList.nativeHandler,callbackList.capture);eventMap={}}for(name in eventMap)return self;delete events[id];try{delete target[expando]}catch(ex){target[expando]=null}}return self},self.fire=function(target,name,args){var id;if(!target||3===target.nodeType||8===target.nodeType)return self;args=fix(null,args),args.type=name,args.target=target;do id=target[expando],id&&executeHandlers(args,id),target=target.parentNode||target.ownerDocument||target.defaultView||target.parentWindow;while(target&&!args.isPropagationStopped());return self},self.clean=function(target){var i,children,unbind=self.unbind;if(!target||3===target.nodeType||8===target.nodeType)return self;if(target[expando]&&unbind(target),target.getElementsByTagName||(target=target.document),target&&target.getElementsByTagName)for(unbind(target),children=target.getElementsByTagName("*"),i=children.length;i--;)target=children[i],target[expando]&&unbind(target);return self},self.destroy=function(){events={}},self.cancel=function(e){return e&&(e.preventDefault(),e.stopImmediatePropagation()),!1}}var eventExpandoPrefix="mce-data-",mouseEventRe=/^(?:mouse|contextmenu)|click/,deprecated={keyLocation:1,layerX:1,layerY:1,returnValue:1,webkitMovementX:1,webkitMovementY:1};return EventUtils.Event=new EventUtils,EventUtils.Event.bind(window,"ready",function(){}),EventUtils}),define("tinymce/dom/Sizzle",[],function(){function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=context.nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){if(elem=context.getElementById(m),!elem||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&testContext(context.parentNode)||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}var keys=[];return cache}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=attrs.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";i<len;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if(outerCache=elem[expando]||(elem[expando]={}),(oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(outerCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;i<len;i++)Sizzle(selector,contexts[i],results);return results}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;i<len;i++)(elem=unmatched[i])&&(filter&&!filter(elem,context,xml)||(newUnmatched.push(elem),mapped&&map.push(i)));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];i<len;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if(matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches),matcher[expando]){for(j=++i;j<len&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context!==document&&context);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;i<len;i++)if(this[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={
ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return!!documentElement&&"HTML"!==documentElement.nodeName},setDocument=Sizzle.setDocument=function(node){function getTop(win){try{return win.top}catch(ex){}return null}var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document&&9===doc.nodeType&&doc.documentElement?(document=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent!==getTop(parent)&&(parent.addEventListener?parent.addEventListener("unload",function(){setDocument()},!1):parent.attachEvent&&parent.attachEvent("onunload",function(){setDocument()})),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(doc.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(doc.getElementsByClassName),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!doc.getElementsByName||!doc.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined)return context.getElementsByTagName(tag)}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){if(documentIsHTML)return context.getElementsByClassName(className)},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(doc.querySelectorAll))&&(assert(function(div){div.innerHTML="<select msallowcapture=''><option selected=''></option></select>",div.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked")}),assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("name","D"),div.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare?compare:(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&compare||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:!operator||(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator&&(result===check||result.slice(0,check.length+1)===check+"-"))}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(outerCache=parent[expando]||(parent[expando]={}),cache=outerCache[type]||[],nodeIndex=cache[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return diff-=last,diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)idx=indexOf.call(seed,matched[i]),seed[idx]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return elemLang=elemLang.toLowerCase(),elemLang===lang||0===elemLang.indexOf(lang+"-");while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;i<length;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=argument<0?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}},Expr.pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){matched&&!(match=rcomma.exec(soFar))||(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length));for(type in Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)cached=matcherFromTokens(match[i]),cached[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers)),cached.selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(tokens=match[0]=match[0].slice(0),tokens.length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0],!context)return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),selector=seed.length&&toSelector(tokens),!selector)return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML)return elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){if(!isXML&&"input"===elem.nodeName.toLowerCase())return elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;if(!isXML)return elem[name]===!0?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}),define("tinymce/util/Arr",[],function(){function toArray(obj){var i,l,array=obj;if(!isArray(obj))for(array=[],i=0,l=obj.length;i<l;i++)array[i]=obj[i];return array}function each(o,cb,s){var n,l;if(!o)return 0;if(s=s||o,o.length!==undefined){for(n=0,l=o.length;n<l;n++)if(cb.call(s,o[n],n,o)===!1)return 0}else for(n in o)if(o.hasOwnProperty(n)&&cb.call(s,o[n],n,o)===!1)return 0;return 1}function map(array,callback){var out=[];return each(array,function(item,index){out.push(callback(item,index,array))}),out}function filter(a,f){var o=[];return each(a,function(v,index){f&&!f(v,index,a)||o.push(v)}),o}function indexOf(a,v){var i,l;if(a)for(i=0,l=a.length;i<l;i++)if(a[i]===v)return i;return-1}function reduce(collection,iteratee,accumulator,thisArg){var i=0;for(arguments.length<3&&(accumulator=collection[0]);i<collection.length;i++)accumulator=iteratee.call(thisArg,accumulator,collection[i],i);return accumulator}function findIndex(array,predicate,thisArg){var i,l;for(i=0,l=array.length;i<l;i++)if(predicate.call(thisArg,array[i],i,array))return i;return-1}function find(array,predicate,thisArg){var idx=findIndex(array,predicate,thisArg);return idx!==-1?array[idx]:undefined}function last(collection){return collection[collection.length-1]}var isArray=Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)};return{isArray:isArray,toArray:toArray,each:each,map:map,filter:filter,indexOf:indexOf,reduce:reduce,findIndex:findIndex,find:find,last:last}}),define("tinymce/util/Tools",["tinymce/Env","tinymce/util/Arr"],function(Env,Arr){function trim(str){return null===str||str===undefined?"":(""+str).replace(whiteSpaceRegExp,"")}function is(obj,type){return type?!("array"!=type||!Arr.isArray(obj))||typeof obj==type:obj!==undefined}function makeMap(items,delim,map){var i;for(items=items||[],delim=delim||",","string"==typeof items&&(items=items.split(delim)),map=map||{},i=items.length;i--;)map[items[i]]={};return map}function create(s,p,root){var sp,ns,cn,scn,c,self=this,de=0;if(s=/^((static) )?([\w.]+)(:([\w.]+))?/.exec(s),cn=s[3].match(/(^|\.)(\w+)$/i)[2],ns=self.createNS(s[3].replace(/\.\w+$/,""),root),!ns[cn]){if("static"==s[2])return ns[cn]=p,void(this.onCreate&&this.onCreate(s[2],s[3],ns[cn]));p[cn]||(p[cn]=function(){},de=1),ns[cn]=p[cn],self.extend(ns[cn].prototype,p),s[5]&&(sp=self.resolve(s[5]).prototype,scn=s[5].match(/\.(\w+)$/i)[1],c=ns[cn],de?ns[cn]=function(){return sp[scn].apply(this,arguments)}:ns[cn]=function(){return this.parent=sp[scn],c.apply(this,arguments)},ns[cn].prototype[cn]=ns[cn],self.each(sp,function(f,n){ns[cn].prototype[n]=sp[n]}),self.each(p,function(f,n){sp[n]?ns[cn].prototype[n]=function(){return this.parent=sp[n],f.apply(this,arguments)}:n!=cn&&(ns[cn].prototype[n]=f)})),self.each(p["static"],function(f,n){ns[cn][n]=f})}}function extend(obj,ext){var i,l,name,value,args=arguments;for(i=1,l=args.length;i<l;i++){ext=args[i];for(name in ext)ext.hasOwnProperty(name)&&(value=ext[name],value!==undefined&&(obj[name]=value))}return obj}function walk(o,f,n,s){s=s||this,o&&(n&&(o=o[n]),Arr.each(o,function(o,i){return f.call(s,o,i,n)!==!1&&void walk(o,f,n,s)}))}function createNS(n,o){var i,v;for(o=o||window,n=n.split("."),i=0;i<n.length;i++)v=n[i],o[v]||(o[v]={}),o=o[v];return o}function resolve(n,o){var i,l;for(o=o||window,n=n.split("."),i=0,l=n.length;i<l&&(o=o[n[i]],o);i++);return o}function explode(s,d){return!s||is(s,"array")?s:Arr.map(s.split(d||","),trim)}function _addCacheSuffix(url){var cacheSuffix=Env.cacheSuffix;return cacheSuffix&&(url+=(url.indexOf("?")===-1?"?":"&")+cacheSuffix),url}var whiteSpaceRegExp=/^\s*|\s*$/g;return{trim:trim,isArray:Arr.isArray,is:is,toArray:Arr.toArray,makeMap:makeMap,each:Arr.each,map:Arr.map,grep:Arr.filter,inArray:Arr.indexOf,extend:extend,create:create,walk:walk,createNS:createNS,resolve:resolve,explode:explode,_addCacheSuffix:_addCacheSuffix}}),define("tinymce/dom/DomQuery",["tinymce/dom/EventUtils","tinymce/dom/Sizzle","tinymce/util/Tools","tinymce/Env"],function(EventUtils,Sizzle,Tools,Env){function isDefined(obj){return"undefined"!=typeof obj}function isString(obj){return"string"==typeof obj}function isWindow(obj){return obj&&obj==obj.window}function createFragment(html,fragDoc){var frag,node,container;for(fragDoc=fragDoc||doc,container=fragDoc.createElement("div"),frag=fragDoc.createDocumentFragment(),container.innerHTML=html;node=container.firstChild;)frag.appendChild(node);return frag}function domManipulate(targetNodes,sourceItem,callback,reverse){var i;if(isString(sourceItem))sourceItem=createFragment(sourceItem,getElementDocument(targetNodes[0]));else if(sourceItem.length&&!sourceItem.nodeType){if(sourceItem=DomQuery.makeArray(sourceItem),reverse)for(i=sourceItem.length-1;i>=0;i--)domManipulate(targetNodes,sourceItem[i],callback,reverse);else for(i=0;i<sourceItem.length;i++)domManipulate(targetNodes,sourceItem[i],callback,reverse);return targetNodes}if(sourceItem.nodeType)for(i=targetNodes.length;i--;)callback.call(targetNodes[i],sourceItem);return targetNodes}function hasClass(node,className){return node&&className&&(" "+node.className+" ").indexOf(" "+className+" ")!==-1}function wrap(elements,wrapper,all){var lastParent,newWrapper;return wrapper=DomQuery(wrapper)[0],elements.each(function(){var self=this;all&&lastParent==self.parentNode?newWrapper.appendChild(self):(lastParent=self.parentNode,newWrapper=wrapper.cloneNode(!1),self.parentNode.insertBefore(newWrapper,self),newWrapper.appendChild(self))}),elements}function DomQuery(selector,context){return new DomQuery.fn.init(selector,context)}function inArray(item,array){var i;if(array.indexOf)return array.indexOf(item);for(i=array.length;i--;)if(array[i]===item)return i;return-1}function trim(str){return null===str||str===undef?"":(""+str).replace(whiteSpaceRegExp,"")}function each(obj,callback){var length,key,i,undef,value;if(obj)if(length=obj.length,length===undef){for(key in obj)if(obj.hasOwnProperty(key)&&(value=obj[key],callback.call(value,key,value)===!1))break}else for(i=0;i<length&&(value=obj[i],callback.call(value,i,value)!==!1);i++);return obj}function grep(array,callback){var out=[];return each(array,function(i,item){callback(item,i)&&out.push(item)}),out}function getElementDocument(element){return element?9==element.nodeType?element:element.ownerDocument:doc}function dir(el,prop,until){var matched=[],cur=el[prop];for("string"!=typeof until&&until instanceof DomQuery&&(until=until[0]);cur&&9!==cur.nodeType;){if(until!==undefined){if(cur===until)break;if("string"==typeof until&&DomQuery(cur).is(until))break}1===cur.nodeType&&matched.push(cur),cur=cur[prop]}return matched}function sibling(node,siblingName,nodeType,until){var result=[];for(until instanceof DomQuery&&(until=until[0]);node;node=node[siblingName])if(!nodeType||node.nodeType===nodeType){if(until!==undefined){if(node===until)break;if("string"==typeof until&&DomQuery(node).is(until))break}result.push(node)}return result}function firstSibling(node,siblingName,nodeType){for(node=node[siblingName];node;node=node[siblingName])if(node.nodeType==nodeType)return node;return null}function appendHooks(targetHooks,prop,hooks){each(hooks,function(name,func){targetHooks[name]=targetHooks[name]||{},targetHooks[name][prop]=func})}var undef,doc=document,push=Array.prototype.push,slice=Array.prototype.slice,rquickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,Event=EventUtils.Event,skipUniques=Tools.makeMap("children,contents,next,prev"),numericCssMap=Tools.makeMap("fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom"," "),booleanMap=Tools.makeMap("checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected"," "),propFix={"for":"htmlFor","class":"className",readonly:"readOnly"},cssFix={"float":"cssFloat"},attrHooks={},cssHooks={},whiteSpaceRegExp=/^\s*|\s*$/g;return DomQuery.fn=DomQuery.prototype={constructor:DomQuery,selector:"",context:null,length:0,init:function(selector,context){var match,node,self=this;if(!selector)return self;if(selector.nodeType)return self.context=self[0]=selector,self.length=1,self;if(context&&context.nodeType)self.context=context;else{if(context)return DomQuery(selector).attr(context);self.context=context=document}if(isString(selector)){if(self.selector=selector,match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector),!match)return DomQuery(context).find(selector);if(match[1])for(node=createFragment(selector,getElementDocument(context)).firstChild;node;)push.call(self,node),node=node.nextSibling;else{if(node=getElementDocument(context).getElementById(match[2]),!node)return self;if(node.id!==match[2])return self.find(selector);self.length=1,self[0]=node}}else this.add(selector,!1);return self},toArray:function(){return Tools.toArray(this)},add:function(items,sort){var nodes,i,self=this;if(isString(items))return self.add(DomQuery(items));if(sort!==!1)for(nodes=DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items))),self.length=nodes.length,i=0;i<nodes.length;i++)self[i]=nodes[i];else push.apply(self,DomQuery.makeArray(items));return self},attr:function(name,value){var hook,self=this;if("object"==typeof name)each(name,function(name,value){self.attr(name,value)});else{if(!isDefined(value)){if(self[0]&&1===self[0].nodeType){if(hook=attrHooks[name],hook&&hook.get)return hook.get(self[0],name);if(booleanMap[name])return self.prop(name)?name:undef;value=self[0].getAttribute(name,2),null===value&&(value=undef)}return value}this.each(function(){var hook;if(1===this.nodeType){if(hook=attrHooks[name],hook&&hook.set)return void hook.set(this,value);null===value?this.removeAttribute(name,2):this.setAttribute(name,value,2)}})}return self},removeAttr:function(name){return this.attr(name,null)},prop:function(name,value){var self=this;if(name=propFix[name]||name,"object"==typeof name)each(name,function(name,value){self.prop(name,value)});else{if(!isDefined(value))return self[0]&&self[0].nodeType&&name in self[0]?self[0][name]:value;this.each(function(){1==this.nodeType&&(this[name]=value)})}return self},css:function(name,value){function camel(name){return name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()})}function dashed(name){return name.replace(/[A-Z]/g,function(a){return"-"+a})}var elm,hook,self=this;if("object"==typeof name)each(name,function(name,value){self.css(name,value)});else if(isDefined(value))name=camel(name),"number"!=typeof value||numericCssMap[name]||(value+="px"),self.each(function(){var style=this.style;if(hook=cssHooks[name],hook&&hook.set)return void hook.set(this,value);try{this.style[cssFix[name]||name]=value}catch(ex){}null!==value&&""!==value||(style.removeProperty?style.removeProperty(dashed(name)):style.removeAttribute(name))});else{if(elm=self[0],hook=cssHooks[name],hook&&hook.get)return hook.get(elm);if(elm.ownerDocument.defaultView)try{return elm.ownerDocument.defaultView.getComputedStyle(elm,null).getPropertyValue(dashed(name))}catch(ex){return undef}else if(elm.currentStyle)return elm.currentStyle[camel(name)]}return self},remove:function(){for(var node,self=this,i=this.length;i--;)node=self[i],Event.clean(node),node.parentNode&&node.parentNode.removeChild(node);return this},empty:function(){for(var node,self=this,i=this.length;i--;)for(node=self[i];node.firstChild;)node.removeChild(node.firstChild);return this},html:function(value){var i,self=this;if(isDefined(value)){i=self.length;try{for(;i--;)self[i].innerHTML=value}catch(ex){DomQuery(self[i]).empty().append(value)}return self}return self[0]?self[0].innerHTML:""},text:function(value){var i,self=this;if(isDefined(value)){for(i=self.length;i--;)"innerText"in self[i]?self[i].innerText=value:self[0].textContent=value;return self}return self[0]?self[0].innerText||self[0].textContent:""},append:function(){return domManipulate(this,arguments,function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.appendChild(node)})},prepend:function(){return domManipulate(this,arguments,function(node){(1===this.nodeType||this.host&&1===this.host.nodeType)&&this.insertBefore(node,this.firstChild)},!0)},before:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this)}):self},after:function(){var self=this;return self[0]&&self[0].parentNode?domManipulate(self,arguments,function(node){this.parentNode.insertBefore(node,this.nextSibling)},!0):self},appendTo:function(val){return DomQuery(val).append(this),this},prependTo:function(val){return DomQuery(val).prepend(this),this},replaceWith:function(content){return this.before(content).remove()},wrap:function(content){return wrap(this,content)},wrapAll:function(content){return wrap(this,content,!0)},wrapInner:function(content){return this.each(function(){DomQuery(this).contents().wrapAll(content);
}),this},unwrap:function(){return this.parent().each(function(){DomQuery(this).replaceWith(this.childNodes)})},clone:function(){var result=[];return this.each(function(){result.push(this.cloneNode(!0))}),DomQuery(result)},addClass:function(className){return this.toggleClass(className,!0)},removeClass:function(className){return this.toggleClass(className,!1)},toggleClass:function(className,state){var self=this;return"string"!=typeof className?self:(className.indexOf(" ")!==-1?each(className.split(" "),function(){self.toggleClass(this,state)}):self.each(function(index,node){var existingClassName,classState;classState=hasClass(node,className),classState!==state&&(existingClassName=node.className,classState?node.className=trim((" "+existingClassName+" ").replace(" "+className+" "," ")):node.className+=existingClassName?" "+className:className)}),self)},hasClass:function(className){return hasClass(this[0],className)},each:function(callback){return each(this,callback)},on:function(name,callback){return this.each(function(){Event.bind(this,name,callback)})},off:function(name,callback){return this.each(function(){Event.unbind(this,name,callback)})},trigger:function(name){return this.each(function(){"object"==typeof name?Event.fire(this,name.type,name):Event.fire(this,name)})},show:function(){return this.css("display","")},hide:function(){return this.css("display","none")},slice:function(){return new DomQuery(slice.apply(this,arguments))},eq:function(index){return index===-1?this.slice(index):this.slice(index,+index+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},find:function(selector){var i,l,ret=[];for(i=0,l=this.length;i<l;i++)DomQuery.find(selector,this[i],ret);return DomQuery(ret)},filter:function(selector){return DomQuery("function"==typeof selector?grep(this.toArray(),function(item,i){return selector(i,item)}):DomQuery.filter(selector,this.toArray()))},closest:function(selector){var result=[];return selector instanceof DomQuery&&(selector=selector[0]),this.each(function(i,node){for(;node;){if("string"==typeof selector&&DomQuery(node).is(selector)){result.push(node);break}if(node==selector){result.push(node);break}node=node.parentNode}}),DomQuery(result)},offset:function(offset){var elm,doc,docElm,pos,x=0,y=0;return offset?this.css(offset):(elm=this[0],elm&&(doc=elm.ownerDocument,docElm=doc.documentElement,elm.getBoundingClientRect&&(pos=elm.getBoundingClientRect(),x=pos.left+(docElm.scrollLeft||doc.body.scrollLeft)-docElm.clientLeft,y=pos.top+(docElm.scrollTop||doc.body.scrollTop)-docElm.clientTop)),{left:x,top:y})},push:push,sort:[].sort,splice:[].splice},Tools.extend(DomQuery,{extend:Tools.extend,makeArray:function(object){return isWindow(object)||object.nodeType?[object]:Tools.toArray(object)},inArray:inArray,isArray:Tools.isArray,each:each,trim:trim,grep:grep,find:Sizzle,expr:Sizzle.selectors,unique:Sizzle.uniqueSort,text:Sizzle.getText,contains:Sizzle.contains,filter:function(expr,elems,not){var i=elems.length;for(not&&(expr=":not("+expr+")");i--;)1!=elems[i].nodeType&&elems.splice(i,1);return elems=1===elems.length?DomQuery.find.matchesSelector(elems[0],expr)?[elems[0]]:[]:DomQuery.find.matches(expr,elems)}}),each({parent:function(node){var parent=node.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(node){return dir(node,"parentNode")},next:function(node){return firstSibling(node,"nextSibling",1)},prev:function(node){return firstSibling(node,"previousSibling",1)},children:function(node){return sibling(node.firstChild,"nextSibling",1)},contents:function(node){return Tools.toArray(("iframe"===node.nodeName?node.contentDocument||node.contentWindow.document:node).childNodes)}},function(name,fn){DomQuery.fn[name]=function(selector){var self=this,result=[];return self.each(function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))}),this.length>1&&(skipUniques[name]||(result=DomQuery.unique(result)),0===name.indexOf("parents")&&(result=result.reverse())),result=DomQuery(result),selector?result.filter(selector):result}}),each({parentsUntil:function(node,until){return dir(node,"parentNode",until)},nextUntil:function(node,until){return sibling(node,"nextSibling",1,until).slice(1)},prevUntil:function(node,until){return sibling(node,"previousSibling",1,until).slice(1)}},function(name,fn){DomQuery.fn[name]=function(selector,filter){var self=this,result=[];return self.each(function(){var nodes=fn.call(result,this,selector,result);nodes&&(DomQuery.isArray(nodes)?result.push.apply(result,nodes):result.push(nodes))}),this.length>1&&(result=DomQuery.unique(result),0!==name.indexOf("parents")&&"prevUntil"!==name||(result=result.reverse())),result=DomQuery(result),filter?result.filter(filter):result}}),DomQuery.fn.is=function(selector){return!!selector&&this.filter(selector).length>0},DomQuery.fn.init.prototype=DomQuery.fn,DomQuery.overrideDefaults=function(callback){function sub(selector,context){return defaults=defaults||callback(),0===arguments.length&&(selector=defaults.element),context||(context=defaults.context),new sub.fn.init(selector,context)}var defaults;return DomQuery.extend(sub,this),sub},Env.ie&&Env.ie<8&&(appendHooks(attrHooks,"get",{maxlength:function(elm){var value=elm.maxLength;return 2147483647===value?undef:value},size:function(elm){var value=elm.size;return 20===value?undef:value},"class":function(elm){return elm.className},style:function(elm){var value=elm.style.cssText;return 0===value.length?undef:value}}),appendHooks(attrHooks,"set",{"class":function(elm,value){elm.className=value},style:function(elm,value){elm.style.cssText=value}})),Env.ie&&Env.ie<9&&(cssFix["float"]="styleFloat",appendHooks(cssHooks,"set",{opacity:function(elm,value){var style=elm.style;null===value||""===value?style.removeAttribute("filter"):(style.zoom=1,style.filter="alpha(opacity="+100*value+")")}})),DomQuery.attrHooks=attrHooks,DomQuery.cssHooks=cssHooks,DomQuery}),define("tinymce/html/Styles",[],function(){return function(settings,schema){function toHex(match,r,g,b){function hex(val){return val=parseInt(val,10).toString(16),val.length>1?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)}var undef,i,encodingItems,validStyles,invalidStyles,rgbRegExp=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)\s*\)/gi,urlOrStrRegExp=/(?:url(?:(?:\(\s*\"([^\"]+)\"\s*\))|(?:\(\s*\'([^\']+)\'\s*\))|(?:\(\s*([^)\s]+)\s*\))))|(?:\'([^\']+)\')|(?:\"([^\"]+)\")/gi,styleRegExp=/\s*([^:]+):\s*([^;]+);?/g,trimRightRegExp=/\s+$/,encodingLookup={},invisibleChar="\ufeff";for(settings=settings||{},schema&&(validStyles=schema.getValidStyles(),invalidStyles=schema.getInvalidStyles()),encodingItems=("\\\" \\' \\; \\: ; : "+invisibleChar).split(" "),i=0;i<encodingItems.length;i++)encodingLookup[encodingItems[i]]=invisibleChar+i,encodingLookup[invisibleChar+i]=encodingItems[i];return{toHex:function(color){return color.replace(rgbRegExp,toHex)},parse:function(css){function compress(prefix,suffix,noJoin){var top,right,bottom,left;if(top=styles[prefix+"-top"+suffix],top&&(right=styles[prefix+"-right"+suffix],right&&(bottom=styles[prefix+"-bottom"+suffix],bottom&&(left=styles[prefix+"-left"+suffix])))){var box=[top,right,bottom,left];for(i=box.length-1;i--&&box[i]===box[i+1];);i>-1&&noJoin||(styles[prefix+suffix]=i==-1?box[0]:box.join(" "),delete styles[prefix+"-top"+suffix],delete styles[prefix+"-right"+suffix],delete styles[prefix+"-bottom"+suffix],delete styles[prefix+"-left"+suffix])}}function canCompress(key){var i,value=styles[key];if(value){for(value=value.split(" "),i=value.length;i--;)if(value[i]!==value[0])return!1;return styles[key]=value[0],!0}}function compress2(target,a,b,c){canCompress(a)&&canCompress(b)&&canCompress(c)&&(styles[target]=styles[a]+" "+styles[b]+" "+styles[c],delete styles[a],delete styles[b],delete styles[c])}function encode(str){return isEncoded=!0,encodingLookup[str]}function decode(str,keep_slashes){return isEncoded&&(str=str.replace(/\uFEFF[0-9]/g,function(str){return encodingLookup[str]})),keep_slashes||(str=str.replace(/\\([\'\";:])/g,"$1")),str}function processUrl(match,url,url2,url3,str,str2){if(str=str||str2)return str=decode(str),"'"+str.replace(/\'/g,"\\'")+"'";if(url=decode(url||url2||url3),!settings.allow_script_urls){var scriptUrl=url.replace(/[\s\r\n]+/,"");if(/(java|vb)script:/i.test(scriptUrl))return"";if(!settings.allow_svg_data_urls&&/^data:image\/svg/i.test(scriptUrl))return""}return urlConverter&&(url=urlConverter.call(urlConverterScope,url,"style")),"url('"+url.replace(/\'/g,"\\'")+"')"}var matches,name,value,isEncoded,styles={},urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope||this;if(css){for(css=css.replace(/[\u0000-\u001F]/g,""),css=css.replace(/\\[\"\';:\uFEFF]/g,encode).replace(/\"[^\"]+\"|\'[^\']+\'/g,function(str){return str.replace(/[;:]/g,encode)});matches=styleRegExp.exec(css);){if(name=matches[1].replace(trimRightRegExp,"").toLowerCase(),value=matches[2].replace(trimRightRegExp,""),value=value.replace(/\\[0-9a-f]+/g,function(e){return String.fromCharCode(parseInt(e.substr(1),16))}),name&&value.length>0){if(!settings.allow_script_urls&&("behavior"==name||/expression\s*\(|\/\*|\*\//.test(value)))continue;"font-weight"===name&&"700"===value?value="bold":"color"!==name&&"background-color"!==name||(value=value.toLowerCase()),value=value.replace(rgbRegExp,toHex),value=value.replace(urlOrStrRegExp,processUrl),styles[name]=isEncoded?decode(value,!0):value}styleRegExp.lastIndex=matches.index+matches[0].length}compress("border","",!0),compress("border","-width"),compress("border","-color"),compress("border","-style"),compress("padding",""),compress("margin",""),compress2("border","border-width","border-style","border-color"),"medium none"===styles.border&&delete styles.border,"none"===styles["border-image"]&&delete styles["border-image"]}return styles},serialize:function(styles,elementName){function serializeStyles(name){var styleList,i,l,value;if(styleList=validStyles[name])for(i=0,l=styleList.length;i<l;i++)name=styleList[i],value=styles[name],value!==undef&&value.length>0&&(css+=(css.length>0?" ":"")+name+": "+value+";")}function isValid(name,elementName){var styleMap;return styleMap=invalidStyles["*"],(!styleMap||!styleMap[name])&&(styleMap=invalidStyles[elementName],!styleMap||!styleMap[name])}var name,value,css="";if(elementName&&validStyles)serializeStyles("*"),serializeStyles(elementName);else for(name in styles)value=styles[name],value!==undef&&value.length>0&&(invalidStyles&&!isValid(name,elementName)||(css+=(css.length>0?" ":"")+name+": "+value+";"));return css}}}}),define("tinymce/dom/TreeWalker",[],function(){return function(startNode,rootNode){function findSibling(node,startName,siblingName,shallow){var sibling,parent;if(node){if(!shallow&&node[startName])return node[startName];if(node!=rootNode){if(sibling=node[siblingName])return sibling;for(parent=node.parentNode;parent&&parent!=rootNode;parent=parent.parentNode)if(sibling=parent[siblingName])return sibling}}}function findPreviousNode(node,startName,siblingName,shallow){var sibling,parent,child;if(node){if(sibling=node[siblingName],rootNode&&sibling===rootNode)return;if(sibling){if(!shallow)for(child=sibling[startName];child;child=child[startName])if(!child[startName])return child;return sibling}if(parent=node.parentNode,parent&&parent!==rootNode)return parent}}var node=startNode;this.current=function(){return node},this.next=function(shallow){return node=findSibling(node,"firstChild","nextSibling",shallow)},this.prev=function(shallow){return node=findSibling(node,"lastChild","previousSibling",shallow)},this.prev2=function(shallow){return node=findPreviousNode(node,"lastChild","previousSibling",shallow)}}}),define("tinymce/dom/Range",["tinymce/util/Tools"],function(Tools){function Range(dom){function createDocumentFragment(){return doc.createDocumentFragment()}function setStart(n,o){_setEndPoint(TRUE,n,o)}function setEnd(n,o){_setEndPoint(FALSE,n,o)}function setStartBefore(n){setStart(n.parentNode,nodeIndex(n))}function setStartAfter(n){setStart(n.parentNode,nodeIndex(n)+1)}function setEndBefore(n){setEnd(n.parentNode,nodeIndex(n))}function setEndAfter(n){setEnd(n.parentNode,nodeIndex(n)+1)}function collapse(ts){ts?(self[END_CONTAINER]=self[START_CONTAINER],self[END_OFFSET]=self[START_OFFSET]):(self[START_CONTAINER]=self[END_CONTAINER],self[START_OFFSET]=self[END_OFFSET]),self.collapsed=TRUE}function selectNode(n){setStartBefore(n),setEndAfter(n)}function selectNodeContents(n){setStart(n,0),setEnd(n,1===n.nodeType?n.childNodes.length:n.nodeValue.length)}function compareBoundaryPoints(h,r){var sc=self[START_CONTAINER],so=self[START_OFFSET],ec=self[END_CONTAINER],eo=self[END_OFFSET],rsc=r.startContainer,rso=r.startOffset,rec=r.endContainer,reo=r.endOffset;return 0===h?_compareBoundaryPoints(sc,so,rsc,rso):1===h?_compareBoundaryPoints(ec,eo,rsc,rso):2===h?_compareBoundaryPoints(ec,eo,rec,reo):3===h?_compareBoundaryPoints(sc,so,rec,reo):void 0}function deleteContents(){_traverse(DELETE)}function extractContents(){return _traverse(EXTRACT)}function cloneContents(){return _traverse(CLONE)}function insertNode(n){var nn,o,startContainer=this[START_CONTAINER],startOffset=this[START_OFFSET];3!==startContainer.nodeType&&4!==startContainer.nodeType||!startContainer.nodeValue?(startContainer.childNodes.length>0&&(o=startContainer.childNodes[startOffset]),o?startContainer.insertBefore(n,o):3==startContainer.nodeType?dom.insertAfter(n,startContainer):startContainer.appendChild(n)):startOffset?startOffset>=startContainer.nodeValue.length?dom.insertAfter(n,startContainer):(nn=startContainer.splitText(startOffset),startContainer.parentNode.insertBefore(n,nn)):startContainer.parentNode.insertBefore(n,startContainer)}function surroundContents(n){var f=self.extractContents();self.insertNode(n),n.appendChild(f),self.selectNode(n)}function cloneRange(){return extend(new Range(dom),{startContainer:self[START_CONTAINER],startOffset:self[START_OFFSET],endContainer:self[END_CONTAINER],endOffset:self[END_OFFSET],collapsed:self.collapsed,commonAncestorContainer:self.commonAncestorContainer})}function _getSelectedNode(container,offset){var child;if(3==container.nodeType)return container;if(offset<0)return container;for(child=container.firstChild;child&&offset>0;)--offset,child=child.nextSibling;return child?child:container}function _isCollapsed(){return self[START_CONTAINER]==self[END_CONTAINER]&&self[START_OFFSET]==self[END_OFFSET]}function _compareBoundaryPoints(containerA,offsetA,containerB,offsetB){var c,offsetC,n,cmnRoot,childA,childB;if(containerA==containerB)return offsetA==offsetB?0:offsetA<offsetB?-1:1;for(c=containerB;c&&c.parentNode!=containerA;)c=c.parentNode;if(c){for(offsetC=0,n=containerA.firstChild;n!=c&&offsetC<offsetA;)offsetC++,n=n.nextSibling;return offsetA<=offsetC?-1:1}for(c=containerA;c&&c.parentNode!=containerB;)c=c.parentNode;if(c){for(offsetC=0,n=containerB.firstChild;n!=c&&offsetC<offsetB;)offsetC++,n=n.nextSibling;return offsetC<offsetB?-1:1}for(cmnRoot=dom.findCommonAncestor(containerA,containerB),childA=containerA;childA&&childA.parentNode!=cmnRoot;)childA=childA.parentNode;for(childA||(childA=cmnRoot),childB=containerB;childB&&childB.parentNode!=cmnRoot;)childB=childB.parentNode;if(childB||(childB=cmnRoot),childA==childB)return 0;for(n=cmnRoot.firstChild;n;){if(n==childA)return-1;if(n==childB)return 1;n=n.nextSibling}}function _setEndPoint(st,n,o){var ec,sc;for(st?(self[START_CONTAINER]=n,self[START_OFFSET]=o):(self[END_CONTAINER]=n,self[END_OFFSET]=o),ec=self[END_CONTAINER];ec.parentNode;)ec=ec.parentNode;for(sc=self[START_CONTAINER];sc.parentNode;)sc=sc.parentNode;sc==ec?_compareBoundaryPoints(self[START_CONTAINER],self[START_OFFSET],self[END_CONTAINER],self[END_OFFSET])>0&&self.collapse(st):self.collapse(st),self.collapsed=_isCollapsed(),self.commonAncestorContainer=dom.findCommonAncestor(self[START_CONTAINER],self[END_CONTAINER])}function _traverse(how){var c,p,depthDiff,startNode,endNode,sp,ep,endContainerDepth=0,startContainerDepth=0;if(self[START_CONTAINER]==self[END_CONTAINER])return _traverseSameContainer(how);for(c=self[END_CONTAINER],p=c.parentNode;p;c=p,p=p.parentNode){if(p==self[START_CONTAINER])return _traverseCommonStartContainer(c,how);++endContainerDepth}for(c=self[START_CONTAINER],p=c.parentNode;p;c=p,p=p.parentNode){if(p==self[END_CONTAINER])return _traverseCommonEndContainer(c,how);++startContainerDepth}for(depthDiff=startContainerDepth-endContainerDepth,startNode=self[START_CONTAINER];depthDiff>0;)startNode=startNode.parentNode,depthDiff--;for(endNode=self[END_CONTAINER];depthDiff<0;)endNode=endNode.parentNode,depthDiff++;for(sp=startNode.parentNode,ep=endNode.parentNode;sp!=ep;sp=sp.parentNode,ep=ep.parentNode)startNode=sp,endNode=ep;return _traverseCommonAncestors(startNode,endNode,how)}function _traverseSameContainer(how){var frag,s,sub,n,cnt,sibling,xferNode,start,len;if(how!=DELETE&&(frag=createDocumentFragment()),self[START_OFFSET]==self[END_OFFSET])return frag;if(3==self[START_CONTAINER].nodeType){if(s=self[START_CONTAINER].nodeValue,sub=s.substring(self[START_OFFSET],self[END_OFFSET]),how!=CLONE&&(n=self[START_CONTAINER],start=self[START_OFFSET],len=self[END_OFFSET]-self[START_OFFSET],0===start&&len>=n.nodeValue.length-1?n.parentNode.removeChild(n):n.deleteData(start,len),self.collapse(TRUE)),how==DELETE)return;return sub.length>0&&frag.appendChild(doc.createTextNode(sub)),frag}for(n=_getSelectedNode(self[START_CONTAINER],self[START_OFFSET]),cnt=self[END_OFFSET]-self[START_OFFSET];n&&cnt>0;)sibling=n.nextSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.appendChild(xferNode),--cnt,n=sibling;return how!=CLONE&&self.collapse(TRUE),frag}function _traverseCommonStartContainer(endAncestor,how){var frag,n,endIdx,cnt,sibling,xferNode;if(how!=DELETE&&(frag=createDocumentFragment()),n=_traverseRightBoundary(endAncestor,how),frag&&frag.appendChild(n),endIdx=nodeIndex(endAncestor),cnt=endIdx-self[START_OFFSET],cnt<=0)return how!=CLONE&&(self.setEndBefore(endAncestor),self.collapse(FALSE)),frag;for(n=endAncestor.previousSibling;cnt>0;)sibling=n.previousSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.insertBefore(xferNode,frag.firstChild),--cnt,n=sibling;return how!=CLONE&&(self.setEndBefore(endAncestor),self.collapse(FALSE)),frag}function _traverseCommonEndContainer(startAncestor,how){var frag,startIdx,n,cnt,sibling,xferNode;for(how!=DELETE&&(frag=createDocumentFragment()),n=_traverseLeftBoundary(startAncestor,how),frag&&frag.appendChild(n),startIdx=nodeIndex(startAncestor),++startIdx,cnt=self[END_OFFSET]-startIdx,n=startAncestor.nextSibling;n&&cnt>0;)sibling=n.nextSibling,xferNode=_traverseFullySelected(n,how),frag&&frag.appendChild(xferNode),--cnt,n=sibling;return how!=CLONE&&(self.setStartAfter(startAncestor),self.collapse(TRUE)),frag}function _traverseCommonAncestors(startAncestor,endAncestor,how){var n,frag,startOffset,endOffset,cnt,sibling,nextSibling;for(how!=DELETE&&(frag=createDocumentFragment()),n=_traverseLeftBoundary(startAncestor,how),frag&&frag.appendChild(n),startOffset=nodeIndex(startAncestor),endOffset=nodeIndex(endAncestor),++startOffset,cnt=endOffset-startOffset,sibling=startAncestor.nextSibling;cnt>0;)nextSibling=sibling.nextSibling,n=_traverseFullySelected(sibling,how),frag&&frag.appendChild(n),sibling=nextSibling,--cnt;return n=_traverseRightBoundary(endAncestor,how),frag&&frag.appendChild(n),how!=CLONE&&(self.setStartAfter(startAncestor),self.collapse(TRUE)),frag}function _traverseRightBoundary(root,how){var parent,clonedParent,prevSibling,clonedChild,clonedGrandParent,next=_getSelectedNode(self[END_CONTAINER],self[END_OFFSET]-1),isFullySelected=next!=self[END_CONTAINER];if(next==root)return _traverseNode(next,isFullySelected,FALSE,how);for(parent=next.parentNode,clonedParent=_traverseNode(parent,FALSE,FALSE,how);parent;){for(;next;)prevSibling=next.previousSibling,clonedChild=_traverseNode(next,isFullySelected,FALSE,how),how!=DELETE&&clonedParent.insertBefore(clonedChild,clonedParent.firstChild),isFullySelected=TRUE,next=prevSibling;if(parent==root)return clonedParent;next=parent.previousSibling,parent=parent.parentNode,clonedGrandParent=_traverseNode(parent,FALSE,FALSE,how),how!=DELETE&&clonedGrandParent.appendChild(clonedParent),clonedParent=clonedGrandParent}}function _traverseLeftBoundary(root,how){var parent,clonedParent,nextSibling,clonedChild,clonedGrandParent,next=_getSelectedNode(self[START_CONTAINER],self[START_OFFSET]),isFullySelected=next!=self[START_CONTAINER];if(next==root)return _traverseNode(next,isFullySelected,TRUE,how);for(parent=next.parentNode,clonedParent=_traverseNode(parent,FALSE,TRUE,how);parent;){for(;next;)nextSibling=next.nextSibling,clonedChild=_traverseNode(next,isFullySelected,TRUE,how),how!=DELETE&&clonedParent.appendChild(clonedChild),isFullySelected=TRUE,next=nextSibling;if(parent==root)return clonedParent;next=parent.nextSibling,parent=parent.parentNode,clonedGrandParent=_traverseNode(parent,FALSE,TRUE,how),how!=DELETE&&clonedGrandParent.appendChild(clonedParent),clonedParent=clonedGrandParent}}function _traverseNode(n,isFullySelected,isLeft,how){var txtValue,newNodeValue,oldNodeValue,offset,newNode;if(isFullySelected)return _traverseFullySelected(n,how);if(3==n.nodeType){if(txtValue=n.nodeValue,isLeft?(offset=self[START_OFFSET],newNodeValue=txtValue.substring(offset),oldNodeValue=txtValue.substring(0,offset)):(offset=self[END_OFFSET],newNodeValue=txtValue.substring(0,offset),oldNodeValue=txtValue.substring(offset)),how!=CLONE&&(n.nodeValue=oldNodeValue),how==DELETE)return;return newNode=dom.clone(n,FALSE),newNode.nodeValue=newNodeValue,newNode}if(how!=DELETE)return dom.clone(n,FALSE)}function _traverseFullySelected(n,how){return how!=DELETE?how==CLONE?dom.clone(n,TRUE):n:void n.parentNode.removeChild(n)}function toStringIE(){return dom.create("body",null,cloneContents()).outerText}var self=this,doc=dom.doc,EXTRACT=0,CLONE=1,DELETE=2,TRUE=!0,FALSE=!1,START_OFFSET="startOffset",START_CONTAINER="startContainer",END_CONTAINER="endContainer",END_OFFSET="endOffset",extend=Tools.extend,nodeIndex=dom.nodeIndex;return extend(self,{startContainer:doc,startOffset:0,endContainer:doc,endOffset:0,collapsed:TRUE,commonAncestorContainer:doc,START_TO_START:0,START_TO_END:1,END_TO_END:2,END_TO_START:3,setStart:setStart,setEnd:setEnd,setStartBefore:setStartBefore,setStartAfter:setStartAfter,setEndBefore:setEndBefore,setEndAfter:setEndAfter,collapse:collapse,selectNode:selectNode,selectNodeContents:selectNodeContents,compareBoundaryPoints:compareBoundaryPoints,deleteContents:deleteContents,extractContents:extractContents,cloneContents:cloneContents,insertNode:insertNode,surroundContents:surroundContents,cloneRange:cloneRange,toStringIE:toStringIE}),self}return Range.prototype.toString=function(){return this.toStringIE()},Range}),define("tinymce/html/Entities",["tinymce/util/Tools"],function(Tools){function nativeDecode(text){var elm;return elm=document.createElement("div"),elm.innerHTML=text,elm.textContent||elm.innerText||text}function buildEntitiesLookup(items,radix){var i,chr,entity,lookup={};if(items){for(items=items.split(","),radix=radix||10,i=0;i<items.length;i+=2)chr=String.fromCharCode(parseInt(items[i],radix)),baseEntities[chr]||(entity="&"+items[i+1]+";",lookup[chr]=entity,lookup[entity]=chr);return lookup}}var namedEntities,baseEntities,reverseEntities,makeMap=Tools.makeMap,attrsCharsRegExp=/[&<>\"\u0060\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,textCharsRegExp=/[<>&\u007E-\uD7FF\uE000-\uFFEF]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g,rawCharsRegExp=/[<>&\"\']/g,entityRegExp=/&#([a-z0-9]+);?|&([a-z0-9]+);/gi,asciiMap={128:"",130:"",131:"",132:"",133:"",134:"",135:"",136:"",137:"",138:"",139:"",140:"",142:"",145:"",146:"",147:"",148:"",149:"",150:"",151:"",152:"",153:"",154:"",155:"",156:"",158:"",159:""};baseEntities={'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;","&":"&amp;","`":"&#96;"},reverseEntities={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&apos;":"'"},namedEntities=buildEntitiesLookup("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32);var Entities={encodeRaw:function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeAllRaw:function(text){return(""+text).replace(rawCharsRegExp,function(chr){return baseEntities[chr]||chr})},encodeNumeric:function(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return chr.length>1?"&#"+(1024*(chr.charCodeAt(0)-55296)+(chr.charCodeAt(1)-56320)+65536)+";":baseEntities[chr]||"&#"+chr.charCodeAt(0)+";"})},encodeNamed:function(text,attr,entities){return entities=entities||namedEntities,text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||chr})},getEncodeFunc:function(name,entities){function encodeNamedAndNumeric(text,attr){return text.replace(attr?attrsCharsRegExp:textCharsRegExp,function(chr){return baseEntities[chr]||entities[chr]||"&#"+chr.charCodeAt(0)+";"||chr})}function encodeCustomNamed(text,attr){return Entities.encodeNamed(text,attr,entities)}return entities=buildEntitiesLookup(entities)||namedEntities,name=makeMap(name.replace(/\+/g,",")),name.named&&name.numeric?encodeNamedAndNumeric:name.named?entities?encodeCustomNamed:Entities.encodeNamed:name.numeric?Entities.encodeNumeric:Entities.encodeRaw},decode:function(text){return text.replace(entityRegExp,function(all,numeric){return numeric?(numeric="x"===numeric.charAt(0).toLowerCase()?parseInt(numeric.substr(1),16):parseInt(numeric,10),numeric>65535?(numeric-=65536,String.fromCharCode(55296+(numeric>>10),56320+(1023&numeric))):asciiMap[numeric]||String.fromCharCode(numeric)):reverseEntities[all]||namedEntities[all]||nativeDecode(all)})}};return Entities}),define("tinymce/dom/StyleSheetLoader",["tinymce/util/Tools","tinymce/util/Delay"],function(Tools,Delay){return function(document,settings){function appendToHead(node){document.getElementsByTagName("head")[0].appendChild(node)}function load(url,loadedCallback,errorCallback){function passed(){for(var callbacks=state.passed,i=callbacks.length;i--;)callbacks[i]();state.status=2,state.passed=[],state.failed=[]}function failed(){for(var callbacks=state.failed,i=callbacks.length;i--;)callbacks[i]();state.status=3,state.passed=[],state.failed=[]}function isOldWebKit(){var webKitChunks=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(webKitChunks&&webKitChunks[1]<536)}function wait(testCallback,waitCallback){testCallback()||((new Date).getTime()-startTime<maxLoadTime?Delay.setTimeout(waitCallback):failed())}function waitForWebKitLinkLoaded(){wait(function(){for(var styleSheet,owner,styleSheets=document.styleSheets,i=styleSheets.length;i--;)if(styleSheet=styleSheets[i],owner=styleSheet.ownerNode?styleSheet.ownerNode:styleSheet.owningElement,owner&&owner.id===link.id)return passed(),!0},waitForWebKitLinkLoaded)}function waitForGeckoLinkLoaded(){wait(function(){try{var cssRules=style.sheet.cssRules;return passed(),!!cssRules}catch(ex){}},waitForGeckoLinkLoaded)}var link,style,startTime,state;if(url=Tools._addCacheSuffix(url),loadedStates[url]?state=loadedStates[url]:(state={passed:[],failed:[]},loadedStates[url]=state),loadedCallback&&state.passed.push(loadedCallback),errorCallback&&state.failed.push(errorCallback),1!=state.status){if(2==state.status)return void passed();if(3==state.status)return void failed();if(state.status=1,link=document.createElement("link"),link.rel="stylesheet",link.type="text/css",link.id="u"+idCount++,link.async=!1,link.defer=!1,startTime=(new Date).getTime(),"onload"in link&&!isOldWebKit())link.onload=waitForWebKitLinkLoaded,link.onerror=failed;else{if(navigator.userAgent.indexOf("Firefox")>0)return style=document.createElement("style"),style.textContent='@import "'+url+'"',waitForGeckoLinkLoaded(),void appendToHead(style);waitForWebKitLinkLoaded()}appendToHead(link),link.href=url}}var maxLoadTime,idCount=0,loadedStates={};settings=settings||{},maxLoadTime=settings.maxLoadTime||5e3,this.load=load}}),define("tinymce/dom/DOMUtils",["tinymce/dom/Sizzle","tinymce/dom/DomQuery","tinymce/html/Styles","tinymce/dom/EventUtils","tinymce/dom/TreeWalker","tinymce/dom/Range","tinymce/html/Entities","tinymce/Env","tinymce/util/Tools","tinymce/dom/StyleSheetLoader"],function(Sizzle,$,Styles,EventUtils,TreeWalker,Range,Entities,Env,Tools,StyleSheetLoader){function setupAttrHooks(domUtils,settings){var keepUrlHook,attrHooks={},keepValues=settings.keep_values;return keepUrlHook={set:function($elm,value,name){settings.url_converter&&(value=settings.url_converter.call(settings.url_converter_scope||domUtils,value,name,$elm[0])),$elm.attr("data-mce-"+name,value).attr(name,value)},get:function($elm,name){return $elm.attr("data-mce-"+name)||$elm.attr(name)}},attrHooks={style:{set:function($elm,value){return null!==value&&"object"==typeof value?void $elm.css(value):(keepValues&&$elm.attr("data-mce-style",value),void $elm.attr("style",value))},get:function($elm){var value=$elm.attr("data-mce-style")||$elm.attr("style");return value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName)}}},keepValues&&(attrHooks.href=attrHooks.src=keepUrlHook),attrHooks}function updateInternalStyleAttr(domUtils,$elm){var value=$elm.attr("style");value=domUtils.serializeStyle(domUtils.parseStyle(value),$elm[0].nodeName),value||(value=null),$elm.attr("data-mce-style",value)}function nodeIndex(node,normalized){var lastNodeType,nodeType,idx=0;if(node)for(lastNodeType=node.nodeType,node=node.previousSibling;node;node=node.previousSibling)nodeType=node.nodeType,(!normalized||3!=nodeType||nodeType!=lastNodeType&&node.nodeValue.length)&&(idx++,lastNodeType=nodeType);return idx}function DOMUtils(doc,settings){
var blockElementsMap,self=this;self.doc=doc,self.win=window,self.files={},self.counter=0,self.stdMode=!isIE||doc.documentMode>=8,self.boxModel=!isIE||"CSS1Compat"==doc.compatMode||self.stdMode,self.styleSheetLoader=new StyleSheetLoader(doc),self.boundEvents=[],self.settings=settings=settings||{},self.schema=settings.schema,self.styles=new Styles({url_converter:settings.url_converter,url_converter_scope:settings.url_converter_scope},settings.schema),self.fixDoc(doc),self.events=settings.ownEvents?new EventUtils(settings.proxy):EventUtils.Event,self.attrHooks=setupAttrHooks(self,settings),blockElementsMap=settings.schema?settings.schema.getBlockElements():{},self.$=$.overrideDefaults(function(){return{context:doc,element:self.getRoot()}}),self.isBlock=function(node){if(!node)return!1;var type=node.nodeType;return type?!(1!==type||!blockElementsMap[node.nodeName]):!!blockElementsMap[node]}}var each=Tools.each,is=Tools.is,grep=Tools.grep,trim=Tools.trim,isIE=Env.ie,simpleSelectorRe=/^([a-z0-9],?)+$/i,whiteSpaceRegExp=/^[ \t\r\n]*$/;return DOMUtils.prototype={$$:function(elm){return"string"==typeof elm&&(elm=this.get(elm)),this.$(elm)},root:null,fixDoc:function(doc){var name,settings=this.settings;if(isIE&&settings.schema){"abbr article aside audio canvas details figcaption figure footer header hgroup mark menu meter nav output progress section summary time video".replace(/\w+/g,function(name){doc.createElement(name)});for(name in settings.schema.getCustomElements())doc.createElement(name)}},clone:function(node,deep){var clone,doc,self=this;return!isIE||1!==node.nodeType||deep?node.cloneNode(deep):(doc=self.doc,deep?clone.firstChild:(clone=doc.createElement(node.nodeName),each(self.getAttribs(node),function(attr){self.setAttrib(clone,attr.nodeName,self.getAttrib(node,attr.nodeName))}),clone))},getRoot:function(){var self=this;return self.settings.root_element||self.doc.body},getViewPort:function(win){var doc,rootElm;return win=win?win:this.win,doc=win.document,rootElm=this.boxModel?doc.documentElement:doc.body,{x:win.pageXOffset||rootElm.scrollLeft,y:win.pageYOffset||rootElm.scrollTop,w:win.innerWidth||rootElm.clientWidth,h:win.innerHeight||rootElm.clientHeight}},getRect:function(elm){var pos,size,self=this;return elm=self.get(elm),pos=self.getPos(elm),size=self.getSize(elm),{x:pos.x,y:pos.y,w:size.w,h:size.h}},getSize:function(elm){var w,h,self=this;return elm=self.get(elm),w=self.getStyle(elm,"width"),h=self.getStyle(elm,"height"),w.indexOf("px")===-1&&(w=0),h.indexOf("px")===-1&&(h=0),{w:parseInt(w,10)||elm.offsetWidth||elm.clientWidth,h:parseInt(h,10)||elm.offsetHeight||elm.clientHeight}},getParent:function(node,selector,root){return this.getParents(node,selector,root,!1)},getParents:function(node,selector,root,collect){var selectorVal,self=this,result=[];for(node=self.get(node),collect=collect===undefined,root=root||("BODY"!=self.getRoot().nodeName?self.getRoot().parentNode:null),is(selector,"string")&&(selectorVal=selector,selector="*"===selector?function(node){return 1==node.nodeType}:function(node){return self.is(node,selectorVal)});node&&node!=root&&node.nodeType&&9!==node.nodeType;){if(!selector||selector(node)){if(!collect)return node;result.push(node)}node=node.parentNode}return collect?result:null},get:function(elm){var name;return elm&&this.doc&&"string"==typeof elm&&(name=elm,elm=this.doc.getElementById(elm),elm&&elm.id!==name)?this.doc.getElementsByName(name)[1]:elm},getNext:function(node,selector){return this._findSib(node,selector,"nextSibling")},getPrev:function(node,selector){return this._findSib(node,selector,"previousSibling")},select:function(selector,scope){var self=this;return Sizzle(selector,self.get(scope)||self.settings.root_element||self.doc,[])},is:function(elm,selector){var i;if(elm.length===undefined){if("*"===selector)return 1==elm.nodeType;if(simpleSelectorRe.test(selector)){for(selector=selector.toLowerCase().split(/,/),elm=elm.nodeName.toLowerCase(),i=selector.length-1;i>=0;i--)if(selector[i]==elm)return!0;return!1}}if(elm.nodeType&&1!=elm.nodeType)return!1;var elms=elm.nodeType?[elm]:elm;return Sizzle(selector,elms[0].ownerDocument||elms[0],null,elms).length>0},add:function(parentElm,name,attrs,html,create){var self=this;return this.run(parentElm,function(parentElm){var newElm;return newElm=is(name,"string")?self.doc.createElement(name):name,self.setAttribs(newElm,attrs),html&&(html.nodeType?newElm.appendChild(html):self.setHTML(newElm,html)),create?newElm:parentElm.appendChild(newElm)})},create:function(name,attrs,html){return this.add(this.doc.createElement(name),name,attrs,html,1)},createHTML:function(name,attrs,html){var key,outHtml="";outHtml+="<"+name;for(key in attrs)attrs.hasOwnProperty(key)&&null!==attrs[key]&&"undefined"!=typeof attrs[key]&&(outHtml+=" "+key+'="'+this.encode(attrs[key])+'"');return"undefined"!=typeof html?outHtml+">"+html+"</"+name+">":outHtml+" />"},createFragment:function(html){var frag,node,container,doc=this.doc;for(container=doc.createElement("div"),frag=doc.createDocumentFragment(),html&&(container.innerHTML=html);node=container.firstChild;)frag.appendChild(node);return frag},remove:function(node,keepChildren){return node=this.$$(node),keepChildren?node.each(function(){for(var child;child=this.firstChild;)3==child.nodeType&&0===child.data.length?this.removeChild(child):this.parentNode.insertBefore(child,this)}).remove():node.remove(),node.length>1?node.toArray():node[0]},setStyle:function(elm,name,value){elm=this.$$(elm).css(name,value),this.settings.update_styles&&updateInternalStyleAttr(this,elm)},getStyle:function(elm,name,computed){return elm=this.$$(elm),computed?elm.css(name):(name=name.replace(/-(\D)/g,function(a,b){return b.toUpperCase()}),"float"==name&&(name=Env.ie&&Env.ie<12?"styleFloat":"cssFloat"),elm[0]&&elm[0].style?elm[0].style[name]:undefined)},setStyles:function(elm,styles){elm=this.$$(elm).css(styles),this.settings.update_styles&&updateInternalStyleAttr(this,elm)},removeAllAttribs:function(e){return this.run(e,function(e){var i,attrs=e.attributes;for(i=attrs.length-1;i>=0;i--)e.removeAttributeNode(attrs.item(i))})},setAttrib:function(elm,name,value){var originalValue,hook,self=this,settings=self.settings;""===value&&(value=null),elm=self.$$(elm),originalValue=elm.attr(name),elm.length&&(hook=self.attrHooks[name],hook&&hook.set?hook.set(elm,value,name):elm.attr(name,value),originalValue!=value&&settings.onSetAttrib&&settings.onSetAttrib({attrElm:elm,attrName:name,attrValue:value}))},setAttribs:function(elm,attrs){var self=this;self.$$(elm).each(function(i,node){each(attrs,function(value,name){self.setAttrib(node,name,value)})})},getAttrib:function(elm,name,defaultVal){var hook,value,self=this;return elm=self.$$(elm),elm.length&&(hook=self.attrHooks[name],value=hook&&hook.get?hook.get(elm,name):elm.attr(name)),"undefined"==typeof value&&(value=defaultVal||""),value},getPos:function(elm,rootElm){var offsetParent,pos,self=this,x=0,y=0,doc=self.doc,body=doc.body;if(elm=self.get(elm),rootElm=rootElm||body,elm){if(rootElm===body&&elm.getBoundingClientRect&&"static"===$(body).css("position"))return pos=elm.getBoundingClientRect(),rootElm=self.boxModel?doc.documentElement:body,x=pos.left+(doc.documentElement.scrollLeft||body.scrollLeft)-rootElm.clientLeft,y=pos.top+(doc.documentElement.scrollTop||body.scrollTop)-rootElm.clientTop,{x:x,y:y};for(offsetParent=elm;offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType;)x+=offsetParent.offsetLeft||0,y+=offsetParent.offsetTop||0,offsetParent=offsetParent.offsetParent;for(offsetParent=elm.parentNode;offsetParent&&offsetParent!=rootElm&&offsetParent.nodeType;)x-=offsetParent.scrollLeft||0,y-=offsetParent.scrollTop||0,offsetParent=offsetParent.parentNode}return{x:x,y:y}},parseStyle:function(cssText){return this.styles.parse(cssText)},serializeStyle:function(styles,name){return this.styles.serialize(styles,name)},addStyle:function(cssText){var head,styleElm,self=this,doc=self.doc;if(self!==DOMUtils.DOM&&doc===document){var addedStyles=DOMUtils.DOM.addedStyles;if(addedStyles=addedStyles||[],addedStyles[cssText])return;addedStyles[cssText]=!0,DOMUtils.DOM.addedStyles=addedStyles}styleElm=doc.getElementById("mceDefaultStyles"),styleElm||(styleElm=doc.createElement("style"),styleElm.id="mceDefaultStyles",styleElm.type="text/css",head=doc.getElementsByTagName("head")[0],head.firstChild?head.insertBefore(styleElm,head.firstChild):head.appendChild(styleElm)),styleElm.styleSheet?styleElm.styleSheet.cssText+=cssText:styleElm.appendChild(doc.createTextNode(cssText))},loadCSS:function(url){var head,self=this,doc=self.doc;return self!==DOMUtils.DOM&&doc===document?void DOMUtils.DOM.loadCSS(url):(url||(url=""),head=doc.getElementsByTagName("head")[0],void each(url.split(","),function(url){var link;url=Tools._addCacheSuffix(url),self.files[url]||(self.files[url]=!0,link=self.create("link",{rel:"stylesheet",href:url}),isIE&&doc.documentMode&&doc.recalc&&(link.onload=function(){doc.recalc&&doc.recalc(),link.onload=null}),head.appendChild(link))}))},addClass:function(elm,cls){this.$$(elm).addClass(cls)},removeClass:function(elm,cls){this.toggleClass(elm,cls,!1)},hasClass:function(elm,cls){return this.$$(elm).hasClass(cls)},toggleClass:function(elm,cls,state){this.$$(elm).toggleClass(cls,state).each(function(){""===this.className&&$(this).attr("class",null)})},show:function(elm){this.$$(elm).show()},hide:function(elm){this.$$(elm).hide()},isHidden:function(elm){return"none"==this.$$(elm).css("display")},uniqueId:function(prefix){return(prefix?prefix:"mce_")+this.counter++},setHTML:function(elm,html){elm=this.$$(elm),isIE?elm.each(function(i,target){if(target.canHaveHTML!==!1){for(;target.firstChild;)target.removeChild(target.firstChild);try{target.innerHTML="<br>"+html,target.removeChild(target.firstChild)}catch(ex){$("<div>").html("<br>"+html).contents().slice(1).appendTo(target)}return html}}):elm.html(html)},getOuterHTML:function(elm){return elm=this.get(elm),1==elm.nodeType&&"outerHTML"in elm?elm.outerHTML:$("<div>").append($(elm).clone()).html()},setOuterHTML:function(elm,html){var self=this;self.$$(elm).each(function(){try{if("outerHTML"in this)return void(this.outerHTML=html)}catch(ex){}self.remove($(this).html(html),!0)})},decode:Entities.decode,encode:Entities.encodeAllRaw,insertAfter:function(node,referenceNode){return referenceNode=this.get(referenceNode),this.run(node,function(node){var parent,nextSibling;return parent=referenceNode.parentNode,nextSibling=referenceNode.nextSibling,nextSibling?parent.insertBefore(node,nextSibling):parent.appendChild(node),node})},replace:function(newElm,oldElm,keepChildren){var self=this;return self.run(oldElm,function(oldElm){return is(oldElm,"array")&&(newElm=newElm.cloneNode(!0)),keepChildren&&each(grep(oldElm.childNodes),function(node){newElm.appendChild(node)}),oldElm.parentNode.replaceChild(newElm,oldElm)})},rename:function(elm,name){var newElm,self=this;return elm.nodeName!=name.toUpperCase()&&(newElm=self.create(name),each(self.getAttribs(elm),function(attrNode){self.setAttrib(newElm,attrNode.nodeName,self.getAttrib(elm,attrNode.nodeName))}),self.replace(newElm,elm,1)),newElm||elm},findCommonAncestor:function(a,b){for(var pe,ps=a;ps;){for(pe=b;pe&&ps!=pe;)pe=pe.parentNode;if(ps==pe)break;ps=ps.parentNode}return!ps&&a.ownerDocument?a.ownerDocument.documentElement:ps},toHex:function(rgbVal){return this.styles.toHex(Tools.trim(rgbVal))},run:function(elm,func,scope){var result,self=this;return"string"==typeof elm&&(elm=self.get(elm)),!!elm&&(scope=scope||this,elm.nodeType||!elm.length&&0!==elm.length?func.call(scope,elm):(result=[],each(elm,function(elm,i){elm&&("string"==typeof elm&&(elm=self.get(elm)),result.push(func.call(scope,elm,i)))}),result))},getAttribs:function(elm){var attrs;if(elm=this.get(elm),!elm)return[];if(isIE){if(attrs=[],"OBJECT"==elm.nodeName)return elm.attributes;"OPTION"===elm.nodeName&&this.getAttrib(elm,"selected")&&attrs.push({specified:1,nodeName:"selected"});var attrRegExp=/<\/?[\w:\-]+ ?|=[\"][^\"]+\"|=\'[^\']+\'|=[\w\-]+|>/gi;return elm.cloneNode(!1).outerHTML.replace(attrRegExp,"").replace(/[\w:\-]+/gi,function(a){attrs.push({specified:1,nodeName:a})}),attrs}return elm.attributes},isEmpty:function(node,elements){var i,attributes,type,walker,name,self=this,brCount=0;if(node=node.firstChild){walker=new TreeWalker(node,node.parentNode),elements=elements||(self.schema?self.schema.getNonEmptyElements():null);do{if(type=node.nodeType,1===type){if(node.getAttribute("data-mce-bogus"))continue;if(name=node.nodeName.toLowerCase(),elements&&elements[name]){if("br"===name){brCount++;continue}return!1}for(attributes=self.getAttribs(node),i=attributes.length;i--;)if(name=attributes[i].nodeName,"name"===name||"data-mce-bookmark"===name)return!1}if(8==type)return!1;if(3===type&&!whiteSpaceRegExp.test(node.nodeValue))return!1}while(node=walker.next())}return brCount<=1},createRng:function(){var doc=this.doc;return doc.createRange?doc.createRange():new Range(this)},nodeIndex:nodeIndex,split:function(parentElm,splitElm,replacementElm){function trimNode(node){function surroundedBySpans(node){var previousIsSpan=node.previousSibling&&"SPAN"==node.previousSibling.nodeName,nextIsSpan=node.nextSibling&&"SPAN"==node.nextSibling.nodeName;return previousIsSpan&&nextIsSpan}var i,children=node.childNodes,type=node.nodeType;if(1!=type||"bookmark"!=node.getAttribute("data-mce-type")){for(i=children.length-1;i>=0;i--)trimNode(children[i]);if(9!=type){if(3==type&&node.nodeValue.length>0){var trimmedLength=trim(node.nodeValue).length;if(!self.isBlock(node.parentNode)||trimmedLength>0||0===trimmedLength&&surroundedBySpans(node))return}else if(1==type&&(children=node.childNodes,1==children.length&&children[0]&&1==children[0].nodeType&&"bookmark"==children[0].getAttribute("data-mce-type")&&node.parentNode.insertBefore(children[0],node),children.length||/^(br|hr|input|img)$/i.test(node.nodeName)))return;self.remove(node)}return node}}var bef,aft,pa,self=this,r=self.createRng();if(parentElm&&splitElm)return r.setStart(parentElm.parentNode,self.nodeIndex(parentElm)),r.setEnd(splitElm.parentNode,self.nodeIndex(splitElm)),bef=r.extractContents(),r=self.createRng(),r.setStart(splitElm.parentNode,self.nodeIndex(splitElm)+1),r.setEnd(parentElm.parentNode,self.nodeIndex(parentElm)+1),aft=r.extractContents(),pa=parentElm.parentNode,pa.insertBefore(trimNode(bef),parentElm),replacementElm?pa.insertBefore(replacementElm,parentElm):pa.insertBefore(splitElm,parentElm),pa.insertBefore(trimNode(aft),parentElm),self.remove(parentElm),replacementElm||splitElm},bind:function(target,name,func,scope){var self=this;if(Tools.isArray(target)){for(var i=target.length;i--;)target[i]=self.bind(target[i],name,func,scope);return target}return!self.settings.collect||target!==self.doc&&target!==self.win||self.boundEvents.push([target,name,func,scope]),self.events.bind(target,name,func,scope||self)},unbind:function(target,name,func){var i,self=this;if(Tools.isArray(target)){for(i=target.length;i--;)target[i]=self.unbind(target[i],name,func);return target}if(self.boundEvents&&(target===self.doc||target===self.win))for(i=self.boundEvents.length;i--;){var item=self.boundEvents[i];target!=item[0]||name&&name!=item[1]||func&&func!=item[2]||this.events.unbind(item[0],item[1],item[2])}return this.events.unbind(target,name,func)},fire:function(target,name,evt){return this.events.fire(target,name,evt)},getContentEditable:function(node){var contentEditable;return node&&1==node.nodeType?(contentEditable=node.getAttribute("data-mce-contenteditable"),contentEditable&&"inherit"!==contentEditable?contentEditable:"inherit"!==node.contentEditable?node.contentEditable:null):null},getContentEditableParent:function(node){for(var root=this.getRoot(),state=null;node&&node!==root&&(state=this.getContentEditable(node),null===state);node=node.parentNode);return state},destroy:function(){var self=this;if(self.boundEvents){for(var i=self.boundEvents.length;i--;){var item=self.boundEvents[i];this.events.unbind(item[0],item[1],item[2])}self.boundEvents=null}Sizzle.setDocument&&Sizzle.setDocument(),self.win=self.doc=self.root=self.events=self.frag=null},isChildOf:function(node,parent){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1},dumpRng:function(r){return"startContainer: "+r.startContainer.nodeName+", startOffset: "+r.startOffset+", endContainer: "+r.endContainer.nodeName+", endOffset: "+r.endOffset},_findSib:function(node,selector,name){var self=this,func=selector;if(node)for("string"==typeof func&&(func=function(node){return self.is(node,selector)}),node=node[name];node;node=node[name])if(func(node))return node;return null}},DOMUtils.DOM=new DOMUtils(document),DOMUtils.nodeIndex=nodeIndex,DOMUtils}),define("tinymce/dom/ScriptLoader",["tinymce/dom/DOMUtils","tinymce/util/Tools"],function(DOMUtils,Tools){function ScriptLoader(){function loadScript(url,callback){function done(){dom.remove(id),elm&&(elm.onreadystatechange=elm.onload=elm=null),callback()}function error(){"undefined"!=typeof console&&console.log&&console.log("Failed to load: "+url)}var elm,id,dom=DOM;id=dom.uniqueId(),elm=document.createElement("script"),elm.id=id,elm.type="text/javascript",elm.src=Tools._addCacheSuffix(url),"onreadystatechange"in elm?elm.onreadystatechange=function(){/loaded|complete/.test(elm.readyState)&&done()}:elm.onload=done,elm.onerror=error,(document.getElementsByTagName("head")[0]||document.body).appendChild(elm)}var undef,QUEUED=0,LOADING=1,LOADED=2,states={},queue=[],scriptLoadedCallbacks={},queueLoadedCallbacks=[],loading=0;this.isDone=function(url){return states[url]==LOADED},this.markDone=function(url){states[url]=LOADED},this.add=this.load=function(url,callback,scope){var state=states[url];state==undef&&(queue.push(url),states[url]=QUEUED),callback&&(scriptLoadedCallbacks[url]||(scriptLoadedCallbacks[url]=[]),scriptLoadedCallbacks[url].push({func:callback,scope:scope||this}))},this.loadQueue=function(callback,scope){this.loadScripts(queue,callback,scope)},this.loadScripts=function(scripts,callback,scope){function execScriptLoadedCallbacks(url){each(scriptLoadedCallbacks[url],function(callback){callback.func.call(callback.scope)}),scriptLoadedCallbacks[url]=undef}var loadScripts;queueLoadedCallbacks.push({func:callback,scope:scope||this}),(loadScripts=function(){var loadingScripts=grep(scripts);scripts.length=0,each(loadingScripts,function(url){return states[url]==LOADED?void execScriptLoadedCallbacks(url):void(states[url]!=LOADING&&(states[url]=LOADING,loading++,loadScript(url,function(){states[url]=LOADED,loading--,execScriptLoadedCallbacks(url),loadScripts()})))}),loading||(each(queueLoadedCallbacks,function(callback){callback.func.call(callback.scope)}),queueLoadedCallbacks.length=0)})()}}var DOM=DOMUtils.DOM,each=Tools.each,grep=Tools.grep;return ScriptLoader.ScriptLoader=new ScriptLoader,ScriptLoader}),define("tinymce/AddOnManager",["tinymce/dom/ScriptLoader","tinymce/util/Tools"],function(ScriptLoader,Tools){function AddOnManager(){var self=this;self.items=[],self.urls={},self.lookup={}}var each=Tools.each;return AddOnManager.prototype={get:function(name){return this.lookup[name]?this.lookup[name].instance:undefined},dependencies:function(name){var result;return this.lookup[name]&&(result=this.lookup[name].dependencies),result||[]},requireLangPack:function(name,languages){var language=AddOnManager.language;if(language&&AddOnManager.languageLoad!==!1){if(languages)if(languages=","+languages+",",languages.indexOf(","+language.substr(0,2)+",")!=-1)language=language.substr(0,2);else if(languages.indexOf(","+language+",")==-1)return;ScriptLoader.ScriptLoader.add(this.urls[name]+"/langs/"+language+".js")}},add:function(id,addOn,dependencies){return this.items.push(addOn),this.lookup[id]={instance:addOn,dependencies:dependencies},addOn},createUrl:function(baseUrl,dep){return"object"==typeof dep?dep:{prefix:baseUrl.prefix,resource:dep,suffix:baseUrl.suffix}},addComponents:function(pluginName,scripts){var pluginUrl=this.urls[pluginName];each(scripts,function(script){ScriptLoader.ScriptLoader.add(pluginUrl+"/"+script)})},load:function(name,addOnUrl,callback,scope){function loadDependencies(){var dependencies=self.dependencies(name);each(dependencies,function(dep){var newUrl=self.createUrl(addOnUrl,dep);self.load(newUrl.resource,newUrl,undefined,undefined)}),callback&&(scope?callback.call(scope):callback.call(ScriptLoader))}var self=this,url=addOnUrl;self.urls[name]||("object"==typeof addOnUrl&&(url=addOnUrl.prefix+addOnUrl.resource+addOnUrl.suffix),0!==url.indexOf("/")&&url.indexOf("://")==-1&&(url=AddOnManager.baseURL+"/"+url),self.urls[name]=url.substring(0,url.lastIndexOf("/")),self.lookup[name]?loadDependencies():ScriptLoader.ScriptLoader.add(url,loadDependencies,scope))}},AddOnManager.PluginManager=new AddOnManager,AddOnManager.ThemeManager=new AddOnManager,AddOnManager}),define("tinymce/dom/NodeType",[],function(){function isNodeType(type){return function(node){return!!node&&node.nodeType==type}}function matchNodeNames(names){return names=names.toLowerCase().split(" "),function(node){var i,name;if(node&&node.nodeType)for(name=node.nodeName.toLowerCase(),i=0;i<names.length;i++)if(name===names[i])return!0;return!1}}function matchStyleValues(name,values){return values=values.toLowerCase().split(" "),function(node){var i,cssValue;if(isElement(node))for(i=0;i<values.length;i++)if(cssValue=getComputedStyle(node,null).getPropertyValue(name),cssValue===values[i])return!0;return!1}}function hasPropValue(propName,propValue){return function(node){return isElement(node)&&node[propName]===propValue}}function hasAttributeValue(attrName,attrValue){return function(node){return isElement(node)&&node.getAttribute(attrName)===attrValue}}function isBogus(node){return isElement(node)&&node.hasAttribute("data-mce-bogus")}function hasContentEditableState(value){return function(node){if(isElement(node)){if(node.contentEditable===value)return!0;if(node.getAttribute("data-mce-contenteditable")===value)return!0}return!1}}var isElement=isNodeType(1);return{isText:isNodeType(3),isElement:isElement,isComment:isNodeType(8),isBr:matchNodeNames("br"),isContentEditableTrue:hasContentEditableState("true"),isContentEditableFalse:hasContentEditableState("false"),matchNodeNames:matchNodeNames,hasPropValue:hasPropValue,hasAttributeValue:hasAttributeValue,matchStyleValues:matchStyleValues,isBogus:isBogus}}),define("tinymce/text/Zwsp",[],function(){function isZwsp(chr){return chr==ZWSP}function trim(str){return str.replace(new RegExp(ZWSP,"g"),"")}var ZWSP="";return{isZwsp:isZwsp,ZWSP:ZWSP,trim:trim}}),define("tinymce/caret/CaretContainer",["tinymce/dom/NodeType","tinymce/text/Zwsp"],function(NodeType,Zwsp){function isCaretContainerBlock(node){return isText(node)&&(node=node.parentNode),isElement(node)&&node.hasAttribute("data-mce-caret")}function isCaretContainerInline(node){return isText(node)&&Zwsp.isZwsp(node.data)}function isCaretContainer(node){return isCaretContainerBlock(node)||isCaretContainerInline(node)}function insertInline(node,before){var doc,sibling,textNode,parentNode;if(doc=node.ownerDocument,textNode=doc.createTextNode(Zwsp.ZWSP),parentNode=node.parentNode,before){if(sibling=node.previousSibling,isText(sibling)){if(isCaretContainer(sibling))return sibling;if(endsWithCaretContainer(sibling))return sibling.splitText(sibling.data.length-1)}parentNode.insertBefore(textNode,node)}else{if(sibling=node.nextSibling,isText(sibling)){if(isCaretContainer(sibling))return sibling;if(startsWithCaretContainer(sibling))return sibling.splitText(1),sibling}node.nextSibling?parentNode.insertBefore(textNode,node.nextSibling):parentNode.appendChild(textNode)}return textNode}function insertBlock(blockName,node,before){var doc,blockNode,parentNode;return doc=node.ownerDocument,blockNode=doc.createElement(blockName),blockNode.setAttribute("data-mce-caret",before?"before":"after"),blockNode.setAttribute("data-mce-bogus","all"),blockNode.appendChild(doc.createTextNode("")),parentNode=node.parentNode,before?parentNode.insertBefore(blockNode,node):node.nextSibling?parentNode.insertBefore(blockNode,node.nextSibling):parentNode.appendChild(blockNode),blockNode}function remove(caretContainerNode){var text;isElement(caretContainerNode)&&isCaretContainer(caretContainerNode)&&("&nbsp;"!=caretContainerNode.innerHTML?caretContainerNode.removeAttribute("data-mce-caret"):caretContainerNode.parentNode&&caretContainerNode.parentNode.removeChild(caretContainerNode)),isText(caretContainerNode)&&(text=Zwsp.trim(caretContainerNode.data),0===text.length&&caretContainerNode.parentNode&&caretContainerNode.parentNode.removeChild(caretContainerNode),caretContainerNode.nodeValue=text)}function startsWithCaretContainer(node){return isText(node)&&node.data[0]==Zwsp.ZWSP}function endsWithCaretContainer(node){return isText(node)&&node.data[node.data.length-1]==Zwsp.ZWSP}var isElement=NodeType.isElement,isText=NodeType.isText;return{isCaretContainer:isCaretContainer,isCaretContainerBlock:isCaretContainerBlock,isCaretContainerInline:isCaretContainerInline,insertInline:insertInline,insertBlock:insertBlock,remove:remove,startsWithCaretContainer:startsWithCaretContainer,endsWithCaretContainer:endsWithCaretContainer}}),define("tinymce/dom/RangeUtils",["tinymce/util/Tools","tinymce/dom/TreeWalker","tinymce/dom/NodeType","tinymce/caret/CaretContainer"],function(Tools,TreeWalker,NodeType,CaretContainer){function getEndChild(container,index){var childNodes=container.childNodes;return index--,index>childNodes.length-1?index=childNodes.length-1:index<0&&(index=0),childNodes[index]||container}function RangeUtils(dom){this.walk=function(rng,callback){function exclude(nodes){var node;return node=nodes[0],3===node.nodeType&&node===startContainer&&startOffset>=node.nodeValue.length&&nodes.splice(0,1),node=nodes[nodes.length-1],0===endOffset&&nodes.length>0&&node===endContainer&&3===node.nodeType&&nodes.splice(nodes.length-1,1),nodes}function collectSiblings(node,name,end_node){for(var siblings=[];node&&node!=end_node;node=node[name])siblings.push(node);return siblings}function findEndPoint(node,root){do{if(node.parentNode==root)return node;node=node.parentNode}while(node)}function walkBoundary(start_node,end_node,next){var siblingName=next?"nextSibling":"previousSibling";for(node=start_node,parent=node.parentNode;node&&node!=end_node;node=parent)parent=node.parentNode,siblings=collectSiblings(node==start_node?node:node[siblingName],siblingName),siblings.length&&(next||siblings.reverse(),callback(exclude(siblings)))}var ancestor,startPoint,endPoint,node,parent,siblings,nodes,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(nodes=dom.select("td[data-mce-selected],th[data-mce-selected]"),nodes.length>0)return void each(nodes,function(node){callback([node])});if(1==startContainer.nodeType&&startContainer.hasChildNodes()&&(startContainer=startContainer.childNodes[startOffset]),1==endContainer.nodeType&&endContainer.hasChildNodes()&&(endContainer=getEndChild(endContainer,endOffset)),startContainer==endContainer)return callback(exclude([startContainer]));for(ancestor=dom.findCommonAncestor(startContainer,endContainer),node=startContainer;node;node=node.parentNode){if(node===endContainer)return walkBoundary(startContainer,ancestor,!0);if(node===ancestor)break}for(node=endContainer;node;node=node.parentNode){if(node===startContainer)return walkBoundary(endContainer,ancestor);if(node===ancestor)break}startPoint=findEndPoint(startContainer,ancestor)||startContainer,endPoint=findEndPoint(endContainer,ancestor)||endContainer,walkBoundary(startContainer,startPoint,!0),siblings=collectSiblings(startPoint==startContainer?startPoint:startPoint.nextSibling,"nextSibling",endPoint==endContainer?endPoint.nextSibling:endPoint),siblings.length&&callback(exclude(siblings)),walkBoundary(endContainer,endPoint)},this.split=function(rng){function splitText(node,offset){return node.splitText(offset)}var startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;return startContainer==endContainer&&3==startContainer.nodeType?startOffset>0&&startOffset<startContainer.nodeValue.length&&(endContainer=splitText(startContainer,startOffset),startContainer=endContainer.previousSibling,endOffset>startOffset?(endOffset-=startOffset,startContainer=endContainer=splitText(endContainer,endOffset).previousSibling,endOffset=endContainer.nodeValue.length,startOffset=0):endOffset=0):(3==startContainer.nodeType&&startOffset>0&&startOffset<startContainer.nodeValue.length&&(startContainer=splitText(startContainer,startOffset),startOffset=0),3==endContainer.nodeType&&endOffset>0&&endOffset<endContainer.nodeValue.length&&(endContainer=splitText(endContainer,endOffset).previousSibling,endOffset=endContainer.nodeValue.length)),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}},this.normalize=function(rng){function normalizeEndPoint(start){function isTableCell(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}function hasBrBeforeAfter(node,left){for(var walker=new TreeWalker(node,dom.getParent(node.parentNode,dom.isBlock)||body);node=walker[left?"prev":"next"]();)if("BR"===node.nodeName)return!0}function hasContentEditableFalseParent(node){for(;node&&node!=body;){if(isContentEditableFalse(node))return!0;node=node.parentNode}return!1}function isPrevNode(node,name){return node.previousSibling&&node.previousSibling.nodeName==name}function findTextNodeRelative(left,startNode){var walker,lastInlineElement,parentBlockContainer;if(startNode=startNode||container,parentBlockContainer=dom.getParent(startNode.parentNode,dom.isBlock)||body,left&&"BR"==startNode.nodeName&&isAfterNode&&dom.isEmpty(parentBlockContainer))return container=startNode.parentNode,offset=dom.nodeIndex(startNode),void(normalized=!0);for(walker=new TreeWalker(startNode,parentBlockContainer);node=walker[left?"prev":"next"]();){if("false"===dom.getContentEditableParent(node)||isCaretContainer(node))return;if(3===node.nodeType&&node.nodeValue.length>0)return container=node,offset=left?node.nodeValue.length:0,void(normalized=!0);if(dom.isBlock(node)||nonEmptyElementsMap[node.nodeName.toLowerCase()])return;lastInlineElement=node}collapsed&&lastInlineElement&&(container=lastInlineElement,normalized=!0,offset=0)}var container,offset,walker,node,nonEmptyElementsMap,directionLeft,isAfterNode,body=dom.getRoot();if(container=rng[(start?"start":"end")+"Container"],offset=rng[(start?"start":"end")+"Offset"],isAfterNode=1==container.nodeType&&offset===container.childNodes.length,nonEmptyElementsMap=dom.schema.getNonEmptyElements(),directionLeft=start,!isCaretContainer(container)){if(1==container.nodeType&&offset>container.childNodes.length-1&&(directionLeft=!1),9===container.nodeType&&(container=dom.getRoot(),offset=0),container===body){if(directionLeft&&(node=container.childNodes[offset>0?offset-1:0])){if(isCaretContainer(node))return;if(nonEmptyElementsMap[node.nodeName]||"TABLE"==node.nodeName)return}if(container.hasChildNodes()){if(offset=Math.min(!directionLeft&&offset>0?offset-1:offset,container.childNodes.length-1),container=container.childNodes[offset],offset=0,hasContentEditableFalseParent(container)||isCaretContainer(container))return;if(container.hasChildNodes()&&!/TABLE/.test(container.nodeName)){node=container,walker=new TreeWalker(container,body);do{if(isContentEditableFalse(node)||isCaretContainer(node)){normalized=!1;break}if(3===node.nodeType&&node.nodeValue.length>0){offset=directionLeft?0:node.nodeValue.length,container=node,normalized=!0;break}if(nonEmptyElementsMap[node.nodeName.toLowerCase()]&&!isTableCell(node)){offset=dom.nodeIndex(node),container=node.parentNode,"IMG"!=node.nodeName||directionLeft||offset++,normalized=!0;break}}while(node=directionLeft?walker.next():walker.prev())}}}collapsed&&(3===container.nodeType&&0===offset&&findTextNodeRelative(!0),1===container.nodeType&&(node=container.childNodes[offset],
node||(node=container.childNodes[offset-1]),!node||"BR"!==node.nodeName||isPrevNode(node,"A")||hasBrBeforeAfter(node)||hasBrBeforeAfter(node,!0)||findTextNodeRelative(!0,node))),directionLeft&&!collapsed&&3===container.nodeType&&offset===container.nodeValue.length&&findTextNodeRelative(!1),normalized&&rng["set"+(start?"Start":"End")](container,offset)}}var normalized,collapsed;return collapsed=rng.collapsed,normalizeEndPoint(!0),collapsed||normalizeEndPoint(),normalized&&collapsed&&rng.collapse(!0),normalized}}function findClosestIeRange(clientX,clientY,doc){var element,rng,rects;if(element=doc.elementFromPoint(clientX,clientY),rng=doc.body.createTextRange(),"HTML"==element.tagName&&(element=doc.body),rng.moveToElementText(element),rects=Tools.toArray(rng.getClientRects()),rects=rects.sort(function(a,b){return a=Math.abs(Math.max(a.top-clientY,a.bottom-clientY)),b=Math.abs(Math.max(b.top-clientY,b.bottom-clientY)),a-b}),rects.length>0){clientY=(rects[0].bottom+rects[0].top)/2;try{return rng.moveToPoint(clientX,clientY),rng.collapse(!0),rng}catch(ex){}}return null}var each=Tools.each,isContentEditableFalse=NodeType.isContentEditableFalse,isCaretContainer=CaretContainer.isCaretContainer;return RangeUtils.compareRanges=function(rng1,rng2){if(rng1&&rng2){if(!rng1.item&&!rng1.duplicate)return rng1.startContainer==rng2.startContainer&&rng1.startOffset==rng2.startOffset;if(rng1.item&&rng2.item&&rng1.item(0)===rng2.item(0))return!0;if(rng1.isEqual&&rng2.isEqual&&rng2.isEqual(rng1))return!0}return!1},RangeUtils.getCaretRangeFromPoint=function(clientX,clientY,doc){var rng,point;if(doc.caretPositionFromPoint)point=doc.caretPositionFromPoint(clientX,clientY),rng=doc.createRange(),rng.setStart(point.offsetNode,point.offset),rng.collapse(!0);else if(doc.caretRangeFromPoint)rng=doc.caretRangeFromPoint(clientX,clientY);else if(doc.body.createTextRange){rng=doc.body.createTextRange();try{rng.moveToPoint(clientX,clientY),rng.collapse(!0)}catch(ex){rng=findClosestIeRange(clientX,clientY,doc)}}return rng},RangeUtils.getSelectedNode=function(range){var startContainer=range.startContainer,startOffset=range.startOffset;return startContainer.hasChildNodes()&&range.endOffset==startOffset+1?startContainer.childNodes[startOffset]:null},RangeUtils.getNode=function(container,offset){return 1==container.nodeType&&container.hasChildNodes()&&(offset>=container.childNodes.length&&(offset=container.childNodes.length-1),container=container.childNodes[offset]),container},RangeUtils}),define("tinymce/NodeChange",["tinymce/dom/RangeUtils","tinymce/Env","tinymce/util/Delay"],function(RangeUtils,Env,Delay){return function(editor){function isSameElementPath(startElm){var i,currentPath;if(currentPath=editor.$(startElm).parentsUntil(editor.getBody()).add(startElm),currentPath.length===lastPath.length){for(i=currentPath.length;i>=0&&currentPath[i]===lastPath[i];i--);if(i===-1)return lastPath=currentPath,!0}return lastPath=currentPath,!1}var lastRng,lastPath=[];"onselectionchange"in editor.getDoc()||editor.on("NodeChange Click MouseUp KeyUp Focus",function(e){var nativeRng,fakeRng;nativeRng=editor.selection.getRng(),fakeRng={startContainer:nativeRng.startContainer,startOffset:nativeRng.startOffset,endContainer:nativeRng.endContainer,endOffset:nativeRng.endOffset},"nodechange"!=e.type&&RangeUtils.compareRanges(fakeRng,lastRng)||editor.fire("SelectionChange"),lastRng=fakeRng}),editor.on("contextmenu",function(){editor.fire("SelectionChange")}),editor.on("SelectionChange",function(){var startElm=editor.selection.getStart(!0);!Env.range&&editor.selection.isCollapsed()||!isSameElementPath(startElm)&&editor.dom.isChildOf(startElm,editor.getBody())&&editor.nodeChanged({selectionChange:!0})}),editor.on("MouseUp",function(e){e.isDefaultPrevented()||("IMG"==editor.selection.getNode().nodeName?Delay.setEditorTimeout(editor,function(){editor.nodeChanged()}):editor.nodeChanged())}),this.nodeChanged=function(args){var node,parents,root,selection=editor.selection;editor.initialized&&selection&&!editor.settings.disable_nodechange&&!editor.readonly&&(root=editor.getBody(),node=selection.getStart()||root,node.ownerDocument==editor.getDoc()&&editor.dom.isChildOf(node,root)||(node=root),"IMG"==node.nodeName&&selection.isCollapsed()&&(node=node.parentNode),parents=[],editor.dom.getParent(node,function(node){return node===root||void parents.push(node)}),args=args||{},args.element=node,args.parents=parents,editor.fire("NodeChange",args))}}}),define("tinymce/html/Node",[],function(){function walk(node,root_node,prev){var sibling,parent,startName=prev?"lastChild":"firstChild",siblingName=prev?"prev":"next";if(node[startName])return node[startName];if(node!==root_node){if(sibling=node[siblingName])return sibling;for(parent=node.parent;parent&&parent!==root_node;parent=parent.parent)if(sibling=parent[siblingName])return sibling}}function Node(name,type){this.name=name,this.type=type,1===type&&(this.attributes=[],this.attributes.map={})}var whiteSpaceRegExp=/^[ \t\r\n]*$/,typeLookup={"#text":3,"#comment":8,"#cdata":4,"#pi":7,"#doctype":10,"#document-fragment":11};return Node.prototype={replace:function(node){var self=this;return node.parent&&node.remove(),self.insert(node,self),self.remove(),self},attr:function(name,value){var attrs,i,undef,self=this;if("string"!=typeof name){for(i in name)self.attr(i,name[i]);return self}if(attrs=self.attributes){if(value!==undef){if(null===value){if(name in attrs.map)for(delete attrs.map[name],i=attrs.length;i--;)if(attrs[i].name===name)return attrs=attrs.splice(i,1),self;return self}if(name in attrs.map){for(i=attrs.length;i--;)if(attrs[i].name===name){attrs[i].value=value;break}}else attrs.push({name:name,value:value});return attrs.map[name]=value,self}return attrs.map[name]}},clone:function(){var i,l,selfAttrs,selfAttr,cloneAttrs,self=this,clone=new Node(self.name,self.type);if(selfAttrs=self.attributes){for(cloneAttrs=[],cloneAttrs.map={},i=0,l=selfAttrs.length;i<l;i++)selfAttr=selfAttrs[i],"id"!==selfAttr.name&&(cloneAttrs[cloneAttrs.length]={name:selfAttr.name,value:selfAttr.value},cloneAttrs.map[selfAttr.name]=selfAttr.value);clone.attributes=cloneAttrs}return clone.value=self.value,clone.shortEnded=self.shortEnded,clone},wrap:function(wrapper){var self=this;return self.parent.insert(wrapper,self),wrapper.append(self),self},unwrap:function(){var node,next,self=this;for(node=self.firstChild;node;)next=node.next,self.insert(node,self,!0),node=next;self.remove()},remove:function(){var self=this,parent=self.parent,next=self.next,prev=self.prev;return parent&&(parent.firstChild===self?(parent.firstChild=next,next&&(next.prev=null)):prev.next=next,parent.lastChild===self?(parent.lastChild=prev,prev&&(prev.next=null)):next.prev=prev,self.parent=self.next=self.prev=null),self},append:function(node){var last,self=this;return node.parent&&node.remove(),last=self.lastChild,last?(last.next=node,node.prev=last,self.lastChild=node):self.lastChild=self.firstChild=node,node.parent=self,node},insert:function(node,ref_node,before){var parent;return node.parent&&node.remove(),parent=ref_node.parent||this,before?(ref_node===parent.firstChild?parent.firstChild=node:ref_node.prev.next=node,node.prev=ref_node.prev,node.next=ref_node,ref_node.prev=node):(ref_node===parent.lastChild?parent.lastChild=node:ref_node.next.prev=node,node.next=ref_node.next,node.prev=ref_node,ref_node.next=node),node.parent=parent,node},getAll:function(name){var node,self=this,collection=[];for(node=self.firstChild;node;node=walk(node,self))node.name===name&&collection.push(node);return collection},empty:function(){var nodes,i,node,self=this;if(self.firstChild){for(nodes=[],node=self.firstChild;node;node=walk(node,self))nodes.push(node);for(i=nodes.length;i--;)node=nodes[i],node.parent=node.firstChild=node.lastChild=node.next=node.prev=null}return self.firstChild=self.lastChild=null,self},isEmpty:function(elements){var i,name,self=this,node=self.firstChild;if(node)do{if(1===node.type){if(node.attributes.map["data-mce-bogus"])continue;if(elements[node.name])return!1;for(i=node.attributes.length;i--;)if(name=node.attributes[i].name,"name"===name||0===name.indexOf("data-mce-bookmark"))return!1}if(8===node.type)return!1;if(3===node.type&&!whiteSpaceRegExp.test(node.value))return!1}while(node=walk(node,self));return!0},walk:function(prev){return walk(this,null,prev)}},Node.create=function(name,attrs){var node,attrName;if(node=new Node(name,typeLookup[name]||1),attrs)for(attrName in attrs)node.attr(attrName,attrs[attrName]);return node},Node}),define("tinymce/html/Schema",["tinymce/util/Tools"],function(Tools){function split(items,delim){return items?items.split(delim||" "):[]}function compileSchema(type){function add(name,attributes,children){function arrayToMap(array,obj){var i,l,map={};for(i=0,l=array.length;i<l;i++)map[array[i]]=obj||{};return map}var ni,i,attributesOrder,args=arguments;for(children=children||[],attributes=attributes||"","string"==typeof children&&(children=split(children)),i=3;i<args.length;i++)"string"==typeof args[i]&&(args[i]=split(args[i])),children.push.apply(children,args[i]);for(name=split(name),ni=name.length;ni--;)attributesOrder=[].concat(globalAttributes,split(attributes)),schema[name[ni]]={attributes:arrayToMap(attributesOrder),attributesOrder:attributesOrder,children:arrayToMap(children,dummyObj)}}function addAttrs(name,attributes){var ni,schemaItem,i,l;for(name=split(name),ni=name.length,attributes=split(attributes);ni--;)for(schemaItem=schema[name[ni]],i=0,l=attributes.length;i<l;i++)schemaItem.attributes[attributes[i]]={},schemaItem.attributesOrder.push(attributes[i])}var globalAttributes,blockContent,phrasingContent,flowContent,html4BlockContent,html4PhrasingContent,schema={};return mapCache[type]?mapCache[type]:(globalAttributes=split("id accesskey class dir lang style tabindex title"),blockContent=split("address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul"),phrasingContent=split("a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd label map noscript object q s samp script select small span strong sub sup textarea u var #text #comment"),"html4"!=type&&(globalAttributes.push.apply(globalAttributes,split("contenteditable contextmenu draggable dropzone hidden spellcheck translate")),blockContent.push.apply(blockContent,split("article aside details dialog figure header footer hgroup section nav")),phrasingContent.push.apply(phrasingContent,split("audio canvas command datalist mark meter output picture progress time wbr video ruby bdi keygen"))),"html5-strict"!=type&&(globalAttributes.push("xml:lang"),html4PhrasingContent=split("acronym applet basefont big font strike tt"),phrasingContent.push.apply(phrasingContent,html4PhrasingContent),each(html4PhrasingContent,function(name){add(name,"",phrasingContent)}),html4BlockContent=split("center dir isindex noframes"),blockContent.push.apply(blockContent,html4BlockContent),flowContent=[].concat(blockContent,phrasingContent),each(html4BlockContent,function(name){add(name,"",flowContent)})),flowContent=flowContent||[].concat(blockContent,phrasingContent),add("html","manifest","head body"),add("head","","base command link meta noscript script style title"),add("title hr noscript br"),add("base","href target"),add("link","href rel media hreflang type sizes hreflang"),add("meta","name http-equiv content charset"),add("style","media type scoped"),add("script","src async defer type charset"),add("body","onafterprint onbeforeprint onbeforeunload onblur onerror onfocus onhashchange onload onmessage onoffline ononline onpagehide onpageshow onpopstate onresize onscroll onstorage onunload",flowContent),add("address dt dd div caption","",flowContent),add("h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn","",phrasingContent),add("blockquote","cite",flowContent),add("ol","reversed start type","li"),add("ul","","li"),add("li","value",flowContent),add("dl","","dt dd"),add("a","href target rel media hreflang type",phrasingContent),add("q","cite",phrasingContent),add("ins del","cite datetime",flowContent),add("img","src sizes srcset alt usemap ismap width height"),add("iframe","src name width height",flowContent),add("embed","src type width height"),add("object","data type typemustmatch name usemap form width height",flowContent,"param"),add("param","name value"),add("map","name",flowContent,"area"),add("area","alt coords shape href target rel media hreflang type"),add("table","border","caption colgroup thead tfoot tbody tr"+("html4"==type?" col":"")),add("colgroup","span","col"),add("col","span"),add("tbody thead tfoot","","tr"),add("tr","","td th"),add("td","colspan rowspan headers",flowContent),add("th","colspan rowspan headers scope abbr",flowContent),add("form","accept-charset action autocomplete enctype method name novalidate target",flowContent),add("fieldset","disabled form name",flowContent,"legend"),add("label","form for",phrasingContent),add("input","accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate formtarget height list max maxlength min multiple name pattern readonly required size src step type value width"),add("button","disabled form formaction formenctype formmethod formnovalidate formtarget name type value","html4"==type?flowContent:phrasingContent),add("select","disabled form multiple name required size","option optgroup"),add("optgroup","disabled label","option"),add("option","disabled label selected value"),add("textarea","cols dirname disabled form maxlength name readonly required rows wrap"),add("menu","type label",flowContent,"li"),add("noscript","",flowContent),"html4"!=type&&(add("wbr"),add("ruby","",phrasingContent,"rt rp"),add("figcaption","",flowContent),add("mark rt rp summary bdi","",phrasingContent),add("canvas","width height",flowContent),add("video","src crossorigin poster preload autoplay mediagroup loop muted controls width height buffered",flowContent,"track source"),add("audio","src crossorigin preload autoplay mediagroup loop muted controls buffered volume",flowContent,"track source"),add("picture","","img source"),add("source","src srcset type media sizes"),add("track","kind src srclang label default"),add("datalist","",phrasingContent,"option"),add("article section nav aside header footer","",flowContent),add("hgroup","","h1 h2 h3 h4 h5 h6"),add("figure","",flowContent,"figcaption"),add("time","datetime",phrasingContent),add("dialog","open",flowContent),add("command","type label icon disabled checked radiogroup command"),add("output","for form name",phrasingContent),add("progress","value max",phrasingContent),add("meter","value min max low high optimum",phrasingContent),add("details","open",flowContent,"summary"),add("keygen","autofocus challenge disabled form keytype name")),"html5-strict"!=type&&(addAttrs("script","language xml:space"),addAttrs("style","xml:space"),addAttrs("object","declare classid code codebase codetype archive standby align border hspace vspace"),addAttrs("embed","align name hspace vspace"),addAttrs("param","valuetype type"),addAttrs("a","charset name rev shape coords"),addAttrs("br","clear"),addAttrs("applet","codebase archive code object alt name width height align hspace vspace"),addAttrs("img","name longdesc align border hspace vspace"),addAttrs("iframe","longdesc frameborder marginwidth marginheight scrolling align"),addAttrs("font basefont","size color face"),addAttrs("input","usemap align"),addAttrs("select","onchange"),addAttrs("textarea"),addAttrs("h1 h2 h3 h4 h5 h6 div p legend caption","align"),addAttrs("ul","type compact"),addAttrs("li","type"),addAttrs("ol dl menu dir","compact"),addAttrs("pre","width xml:space"),addAttrs("hr","align noshade size width"),addAttrs("isindex","prompt"),addAttrs("table","summary width frame rules cellspacing cellpadding align bgcolor"),addAttrs("col","width align char charoff valign"),addAttrs("colgroup","width align char charoff valign"),addAttrs("thead","align char charoff valign"),addAttrs("tr","align char charoff valign bgcolor"),addAttrs("th","axis align char charoff valign nowrap bgcolor width height"),addAttrs("form","accept"),addAttrs("td","abbr axis scope align char charoff valign nowrap bgcolor width height"),addAttrs("tfoot","align char charoff valign"),addAttrs("tbody","align char charoff valign"),addAttrs("area","nohref"),addAttrs("body","background bgcolor text link vlink alink")),"html4"!=type&&(addAttrs("input button select textarea","autofocus"),addAttrs("input textarea","placeholder"),addAttrs("a","download"),addAttrs("link script img","crossorigin"),addAttrs("iframe","sandbox seamless allowfullscreen")),each(split("a form meter progress dfn"),function(name){schema[name]&&delete schema[name].children[name]}),delete schema.caption.children.table,delete schema.script,mapCache[type]=schema,schema)}function compileElementMap(value,mode){var styles;return value&&(styles={},"string"==typeof value&&(value={"*":value}),each(value,function(value,key){styles[key]=styles[key.toUpperCase()]="map"==mode?makeMap(value,/[, ]/):explode(value,/[, ]/)})),styles}var mapCache={},dummyObj={},makeMap=Tools.makeMap,each=Tools.each,extend=Tools.extend,explode=Tools.explode,inArray=Tools.inArray;return function(settings){function createLookupTable(option,default_value,extendWith){var value=settings[option];return value?value=makeMap(value,/[, ]/,makeMap(value.toUpperCase(),/[, ]/)):(value=mapCache[option],value||(value=makeMap(default_value," ",makeMap(default_value.toUpperCase()," ")),value=extend(value,extendWith),mapCache[option]=value)),value}function patternToRegExp(str){return new RegExp("^"+str.replace(/([?+*])/g,".$1")+"$")}function addValidElements(validElements){var ei,el,ai,al,matches,element,attr,attrData,elementName,attrName,attrType,attributes,attributesOrder,prefix,outputName,globalAttributes,globalAttributesOrder,key,value,elementRuleRegExp=/^([#+\-])?([^\[!\/]+)(?:\/([^\[!]+))?(?:(!?)\[([^\]]+)\])?$/,attrRuleRegExp=/^([!\-])?(\w+::\w+|[^=:<]+)?(?:([=:<])(.*))?$/,hasPatternsRegExp=/[*?+]/;if(validElements)for(validElements=split(validElements,","),elements["@"]&&(globalAttributes=elements["@"].attributes,globalAttributesOrder=elements["@"].attributesOrder),ei=0,el=validElements.length;ei<el;ei++)if(matches=elementRuleRegExp.exec(validElements[ei])){if(prefix=matches[1],elementName=matches[2],outputName=matches[3],attrData=matches[5],attributes={},attributesOrder=[],element={attributes:attributes,attributesOrder:attributesOrder},"#"===prefix&&(element.paddEmpty=!0),"-"===prefix&&(element.removeEmpty=!0),"!"===matches[4]&&(element.removeEmptyAttrs=!0),globalAttributes){for(key in globalAttributes)attributes[key]=globalAttributes[key];attributesOrder.push.apply(attributesOrder,globalAttributesOrder)}if(attrData)for(attrData=split(attrData,"|"),ai=0,al=attrData.length;ai<al;ai++)if(matches=attrRuleRegExp.exec(attrData[ai])){if(attr={},attrType=matches[1],attrName=matches[2].replace(/::/g,":"),prefix=matches[3],value=matches[4],"!"===attrType&&(element.attributesRequired=element.attributesRequired||[],element.attributesRequired.push(attrName),attr.required=!0),"-"===attrType){delete attributes[attrName],attributesOrder.splice(inArray(attributesOrder,attrName),1);continue}prefix&&("="===prefix&&(element.attributesDefault=element.attributesDefault||[],element.attributesDefault.push({name:attrName,value:value}),attr.defaultValue=value),":"===prefix&&(element.attributesForced=element.attributesForced||[],element.attributesForced.push({name:attrName,value:value}),attr.forcedValue=value),"<"===prefix&&(attr.validValues=makeMap(value,"?"))),hasPatternsRegExp.test(attrName)?(element.attributePatterns=element.attributePatterns||[],attr.pattern=patternToRegExp(attrName),element.attributePatterns.push(attr)):(attributes[attrName]||attributesOrder.push(attrName),attributes[attrName]=attr)}globalAttributes||"@"!=elementName||(globalAttributes=attributes,globalAttributesOrder=attributesOrder),outputName&&(element.outputName=elementName,elements[outputName]=element),hasPatternsRegExp.test(elementName)?(element.pattern=patternToRegExp(elementName),patternElements.push(element)):elements[elementName]=element}}function setValidElements(validElements){elements={},patternElements=[],addValidElements(validElements),each(schemaItems,function(element,name){children[name]=element.children})}function addCustomElements(customElements){var customElementRegExp=/^(~)?(.+)$/;customElements&&(mapCache.text_block_elements=mapCache.block_elements=null,each(split(customElements,","),function(rule){var matches=customElementRegExp.exec(rule),inline="~"===matches[1],cloneName=inline?"span":"div",name=matches[2];if(children[name]=children[cloneName],customElementsMap[name]=cloneName,inline||(blockElementsMap[name.toUpperCase()]={},blockElementsMap[name]={}),!elements[name]){var customRule=elements[cloneName];customRule=extend({},customRule),delete customRule.removeEmptyAttrs,delete customRule.removeEmpty,elements[name]=customRule}each(children,function(element,elmName){element[cloneName]&&(children[elmName]=element=extend({},children[elmName]),element[name]=element[cloneName])})}))}function addValidChildren(validChildren){var childRuleRegExp=/^([+\-]?)(\w+)\[([^\]]+)\]$/;mapCache[settings.schema]=null,validChildren&&each(split(validChildren,","),function(rule){var parent,prefix,matches=childRuleRegExp.exec(rule);matches&&(prefix=matches[1],parent=prefix?children[matches[2]]:children[matches[2]]={"#comment":{}},parent=children[matches[2]],each(split(matches[3],"|"),function(child){"-"===prefix?delete parent[child]:parent[child]={}}))})}function getElementRule(name){var i,element=elements[name];if(element)return element;for(i=patternElements.length;i--;)if(element=patternElements[i],element.pattern.test(name))return element}var validStyles,invalidStyles,schemaItems,whiteSpaceElementsMap,selfClosingElementsMap,shortEndedElementsMap,boolAttrMap,validClasses,blockElementsMap,nonEmptyElementsMap,moveCaretBeforeOnEnterElementsMap,textBlockElementsMap,textInlineElementsMap,self=this,elements={},children={},patternElements=[],customElementsMap={},specialElements={};settings=settings||{},schemaItems=compileSchema(settings.schema),settings.verify_html===!1&&(settings.valid_elements="*[*]"),validStyles=compileElementMap(settings.valid_styles),invalidStyles=compileElementMap(settings.invalid_styles,"map"),validClasses=compileElementMap(settings.valid_classes,"map"),whiteSpaceElementsMap=createLookupTable("whitespace_elements","pre script noscript style textarea video audio iframe object"),selfClosingElementsMap=createLookupTable("self_closing_elements","colgroup dd dt li option p td tfoot th thead tr"),shortEndedElementsMap=createLookupTable("short_ended_elements","area base basefont br col frame hr img input isindex link meta param embed source wbr track"),boolAttrMap=createLookupTable("boolean_attributes","checked compact declare defer disabled ismap multiple nohref noresize noshade nowrap readonly selected autoplay loop controls"),nonEmptyElementsMap=createLookupTable("non_empty_elements","td th iframe video audio object script",shortEndedElementsMap),moveCaretBeforeOnEnterElementsMap=createLookupTable("move_caret_before_on_enter_elements","table",nonEmptyElementsMap),textBlockElementsMap=createLookupTable("text_block_elements","h1 h2 h3 h4 h5 h6 p div address pre form blockquote center dir fieldset header footer article section hgroup aside nav figure"),blockElementsMap=createLookupTable("block_elements","hr table tbody thead tfoot th tr td li ol ul caption dl dt dd noscript menu isindex option datalist select optgroup figcaption",textBlockElementsMap),textInlineElementsMap=createLookupTable("text_inline_elements","span strong b em i font strike u var cite dfn code mark q sup sub samp"),each((settings.special||"script noscript style textarea").split(" "),function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")}),settings.valid_elements?setValidElements(settings.valid_elements):(each(schemaItems,function(element,name){elements[name]={attributes:element.attributes,attributesOrder:element.attributesOrder},children[name]=element.children}),"html5"!=settings.schema&&each(split("strong/b em/i"),function(item){item=split(item,"/"),elements[item[1]].outputName=item[0]}),each(split("ol ul sub sup blockquote span font a table tbody tr strong em b i"),function(name){elements[name]&&(elements[name].removeEmpty=!0)}),each(split("p h1 h2 h3 h4 h5 h6 th td pre div address caption"),function(name){elements[name].paddEmpty=!0}),each(split("span"),function(name){elements[name].removeEmptyAttrs=!0})),addCustomElements(settings.custom_elements),addValidChildren(settings.valid_children),addValidElements(settings.extended_valid_elements),addValidChildren("+ol[ul|ol],+ul[ul|ol]"),settings.invalid_elements&&each(explode(settings.invalid_elements),function(item){elements[item]&&delete elements[item]}),getElementRule("span")||addValidElements("span[!data-mce-type|*]"),self.children=children,self.getValidStyles=function(){return validStyles},self.getInvalidStyles=function(){return invalidStyles},self.getValidClasses=function(){return validClasses},self.getBoolAttrs=function(){return boolAttrMap},self.getBlockElements=function(){return blockElementsMap},self.getTextBlockElements=function(){return textBlockElementsMap},self.getTextInlineElements=function(){return textInlineElementsMap},self.getShortEndedElements=function(){return shortEndedElementsMap},self.getSelfClosingElements=function(){return selfClosingElementsMap},self.getNonEmptyElements=function(){return nonEmptyElementsMap},self.getMoveCaretBeforeOnEnterElements=function(){return moveCaretBeforeOnEnterElementsMap},self.getWhiteSpaceElements=function(){return whiteSpaceElementsMap},self.getSpecialElements=function(){return specialElements},self.isValidChild=function(name,child){var parent=children[name];return!(!parent||!parent[child])},self.isValid=function(name,attr){var attrPatterns,i,rule=getElementRule(name);if(rule){if(!attr)return!0;if(rule.attributes[attr])return!0;if(attrPatterns=rule.attributePatterns)for(i=attrPatterns.length;i--;)if(attrPatterns[i].pattern.test(name))return!0}return!1},self.getElementRule=getElementRule,self.getCustomElements=function(){return customElementsMap},self.addValidElements=addValidElements,self.setValidElements=setValidElements,self.addCustomElements=addCustomElements,self.addValidChildren=addValidChildren,self.elements=elements}}),define("tinymce/html/SaxParser",["tinymce/html/Schema","tinymce/html/Entities","tinymce/util/Tools"],function(Schema,Entities,Tools){function findEndTag(schema,html,startIndex){var index,matches,tokenRegExp,shortEndedElements,count=1;for(shortEndedElements=schema.getShortEndedElements(),tokenRegExp=/<([!?\/])?([A-Za-z0-9\-_\:\.]+)((?:\s+[^"\'>]+(?:(?:"[^"]*")|(?:\'[^\']*\')|[^>]*))*|\/|\s+)>/g,tokenRegExp.lastIndex=index=startIndex;matches=tokenRegExp.exec(html);){if(index=tokenRegExp.lastIndex,"/"===matches[1])count--;else if(!matches[1]){if(matches[2]in shortEndedElements)continue;count++}if(0===count)break}return index}function SaxParser(settings,schema){function noop(){}var self=this;settings=settings||{},self.schema=schema=schema||new Schema,settings.fix_self_closing!==!1&&(settings.fix_self_closing=!0),each("comment cdata text start end pi doctype".split(" "),function(name){name&&(self[name]=settings[name]||noop)}),self.parse=function(html){function processEndTag(name){var pos,i;for(pos=stack.length;pos--&&stack[pos].name!==name;);if(pos>=0){for(i=stack.length-1;i>=pos;i--)name=stack[i],name.valid&&self.end(name.name);stack.length=pos}}function parseAttribute(match,name,value,val2,val3){var attrRule,i,trimRegExp=/[\s\u0000-\u001F]+/g;if(name=name.toLowerCase(),value=name in fillAttrsMap?name:decode(value||val2||val3||""),validate&&!isInternalElement&&0!==name.indexOf("data-")){if(attrRule=validAttributesMap[name],!attrRule&&validAttributePatterns){for(i=validAttributePatterns.length;i--&&(attrRule=validAttributePatterns[i],!attrRule.pattern.test(name)););i===-1&&(attrRule=null)}if(!attrRule)return;if(attrRule.validValues&&!(value in attrRule.validValues))return}if(filteredUrlAttrs[name]&&!settings.allow_script_urls){var uri=value.replace(trimRegExp,"");try{uri=decodeURIComponent(uri)}catch(ex){uri=unescape(uri)}if(scriptUriRegExp.test(uri))return;if(!settings.allow_html_data_urls&&dataUriRegExp.test(uri)&&!/^data:image\//i.test(uri))return}attrList.map[name]=value,attrList.push({name:name,value:value})}var matches,value,endRegExp,attrList,i,text,name,isInternalElement,removeInternalElements,shortEndedElements,fillAttrsMap,isShortEnded,validate,elementRule,isValidElement,attr,attribsValue,validAttributesMap,validAttributePatterns,attributesRequired,attributesDefault,attributesForced,anyAttributesRequired,selfClosing,tokenRegExp,attrRegExp,specialElements,attrValue,fixSelfClosing,self=this,index=0,stack=[],idCount=0,decode=Entities.decode,filteredUrlAttrs=Tools.makeMap("src,href,data,background,formaction,poster"),scriptUriRegExp=/((java|vb)script|mhtml):/i,dataUriRegExp=/^data:/i;for(tokenRegExp=new RegExp("<(?:(?:!--([\\w\\W]*?)-->)|(?:!\\[CDATA\\[([\\w\\W]*?)\\]\\]>)|(?:!DOCTYPE([\\w\\W]*?)>)|(?:\\?([^\\s\\/<>]+) ?([\\w\\W]*?)[?/]>)|(?:\\/([^>]+)>)|(?:([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"'>]+(?:(?:\"[^\"]*\")|(?:'[^']*')|[^>]*))*|\\/|\\s+)>))","g"),attrRegExp=/([\w:\-]+)(?:\s*=\s*(?:(?:\"((?:[^\"])*)\")|(?:\'((?:[^\'])*)\')|([^>\s]+)))?/g,shortEndedElements=schema.getShortEndedElements(),selfClosing=settings.self_closing_elements||schema.getSelfClosingElements(),fillAttrsMap=schema.getBoolAttrs(),validate=settings.validate,removeInternalElements=settings.remove_internals,fixSelfClosing=settings.fix_self_closing,specialElements=schema.getSpecialElements();matches=tokenRegExp.exec(html);){if(index<matches.index&&self.text(decode(html.substr(index,matches.index-index))),value=matches[6])value=value.toLowerCase(),":"===value.charAt(0)&&(value=value.substr(1)),processEndTag(value);else if(value=matches[7]){if(value=value.toLowerCase(),":"===value.charAt(0)&&(value=value.substr(1)),isShortEnded=value in shortEndedElements,fixSelfClosing&&selfClosing[value]&&stack.length>0&&stack[stack.length-1].name===value&&processEndTag(value),!validate||(elementRule=schema.getElementRule(value))){if(isValidElement=!0,validate&&(validAttributesMap=elementRule.attributes,validAttributePatterns=elementRule.attributePatterns),(attribsValue=matches[8])?(isInternalElement=attribsValue.indexOf("data-mce-type")!==-1,isInternalElement&&removeInternalElements&&(isValidElement=!1),attrList=[],attrList.map={},attribsValue.replace(attrRegExp,parseAttribute)):(attrList=[],attrList.map={}),validate&&!isInternalElement){if(attributesRequired=elementRule.attributesRequired,attributesDefault=elementRule.attributesDefault,attributesForced=elementRule.attributesForced,anyAttributesRequired=elementRule.removeEmptyAttrs,anyAttributesRequired&&!attrList.length&&(isValidElement=!1),attributesForced)for(i=attributesForced.length;i--;)attr=attributesForced[i],name=attr.name,attrValue=attr.value,"{$uid}"===attrValue&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue});if(attributesDefault)for(i=attributesDefault.length;i--;)attr=attributesDefault[i],name=attr.name,name in attrList.map||(attrValue=attr.value,"{$uid}"===attrValue&&(attrValue="mce_"+idCount++),attrList.map[name]=attrValue,attrList.push({name:name,value:attrValue}));if(attributesRequired){for(i=attributesRequired.length;i--&&!(attributesRequired[i]in attrList.map););i===-1&&(isValidElement=!1)}if(attr=attrList.map["data-mce-bogus"]){if("all"===attr){index=findEndTag(schema,html,tokenRegExp.lastIndex),tokenRegExp.lastIndex=index;continue}isValidElement=!1}}isValidElement&&self.start(value,attrList,isShortEnded)}else isValidElement=!1;if(endRegExp=specialElements[value]){endRegExp.lastIndex=index=matches.index+matches[0].length,
(matches=endRegExp.exec(html))?(isValidElement&&(text=html.substr(index,matches.index-index)),index=matches.index+matches[0].length):(text=html.substr(index),index=html.length),isValidElement&&(text.length>0&&self.text(text,!0),self.end(value)),tokenRegExp.lastIndex=index;continue}isShortEnded||(attribsValue&&attribsValue.indexOf("/")==attribsValue.length-1?isValidElement&&self.end(value):stack.push({name:value,valid:isValidElement}))}else(value=matches[1])?(">"===value.charAt(0)&&(value=" "+value),settings.allow_conditional_comments||"[if"!==value.substr(0,3)||(value=" "+value),self.comment(value)):(value=matches[2])?self.cdata(value):(value=matches[3])?self.doctype(value):(value=matches[4])&&self.pi(value,matches[5]);index=matches.index+matches[0].length}for(index<html.length&&self.text(decode(html.substr(index))),i=stack.length-1;i>=0;i--)value=stack[i],value.valid&&self.end(value.name)}}var each=Tools.each;return SaxParser.findEndTag=findEndTag,SaxParser}),define("tinymce/html/DomParser",["tinymce/html/Node","tinymce/html/Schema","tinymce/html/SaxParser","tinymce/util/Tools"],function(Node,Schema,SaxParser,Tools){var makeMap=Tools.makeMap,each=Tools.each,explode=Tools.explode,extend=Tools.extend;return function(settings,schema){function fixInvalidChildren(nodes){var ni,node,parent,parents,newParent,currentNode,tempNode,childNode,i,nonEmptyElements,nonSplitableElements,textBlockElements,specialElements,sibling,nextNode;for(nonSplitableElements=makeMap("tr,td,th,tbody,thead,tfoot,table"),nonEmptyElements=schema.getNonEmptyElements(),textBlockElements=schema.getTextBlockElements(),specialElements=schema.getSpecialElements(),ni=0;ni<nodes.length;ni++)if(node=nodes[ni],node.parent&&!node.fixed)if(textBlockElements[node.name]&&"li"==node.parent.name){for(sibling=node.next;sibling&&textBlockElements[sibling.name];)sibling.name="li",sibling.fixed=!0,node.parent.insert(sibling,node.parent),sibling=sibling.next;node.unwrap(node)}else{for(parents=[node],parent=node.parent;parent&&!schema.isValidChild(parent.name,node.name)&&!nonSplitableElements[parent.name];parent=parent.parent)parents.push(parent);if(parent&&parents.length>1){for(parents.reverse(),newParent=currentNode=self.filterNode(parents[0].clone()),i=0;i<parents.length-1;i++){for(schema.isValidChild(currentNode.name,parents[i].name)?(tempNode=self.filterNode(parents[i].clone()),currentNode.append(tempNode)):tempNode=currentNode,childNode=parents[i].firstChild;childNode&&childNode!=parents[i+1];)nextNode=childNode.next,tempNode.append(childNode),childNode=nextNode;currentNode=tempNode}newParent.isEmpty(nonEmptyElements)?parent.insert(node,parents[0],!0):(parent.insert(newParent,parents[0],!0),parent.insert(node,newParent)),parent=parents[0],(parent.isEmpty(nonEmptyElements)||parent.firstChild===parent.lastChild&&"br"===parent.firstChild.name)&&parent.empty().remove()}else if(node.parent){if("li"===node.name){if(sibling=node.prev,sibling&&("ul"===sibling.name||"ul"===sibling.name)){sibling.append(node);continue}if(sibling=node.next,sibling&&("ul"===sibling.name||"ul"===sibling.name)){sibling.insert(node,sibling.firstChild,!0);continue}node.wrap(self.filterNode(new Node("ul",1)));continue}schema.isValidChild(node.parent.name,"div")&&schema.isValidChild("div",node.name)?node.wrap(self.filterNode(new Node("div",1))):specialElements[node.name]?node.empty().remove():node.unwrap()}}}var self=this,nodeFilters={},attributeFilters=[],matchedNodes={},matchedAttributes={};settings=settings||{},settings.validate=!("validate"in settings)||settings.validate,settings.root_name=settings.root_name||"body",self.schema=schema=schema||new Schema,self.filterNode=function(node){var i,name,list;name in nodeFilters&&(list=matchedNodes[name],list?list.push(node):matchedNodes[name]=[node]),i=attributeFilters.length;for(;i--;)name=attributeFilters[i].name,name in node.attributes.map&&(list=matchedAttributes[name],list?list.push(node):matchedAttributes[name]=[node]);return node},self.addNodeFilter=function(name,callback){each(explode(name),function(name){var list=nodeFilters[name];list||(nodeFilters[name]=list=[]),list.push(callback)})},self.addAttributeFilter=function(name,callback){each(explode(name),function(name){var i;for(i=0;i<attributeFilters.length;i++)if(attributeFilters[i].name===name)return void attributeFilters[i].callbacks.push(callback);attributeFilters.push({name:name,callbacks:[callback]})})},self.parse=function(html,args){function addRootBlocks(){function trim(rootBlockNode){rootBlockNode&&(node=rootBlockNode.firstChild,node&&3==node.type&&(node.value=node.value.replace(startWhiteSpaceRegExp,"")),node=rootBlockNode.lastChild,node&&3==node.type&&(node.value=node.value.replace(endWhiteSpaceRegExp,"")))}var next,rootBlockNode,node=rootNode.firstChild;if(schema.isValidChild(rootNode.name,rootBlockName.toLowerCase())){for(;node;)next=node.next,3==node.type||1==node.type&&"p"!==node.name&&!blockElements[node.name]&&!node.attr("data-mce-type")?rootBlockNode?rootBlockNode.append(node):(rootBlockNode=createNode(rootBlockName,1),rootBlockNode.attr(settings.forced_root_block_attrs),rootNode.insert(rootBlockNode,node),rootBlockNode.append(node)):(trim(rootBlockNode),rootBlockNode=null),node=next;trim(rootBlockNode)}}function createNode(name,type){var list,node=new Node(name,type);return name in nodeFilters&&(list=matchedNodes[name],list?list.push(node):matchedNodes[name]=[node]),node}function removeWhitespaceBefore(node){var textNode,textNodeNext,textVal,sibling,blockElements=schema.getBlockElements();for(textNode=node.prev;textNode&&3===textNode.type;){if(textVal=textNode.value.replace(endWhiteSpaceRegExp,""),textVal.length>0)return void(textNode.value=textVal);if(textNodeNext=textNode.next){if(3==textNodeNext.type&&textNodeNext.value.length){textNode=textNode.prev;continue}if(!blockElements[textNodeNext.name]&&"script"!=textNodeNext.name&&"style"!=textNodeNext.name){textNode=textNode.prev;continue}}sibling=textNode.prev,textNode.remove(),textNode=sibling}}function cloneAndExcludeBlocks(input){var name,output={};for(name in input)"li"!==name&&"p"!=name&&(output[name]=input[name]);return output}var parser,rootNode,node,nodes,i,l,fi,fl,list,name,validate,blockElements,startWhiteSpaceRegExp,isInWhiteSpacePreservedElement,endWhiteSpaceRegExp,allWhiteSpaceRegExp,isAllWhiteSpaceRegExp,whiteSpaceElements,children,nonEmptyElements,rootBlockName,invalidChildren=[];if(args=args||{},matchedNodes={},matchedAttributes={},blockElements=extend(makeMap("script,style,head,html,body,title,meta,param"),schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements(),children=schema.children,validate=settings.validate,rootBlockName="forced_root_block"in args?args.forced_root_block:settings.forced_root_block,whiteSpaceElements=schema.getWhiteSpaceElements(),startWhiteSpaceRegExp=/^[ \t\r\n]+/,endWhiteSpaceRegExp=/[ \t\r\n]+$/,allWhiteSpaceRegExp=/[ \t\r\n]+/g,isAllWhiteSpaceRegExp=/^[ \t\r\n]+$/,parser=new SaxParser({validate:validate,allow_script_urls:settings.allow_script_urls,allow_conditional_comments:settings.allow_conditional_comments,self_closing_elements:cloneAndExcludeBlocks(schema.getSelfClosingElements()),cdata:function(text){node.append(createNode("#cdata",4)).value=text},text:function(text,raw){var textNode;isInWhiteSpacePreservedElement||(text=text.replace(allWhiteSpaceRegExp," "),node.lastChild&&blockElements[node.lastChild.name]&&(text=text.replace(startWhiteSpaceRegExp,""))),0!==text.length&&(textNode=createNode("#text",3),textNode.raw=!!raw,node.append(textNode).value=text)},comment:function(text){node.append(createNode("#comment",8)).value=text},pi:function(name,text){node.append(createNode(name,7)).value=text,removeWhitespaceBefore(node)},doctype:function(text){var newNode;newNode=node.append(createNode("#doctype",10)),newNode.value=text,removeWhitespaceBefore(node)},start:function(name,attrs,empty){var newNode,attrFiltersLen,elementRule,attrName,parent;if(elementRule=validate?schema.getElementRule(name):{}){for(newNode=createNode(elementRule.outputName||name,1),newNode.attributes=attrs,newNode.shortEnded=empty,node.append(newNode),parent=children[node.name],parent&&children[newNode.name]&&!parent[newNode.name]&&invalidChildren.push(newNode),attrFiltersLen=attributeFilters.length;attrFiltersLen--;)attrName=attributeFilters[attrFiltersLen].name,attrName in attrs.map&&(list=matchedAttributes[attrName],list?list.push(newNode):matchedAttributes[attrName]=[newNode]);blockElements[name]&&removeWhitespaceBefore(newNode),empty||(node=newNode),!isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!0)}},end:function(name){var textNode,elementRule,text,sibling,tempNode;if(elementRule=validate?schema.getElementRule(name):{}){if(blockElements[name]&&!isInWhiteSpacePreservedElement){if(textNode=node.firstChild,textNode&&3===textNode.type)if(text=textNode.value.replace(startWhiteSpaceRegExp,""),text.length>0)textNode.value=text,textNode=textNode.next;else for(sibling=textNode.next,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.next,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling;if(textNode=node.lastChild,textNode&&3===textNode.type)if(text=textNode.value.replace(endWhiteSpaceRegExp,""),text.length>0)textNode.value=text,textNode=textNode.prev;else for(sibling=textNode.prev,textNode.remove(),textNode=sibling;textNode&&3===textNode.type;)text=textNode.value,sibling=textNode.prev,(0===text.length||isAllWhiteSpaceRegExp.test(text))&&(textNode.remove(),textNode=sibling),textNode=sibling}if(isInWhiteSpacePreservedElement&&whiteSpaceElements[name]&&(isInWhiteSpacePreservedElement=!1),(elementRule.removeEmpty||elementRule.paddEmpty)&&node.isEmpty(nonEmptyElements))if(elementRule.paddEmpty)node.empty().append(new Node("#text","3")).value="";else if(!node.attributes.map.name&&!node.attributes.map.id)return tempNode=node.parent,blockElements[node.name]?node.empty().remove():node.unwrap(),void(node=tempNode);node=node.parent}}},schema),rootNode=node=new Node(args.context||settings.root_name,11),parser.parse(html),validate&&invalidChildren.length&&(args.context?args.invalid=!0:fixInvalidChildren(invalidChildren)),rootBlockName&&("body"==rootNode.name||args.isRootContent)&&addRootBlocks(),!args.invalid){for(name in matchedNodes){for(list=nodeFilters[name],nodes=matchedNodes[name],fi=nodes.length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(i=0,l=list.length;i<l;i++)list[i](nodes,name,args)}for(i=0,l=attributeFilters.length;i<l;i++)if(list=attributeFilters[i],list.name in matchedAttributes){for(nodes=matchedAttributes[list.name],fi=nodes.length;fi--;)nodes[fi].parent||nodes.splice(fi,1);for(fi=0,fl=list.callbacks.length;fi<fl;fi++)list.callbacks[fi](nodes,list.name,args)}}return rootNode},settings.remove_trailing_brs&&self.addNodeFilter("br",function(nodes){var i,node,parent,lastParent,prev,prevName,elementRule,textNode,l=nodes.length,blockElements=extend({},schema.getBlockElements()),nonEmptyElements=schema.getNonEmptyElements();for(blockElements.body=1,i=0;i<l;i++)if(node=nodes[i],parent=node.parent,blockElements[node.parent.name]&&node===parent.lastChild){for(prev=node.prev;prev;){if(prevName=prev.name,"span"!==prevName||"bookmark"!==prev.attr("data-mce-type")){if("br"!==prevName)break;if("br"===prevName){node=null;break}}prev=prev.prev}node&&(node.remove(),parent.isEmpty(nonEmptyElements)&&(elementRule=schema.getElementRule(parent.name),elementRule&&(elementRule.removeEmpty?parent.remove():elementRule.paddEmpty&&(parent.empty().append(new Node("#text",3)).value=""))))}else{for(lastParent=node;parent&&parent.firstChild===lastParent&&parent.lastChild===lastParent&&(lastParent=parent,!blockElements[parent.name]);)parent=parent.parent;lastParent===parent&&(textNode=new Node("#text",3),textNode.value="",node.replace(textNode))}}),settings.allow_html_in_named_anchor||self.addAttributeFilter("id,name",function(nodes){for(var sibling,prevSibling,parent,node,i=nodes.length;i--;)if(node=nodes[i],"a"===node.name&&node.firstChild&&!node.attr("href")){parent=node.parent,sibling=node.lastChild;do prevSibling=sibling.prev,parent.insert(sibling,node),sibling=prevSibling;while(sibling)}}),settings.validate&&schema.getValidClasses()&&self.addAttributeFilter("class",function(nodes){for(var node,classList,ci,className,classValue,validClassesMap,valid,i=nodes.length,validClasses=schema.getValidClasses();i--;){for(node=nodes[i],classList=node.attr("class").split(" "),classValue="",ci=0;ci<classList.length;ci++)className=classList[ci],valid=!1,validClassesMap=validClasses["*"],validClassesMap&&validClassesMap[className]&&(valid=!0),validClassesMap=validClasses[node.name],!valid&&validClassesMap&&validClassesMap[className]&&(valid=!0),valid&&(classValue&&(classValue+=" "),classValue+=className);classValue.length||(classValue=null),node.attr("class",classValue)}})}}),define("tinymce/html/Writer",["tinymce/html/Entities","tinymce/util/Tools"],function(Entities,Tools){var makeMap=Tools.makeMap;return function(settings){var indent,indentBefore,indentAfter,encode,htmlOutput,html=[];return settings=settings||{},indent=settings.indent,indentBefore=makeMap(settings.indent_before||""),indentAfter=makeMap(settings.indent_after||""),encode=Entities.getEncodeFunc(settings.entity_encoding||"raw",settings.entities),htmlOutput="html"==settings.element_format,{start:function(name,attrs,empty){var i,l,attr,value;if(indent&&indentBefore[name]&&html.length>0&&(value=html[html.length-1],value.length>0&&"\n"!==value&&html.push("\n")),html.push("<",name),attrs)for(i=0,l=attrs.length;i<l;i++)attr=attrs[i],html.push(" ",attr.name,'="',encode(attr.value,!0),'"');!empty||htmlOutput?html[html.length]=">":html[html.length]=" />",empty&&indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1],value.length>0&&"\n"!==value&&html.push("\n"))},end:function(name){var value;html.push("</",name,">"),indent&&indentAfter[name]&&html.length>0&&(value=html[html.length-1],value.length>0&&"\n"!==value&&html.push("\n"))},text:function(text,raw){text.length>0&&(html[html.length]=raw?text:encode(text))},cdata:function(text){html.push("<![CDATA[",text,"]]>")},comment:function(text){html.push("<!--",text,"-->")},pi:function(name,text){text?html.push("<?",name," ",encode(text),"?>"):html.push("<?",name,"?>"),indent&&html.push("\n")},doctype:function(text){html.push("<!DOCTYPE",text,">",indent?"\n":"")},reset:function(){html.length=0},getContent:function(){return html.join("").replace(/\n$/,"")}}}}),define("tinymce/html/Serializer",["tinymce/html/Writer","tinymce/html/Schema"],function(Writer,Schema){return function(settings,schema){var self=this,writer=new Writer(settings);settings=settings||{},settings.validate=!("validate"in settings)||settings.validate,self.schema=schema=schema||new Schema,self.writer=writer,self.serialize=function(node){function walk(node){var name,isEmpty,attrs,attrName,attrValue,sortedAttrs,i,l,elementRule,handler=handlers[node.type];if(handler)handler(node);else{if(name=node.name,isEmpty=node.shortEnded,attrs=node.attributes,validate&&attrs&&attrs.length>1&&(sortedAttrs=[],sortedAttrs.map={},elementRule=schema.getElementRule(node.name))){for(i=0,l=elementRule.attributesOrder.length;i<l;i++)attrName=elementRule.attributesOrder[i],attrName in attrs.map&&(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));for(i=0,l=attrs.length;i<l;i++)attrName=attrs[i].name,attrName in sortedAttrs.map||(attrValue=attrs.map[attrName],sortedAttrs.map[attrName]=attrValue,sortedAttrs.push({name:attrName,value:attrValue}));attrs=sortedAttrs}if(writer.start(node.name,attrs,isEmpty),!isEmpty){if(node=node.firstChild)do walk(node);while(node=node.next);writer.end(name)}}}var handlers,validate;return validate=settings.validate,handlers={3:function(node){writer.text(node.value,node.raw)},8:function(node){writer.comment(node.value)},7:function(node){writer.pi(node.name,node.value)},10:function(node){writer.doctype(node.value)},4:function(node){writer.cdata(node.value)},11:function(node){if(node=node.firstChild)do walk(node);while(node=node.next)}},writer.reset(),1!=node.type||settings.inner?handlers[11](node):walk(node),writer.getContent()}}}),define("tinymce/dom/Serializer",["tinymce/dom/DOMUtils","tinymce/html/DomParser","tinymce/html/SaxParser","tinymce/html/Entities","tinymce/html/Serializer","tinymce/html/Node","tinymce/html/Schema","tinymce/Env","tinymce/util/Tools","tinymce/text/Zwsp"],function(DOMUtils,DomParser,SaxParser,Entities,Serializer,Node,Schema,Env,Tools,Zwsp){function trimTrailingBr(rootNode){function isBr(node){return node&&"br"===node.name}var brNode1,brNode2;brNode1=rootNode.lastChild,isBr(brNode1)&&(brNode2=brNode1.prev,isBr(brNode2)&&(brNode1.remove(),brNode2.remove()))}var each=Tools.each,trim=Tools.trim,DOM=DOMUtils.DOM,tempAttrs=["data-mce-selected"];return function(settings,editor){function trimHtml(html){var trimContentRegExp=new RegExp(["<span[^>]+data-mce-bogus[^>]+>[\ufeff]+<\\/span>","\\s?("+tempAttrs.join("|")+')="[^"]+"'].join("|"),"gi");return html=Zwsp.trim(html.replace(trimContentRegExp,""))}function getTrimmedContent(){var endTagIndex,index,matchLength,matches,shortEndedElements,content=editor.getBody().innerHTML,bogusAllRegExp=/<(\w+) [^>]*data-mce-bogus="all"[^>]*>/g,schema=editor.schema;for(content=trimHtml(content),shortEndedElements=schema.getShortEndedElements();matches=bogusAllRegExp.exec(content);)index=bogusAllRegExp.lastIndex,matchLength=matches[0].length,endTagIndex=shortEndedElements[matches[1]]?index:SaxParser.findEndTag(schema,content,index),content=content.substring(0,index-matchLength)+content.substring(endTagIndex),bogusAllRegExp.lastIndex=index-matchLength;return trim(content)}function addTempAttr(name){Tools.inArray(tempAttrs,name)===-1&&(htmlParser.addAttributeFilter(name,function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}),tempAttrs.push(name))}var dom,schema,htmlParser;return editor&&(dom=editor.dom,schema=editor.schema),dom=dom||DOM,schema=schema||new Schema(settings),settings.entity_encoding=settings.entity_encoding||"named",settings.remove_trailing_brs=!("remove_trailing_brs"in settings)||settings.remove_trailing_brs,htmlParser=new DomParser(settings,schema),htmlParser.addAttributeFilter("data-mce-tabindex",function(nodes,name){for(var node,i=nodes.length;i--;)node=nodes[i],node.attr("tabindex",node.attributes.map["data-mce-tabindex"]),node.attr(name,null)}),htmlParser.addAttributeFilter("src,href,style",function(nodes,name){for(var node,value,undef,i=nodes.length,internalName="data-mce-"+name,urlConverter=settings.url_converter,urlConverterScope=settings.url_converter_scope;i--;)node=nodes[i],value=node.attributes.map[internalName],value!==undef?(node.attr(name,value.length>0?value:null),node.attr(internalName,null)):(value=node.attributes.map[name],"style"===name?value=dom.serializeStyle(dom.parseStyle(value),node.name):urlConverter&&(value=urlConverter.call(urlConverterScope,value,name,node.name)),node.attr(name,value.length>0?value:null))}),htmlParser.addAttributeFilter("class",function(nodes){for(var node,value,i=nodes.length;i--;)node=nodes[i],value=node.attr("class"),value&&(value=node.attr("class").replace(/(?:^|\s)mce-item-\w+(?!\S)/g,""),node.attr("class",value.length>0?value:null))}),htmlParser.addAttributeFilter("data-mce-type",function(nodes,name,args){for(var node,i=nodes.length;i--;)node=nodes[i],"bookmark"!==node.attributes.map["data-mce-type"]||args.cleanup||node.remove()}),htmlParser.addNodeFilter("noscript",function(nodes){for(var node,i=nodes.length;i--;)node=nodes[i].firstChild,node&&(node.value=Entities.decode(node.value))}),htmlParser.addNodeFilter("script,style",function(nodes,name){function trim(value){return value.replace(/(<!--\[CDATA\[|\]\]-->)/g,"\n").replace(/^[\r\n]*|[\r\n]*$/g,"").replace(/^\s*((<!--)?(\s*\/\/)?\s*<!\[CDATA\[|(<!--\s*)?\/\*\s*<!\[CDATA\[\s*\*\/|(\/\/)?\s*<!--|\/\*\s*<!--\s*\*\/)\s*[\r\n]*/gi,"").replace(/\s*(\/\*\s*\]\]>\s*\*\/(-->)?|\s*\/\/\s*\]\]>(-->)?|\/\/\s*(-->)?|\]\]>|\/\*\s*-->\s*\*\/|\s*-->\s*)\s*$/g,"")}for(var node,value,type,i=nodes.length;i--;)node=nodes[i],value=node.firstChild?node.firstChild.value:"","script"===name?(type=node.attr("type"),type&&node.attr("type","mce-no/type"==type?null:type.replace(/^mce\-/,"")),value.length>0&&(node.firstChild.value="// <![CDATA[\n"+trim(value)+"\n// ]]>")):value.length>0&&(node.firstChild.value="<!--\n"+trim(value)+"\n-->")}),htmlParser.addNodeFilter("#comment",function(nodes){for(var node,i=nodes.length;i--;)node=nodes[i],0===node.value.indexOf("[CDATA[")?(node.name="#cdata",node.type=4,node.value=node.value.replace(/^\[CDATA\[|\]\]$/g,"")):0===node.value.indexOf("mce:protected ")&&(node.name="#text",node.type=3,node.raw=!0,node.value=unescape(node.value).substr(14))}),htmlParser.addNodeFilter("xml:namespace,input",function(nodes,name){for(var node,i=nodes.length;i--;)node=nodes[i],7===node.type?node.remove():1===node.type&&("input"!==name||"type"in node.attributes.map||node.attr("type","text"))}),settings.fix_list_elements&&htmlParser.addNodeFilter("ul,ol",function(nodes){for(var node,parentNode,i=nodes.length;i--;)node=nodes[i],parentNode=node.parent,"ul"!==parentNode.name&&"ol"!==parentNode.name||node.prev&&"li"===node.prev.name&&node.prev.append(node)}),htmlParser.addAttributeFilter("data-mce-src,data-mce-href,data-mce-style,data-mce-selected,data-mce-expando,data-mce-type,data-mce-resize",function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)}),{schema:schema,addNodeFilter:htmlParser.addNodeFilter,addAttributeFilter:htmlParser.addAttributeFilter,serialize:function(node,args){var impl,doc,oldDoc,htmlSerializer,content,rootNode,self=this;return Env.ie&&dom.select("script,style,select,map").length>0?(content=node.innerHTML,node=node.cloneNode(!1),dom.setHTML(node,content)):node=node.cloneNode(!0),impl=node.ownerDocument.implementation,impl.createHTMLDocument&&(doc=impl.createHTMLDocument(""),each("BODY"==node.nodeName?node.childNodes:[node],function(node){doc.body.appendChild(doc.importNode(node,!0))}),node="BODY"!=node.nodeName?doc.body.firstChild:doc.body,oldDoc=dom.doc,dom.doc=doc),args=args||{},args.format=args.format||"html",args.selection&&(args.forced_root_block=""),args.no_events||(args.node=node,self.onPreProcess(args)),rootNode=htmlParser.parse(trim(args.getInner?node.innerHTML:dom.getOuterHTML(node)),args),trimTrailingBr(rootNode),htmlSerializer=new Serializer(settings,schema),args.content=htmlSerializer.serialize(rootNode),args.cleanup||(args.content=Zwsp.trim(args.content),args.content=args.content.replace(/\uFEFF/g,"")),args.no_events||self.onPostProcess(args),oldDoc&&(dom.doc=oldDoc),args.node=null,args.content},addRules:function(rules){schema.addValidElements(rules)},setRules:function(rules){schema.setValidElements(rules)},onPreProcess:function(args){editor&&editor.fire("PreProcess",args)},onPostProcess:function(args){editor&&editor.fire("PostProcess",args)},addTempAttr:addTempAttr,trimHtml:trimHtml,getTrimmedContent:getTrimmedContent}}}),define("tinymce/dom/TridentSelection",[],function(){function Selection(selection){function getPosition(rng,start){var checkRng,endIndex,inside,children,child,offset,index,parent,startIndex=0,position=-1;if(checkRng=rng.duplicate(),checkRng.collapse(start),parent=checkRng.parentElement(),parent.ownerDocument===selection.dom.doc){for(;"false"===parent.contentEditable;)parent=parent.parentNode;if(!parent.hasChildNodes())return{node:parent,inside:1};for(children=parent.children,endIndex=children.length-1;startIndex<=endIndex;)if(index=Math.floor((startIndex+endIndex)/2),child=children[index],checkRng.moveToElementText(child),position=checkRng.compareEndPoints(start?"StartToStart":"EndToEnd",rng),position>0)endIndex=index-1;else{if(!(position<0))return{node:child};startIndex=index+1}if(position<0)for(child?checkRng.collapse(!1):(checkRng.moveToElementText(parent),checkRng.collapse(!0),child=parent,inside=!0),offset=0;0!==checkRng.compareEndPoints(start?"StartToStart":"StartToEnd",rng)&&0!==checkRng.move("character",1)&&parent==checkRng.parentElement();)offset++;else for(checkRng.collapse(!0),offset=0;0!==checkRng.compareEndPoints(start?"StartToStart":"StartToEnd",rng)&&0!==checkRng.move("character",-1)&&parent==checkRng.parentElement();)offset++;return{node:child,position:position,offset:offset,inside:inside}}}function getRange(){function findEndPoint(start){var container,offset,sibling,undef,nodeValue,endPoint=getPosition(ieRange,start),textNodeOffset=0;if(container=endPoint.node,offset=endPoint.offset,endPoint.inside&&!container.hasChildNodes())return void domRange[start?"setStart":"setEnd"](container,0);if(offset===undef)return void domRange[start?"setStartBefore":"setEndAfter"](container);if(endPoint.position<0){if(sibling=endPoint.inside?container.firstChild:container.nextSibling,!sibling)return void domRange[start?"setStartAfter":"setEndAfter"](container);if(!offset)return void(3==sibling.nodeType?domRange[start?"setStart":"setEnd"](sibling,0):domRange[start?"setStartBefore":"setEndBefore"](sibling));for(;sibling;){if(3==sibling.nodeType&&(nodeValue=sibling.nodeValue,textNodeOffset+=nodeValue.length,textNodeOffset>=offset)){container=sibling,textNodeOffset-=offset,textNodeOffset=nodeValue.length-textNodeOffset;break}sibling=sibling.nextSibling}}else{if(sibling=container.previousSibling,!sibling)return domRange[start?"setStartBefore":"setEndBefore"](container);if(!offset)return void(3==container.nodeType?domRange[start?"setStart":"setEnd"](sibling,container.nodeValue.length):domRange[start?"setStartAfter":"setEndAfter"](sibling));for(;sibling;){if(3==sibling.nodeType&&(textNodeOffset+=sibling.nodeValue.length,textNodeOffset>=offset)){container=sibling,textNodeOffset-=offset;break}sibling=sibling.previousSibling}}domRange[start?"setStart":"setEnd"](container,textNodeOffset)}var element,collapsed,tmpRange,element2,bookmark,ieRange=selection.getRng(),domRange=dom.createRng();if(element=ieRange.item?ieRange.item(0):ieRange.parentElement(),element.ownerDocument!=dom.doc)return domRange;if(collapsed=selection.isCollapsed(),ieRange.item)return domRange.setStart(element.parentNode,dom.nodeIndex(element)),domRange.setEnd(domRange.startContainer,domRange.startOffset+1),domRange;try{findEndPoint(!0),collapsed||findEndPoint()}catch(ex){if(ex.number!=-2147024809)throw ex;bookmark=self.getBookmark(2),tmpRange=ieRange.duplicate(),tmpRange.collapse(!0),element=tmpRange.parentElement(),collapsed||(tmpRange=ieRange.duplicate(),tmpRange.collapse(!1),element2=tmpRange.parentElement(),element2.innerHTML=element2.innerHTML),element.innerHTML=element.innerHTML,self.moveToBookmark(bookmark),ieRange=selection.getRng(),findEndPoint(!0),collapsed||findEndPoint()}return domRange}var self=this,dom=selection.dom,FALSE=!1;this.getBookmark=function(type){function getIndexes(node){var parent,root,children,i,indexes=[];for(parent=node.parentNode,root=dom.getRoot().parentNode;parent!=root&&9!==parent.nodeType;){for(children=parent.children,i=children.length;i--;)if(node===children[i]){indexes.push(i);break}node=parent,parent=parent.parentNode}return indexes}function getBookmarkEndPoint(start){var position;if(position=getPosition(rng,start))return{position:position.position,offset:position.offset,indexes:getIndexes(position.node),inside:position.inside}}var rng=selection.getRng(),bookmark={};return 2===type&&(rng.item?bookmark.start={ctrl:!0,indexes:getIndexes(rng.item(0))}:(bookmark.start=getBookmarkEndPoint(!0),selection.isCollapsed()||(bookmark.end=getBookmarkEndPoint()))),bookmark},this.moveToBookmark=function(bookmark){function resolveIndexes(indexes){var node,i,idx,children;for(node=dom.getRoot(),i=indexes.length-1;i>=0;i--)children=node.children,idx=indexes[i],idx<=children.length-1&&(node=children[idx]);return node}function setBookmarkEndPoint(start){var moveLeft,moveRng,undef,offset,endPoint=bookmark[start?"start":"end"];endPoint&&(moveLeft=endPoint.position>0,moveRng=body.createTextRange(),moveRng.moveToElementText(resolveIndexes(endPoint.indexes)),offset=endPoint.offset,offset!==undef?(moveRng.collapse(endPoint.inside||moveLeft),moveRng.moveStart("character",moveLeft?-offset:offset)):moveRng.collapse(start),rng.setEndPoint(start?"StartToStart":"EndToStart",moveRng),start&&rng.collapse(!0))}var rng,body=dom.doc.body;bookmark.start&&(bookmark.start.ctrl?(rng=body.createControlRange(),rng.addElement(resolveIndexes(bookmark.start.indexes)),rng.select()):(rng=body.createTextRange(),setBookmarkEndPoint(!0),setBookmarkEndPoint(),rng.select()))},this.addRange=function(rng){function setEndPoint(start){var container,offset,marker,tmpRng,nodes;marker=dom.create("a"),container=start?startContainer:endContainer,offset=start?startOffset:endOffset,tmpRng=ieRng.duplicate(),container!=doc&&container!=doc.documentElement||(container=body,offset=0),3==container.nodeType?(container.parentNode.insertBefore(marker,container),tmpRng.moveToElementText(marker),tmpRng.moveStart("character",offset),dom.remove(marker),ieRng.setEndPoint(start?"StartToStart":"EndToEnd",tmpRng)):(nodes=container.childNodes,nodes.length?(offset>=nodes.length?dom.insertAfter(marker,nodes[nodes.length-1]):container.insertBefore(marker,nodes[offset]),tmpRng.moveToElementText(marker)):container.canHaveHTML&&(container.innerHTML="<span>&#xFEFF;</span>",marker=container.firstChild,tmpRng.moveToElementText(marker),tmpRng.collapse(FALSE)),ieRng.setEndPoint(start?"StartToStart":"EndToEnd",tmpRng),dom.remove(marker))}var ieRng,ctrlRng,startContainer,startOffset,endContainer,endOffset,sibling,nativeRng,ctrlElm,doc=selection.dom.doc,body=doc.body;if(startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset,ieRng=body.createTextRange(),startContainer==endContainer&&1==startContainer.nodeType){if(startOffset==endOffset&&!startContainer.hasChildNodes()){if(startContainer.canHaveHTML)return sibling=startContainer.previousSibling,sibling&&!sibling.hasChildNodes()&&dom.isBlock(sibling)?sibling.innerHTML="&#xFEFF;":sibling=null,startContainer.innerHTML="<span>&#xFEFF;</span><span>&#xFEFF;</span>",ieRng.moveToElementText(startContainer.lastChild),ieRng.select(),dom.doc.selection.clear(),startContainer.innerHTML="",void(sibling&&(sibling.innerHTML=""));startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode}if(startOffset==endOffset-1)try{if(ctrlElm=startContainer.childNodes[startOffset],ctrlRng=body.createControlRange(),ctrlRng.addElement(ctrlElm),ctrlRng.select(),nativeRng=selection.getRng(),nativeRng.item&&ctrlElm===nativeRng.item(0))return}catch(ex){}}setEndPoint(!0),setEndPoint(),ieRng.select()},this.getRangeAt=getRange}return Selection}),define("tinymce/util/VK",["tinymce/Env"],function(Env){return{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,LEFT:37,RIGHT:39,SPACEBAR:32,TAB:9,UP:38,modifierPressed:function(e){return e.shiftKey||e.ctrlKey||e.altKey||this.metaKeyPressed(e)},metaKeyPressed:function(e){return Env.mac?e.metaKey:e.ctrlKey&&!e.altKey}}}),define("tinymce/dom/ControlSelection",["tinymce/util/VK","tinymce/util/Tools","tinymce/util/Delay","tinymce/Env","tinymce/dom/NodeType"],function(VK,Tools,Delay,Env,NodeType){var isContentEditableFalse=NodeType.isContentEditableFalse;return function(selection,editor){function isResizable(elm){var selector=editor.settings.object_resizing;return selector!==!1&&!Env.iOS&&("string"!=typeof selector&&(selector="table,img,div"),"false"!==elm.getAttribute("data-mce-resize")&&(elm!=editor.getBody()&&editor.dom.is(elm,selector)))}function resizeGhostElement(e){var deltaX,deltaY,proportional,resizeHelperX,resizeHelperY;deltaX=e.screenX-startX,deltaY=e.screenY-startY,width=deltaX*selectedHandle[2]+startW,height=deltaY*selectedHandle[3]+startH,width=width<5?5:width,height=height<5?5:height,proportional="IMG"==selectedElm.nodeName&&editor.settings.resize_img_proportional!==!1?!VK.modifierPressed(e):VK.modifierPressed(e)||"IMG"==selectedElm.nodeName&&selectedHandle[2]*selectedHandle[3]!==0,
proportional&&(abs(deltaX)>abs(deltaY)?(height=round(width*ratio),width=round(height/ratio)):(width=round(height/ratio),height=round(width*ratio))),dom.setStyles(selectedElmGhost,{width:width,height:height}),resizeHelperX=selectedHandle.startPos.x+deltaX,resizeHelperY=selectedHandle.startPos.y+deltaY,resizeHelperX=resizeHelperX>0?resizeHelperX:0,resizeHelperY=resizeHelperY>0?resizeHelperY:0,dom.setStyles(resizeHelper,{left:resizeHelperX,top:resizeHelperY,display:"block"}),resizeHelper.innerHTML=width+" &times; "+height,selectedHandle[2]<0&&selectedElmGhost.clientWidth<=width&&dom.setStyle(selectedElmGhost,"left",selectedElmX+(startW-width)),selectedHandle[3]<0&&selectedElmGhost.clientHeight<=height&&dom.setStyle(selectedElmGhost,"top",selectedElmY+(startH-height)),deltaX=rootElement.scrollWidth-startScrollWidth,deltaY=rootElement.scrollHeight-startScrollHeight,deltaX+deltaY!==0&&dom.setStyles(resizeHelper,{left:resizeHelperX-deltaX,top:resizeHelperY-deltaY}),resizeStarted||(editor.fire("ObjectResizeStart",{target:selectedElm,width:startW,height:startH}),resizeStarted=!0)}function endGhostResize(){function setSizeProp(name,value){value&&(selectedElm.style[name]||!editor.schema.isValid(selectedElm.nodeName.toLowerCase(),name)?dom.setStyle(selectedElm,name,value):dom.setAttrib(selectedElm,name,value))}resizeStarted=!1,setSizeProp("width",width),setSizeProp("height",height),dom.unbind(editableDoc,"mousemove",resizeGhostElement),dom.unbind(editableDoc,"mouseup",endGhostResize),rootDocument!=editableDoc&&(dom.unbind(rootDocument,"mousemove",resizeGhostElement),dom.unbind(rootDocument,"mouseup",endGhostResize)),dom.remove(selectedElmGhost),dom.remove(resizeHelper),isIE&&"TABLE"!=selectedElm.nodeName||showResizeRect(selectedElm),editor.fire("ObjectResized",{target:selectedElm,width:width,height:height}),dom.setAttrib(selectedElm,"style",dom.getAttrib(selectedElm,"style")),editor.nodeChanged()}function showResizeRect(targetElm,mouseDownHandleName,mouseDownEvent){var position,targetWidth,targetHeight,e,rect;hideResizeRect(),unbindResizeHandleEvents(),position=dom.getPos(targetElm,rootElement),selectedElmX=position.x,selectedElmY=position.y,rect=targetElm.getBoundingClientRect(),targetWidth=rect.width||rect.right-rect.left,targetHeight=rect.height||rect.bottom-rect.top,selectedElm!=targetElm&&(detachResizeStartListener(),selectedElm=targetElm,width=height=0),e=editor.fire("ObjectSelected",{target:targetElm}),isResizable(targetElm)&&!e.isDefaultPrevented()?each(resizeHandles,function(handle,name){function startDrag(e){startX=e.screenX,startY=e.screenY,startW=selectedElm.clientWidth,startH=selectedElm.clientHeight,ratio=startH/startW,selectedHandle=handle,handle.startPos={x:targetWidth*handle[0]+selectedElmX,y:targetHeight*handle[1]+selectedElmY},startScrollWidth=rootElement.scrollWidth,startScrollHeight=rootElement.scrollHeight,selectedElmGhost=selectedElm.cloneNode(!0),dom.addClass(selectedElmGhost,"mce-clonedresizable"),dom.setAttrib(selectedElmGhost,"data-mce-bogus","all"),selectedElmGhost.contentEditable=!1,selectedElmGhost.unSelectabe=!0,dom.setStyles(selectedElmGhost,{left:selectedElmX,top:selectedElmY,margin:0}),selectedElmGhost.removeAttribute("data-mce-selected"),rootElement.appendChild(selectedElmGhost),dom.bind(editableDoc,"mousemove",resizeGhostElement),dom.bind(editableDoc,"mouseup",endGhostResize),rootDocument!=editableDoc&&(dom.bind(rootDocument,"mousemove",resizeGhostElement),dom.bind(rootDocument,"mouseup",endGhostResize)),resizeHelper=dom.add(rootElement,"div",{"class":"mce-resize-helper","data-mce-bogus":"all"},startW+" &times; "+startH)}var handleElm;return mouseDownHandleName?void(name==mouseDownHandleName&&startDrag(mouseDownEvent)):(handleElm=dom.get("mceResizeHandle"+name),handleElm&&dom.remove(handleElm),handleElm=dom.add(rootElement,"div",{id:"mceResizeHandle"+name,"data-mce-bogus":"all","class":"mce-resizehandle",unselectable:!0,style:"cursor:"+name+"-resize; margin:0; padding:0"}),Env.ie&&(handleElm.contentEditable=!1),dom.bind(handleElm,"mousedown",function(e){e.stopImmediatePropagation(),e.preventDefault(),startDrag(e)}),handle.elm=handleElm,void dom.setStyles(handleElm,{left:targetWidth*handle[0]+selectedElmX-handleElm.offsetWidth/2,top:targetHeight*handle[1]+selectedElmY-handleElm.offsetHeight/2}))}):hideResizeRect(),selectedElm.setAttribute("data-mce-selected","1")}function hideResizeRect(){var name,handleElm;unbindResizeHandleEvents(),selectedElm&&selectedElm.removeAttribute("data-mce-selected");for(name in resizeHandles)handleElm=dom.get("mceResizeHandle"+name),handleElm&&(dom.unbind(handleElm),dom.remove(handleElm))}function updateResizeRect(e){function isChildOrEqual(node,parent){if(node)do if(node===parent)return!0;while(node=node.parentNode)}var startElm,controlElm;if(!resizeStarted&&!editor.removed)return each(dom.select("img[data-mce-selected],hr[data-mce-selected]"),function(img){img.removeAttribute("data-mce-selected")}),controlElm="mousedown"==e.type?e.target:selection.getNode(),controlElm=dom.$(controlElm).closest(isIE?"table":"table,img,hr")[0],isChildOrEqual(controlElm,rootElement)&&(disableGeckoResize(),startElm=selection.getStart(!0),isChildOrEqual(startElm,controlElm)&&isChildOrEqual(selection.getEnd(!0),controlElm)&&(!isIE||controlElm!=startElm&&"IMG"!==startElm.nodeName))?void showResizeRect(controlElm):void hideResizeRect()}function attachEvent(elm,name,func){elm&&elm.attachEvent&&elm.attachEvent("on"+name,func)}function detachEvent(elm,name,func){elm&&elm.detachEvent&&elm.detachEvent("on"+name,func)}function resizeNativeStart(e){var pos,name,corner,cornerX,cornerY,relativeX,relativeY,target=e.srcElement;pos=target.getBoundingClientRect(),relativeX=lastMouseDownEvent.clientX-pos.left,relativeY=lastMouseDownEvent.clientY-pos.top;for(name in resizeHandles)if(corner=resizeHandles[name],cornerX=target.offsetWidth*corner[0],cornerY=target.offsetHeight*corner[1],abs(cornerX-relativeX)<8&&abs(cornerY-relativeY)<8){selectedHandle=corner;break}resizeStarted=!0,editor.fire("ObjectResizeStart",{target:selectedElm,width:selectedElm.clientWidth,height:selectedElm.clientHeight}),editor.getDoc().selection.empty(),showResizeRect(target,name,lastMouseDownEvent)}function preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function nativeControlSelect(e){var target=e.srcElement;if(isContentEditableFalse(target))return void preventDefault(e);if(target!=selectedElm){if(editor.fire("ObjectSelected",{target:target}),detachResizeStartListener(),0===target.id.indexOf("mceResizeHandle"))return void(e.returnValue=!1);"IMG"!=target.nodeName&&"TABLE"!=target.nodeName||(hideResizeRect(),selectedElm=target,attachEvent(target,"resizestart",resizeNativeStart))}}function detachResizeStartListener(){detachEvent(selectedElm,"resizestart",resizeNativeStart)}function unbindResizeHandleEvents(){for(var name in resizeHandles){var handle=resizeHandles[name];handle.elm&&(dom.unbind(handle.elm),delete handle.elm)}}function disableGeckoResize(){try{editor.getDoc().execCommand("enableObjectResizing",!1,!1)}catch(ex){}}function controlSelect(elm){var ctrlRng;if(isIE){ctrlRng=editableDoc.body.createControlRange();try{return ctrlRng.addElement(elm),ctrlRng.select(),!0}catch(ex){}}}function destroy(){selectedElm=selectedElmGhost=null,isIE&&(detachResizeStartListener(),detachEvent(rootElement,"controlselect",nativeControlSelect))}var selectedElm,selectedElmGhost,resizeHelper,resizeHandles,selectedHandle,lastMouseDownEvent,startX,startY,selectedElmX,selectedElmY,startW,startH,ratio,resizeStarted,width,height,startScrollWidth,startScrollHeight,dom=editor.dom,each=Tools.each,editableDoc=editor.getDoc(),rootDocument=document,isIE=Env.ie&&Env.ie<11,abs=Math.abs,round=Math.round,rootElement=editor.getBody();resizeHandles={nw:[0,0,-1,-1],ne:[1,0,1,-1],se:[1,1,1,1],sw:[0,1,-1,1]};var rootClass=".mce-content-body";return editor.contentStyles.push(rootClass+" div.mce-resizehandle {position: absolute;border: 1px solid black;box-sizing: box-sizing;background: #FFF;width: 7px;height: 7px;z-index: 10000}"+rootClass+" .mce-resizehandle:hover {background: #000}"+rootClass+" img[data-mce-selected],"+rootClass+" hr[data-mce-selected] {outline: 1px solid black;resize: none}"+rootClass+" .mce-clonedresizable {position: absolute;"+(Env.gecko?"":"outline: 1px dashed black;")+"opacity: .5;filter: alpha(opacity=50);z-index: 10000}"+rootClass+" .mce-resize-helper {background: #555;background: rgba(0,0,0,0.75);border-radius: 3px;border: 1px;color: white;display: none;font-family: sans-serif;font-size: 12px;white-space: nowrap;line-height: 14px;margin: 5px 10px;padding: 5px;position: absolute;z-index: 10001}"),editor.on("init",function(){isIE?(editor.on("ObjectResized",function(e){"TABLE"!=e.target.nodeName&&(hideResizeRect(),controlSelect(e.target))}),attachEvent(rootElement,"controlselect",nativeControlSelect),editor.on("mousedown",function(e){lastMouseDownEvent=e})):(disableGeckoResize(),Env.ie>=11&&(editor.on("mousedown click",function(e){var nodeName=e.target.nodeName;!resizeStarted&&/^(TABLE|IMG|HR)$/.test(nodeName)&&(editor.selection.select(e.target,"TABLE"==nodeName),"mousedown"==e.type&&editor.nodeChanged())}),editor.dom.bind(rootElement,"mscontrolselect",function(e){function delayedSelect(node){Delay.setEditorTimeout(editor,function(){editor.selection.select(node)})}return isContentEditableFalse(e.target)?(e.preventDefault(),void delayedSelect(e.target)):void(/^(TABLE|IMG|HR)$/.test(e.target.nodeName)&&(e.preventDefault(),"IMG"==e.target.tagName&&delayedSelect(e.target)))})));var throttledUpdateResizeRect=Delay.throttle(function(e){editor.composing||updateResizeRect(e)});editor.on("nodechange ResizeEditor ResizeWindow drop",throttledUpdateResizeRect),editor.on("keyup compositionend",function(e){selectedElm&&"TABLE"==selectedElm.nodeName&&throttledUpdateResizeRect(e)}),editor.on("hide blur",hideResizeRect)}),editor.on("remove",unbindResizeHandleEvents),{isResizable:isResizable,showResizeRect:showResizeRect,hideResizeRect:hideResizeRect,updateResizeRect:updateResizeRect,controlSelect:controlSelect,destroy:destroy}}}),define("tinymce/util/Fun",[],function(){function constant(value){return function(){return value}}function negate(predicate){return function(x){return!predicate(x)}}function compose(f,g){return function(x){return f(g(x))}}function or(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++)if(args[i](x))return!0;return!1}}function and(){var args=slice.call(arguments);return function(x){for(var i=0;i<args.length;i++)if(!args[i](x))return!1;return!0}}function curry(fn){var args=slice.call(arguments);return args.length-1>=fn.length?fn.apply(this,args.slice(1)):function(){var tempArgs=args.concat([].slice.call(arguments));return curry.apply(this,tempArgs)}}var slice=[].slice;return{constant:constant,negate:negate,and:and,or:or,curry:curry,compose:compose}}),define("tinymce/caret/CaretCandidate",["tinymce/dom/NodeType","tinymce/util/Arr","tinymce/caret/CaretContainer"],function(NodeType,Arr,CaretContainer){function isCaretCandidate(node){return!isCaretContainer(node)&&(isText(node)?!isInvalidTextElement(node.parentNode):isAtomicInline(node)||isBr(node)||isTable(node)||isContentEditableFalse(node))}function isInEditable(node,rootNode){for(node=node.parentNode;node&&node!=rootNode;node=node.parentNode){if(isContentEditableFalse(node))return!1;if(isContentEditableTrue(node))return!0}return!0}function isAtomicContentEditableFalse(node){return!!isContentEditableFalse(node)&&Arr.reduce(node.getElementsByTagName("*"),function(result,elm){return result||isContentEditableTrue(elm)},!1)!==!0}function isAtomic(node){return isAtomicInline(node)||isAtomicContentEditableFalse(node)}function isEditableCaretCandidate(node,rootNode){return isCaretCandidate(node)&&isInEditable(node,rootNode)}var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBr=NodeType.isBr,isText=NodeType.isText,isInvalidTextElement=NodeType.matchNodeNames("script style textarea"),isAtomicInline=NodeType.matchNodeNames("img input textarea hr iframe video audio object"),isTable=NodeType.matchNodeNames("table"),isCaretContainer=CaretContainer.isCaretContainer;return{isCaretCandidate:isCaretCandidate,isInEditable:isInEditable,isAtomic:isAtomic,isEditableCaretCandidate:isEditableCaretCandidate}}),define("tinymce/geom/ClientRect",[],function(){function clone(rect){return rect?{left:round(rect.left),top:round(rect.top),bottom:round(rect.bottom),right:round(rect.right),width:round(rect.width),height:round(rect.height)}:{left:0,top:0,bottom:0,right:0,width:0,height:0}}function collapse(clientRect,toStart){return clientRect=clone(clientRect),toStart?clientRect.right=clientRect.left:(clientRect.left=clientRect.left+clientRect.width,clientRect.right=clientRect.left),clientRect.width=0,clientRect}function isEqual(rect1,rect2){return rect1.left===rect2.left&&rect1.top===rect2.top&&rect1.bottom===rect2.bottom&&rect1.right===rect2.right}function isValidOverflow(overflowY,clientRect1,clientRect2){return overflowY>=0&&overflowY<=Math.min(clientRect1.height,clientRect2.height)/2}function isAbove(clientRect1,clientRect2){return clientRect1.bottom<clientRect2.top||!(clientRect1.top>clientRect2.bottom)&&isValidOverflow(clientRect2.top-clientRect1.bottom,clientRect1,clientRect2)}function isBelow(clientRect1,clientRect2){return clientRect1.top>clientRect2.bottom||!(clientRect1.bottom<clientRect2.top)&&isValidOverflow(clientRect2.bottom-clientRect1.top,clientRect1,clientRect2)}function isLeft(clientRect1,clientRect2){return clientRect1.left<clientRect2.left}function isRight(clientRect1,clientRect2){return clientRect1.right>clientRect2.right}function compare(clientRect1,clientRect2){return isAbove(clientRect1,clientRect2)?-1:isBelow(clientRect1,clientRect2)?1:isLeft(clientRect1,clientRect2)?-1:isRight(clientRect1,clientRect2)?1:0}function containsXY(clientRect,clientX,clientY){return clientX>=clientRect.left&&clientX<=clientRect.right&&clientY>=clientRect.top&&clientY<=clientRect.bottom}var round=Math.round;return{clone:clone,collapse:collapse,isEqual:isEqual,isAbove:isAbove,isBelow:isBelow,isLeft:isLeft,isRight:isRight,compare:compare,containsXY:containsXY}}),define("tinymce/text/ExtendingChar",[],function(){function isExtendingChar(ch){return"string"==typeof ch&&ch.charCodeAt(0)>=768&&extendingChars.test(ch)}var extendingChars=new RegExp("[-----------------------------------------------------------------------------------------------------------------------------------]");return{isExtendingChar:isExtendingChar}}),define("tinymce/caret/CaretPosition",["tinymce/util/Fun","tinymce/dom/NodeType","tinymce/dom/DOMUtils","tinymce/dom/RangeUtils","tinymce/caret/CaretCandidate","tinymce/geom/ClientRect","tinymce/text/ExtendingChar"],function(Fun,NodeType,DOMUtils,RangeUtils,CaretCandidate,ClientRect,ExtendingChar){function isWhiteSpace(chr){return chr&&/[\r\n\t ]/.test(chr)}function isHiddenWhiteSpaceRange(range){var text,container=range.startContainer,offset=range.startOffset;return!!(isWhiteSpace(range.toString())&&isNotPre(container.parentNode)&&(text=container.data,isWhiteSpace(text[offset-1])||isWhiteSpace(text[offset+1])))}function getCaretPositionClientRects(caretPosition){function getBrClientRect(brNode){var clientRect,doc=brNode.ownerDocument,rng=doc.createRange(),nbsp=doc.createTextNode(""),parentNode=brNode.parentNode;return parentNode.insertBefore(nbsp,brNode),rng.setStart(nbsp,0),rng.setEnd(nbsp,1),clientRect=ClientRect.clone(rng.getBoundingClientRect()),parentNode.removeChild(nbsp),clientRect}function getBoundingClientRect(item){var clientRect,clientRects;return clientRects=item.getClientRects(),clientRect=clientRects.length>0?ClientRect.clone(clientRects[0]):ClientRect.clone(item.getBoundingClientRect()),isBr(item)&&0===clientRect.left?getBrClientRect(item):clientRect}function collapseAndInflateWidth(clientRect,toStart){return clientRect=ClientRect.collapse(clientRect,toStart),clientRect.width=1,clientRect.right=clientRect.left+1,clientRect}function addUniqueAndValidRect(clientRect){0!==clientRect.height&&(clientRects.length>0&&ClientRect.isEqual(clientRect,clientRects[clientRects.length-1])||clientRects.push(clientRect))}function addCharacterOffset(container,offset){var range=container.ownerDocument.createRange();if(offset<container.data.length){if(ExtendingChar.isExtendingChar(container.data[offset]))return clientRects;if(ExtendingChar.isExtendingChar(container.data[offset-1])&&(range.setStart(container,offset),range.setEnd(container,offset+1),!isHiddenWhiteSpaceRange(range)))return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!1)),clientRects}offset>0&&(range.setStart(container,offset-1),range.setEnd(container,offset),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!1))),offset<container.data.length&&(range.setStart(container,offset),range.setEnd(container,offset+1),isHiddenWhiteSpaceRange(range)||addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range),!0)))}var beforeNode,node,clientRects=[];if(isText(caretPosition.container()))return addCharacterOffset(caretPosition.container(),caretPosition.offset()),clientRects;if(isElement(caretPosition.container()))if(caretPosition.isAtEnd())node=resolveIndex(caretPosition.container(),caretPosition.offset()),isText(node)&&addCharacterOffset(node,node.data.length),isValidElementCaretCandidate(node)&&!isBr(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!1));else{if(node=resolveIndex(caretPosition.container(),caretPosition.offset()),isText(node)&&addCharacterOffset(node,0),isValidElementCaretCandidate(node)&&caretPosition.isAtEnd())return addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!1)),clientRects;beforeNode=resolveIndex(caretPosition.container(),caretPosition.offset()-1),isValidElementCaretCandidate(beforeNode)&&!isBr(beforeNode)&&(isBlock(beforeNode)||isBlock(node)||!isValidElementCaretCandidate(node))&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode),!1)),isValidElementCaretCandidate(node)&&addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node),!0))}return clientRects}function CaretPosition(container,offset,clientRects){function isAtStart(){return isText(container)?0===offset:0===offset}function isAtEnd(){return isText(container)?offset>=container.data.length:offset>=container.childNodes.length}function toRange(){var range;return range=container.ownerDocument.createRange(),range.setStart(container,offset),range.setEnd(container,offset),range}function getClientRects(){return clientRects||(clientRects=getCaretPositionClientRects(new CaretPosition(container,offset))),clientRects}function isVisible(){return getClientRects().length>0}function isEqual(caretPosition){return caretPosition&&container===caretPosition.container()&&offset===caretPosition.offset()}function getNode(before){return resolveIndex(container,before?offset-1:offset)}return{container:Fun.constant(container),offset:Fun.constant(offset),toRange:toRange,getClientRects:getClientRects,isVisible:isVisible,isAtStart:isAtStart,isAtEnd:isAtEnd,isEqual:isEqual,getNode:getNode}}var isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate,isBlock=NodeType.matchStyleValues("display","block table"),isFloated=NodeType.matchStyleValues("float","left right"),isValidElementCaretCandidate=Fun.and(isElement,isCaretCandidate,Fun.negate(isFloated)),isNotPre=Fun.negate(NodeType.matchStyleValues("white-space","pre pre-line pre-wrap")),isText=NodeType.isText,isBr=NodeType.isBr,nodeIndex=DOMUtils.nodeIndex,resolveIndex=RangeUtils.getNode;return CaretPosition.fromRangeStart=function(range){return new CaretPosition(range.startContainer,range.startOffset)},CaretPosition.fromRangeEnd=function(range){return new CaretPosition(range.endContainer,range.endOffset)},CaretPosition.after=function(node){return new CaretPosition(node.parentNode,nodeIndex(node)+1)},CaretPosition.before=function(node){return new CaretPosition(node.parentNode,nodeIndex(node))},CaretPosition}),define("tinymce/caret/CaretBookmark",["tinymce/dom/NodeType","tinymce/dom/DOMUtils","tinymce/util/Fun","tinymce/util/Arr","tinymce/caret/CaretPosition"],function(NodeType,DomUtils,Fun,Arr,CaretPosition){function normalizedParent(node){var parentNode=node.parentNode;return isBogus(parentNode)?normalizedParent(parentNode):parentNode}function getChildNodes(node){return node?Arr.reduce(node.childNodes,function(result,node){return isBogus(node)&&"BR"!=node.nodeName?result=result.concat(getChildNodes(node)):result.push(node),result},[]):[]}function normalizedTextOffset(textNode,offset){for(;(textNode=textNode.previousSibling)&&isText(textNode);)offset+=textNode.data.length;return offset}function equal(targetValue){return function(value){return targetValue===value}}function normalizedNodeIndex(node){var nodes,index,numTextFragments;return nodes=getChildNodes(normalizedParent(node)),index=Arr.findIndex(nodes,equal(node),node),nodes=nodes.slice(0,index+1),numTextFragments=Arr.reduce(nodes,function(result,node,i){return isText(node)&&isText(nodes[i-1])&&result++,result},0),nodes=Arr.filter(nodes,NodeType.matchNodeNames(node.nodeName)),index=Arr.findIndex(nodes,equal(node),node),index-numTextFragments}function createPathItem(node){var name;return name=isText(node)?"text()":node.nodeName.toLowerCase(),name+"["+normalizedNodeIndex(node)+"]"}function parentsUntil(rootNode,node,predicate){var parents=[];for(node=node.parentNode;node!=rootNode&&(!predicate||!predicate(node));node=node.parentNode)parents.push(node);return parents}function create(rootNode,caretPosition){var container,offset,outputOffset,childNodes,parents,path=[];return container=caretPosition.container(),offset=caretPosition.offset(),isText(container)?outputOffset=normalizedTextOffset(container,offset):(childNodes=container.childNodes,offset>=childNodes.length?(outputOffset="after",offset=childNodes.length-1):outputOffset="before",container=childNodes[offset]),path.push(createPathItem(container)),parents=parentsUntil(rootNode,container),parents=Arr.filter(parents,Fun.negate(NodeType.isBogus)),path=path.concat(Arr.map(parents,function(node){return createPathItem(node)})),path.reverse().join("/")+","+outputOffset}function resolvePathItem(node,name,index){var nodes=getChildNodes(node);return nodes=Arr.filter(nodes,function(node,index){return!isText(node)||!isText(nodes[index-1])}),nodes=Arr.filter(nodes,NodeType.matchNodeNames(name)),nodes[index]}function findTextPosition(container,offset){for(var dataLen,node=container,targetOffset=0;isText(node);){if(dataLen=node.data.length,offset>=targetOffset&&offset<=targetOffset+dataLen){container=node,offset-=targetOffset;break}if(!isText(node.nextSibling)){container=node,offset=dataLen;break}targetOffset+=dataLen,node=node.nextSibling}return offset>container.data.length&&(offset=container.data.length),new CaretPosition(container,offset)}function resolve(rootNode,path){var parts,container,offset;return path?(parts=path.split(","),path=parts[0].split("/"),offset=parts.length>1?parts[1]:"before",container=Arr.reduce(path,function(result,value){return(value=/([\w\-\(\)]+)\[([0-9]+)\]/.exec(value))?("text()"===value[1]&&(value[1]="#text"),resolvePathItem(result,value[1],parseInt(value[2],10))):null},rootNode),container?isText(container)?findTextPosition(container,parseInt(offset,10)):(offset="after"===offset?nodeIndex(container)+1:nodeIndex(container),new CaretPosition(container.parentNode,offset)):null):null}var isText=NodeType.isText,isBogus=NodeType.isBogus,nodeIndex=DomUtils.nodeIndex;return{create:create,resolve:resolve}}),define("tinymce/dom/BookmarkManager",["tinymce/Env","tinymce/util/Tools","tinymce/caret/CaretContainer","tinymce/caret/CaretBookmark","tinymce/caret/CaretPosition","tinymce/dom/NodeType"],function(Env,Tools,CaretContainer,CaretBookmark,CaretPosition,NodeType){function BookmarkManager(selection){var dom=selection.dom;this.getBookmark=function(type,normalized){function findIndex(name,element){var count=0;return Tools.each(dom.select(name),function(node){if("all"!==node.getAttribute("data-mce-bogus"))return node!=element&&void count++}),count}function normalizeTableCellSelection(rng){function moveEndPoint(start){var container,offset,childNodes,prefix=start?"start":"end";container=rng[prefix+"Container"],offset=rng[prefix+"Offset"],1==container.nodeType&&"TR"==container.nodeName&&(childNodes=container.childNodes,container=childNodes[Math.min(start?offset:offset-1,childNodes.length-1)],container&&(offset=start?0:container.childNodes.length,rng["set"+(start?"Start":"End")](container,offset)))}return moveEndPoint(!0),moveEndPoint(),rng}function getLocation(rng){function getPoint(rng,start){var node,childNodes,container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],point=[],after=0;if(3==container.nodeType){if(normalized)for(node=container.previousSibling;node&&3==node.nodeType;node=node.previousSibling)offset+=node.nodeValue.length;point.push(offset)}else childNodes=container.childNodes,offset>=childNodes.length&&childNodes.length&&(after=1,offset=Math.max(0,childNodes.length-1)),point.push(dom.nodeIndex(childNodes[offset],normalized)+after);for(;container&&container!=root;container=container.parentNode)point.push(dom.nodeIndex(container,normalized));return point}var root=dom.getRoot(),bookmark={};return bookmark.start=getPoint(rng,!0),selection.isCollapsed()||(bookmark.end=getPoint(rng)),bookmark}function findAdjacentContentEditableFalseElm(rng){function findSibling(node){var sibling;if(CaretContainer.isCaretContainer(node)){if(NodeType.isText(node)&&CaretContainer.isCaretContainerBlock(node)&&(node=node.parentNode),sibling=node.previousSibling,isContentEditableFalse(sibling))return sibling;if(sibling=node.nextSibling,isContentEditableFalse(sibling))return sibling}}return findSibling(rng.startContainer)||findSibling(rng.endContainer)}var rng,rng2,id,collapsed,name,element,styles,chr="&#xFEFF;";if(2==type)return element=selection.getNode(),name=element?element.nodeName:null,rng=selection.getRng(),isContentEditableFalse(element)||"IMG"==name?{name:name,index:findIndex(name,element)}:selection.tridentSel?selection.tridentSel.getBookmark(type):(element=findAdjacentContentEditableFalseElm(rng),element?(name=element.tagName,{name:name,index:findIndex(name,element)}):getLocation(rng));if(3==type)return rng=selection.getRng(),{start:CaretBookmark.create(dom.getRoot(),CaretPosition.fromRangeStart(rng)),end:CaretBookmark.create(dom.getRoot(),CaretPosition.fromRangeEnd(rng))};if(type)return{rng:selection.getRng()};if(rng=selection.getRng(),id=dom.uniqueId(),collapsed=selection.isCollapsed(),styles="overflow:hidden;line-height:0px",rng.duplicate||rng.item){if(rng.item)return element=rng.item(0),name=element.nodeName,{name:name,index:findIndex(name,element)};rng2=rng.duplicate();try{rng.collapse(),rng.pasteHTML('<span data-mce-type="bookmark" id="'+id+'_start" style="'+styles+'">'+chr+"</span>"),collapsed||(rng2.collapse(!1),rng.moveToElementText(rng2.parentElement()),0===rng.compareEndPoints("StartToEnd",rng2)&&rng2.move("character",-1),rng2.pasteHTML('<span data-mce-type="bookmark" id="'+id+'_end" style="'+styles+'">'+chr+"</span>"))}catch(ex){return null}}else{if(element=selection.getNode(),name=element.nodeName,"IMG"==name)return{name:name,index:findIndex(name,element)};rng2=normalizeTableCellSelection(rng.cloneRange()),collapsed||(rng2.collapse(!1),rng2.insertNode(dom.create("span",{"data-mce-type":"bookmark",id:id+"_end",style:styles},chr))),rng=normalizeTableCellSelection(rng),rng.collapse(!0),rng.insertNode(dom.create("span",{"data-mce-type":"bookmark",id:id+"_start",style:styles},chr))}return selection.moveToBookmark({id:id,keep:1}),{id:id}},this.moveToBookmark=function(bookmark){function setEndPoint(start){var i,node,offset,children,point=bookmark[start?"start":"end"];if(point){for(offset=point[0],node=root,i=point.length-1;i>=1;i--){if(children=node.childNodes,point[i]>children.length-1)return;node=children[point[i]]}3===node.nodeType&&(offset=Math.min(point[0],node.nodeValue.length)),1===node.nodeType&&(offset=Math.min(point[0],node.childNodes.length)),start?rng.setStart(node,offset):rng.setEnd(node,offset)}return!0}function restoreEndPoint(suffix){var node,idx,next,prev,marker=dom.get(bookmark.id+"_"+suffix),keep=bookmark.keep;if(marker&&(node=marker.parentNode,"start"==suffix?(keep?(node=marker.firstChild,idx=1):idx=dom.nodeIndex(marker),startContainer=endContainer=node,startOffset=endOffset=idx):(keep?(node=marker.firstChild,idx=1):idx=dom.nodeIndex(marker),endContainer=node,endOffset=idx),!keep)){for(prev=marker.previousSibling,next=marker.nextSibling,Tools.each(Tools.grep(marker.childNodes),function(node){3==node.nodeType&&(node.nodeValue=node.nodeValue.replace(/\uFEFF/g,""))});marker=dom.get(bookmark.id+"_"+suffix);)dom.remove(marker,1);prev&&next&&prev.nodeType==next.nodeType&&3==prev.nodeType&&!Env.opera&&(idx=prev.nodeValue.length,prev.appendData(next.nodeValue),dom.remove(next),"start"==suffix?(startContainer=endContainer=prev,startOffset=endOffset=idx):(endContainer=prev,endOffset=idx))}}function addBogus(node){return!dom.isBlock(node)||node.innerHTML||Env.ie||(node.innerHTML='<br data-mce-bogus="1" />'),node}function resolveCaretPositionBookmark(){var rng,pos;return rng=dom.createRng(),pos=CaretBookmark.resolve(dom.getRoot(),bookmark.start),rng.setStart(pos.container(),pos.offset()),pos=CaretBookmark.resolve(dom.getRoot(),bookmark.end),rng.setEnd(pos.container(),pos.offset()),rng}var rng,root,startContainer,endContainer,startOffset,endOffset;if(bookmark)if(Tools.isArray(bookmark.start)){if(rng=dom.createRng(),root=dom.getRoot(),selection.tridentSel)return selection.tridentSel.moveToBookmark(bookmark);setEndPoint(!0)&&setEndPoint()&&selection.setRng(rng)}else"string"==typeof bookmark.start?selection.setRng(resolveCaretPositionBookmark(bookmark)):bookmark.id?(restoreEndPoint("start"),restoreEndPoint("end"),startContainer&&(rng=dom.createRng(),rng.setStart(addBogus(startContainer),startOffset),rng.setEnd(addBogus(endContainer),endOffset),selection.setRng(rng))):bookmark.name?selection.select(dom.select(bookmark.name)[bookmark.index]):bookmark.rng&&selection.setRng(bookmark.rng)}}var isContentEditableFalse=NodeType.isContentEditableFalse;return BookmarkManager.isBookmarkNode=function(node){return node&&"SPAN"===node.tagName&&"bookmark"===node.getAttribute("data-mce-type")},BookmarkManager}),define("tinymce/dom/Selection",["tinymce/dom/TreeWalker","tinymce/dom/TridentSelection","tinymce/dom/ControlSelection","tinymce/dom/RangeUtils","tinymce/dom/BookmarkManager","tinymce/dom/NodeType","tinymce/Env","tinymce/util/Tools"],function(TreeWalker,TridentSelection,ControlSelection,RangeUtils,BookmarkManager,NodeType,Env,Tools){function Selection(dom,win,serializer,editor){var self=this;self.dom=dom,self.win=win,self.serializer=serializer,self.editor=editor,self.bookmarkManager=new BookmarkManager(self),self.controlSelection=new ControlSelection(self,editor),self.win.getSelection||(self.tridentSel=new TridentSelection(self))}var each=Tools.each,trim=Tools.trim,isIE=Env.ie;return Selection.prototype={setCursorLocation:function(node,offset){var self=this,rng=self.dom.createRng();node?(rng.setStart(node,offset),rng.setEnd(node,offset),self.setRng(rng),self.collapse(!1)):(self._moveEndPoint(rng,self.editor.getBody(),!0),self.setRng(rng))},getContent:function(args){var whiteSpaceBefore,whiteSpaceAfter,fragment,self=this,rng=self.getRng(),tmpElm=self.dom.create("body"),se=self.getSel();
return args=args||{},whiteSpaceBefore=whiteSpaceAfter="",args.get=!0,args.format=args.format||"html",args.selection=!0,self.editor.fire("BeforeGetContent",args),"text"==args.format?self.isCollapsed()?"":rng.text||(se.toString?se.toString():""):(rng.cloneContents?(fragment=rng.cloneContents(),fragment&&tmpElm.appendChild(fragment)):rng.item!==undefined||rng.htmlText!==undefined?(tmpElm.innerHTML="<br>"+(rng.item?rng.item(0).outerHTML:rng.htmlText),tmpElm.removeChild(tmpElm.firstChild)):tmpElm.innerHTML=rng.toString(),/^\s/.test(tmpElm.innerHTML)&&(whiteSpaceBefore=" "),/\s+$/.test(tmpElm.innerHTML)&&(whiteSpaceAfter=" "),args.getInner=!0,args.content=self.isCollapsed()?"":whiteSpaceBefore+self.serializer.serialize(tmpElm,args)+whiteSpaceAfter,self.editor.fire("GetContent",args),args.content)},setContent:function(content,args){var caretNode,frag,temp,self=this,rng=self.getRng(),doc=self.win.document;if(args=args||{format:"html"},args.set=!0,args.selection=!0,args.content=content,args.no_events||self.editor.fire("BeforeSetContent",args),content=args.content,rng.insertNode){content+='<span id="__caret">_</span>',rng.startContainer==doc&&rng.endContainer==doc?doc.body.innerHTML=content:(rng.deleteContents(),0===doc.body.childNodes.length?doc.body.innerHTML=content:rng.createContextualFragment?rng.insertNode(rng.createContextualFragment(content)):(frag=doc.createDocumentFragment(),temp=doc.createElement("div"),frag.appendChild(temp),temp.outerHTML=content,rng.insertNode(frag))),caretNode=self.dom.get("__caret"),rng=doc.createRange(),rng.setStartBefore(caretNode),rng.setEndBefore(caretNode),self.setRng(rng),self.dom.remove("__caret");try{self.setRng(rng)}catch(ex){}}else rng.item&&(doc.execCommand("Delete",!1,null),rng=self.getRng()),/^\s+/.test(content)?(rng.pasteHTML('<span id="__mce_tmp">_</span>'+content),self.dom.remove("__mce_tmp")):rng.pasteHTML(content);args.no_events||self.editor.fire("SetContent",args)},getStart:function(real){var startElement,parentElement,checkRng,node,self=this,rng=self.getRng();if(rng.duplicate||rng.item){if(rng.item)return rng.item(0);for(checkRng=rng.duplicate(),checkRng.collapse(1),startElement=checkRng.parentElement(),startElement.ownerDocument!==self.dom.doc&&(startElement=self.dom.getRoot()),parentElement=node=rng.parentElement();node=node.parentNode;)if(node==startElement){startElement=parentElement;break}return startElement}return startElement=rng.startContainer,1==startElement.nodeType&&startElement.hasChildNodes()&&(real&&rng.collapsed||(startElement=startElement.childNodes[Math.min(startElement.childNodes.length-1,rng.startOffset)])),startElement&&3==startElement.nodeType?startElement.parentNode:startElement},getEnd:function(real){var endElement,endOffset,self=this,rng=self.getRng();return rng.duplicate||rng.item?rng.item?rng.item(0):(rng=rng.duplicate(),rng.collapse(0),endElement=rng.parentElement(),endElement.ownerDocument!==self.dom.doc&&(endElement=self.dom.getRoot()),endElement&&"BODY"==endElement.nodeName?endElement.lastChild||endElement:endElement):(endElement=rng.endContainer,endOffset=rng.endOffset,1==endElement.nodeType&&endElement.hasChildNodes()&&(real&&rng.collapsed||(endElement=endElement.childNodes[endOffset>0?endOffset-1:endOffset])),endElement&&3==endElement.nodeType?endElement.parentNode:endElement)},getBookmark:function(type,normalized){return this.bookmarkManager.getBookmark(type,normalized)},moveToBookmark:function(bookmark){return this.bookmarkManager.moveToBookmark(bookmark)},select:function(node,content){var idx,self=this,dom=self.dom,rng=dom.createRng();if(self.lastFocusBookmark=null,node){if(!content&&self.controlSelection.controlSelect(node))return;idx=dom.nodeIndex(node),rng.setStart(node.parentNode,idx),rng.setEnd(node.parentNode,idx+1),content&&(self._moveEndPoint(rng,node,!0),self._moveEndPoint(rng,node)),self.setRng(rng)}return node},isCollapsed:function(){var self=this,rng=self.getRng(),sel=self.getSel();return!(!rng||rng.item)&&(rng.compareEndPoints?0===rng.compareEndPoints("StartToEnd",rng):!sel||rng.collapsed)},collapse:function(toStart){var node,self=this,rng=self.getRng();rng.item&&(node=rng.item(0),rng=self.win.document.body.createTextRange(),rng.moveToElementText(node)),rng.collapse(!!toStart),self.setRng(rng)},getSel:function(){var win=this.win;return win.getSelection?win.getSelection():win.document.selection},getRng:function(w3c){function tryCompareBoundaryPoints(how,sourceRange,destinationRange){try{return sourceRange.compareBoundaryPoints(how,destinationRange)}catch(ex){return-1}}var selection,rng,elm,doc,ieRng,evt,self=this;if(!self.win)return null;if(doc=self.win.document,!w3c&&self.lastFocusBookmark){var bookmark=self.lastFocusBookmark;return bookmark.startContainer?(rng=doc.createRange(),rng.setStart(bookmark.startContainer,bookmark.startOffset),rng.setEnd(bookmark.endContainer,bookmark.endOffset)):rng=bookmark,rng}if(w3c&&self.tridentSel)return self.tridentSel.getRangeAt(0);try{(selection=self.getSel())&&(rng=selection.rangeCount>0?selection.getRangeAt(0):selection.createRange?selection.createRange():doc.createRange())}catch(ex){}if(evt=self.editor.fire("GetSelectionRange",{range:rng}),evt.range!==rng)return evt.range;if(isIE&&rng&&rng.setStart&&doc.selection){try{ieRng=doc.selection.createRange()}catch(ex){}ieRng&&ieRng.item&&(elm=ieRng.item(0),rng=doc.createRange(),rng.setStartBefore(elm),rng.setEndAfter(elm))}return rng||(rng=doc.createRange?doc.createRange():doc.body.createTextRange()),rng.setStart&&9===rng.startContainer.nodeType&&rng.collapsed&&(elm=self.dom.getRoot(),rng.setStart(elm,0),rng.setEnd(elm,0)),self.selectedRange&&self.explicitRange&&(0===tryCompareBoundaryPoints(rng.START_TO_START,rng,self.selectedRange)&&0===tryCompareBoundaryPoints(rng.END_TO_END,rng,self.selectedRange)?rng=self.explicitRange:(self.selectedRange=null,self.explicitRange=null)),rng},setRng:function(rng,forward){var sel,node,evt,self=this;if(rng)if(rng.select){self.explicitRange=null;try{rng.select()}catch(ex){}}else if(self.tridentSel){if(rng.cloneRange)try{self.tridentSel.addRange(rng)}catch(ex){}}else{if(sel=self.getSel(),evt=self.editor.fire("SetSelectionRange",{range:rng}),rng=evt.range,sel){self.explicitRange=rng;try{sel.removeAllRanges(),sel.addRange(rng)}catch(ex){}forward===!1&&sel.extend&&(sel.collapse(rng.endContainer,rng.endOffset),sel.extend(rng.startContainer,rng.startOffset)),self.selectedRange=sel.rangeCount>0?sel.getRangeAt(0):null}rng.collapsed||rng.startContainer!=rng.endContainer||!sel.setBaseAndExtent||Env.ie||rng.endOffset-rng.startOffset<2&&rng.startContainer.hasChildNodes()&&(node=rng.startContainer.childNodes[rng.startOffset],node&&"IMG"==node.tagName&&self.getSel().setBaseAndExtent(node,0,node,1))}},setNode:function(elm){var self=this;return self.setContent(self.dom.getOuterHTML(elm)),elm},getNode:function(){function skipEmptyTextNodes(node,forwards){for(var orig=node;node&&3===node.nodeType&&0===node.length;)node=forwards?node.nextSibling:node.previousSibling;return node||orig}var elm,startContainer,endContainer,startOffset,endOffset,self=this,rng=self.getRng(),root=self.dom.getRoot();return rng?(startContainer=rng.startContainer,endContainer=rng.endContainer,startOffset=rng.startOffset,endOffset=rng.endOffset,rng.setStart?(elm=rng.commonAncestorContainer,!rng.collapsed&&(startContainer==endContainer&&endOffset-startOffset<2&&startContainer.hasChildNodes()&&(elm=startContainer.childNodes[startOffset]),3===startContainer.nodeType&&3===endContainer.nodeType&&(startContainer=startContainer.length===startOffset?skipEmptyTextNodes(startContainer.nextSibling,!0):startContainer.parentNode,endContainer=0===endOffset?skipEmptyTextNodes(endContainer.previousSibling,!1):endContainer.parentNode,startContainer&&startContainer===endContainer))?startContainer:elm&&3==elm.nodeType?elm.parentNode:elm):(elm=rng.item?rng.item(0):rng.parentElement(),elm.ownerDocument!==self.win.document&&(elm=root),elm)):root},getSelectedBlocks:function(startElm,endElm){var node,root,self=this,dom=self.dom,selectedBlocks=[];if(root=dom.getRoot(),startElm=dom.getParent(startElm||self.getStart(),dom.isBlock),endElm=dom.getParent(endElm||self.getEnd(),dom.isBlock),startElm&&startElm!=root&&selectedBlocks.push(startElm),startElm&&endElm&&startElm!=endElm){node=startElm;for(var walker=new TreeWalker(startElm,root);(node=walker.next())&&node!=endElm;)dom.isBlock(node)&&selectedBlocks.push(node)}return endElm&&startElm!=endElm&&endElm!=root&&selectedBlocks.push(endElm),selectedBlocks},isForward:function(){var anchorRange,focusRange,dom=this.dom,sel=this.getSel();return!(sel&&sel.anchorNode&&sel.focusNode)||(anchorRange=dom.createRng(),anchorRange.setStart(sel.anchorNode,sel.anchorOffset),anchorRange.collapse(!0),focusRange=dom.createRng(),focusRange.setStart(sel.focusNode,sel.focusOffset),focusRange.collapse(!0),anchorRange.compareBoundaryPoints(anchorRange.START_TO_START,focusRange)<=0)},normalize:function(){var self=this,rng=self.getRng();return Env.range&&new RangeUtils(self.dom).normalize(rng)&&self.setRng(rng,self.isForward()),rng},selectorChanged:function(selector,callback){var currentSelectors,self=this;return self.selectorChangedData||(self.selectorChangedData={},currentSelectors={},self.editor.on("NodeChange",function(e){var node=e.element,dom=self.dom,parents=dom.getParents(node,null,dom.getRoot()),matchedSelectors={};each(self.selectorChangedData,function(callbacks,selector){each(parents,function(node){if(dom.is(node,selector))return currentSelectors[selector]||(each(callbacks,function(callback){callback(!0,{node:node,selector:selector,parents:parents})}),currentSelectors[selector]=callbacks),matchedSelectors[selector]=callbacks,!1})}),each(currentSelectors,function(callbacks,selector){matchedSelectors[selector]||(delete currentSelectors[selector],each(callbacks,function(callback){callback(!1,{node:node,selector:selector,parents:parents})}))})})),self.selectorChangedData[selector]||(self.selectorChangedData[selector]=[]),self.selectorChangedData[selector].push(callback),self},getScrollContainer:function(){for(var scrollContainer,node=this.dom.getRoot();node&&"BODY"!=node.nodeName;){if(node.scrollHeight>node.clientHeight){scrollContainer=node;break}node=node.parentNode}return scrollContainer},scrollIntoView:function(elm,alignToTop){function getPos(elm){for(var x=0,y=0,offsetParent=elm;offsetParent&&offsetParent.nodeType;)x+=offsetParent.offsetLeft||0,y+=offsetParent.offsetTop||0,offsetParent=offsetParent.offsetParent;return{x:x,y:y}}var y,viewPort,viewPortY,viewPortH,self=this,dom=self.dom,root=dom.getRoot(),offsetY=0;if(NodeType.isElement(elm)){if(alignToTop===!1&&(offsetY=elm.offsetHeight),"BODY"!=root.nodeName){var scrollContainer=self.getScrollContainer();if(scrollContainer)return y=getPos(elm).y-getPos(scrollContainer).y+offsetY,viewPortH=scrollContainer.clientHeight,viewPortY=scrollContainer.scrollTop,void((y<viewPortY||y+25>viewPortY+viewPortH)&&(scrollContainer.scrollTop=y<viewPortY?y:y-viewPortH+25))}viewPort=dom.getViewPort(self.editor.getWin()),y=dom.getPos(elm).y+offsetY,viewPortY=viewPort.y,viewPortH=viewPort.h,(y<viewPort.y||y+25>viewPortY+viewPortH)&&self.editor.getWin().scrollTo(0,y<viewPortY?y:y-viewPortH+25)}},placeCaretAt:function(clientX,clientY){this.setRng(RangeUtils.getCaretRangeFromPoint(clientX,clientY,this.editor.getDoc()))},_moveEndPoint:function(rng,node,start){var root=node,walker=new TreeWalker(node,root),nonEmptyElementsMap=this.dom.schema.getNonEmptyElements();do{if(3==node.nodeType&&0!==trim(node.nodeValue).length)return void(start?rng.setStart(node,0):rng.setEnd(node,node.nodeValue.length));if(nonEmptyElementsMap[node.nodeName]&&!/^(TD|TH)$/.test(node.nodeName))return void(start?rng.setStartBefore(node):"BR"==node.nodeName?rng.setEndBefore(node):rng.setEndAfter(node));if(Env.ie&&Env.ie<11&&this.dom.isBlock(node)&&this.dom.isEmpty(node))return void(start?rng.setStart(node,0):rng.setEnd(node,0))}while(node=start?walker.next():walker.prev());"BODY"==root.nodeName&&(start?rng.setStart(root,0):rng.setEnd(root,root.childNodes.length))},destroy:function(){this.win=null,this.controlSelection.destroy()}},Selection}),define("tinymce/dom/ElementUtils",["tinymce/dom/BookmarkManager","tinymce/util/Tools"],function(BookmarkManager,Tools){function ElementUtils(dom){this.compare=function(node1,node2){function getAttribs(node){var attribs={};return each(dom.getAttribs(node),function(attr){var name=attr.nodeName.toLowerCase();0!==name.indexOf("_")&&"style"!==name&&"data-mce-style"!==name&&"data-mce-fragment"!=name&&(attribs[name]=dom.getAttrib(node,name))}),attribs}function compareObjects(obj1,obj2){var value,name;for(name in obj1)if(obj1.hasOwnProperty(name)){if(value=obj2[name],"undefined"==typeof value)return!1;if(obj1[name]!=value)return!1;delete obj2[name]}for(name in obj2)if(obj2.hasOwnProperty(name))return!1;return!0}return node1.nodeName==node2.nodeName&&(!!compareObjects(getAttribs(node1),getAttribs(node2))&&(!!compareObjects(dom.parseStyle(dom.getAttrib(node1,"style")),dom.parseStyle(dom.getAttrib(node2,"style")))&&(!BookmarkManager.isBookmarkNode(node1)&&!BookmarkManager.isBookmarkNode(node2))))}}var each=Tools.each;return ElementUtils}),define("tinymce/fmt/Preview",["tinymce/util/Tools"],function(Tools){function getCssText(editor,format){function removeVars(val){return val.replace(/%(\w+)/g,"")}var name,previewElm,parentFontSize,previewStyles,dom=editor.dom,previewCss="";if(previewStyles=editor.settings.preview_styles,previewStyles===!1)return"";if(previewStyles||(previewStyles="font-family font-size font-weight font-style text-decoration text-transform color background-color border border-radius outline text-shadow"),"string"==typeof format){if(format=editor.formatter.get(format),!format)return;format=format[0]}return name=format.block||format.inline||"span",previewElm=dom.create(name),each(format.styles,function(value,name){value=removeVars(value),value&&dom.setStyle(previewElm,name,value)}),each(format.attributes,function(value,name){value=removeVars(value),value&&dom.setAttrib(previewElm,name,value)}),each(format.classes,function(value){value=removeVars(value),dom.hasClass(previewElm,value)||dom.addClass(previewElm,value)}),editor.fire("PreviewFormats"),dom.setStyles(previewElm,{position:"absolute",left:-65535}),editor.getBody().appendChild(previewElm),parentFontSize=dom.getStyle(editor.getBody(),"fontSize",!0),parentFontSize=/px$/.test(parentFontSize)?parseInt(parentFontSize,10):0,each(previewStyles.split(" "),function(name){var value=dom.getStyle(previewElm,name,!0);if(!("background-color"==name&&/transparent|rgba\s*\([^)]+,\s*0\)/.test(value)&&(value=dom.getStyle(editor.getBody(),name,!0),"#ffffff"==dom.toHex(value).toLowerCase())||"color"==name&&"#000000"==dom.toHex(value).toLowerCase())){if("font-size"==name&&/em|%$/.test(value)){if(0===parentFontSize)return;value=parseFloat(value,10)/(/%$/.test(value)?100:1),value=value*parentFontSize+"px"}"border"==name&&value&&(previewCss+="padding:0 2px;"),previewCss+=name+":"+value+";"}}),editor.fire("AfterPreviewFormats"),dom.remove(previewElm),previewCss}var each=Tools.each;return{getCssText:getCssText}}),define("tinymce/fmt/Hooks",["tinymce/util/Arr","tinymce/dom/NodeType","tinymce/dom/DomQuery"],function(Arr,NodeType,$){function addPostProcessHook(name,hook){var hooks=postProcessHooks[name];hooks||(postProcessHooks[name]=hooks=[]),postProcessHooks[name].push(hook)}function postProcess(name,editor){each(postProcessHooks[name],function(hook){hook(editor)})}var postProcessHooks=[],filter=Arr.filter,each=Arr.each;return addPostProcessHook("pre",function(editor){function hasPreSibling(pre){return isPre(pre.previousSibling)&&Arr.indexOf(blocks,pre.previousSibling)!=-1}function joinPre(pre1,pre2){$(pre2).remove(),$(pre1).append("<br><br>").append(pre2.childNodes)}var isPre,blocks,rng=editor.selection.getRng();isPre=NodeType.matchNodeNames("pre"),rng.collapsed||(blocks=editor.selection.getSelectedBlocks(),each(filter(filter(blocks,isPre),hasPreSibling),function(pre){joinPre(pre.previousSibling,pre)}))}),{postProcess:postProcess}}),define("tinymce/Formatter",["tinymce/dom/TreeWalker","tinymce/dom/RangeUtils","tinymce/dom/BookmarkManager","tinymce/dom/ElementUtils","tinymce/util/Tools","tinymce/fmt/Preview","tinymce/fmt/Hooks"],function(TreeWalker,RangeUtils,BookmarkManager,ElementUtils,Tools,Preview,Hooks){return function(ed){function isTextBlock(name){return name.nodeType&&(name=name.nodeName),!!ed.schema.getTextBlockElements()[name.toLowerCase()]}function isTableCell(node){return/^(TH|TD)$/.test(node.nodeName)}function isInlineBlock(node){return node&&/^(IMG)$/.test(node.nodeName)}function getParents(node,selector){return dom.getParents(node,selector,dom.getRoot())}function isCaretNode(node){return 1===node.nodeType&&"_mce_caret"===node.id}function defaultFormats(){register({valigntop:[{selector:"td,th",styles:{verticalAlign:"top"}}],valignmiddle:[{selector:"td,th",styles:{verticalAlign:"middle"}}],valignbottom:[{selector:"td,th",styles:{verticalAlign:"bottom"}}],alignleft:[{selector:"figure.image",collapsed:!1,classes:"align-left",ceFalseOverride:!0},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"left"},inherit:!1,defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"left"}}],aligncenter:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"center"},inherit:!1,defaultBlock:"div"},{selector:"figure.image",collapsed:!1,classes:"align-center",ceFalseOverride:!0},{selector:"img",collapsed:!1,styles:{display:"block",marginLeft:"auto",marginRight:"auto"}},{selector:"table",collapsed:!1,styles:{marginLeft:"auto",marginRight:"auto"}}],alignright:[{selector:"figure.image",collapsed:!1,classes:"align-right",ceFalseOverride:!0},{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"right"},inherit:!1,defaultBlock:"div"},{selector:"img,table",collapsed:!1,styles:{"float":"right"}}],alignjustify:[{selector:"figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li",styles:{textAlign:"justify"},inherit:!1,defaultBlock:"div"}],bold:[{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}},{inline:"b",remove:"all"}],italic:[{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}},{inline:"i",remove:"all"}],underline:[{inline:"span",styles:{textDecoration:"underline"},exact:!0},{inline:"u",remove:"all"}],strikethrough:[{inline:"span",styles:{textDecoration:"line-through"},exact:!0},{inline:"strike",remove:"all"}],forecolor:{inline:"span",styles:{color:"%value"},links:!0,remove_similar:!0},hilitecolor:{inline:"span",styles:{backgroundColor:"%value"},links:!0,remove_similar:!0},fontname:{inline:"span",styles:{fontFamily:"%value"}},fontsize:{inline:"span",styles:{fontSize:"%value"}},fontsize_class:{inline:"span",attributes:{"class":"%value"}},blockquote:{block:"blockquote",wrapper:1,remove:"all"},subscript:{inline:"sub"},superscript:{inline:"sup"},code:{inline:"code"},link:{inline:"a",selector:"a",remove:"all",split:!0,deep:!0,onmatch:function(){return!0},onformat:function(elm,fmt,vars){each(vars,function(value,key){dom.setAttrib(elm,key,value)})}},removeformat:[{selector:"b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins",remove:"all",split:!0,expand:!1,block_expand:!0,deep:!0},{selector:"span",attributes:["style","class"],remove:"empty",split:!0,expand:!1,deep:!0},{selector:"*",attributes:["style","class"],split:!1,expand:!1,deep:!0}]}),each("p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp".split(/\s/),function(name){register(name,{block:name,remove:"all"})}),register(ed.settings.formats)}function addKeyboardShortcuts(){ed.addShortcut("meta+b","bold_desc","Bold"),ed.addShortcut("meta+i","italic_desc","Italic"),ed.addShortcut("meta+u","underline_desc","Underline");for(var i=1;i<=6;i++)ed.addShortcut("access+"+i,"",["FormatBlock",!1,"h"+i]);ed.addShortcut("access+7","",["FormatBlock",!1,"p"]),ed.addShortcut("access+8","",["FormatBlock",!1,"div"]),ed.addShortcut("access+9","",["FormatBlock",!1,"address"])}function get(name){return name?formats[name]:formats}function register(name,format){name&&("string"!=typeof name?each(name,function(format,name){register(name,format)}):(format=format.length?format:[format],each(format,function(format){format.deep===undef&&(format.deep=!format.selector),format.split===undef&&(format.split=!format.selector||format.inline),format.remove===undef&&format.selector&&!format.inline&&(format.remove="none"),format.selector&&format.inline&&(format.mixed=!0,format.block_expand=!0),"string"==typeof format.classes&&(format.classes=format.classes.split(/\s+/))}),formats[name]=format))}function unregister(name){return name&&formats[name]&&delete formats[name],formats}function matchesUnInheritedFormatSelector(node,name){var formatList=get(name);if(formatList)for(var i=0;i<formatList.length;i++)if(formatList[i].inherit===!1&&dom.is(node,formatList[i].selector))return!0;return!1}function getTextDecoration(node){var decoration;return ed.dom.getParent(node,function(n){return decoration=ed.dom.getStyle(n,"text-decoration"),decoration&&"none"!==decoration}),decoration}function processUnderlineAndColor(node){var textDecoration;1===node.nodeType&&node.parentNode&&1===node.parentNode.nodeType&&(textDecoration=getTextDecoration(node.parentNode),ed.dom.getStyle(node,"color")&&textDecoration?ed.dom.setStyle(node,"text-decoration",textDecoration):ed.dom.getStyle(node,"text-decoration")===textDecoration&&ed.dom.setStyle(node,"text-decoration",null))}function apply(name,vars,node){function setElementFormat(elm,fmt){if(fmt=fmt||format,elm){if(fmt.onformat&&fmt.onformat(elm,fmt,vars,node),each(fmt.styles,function(value,name){dom.setStyle(elm,name,replaceVars(value,vars))}),fmt.styles){var styleVal=dom.getAttrib(elm,"style");styleVal&&elm.setAttribute("data-mce-style",styleVal)}each(fmt.attributes,function(value,name){dom.setAttrib(elm,name,replaceVars(value,vars))}),each(fmt.classes,function(value){value=replaceVars(value,vars),dom.hasClass(elm,value)||dom.addClass(elm,value)})}}function adjustSelectionToVisibleSelection(){function findSelectionEnd(start,end){var walker=new TreeWalker(end);for(node=walker.prev2();node;node=walker.prev2()){if(3==node.nodeType&&node.data.length>0)return node;if(node.childNodes.length>1||node==start||"BR"==node.tagName)return node}}var rng=ed.selection.getRng(),start=rng.startContainer,end=rng.endContainer;if(start!=end&&0===rng.endOffset){var newEnd=findSelectionEnd(start,end),endOffset=3==newEnd.nodeType?newEnd.data.length:newEnd.childNodes.length;rng.setEnd(newEnd,endOffset)}return rng}function applyRngStyle(rng,bookmark,node_specific){var wrapName,wrapElm,newWrappers=[],contentEditable=!0;wrapName=format.inline||format.block,wrapElm=dom.create(wrapName),setElementFormat(wrapElm),rangeUtils.walk(rng,function(nodes){function process(node){var nodeName,parentName,found,hasContentEditableState,lastContentEditable;return lastContentEditable=contentEditable,nodeName=node.nodeName.toLowerCase(),parentName=node.parentNode.nodeName.toLowerCase(),1===node.nodeType&&getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===getContentEditable(node),hasContentEditableState=!0),isEq(nodeName,"br")?(currentWrapElm=0,void(format.block&&dom.remove(node))):format.wrapper&&matchNode(node,name,vars)?void(currentWrapElm=0):contentEditable&&!hasContentEditableState&&format.block&&!format.wrapper&&isTextBlock(nodeName)&&isValid(parentName,wrapName)?(node=dom.rename(node,wrapName),setElementFormat(node),newWrappers.push(node),void(currentWrapElm=0)):format.selector&&(each(formatList,function(format){if(!("collapsed"in format&&format.collapsed!==isCollapsed))return dom.is(node,format.selector)&&!isCaretNode(node)?(setElementFormat(node,format),found=!0,!1):void 0}),!format.inline||found)?void(currentWrapElm=0):void(!contentEditable||hasContentEditableState||!isValid(wrapName,nodeName)||!isValid(parentName,wrapName)||!node_specific&&3===node.nodeType&&1===node.nodeValue.length&&65279===node.nodeValue.charCodeAt(0)||isCaretNode(node)||format.inline&&isBlock(node)?(currentWrapElm=0,each(grep(node.childNodes),process),hasContentEditableState&&(contentEditable=lastContentEditable),currentWrapElm=0):(currentWrapElm||(currentWrapElm=dom.clone(wrapElm,FALSE),node.parentNode.insertBefore(currentWrapElm,node),newWrappers.push(currentWrapElm)),currentWrapElm.appendChild(node)))}var currentWrapElm;each(nodes,process)}),format.links===!0&&each(newWrappers,function(node){function process(node){"A"===node.nodeName&&setElementFormat(node,format),each(grep(node.childNodes),process)}process(node)}),each(newWrappers,function(node){function getChildCount(node){var count=0;return each(node.childNodes,function(node){isWhiteSpaceNode(node)||isBookmarkNode(node)||count++}),count}function mergeStyles(node){var child,clone;return each(node.childNodes,function(node){if(1==node.nodeType&&!isBookmarkNode(node)&&!isCaretNode(node))return child=node,FALSE}),child&&!isBookmarkNode(child)&&matchName(child,format)&&(clone=dom.clone(child,FALSE),setElementFormat(clone),dom.replace(clone,node,TRUE),dom.remove(child,1)),clone||node}var childCount;if(childCount=getChildCount(node),(newWrappers.length>1||!isBlock(node))&&0===childCount)return void dom.remove(node,1);if(format.inline||format.wrapper){if(format.exact||1!==childCount||(node=mergeStyles(node)),each(formatList,function(format){each(dom.select(format.inline,node),function(child){isBookmarkNode(child)||removeFormat(format,vars,child,format.exact?child:null)})}),matchNode(node.parentNode,name,vars))return dom.remove(node,1),node=0,TRUE;format.merge_with_parents&&dom.getParent(node.parentNode,function(parent){if(matchNode(parent,name,vars))return dom.remove(node,1),node=0,TRUE}),node&&format.merge_siblings!==!1&&(node=mergeSiblings(getNonWhiteSpaceSibling(node),node),node=mergeSiblings(node,getNonWhiteSpaceSibling(node,TRUE)))}})}var bookmark,rng,formatList=get(name),format=formatList[0],isCollapsed=!node&&selection.isCollapsed();if("false"!==getContentEditable(selection.getNode())){if(format){if(node)node.nodeType?(rng=dom.createRng(),rng.setStartBefore(node),rng.setEndAfter(node),applyRngStyle(expandRng(rng,formatList),null,!0)):applyRngStyle(node,null,!0);else if(isCollapsed&&format.inline&&!dom.select("td[data-mce-selected],th[data-mce-selected]").length)performCaretAction("apply",name,vars);else{var curSelNode=ed.selection.getNode();forcedRootBlock||!formatList[0].defaultBlock||dom.getParent(curSelNode,dom.isBlock)||apply(formatList[0].defaultBlock),ed.selection.setRng(adjustSelectionToVisibleSelection()),bookmark=selection.getBookmark(),applyRngStyle(expandRng(selection.getRng(TRUE),formatList),bookmark),format.styles&&(format.styles.color||format.styles.textDecoration)&&(walk(curSelNode,processUnderlineAndColor,"childNodes"),processUnderlineAndColor(curSelNode)),selection.moveToBookmark(bookmark),moveStart(selection.getRng(TRUE)),ed.nodeChanged()}Hooks.postProcess(name,ed)}}else{node=selection.getNode();for(var i=0,l=formatList.length;i<l;i++)if(formatList[i].ceFalseOverride&&dom.is(node,formatList[i].selector))return void setElementFormat(node,formatList[i])}}function remove(name,vars,node,similar){function process(node){var children,i,l,lastContentEditable,hasContentEditableState;if(1===node.nodeType&&getContentEditable(node)&&(lastContentEditable=contentEditable,contentEditable="true"===getContentEditable(node),hasContentEditableState=!0),children=grep(node.childNodes),contentEditable&&!hasContentEditableState)for(i=0,l=formatList.length;i<l&&!removeFormat(formatList[i],vars,node,node);i++);if(format.deep&&children.length){for(i=0,l=children.length;i<l;i++)process(children[i]);hasContentEditableState&&(contentEditable=lastContentEditable)}}function findFormatRoot(container){var formatRoot;return each(getParents(container.parentNode).reverse(),function(parent){var format;formatRoot||"_start"==parent.id||"_end"==parent.id||(format=matchNode(parent,name,vars,similar),format&&format.split!==!1&&(formatRoot=parent))}),formatRoot}function wrapAndSplit(formatRoot,container,target,split){var parent,clone,lastClone,firstClone,i,formatRootParent;if(formatRoot){for(formatRootParent=formatRoot.parentNode,parent=container.parentNode;parent&&parent!=formatRootParent;parent=parent.parentNode){for(clone=dom.clone(parent,FALSE),i=0;i<formatList.length;i++)if(removeFormat(formatList[i],vars,clone,clone)){clone=0;break}clone&&(lastClone&&clone.appendChild(lastClone),firstClone||(firstClone=clone),lastClone=clone)}!split||format.mixed&&isBlock(formatRoot)||(container=dom.split(formatRoot,container)),lastClone&&(target.parentNode.insertBefore(lastClone,target),firstClone.appendChild(target))}return container}function splitToFormatRoot(container){return wrapAndSplit(findFormatRoot(container),container,container,!0)}function unwrap(start){var node=dom.get(start?"_start":"_end"),out=node[start?"firstChild":"lastChild"];return isBookmarkNode(out)&&(out=out[start?"firstChild":"lastChild"]),3==out.nodeType&&0===out.data.length&&(out=start?node.previousSibling||node.nextSibling:node.nextSibling||node.previousSibling),dom.remove(node,!0),out}function removeRngStyle(rng){var startContainer,endContainer,commonAncestorContainer=rng.commonAncestorContainer;if(rng=expandRng(rng,formatList,TRUE),format.split){if(startContainer=getContainer(rng,TRUE),endContainer=getContainer(rng),startContainer!=endContainer){if(/^(TR|TH|TD)$/.test(startContainer.nodeName)&&startContainer.firstChild&&(startContainer="TR"==startContainer.nodeName?startContainer.firstChild.firstChild||startContainer:startContainer.firstChild||startContainer),commonAncestorContainer&&/^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName)&&isTableCell(endContainer)&&endContainer.firstChild&&(endContainer=endContainer.firstChild||endContainer),dom.isChildOf(startContainer,endContainer)&&!isBlock(endContainer)&&!isTableCell(startContainer)&&!isTableCell(endContainer))return startContainer=wrap(startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),splitToFormatRoot(startContainer),void(startContainer=unwrap(TRUE));startContainer=wrap(startContainer,"span",{id:"_start","data-mce-type":"bookmark"}),endContainer=wrap(endContainer,"span",{id:"_end","data-mce-type":"bookmark"}),splitToFormatRoot(startContainer),splitToFormatRoot(endContainer),startContainer=unwrap(TRUE),endContainer=unwrap()}else startContainer=endContainer=splitToFormatRoot(startContainer);rng.startContainer=startContainer.parentNode?startContainer.parentNode:startContainer,rng.startOffset=nodeIndex(startContainer),rng.endContainer=endContainer.parentNode?endContainer.parentNode:endContainer,rng.endOffset=nodeIndex(endContainer)+1}rangeUtils.walk(rng,function(nodes){each(nodes,function(node){process(node),1===node.nodeType&&"underline"===ed.dom.getStyle(node,"text-decoration")&&node.parentNode&&"underline"===getTextDecoration(node.parentNode)&&removeFormat({deep:!1,exact:!0,inline:"span",styles:{textDecoration:"underline"}},null,node)})})}var bookmark,rng,formatList=get(name),format=formatList[0],contentEditable=!0;if(node)return void(node.nodeType?(rng=dom.createRng(),rng.setStartBefore(node),rng.setEndAfter(node),removeRngStyle(rng)):removeRngStyle(node));if("false"!==getContentEditable(selection.getNode()))selection.isCollapsed()&&format.inline&&!dom.select("td[data-mce-selected],th[data-mce-selected]").length?performCaretAction("remove",name,vars,similar):(bookmark=selection.getBookmark(),removeRngStyle(selection.getRng(TRUE)),selection.moveToBookmark(bookmark),format.inline&&match(name,vars,selection.getStart())&&moveStart(selection.getRng(!0)),ed.nodeChanged());else{node=selection.getNode();for(var i=0,l=formatList.length;i<l&&(!formatList[i].ceFalseOverride||!removeFormat(formatList[i],vars,node,node));i++);}}function toggle(name,vars,node){var fmt=get(name);!match(name,vars,node)||"toggle"in fmt[0]&&!fmt[0].toggle?apply(name,vars,node):remove(name,vars,node);
}function matchNode(node,name,vars,similar){function matchItems(node,format,item_name){var key,value,i,items=format[item_name];if(format.onmatch)return format.onmatch(node,format,item_name);if(items)if(items.length===undef){for(key in items)if(items.hasOwnProperty(key)){if(value="attributes"===item_name?dom.getAttrib(node,key):getStyle(node,key),similar&&!value&&!format.exact)return;if((!similar||format.exact)&&!isEq(value,normalizeStyleValue(replaceVars(items[key],vars),key)))return}}else for(i=0;i<items.length;i++)if("attributes"===item_name?dom.getAttrib(node,items[i]):getStyle(node,items[i]))return format;return format}var format,i,classes,formatList=get(name);if(formatList&&node)for(i=0;i<formatList.length;i++)if(format=formatList[i],matchName(node,format)&&matchItems(node,format,"attributes")&&matchItems(node,format,"styles")){if(classes=format.classes)for(i=0;i<classes.length;i++)if(!dom.hasClass(node,classes[i]))return;return format}}function match(name,vars,node){function matchParents(node){var root=dom.getRoot();return node!==root&&(node=dom.getParent(node,function(node){return!!matchesUnInheritedFormatSelector(node,name)||(node.parentNode===root||!!matchNode(node,name,vars,!0))}),matchNode(node,name,vars))}var startNode;return node?matchParents(node):(node=selection.getNode(),matchParents(node)?TRUE:(startNode=selection.getStart(),startNode!=node&&matchParents(startNode)?TRUE:FALSE))}function matchAll(names,vars){var startElement,matchedFormatNames=[],checkedMap={};return startElement=selection.getStart(),dom.getParent(startElement,function(node){var i,name;for(i=0;i<names.length;i++)name=names[i],!checkedMap[name]&&matchNode(node,name,vars)&&(checkedMap[name]=!0,matchedFormatNames.push(name))},dom.getRoot()),matchedFormatNames}function canApply(name){var startNode,parents,i,x,selector,formatList=get(name);if(formatList)for(startNode=selection.getStart(),parents=getParents(startNode),x=formatList.length-1;x>=0;x--){if(selector=formatList[x].selector,!selector||formatList[x].defaultBlock)return TRUE;for(i=parents.length-1;i>=0;i--)if(dom.is(parents[i],selector))return TRUE}return FALSE}function formatChanged(formats,callback,similar){var currentFormats;return formatChangeData||(formatChangeData={},currentFormats={},ed.on("NodeChange",function(e){var parents=getParents(e.element),matchedFormats={};parents=Tools.grep(parents,function(node){return 1==node.nodeType&&!node.getAttribute("data-mce-bogus")}),each(formatChangeData,function(callbacks,format){each(parents,function(node){return matchNode(node,format,{},callbacks.similar)?(currentFormats[format]||(each(callbacks,function(callback){callback(!0,{node:node,format:format,parents:parents})}),currentFormats[format]=callbacks),matchedFormats[format]=callbacks,!1):!matchesUnInheritedFormatSelector(node,format)&&void 0})}),each(currentFormats,function(callbacks,format){matchedFormats[format]||(delete currentFormats[format],each(callbacks,function(callback){callback(!1,{node:e.element,format:format,parents:parents})}))})})),each(formats.split(","),function(format){formatChangeData[format]||(formatChangeData[format]=[],formatChangeData[format].similar=similar),formatChangeData[format].push(callback)}),this}function getCssText(format){return Preview.getCssText(ed,format)}function matchName(node,format){return isEq(node,format.inline)?TRUE:isEq(node,format.block)?TRUE:format.selector?1==node.nodeType&&dom.is(node,format.selector):void 0}function isEq(str1,str2){return str1=str1||"",str2=str2||"",str1=""+(str1.nodeName||str1),str2=""+(str2.nodeName||str2),str1.toLowerCase()==str2.toLowerCase()}function getStyle(node,name){return normalizeStyleValue(dom.getStyle(node,name),name)}function normalizeStyleValue(value,name){return"color"!=name&&"backgroundColor"!=name||(value=dom.toHex(value)),"fontWeight"==name&&700==value&&(value="bold"),"fontFamily"==name&&(value=value.replace(/[\'\"]/g,"").replace(/,\s+/g,",")),""+value}function replaceVars(value,vars){return"string"!=typeof value?value=value(vars):vars&&(value=value.replace(/%(\w+)/g,function(str,name){return vars[name]||str})),value}function isWhiteSpaceNode(node){return node&&3===node.nodeType&&/^([\t \r\n]+|)$/.test(node.nodeValue)}function wrap(node,name,attrs){var wrapper=dom.create(name,attrs);return node.parentNode.insertBefore(wrapper,node),wrapper.appendChild(node),wrapper}function expandRng(rng,format,remove){function findParentContainer(start){function isBogusBr(node){return"BR"==node.nodeName&&node.getAttribute("data-mce-bogus")&&!node.nextSibling}var container,parent,sibling,siblingName,root;if(container=parent=start?startContainer:endContainer,siblingName=start?"previousSibling":"nextSibling",root=dom.getRoot(),3==container.nodeType&&!isWhiteSpaceNode(container)&&(start?startOffset>0:endOffset<container.nodeValue.length))return container;for(;;){if(!format[0].block_expand&&isBlock(parent))return parent;for(sibling=parent[siblingName];sibling;sibling=sibling[siblingName])if(!isBookmarkNode(sibling)&&!isWhiteSpaceNode(sibling)&&!isBogusBr(sibling))return parent;if(parent==root||parent.parentNode==root){container=parent;break}parent=parent.parentNode}return container}function findLeaf(node,offset){for(offset===undef&&(offset=3===node.nodeType?node.length:node.childNodes.length);node&&node.hasChildNodes();)node=node.childNodes[offset],node&&(offset=3===node.nodeType?node.length:node.childNodes.length);return{node:node,offset:offset}}function findParentContentEditable(node){for(var parent=node;parent;){if(1===parent.nodeType&&getContentEditable(parent))return"false"===getContentEditable(parent)?parent:node;parent=parent.parentNode}return node}function findWordEndPoint(container,offset,start){function findSpace(node,offset){var pos,pos2,str=node.nodeValue;return"undefined"==typeof offset&&(offset=start?str.length:0),start?(pos=str.lastIndexOf(" ",offset),pos2=str.lastIndexOf("",offset),pos=pos>pos2?pos:pos2,pos===-1||remove||pos++):(pos=str.indexOf(" ",offset),pos2=str.indexOf("",offset),pos=pos!==-1&&(pos2===-1||pos<pos2)?pos:pos2),pos}var walker,node,pos,lastTextNode;if(3===container.nodeType){if(pos=findSpace(container,offset),pos!==-1)return{container:container,offset:pos};lastTextNode=container}for(walker=new TreeWalker(container,dom.getParent(container,isBlock)||ed.getBody());node=walker[start?"prev":"next"]();)if(3===node.nodeType){if(lastTextNode=node,pos=findSpace(node),pos!==-1)return{container:node,offset:pos}}else if(isBlock(node))break;if(lastTextNode)return offset=start?0:lastTextNode.length,{container:lastTextNode,offset:offset}}function findSelectorEndPoint(container,sibling_name){var parents,i,y,curFormat;for(3==container.nodeType&&0===container.nodeValue.length&&container[sibling_name]&&(container=container[sibling_name]),parents=getParents(container),i=0;i<parents.length;i++)for(y=0;y<format.length;y++)if(curFormat=format[y],!("collapsed"in curFormat&&curFormat.collapsed!==rng.collapsed)&&dom.is(parents[i],curFormat.selector))return parents[i];return container}function findBlockEndPoint(container,sibling_name){var node,root=dom.getRoot();if(format[0].wrapper||(node=dom.getParent(container,format[0].block,root)),node||(node=dom.getParent(3==container.nodeType?container.parentNode:container,function(node){return node!=root&&isTextBlock(node)})),node&&format[0].wrapper&&(node=getParents(node,"ul,ol").reverse()[0]||node),!node)for(node=container;node[sibling_name]&&!isBlock(node[sibling_name])&&(node=node[sibling_name],!isEq(node,"br")););return node||container}var lastIdx,leaf,endPoint,startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;if(1==startContainer.nodeType&&startContainer.hasChildNodes()&&(lastIdx=startContainer.childNodes.length-1,startContainer=startContainer.childNodes[startOffset>lastIdx?lastIdx:startOffset],3==startContainer.nodeType&&(startOffset=0)),1==endContainer.nodeType&&endContainer.hasChildNodes()&&(lastIdx=endContainer.childNodes.length-1,endContainer=endContainer.childNodes[endOffset>lastIdx?lastIdx:endOffset-1],3==endContainer.nodeType&&(endOffset=endContainer.nodeValue.length)),startContainer=findParentContentEditable(startContainer),endContainer=findParentContentEditable(endContainer),(isBookmarkNode(startContainer.parentNode)||isBookmarkNode(startContainer))&&(startContainer=isBookmarkNode(startContainer)?startContainer:startContainer.parentNode,startContainer=startContainer.nextSibling||startContainer,3==startContainer.nodeType&&(startOffset=0)),(isBookmarkNode(endContainer.parentNode)||isBookmarkNode(endContainer))&&(endContainer=isBookmarkNode(endContainer)?endContainer:endContainer.parentNode,endContainer=endContainer.previousSibling||endContainer,3==endContainer.nodeType&&(endOffset=endContainer.length)),format[0].inline&&(rng.collapsed&&(endPoint=findWordEndPoint(startContainer,startOffset,!0),endPoint&&(startContainer=endPoint.container,startOffset=endPoint.offset),endPoint=findWordEndPoint(endContainer,endOffset),endPoint&&(endContainer=endPoint.container,endOffset=endPoint.offset)),leaf=findLeaf(endContainer,endOffset),leaf.node)){for(;leaf.node&&0===leaf.offset&&leaf.node.previousSibling;)leaf=findLeaf(leaf.node.previousSibling);leaf.node&&leaf.offset>0&&3===leaf.node.nodeType&&" "===leaf.node.nodeValue.charAt(leaf.offset-1)&&leaf.offset>1&&(endContainer=leaf.node,endContainer.splitText(leaf.offset-1))}return(format[0].inline||format[0].block_expand)&&(format[0].inline&&3==startContainer.nodeType&&0!==startOffset||(startContainer=findParentContainer(!0)),format[0].inline&&3==endContainer.nodeType&&endOffset!==endContainer.nodeValue.length||(endContainer=findParentContainer())),format[0].selector&&format[0].expand!==FALSE&&!format[0].inline&&(startContainer=findSelectorEndPoint(startContainer,"previousSibling"),endContainer=findSelectorEndPoint(endContainer,"nextSibling")),(format[0].block||format[0].selector)&&(startContainer=findBlockEndPoint(startContainer,"previousSibling"),endContainer=findBlockEndPoint(endContainer,"nextSibling"),format[0].block&&(isBlock(startContainer)||(startContainer=findParentContainer(!0)),isBlock(endContainer)||(endContainer=findParentContainer()))),1==startContainer.nodeType&&(startOffset=nodeIndex(startContainer),startContainer=startContainer.parentNode),1==endContainer.nodeType&&(endOffset=nodeIndex(endContainer)+1,endContainer=endContainer.parentNode),{startContainer:startContainer,startOffset:startOffset,endContainer:endContainer,endOffset:endOffset}}function isColorFormatAndAnchor(node,format){return format.links&&"A"==node.tagName}function removeFormat(format,vars,node,compare_node){var i,attrs,stylesModified;if(!matchName(node,format)&&!isColorFormatAndAnchor(node,format))return FALSE;if("all"!=format.remove)for(each(format.styles,function(value,name){value=normalizeStyleValue(replaceVars(value,vars),name),"number"==typeof name&&(name=value,compare_node=0),(format.remove_similar||!compare_node||isEq(getStyle(compare_node,name),value))&&dom.setStyle(node,name,""),stylesModified=1}),stylesModified&&""===dom.getAttrib(node,"style")&&(node.removeAttribute("style"),node.removeAttribute("data-mce-style")),each(format.attributes,function(value,name){var valueOut;if(value=replaceVars(value,vars),"number"==typeof name&&(name=value,compare_node=0),!compare_node||isEq(dom.getAttrib(compare_node,name),value)){if("class"==name&&(value=dom.getAttrib(node,name),value&&(valueOut="",each(value.split(/\s+/),function(cls){/mce\-\w+/.test(cls)&&(valueOut+=(valueOut?" ":"")+cls)}),valueOut)))return void dom.setAttrib(node,name,valueOut);"class"==name&&node.removeAttribute("className"),MCE_ATTR_RE.test(name)&&node.removeAttribute("data-mce-"+name),node.removeAttribute(name)}}),each(format.classes,function(value){value=replaceVars(value,vars),compare_node&&!dom.hasClass(compare_node,value)||dom.removeClass(node,value)}),attrs=dom.getAttribs(node),i=0;i<attrs.length;i++)if(0!==attrs[i].nodeName.indexOf("_"))return FALSE;return"none"!=format.remove?(removeNode(node,format),TRUE):void 0}function removeNode(node,format){function find(node,next,inc){return node=getNonWhiteSpaceSibling(node,next,inc),!node||"BR"==node.nodeName||isBlock(node)}var rootBlockElm,parentNode=node.parentNode;format.block&&(forcedRootBlock?parentNode==dom.getRoot()&&(format.list_block&&isEq(node,format.list_block)||each(grep(node.childNodes),function(node){isValid(forcedRootBlock,node.nodeName.toLowerCase())?rootBlockElm?rootBlockElm.appendChild(node):(rootBlockElm=wrap(node,forcedRootBlock),dom.setAttribs(rootBlockElm,ed.settings.forced_root_block_attrs)):rootBlockElm=0})):isBlock(node)&&!isBlock(parentNode)&&(find(node,FALSE)||find(node.firstChild,TRUE,1)||node.insertBefore(dom.create("br"),node.firstChild),find(node,TRUE)||find(node.lastChild,FALSE,1)||node.appendChild(dom.create("br")))),format.selector&&format.inline&&!isEq(format.inline,node)||dom.remove(node,1)}function getNonWhiteSpaceSibling(node,next,inc){if(node)for(next=next?"nextSibling":"previousSibling",node=inc?node:node[next];node;node=node[next])if(1==node.nodeType||!isWhiteSpaceNode(node))return node}function mergeSiblings(prev,next){function findElementSibling(node,sibling_name){for(sibling=node;sibling;sibling=sibling[sibling_name]){if(3==sibling.nodeType&&0!==sibling.nodeValue.length)return node;if(1==sibling.nodeType&&!isBookmarkNode(sibling))return sibling}return node}var sibling,tmpSibling,elementUtils=new ElementUtils(dom);if(prev&&next&&(prev=findElementSibling(prev,"previousSibling"),next=findElementSibling(next,"nextSibling"),elementUtils.compare(prev,next))){for(sibling=prev.nextSibling;sibling&&sibling!=next;)tmpSibling=sibling,sibling=sibling.nextSibling,prev.appendChild(tmpSibling);return dom.remove(next),each(grep(next.childNodes),function(node){prev.appendChild(node)}),prev}return next}function getContainer(rng,start){var container,offset,lastIdx;return container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],1==container.nodeType&&(lastIdx=container.childNodes.length-1,!start&&offset&&offset--,container=container.childNodes[offset>lastIdx?lastIdx:offset]),3===container.nodeType&&start&&offset>=container.nodeValue.length&&(container=new TreeWalker(container,ed.getBody()).next()||container),3!==container.nodeType||start||0!==offset||(container=new TreeWalker(container,ed.getBody()).prev()||container),container}function performCaretAction(type,name,vars,similar){function createCaretContainer(fill){var caretContainer=dom.create("span",{id:caretContainerId,"data-mce-bogus":!0,style:debug?"color:red":""});return fill&&caretContainer.appendChild(ed.getDoc().createTextNode(INVISIBLE_CHAR)),caretContainer}function isCaretContainerEmpty(node,nodes){for(;node;){if(3===node.nodeType&&node.nodeValue!==INVISIBLE_CHAR||node.childNodes.length>1)return!1;nodes&&1===node.nodeType&&nodes.push(node),node=node.firstChild}return!0}function getParentCaretContainer(node){for(;node;){if(node.id===caretContainerId)return node;node=node.parentNode}}function findFirstTextNode(node){var walker;if(node)for(walker=new TreeWalker(node,node),node=walker.current();node;node=walker.next())if(3===node.nodeType)return node}function removeCaretContainer(node,move_caret){var child,rng;if(node)rng=selection.getRng(!0),isCaretContainerEmpty(node)?(move_caret!==!1&&(rng.setStartBefore(node),rng.setEndBefore(node)),dom.remove(node)):(child=findFirstTextNode(node),child.nodeValue.charAt(0)===INVISIBLE_CHAR&&(child.deleteData(0,1),rng.startContainer==child&&rng.startOffset>0&&rng.setStart(child,rng.startOffset-1),rng.endContainer==child&&rng.endOffset>0&&rng.setEnd(child,rng.endOffset-1)),dom.remove(node,1)),selection.setRng(rng);else if(node=getParentCaretContainer(selection.getStart()),!node)for(;node=dom.get(caretContainerId);)removeCaretContainer(node,!1)}function applyCaretFormat(){var rng,caretContainer,textNode,offset,bookmark,container,text;rng=selection.getRng(!0),offset=rng.startOffset,container=rng.startContainer,text=container.nodeValue,caretContainer=getParentCaretContainer(selection.getStart()),caretContainer&&(textNode=findFirstTextNode(caretContainer)),text&&offset>0&&offset<text.length&&/\w/.test(text.charAt(offset))&&/\w/.test(text.charAt(offset-1))?(bookmark=selection.getBookmark(),rng.collapse(!0),rng=expandRng(rng,get(name)),rng=rangeUtils.split(rng),apply(name,vars,rng),selection.moveToBookmark(bookmark)):(caretContainer&&textNode.nodeValue===INVISIBLE_CHAR?apply(name,vars,caretContainer):(caretContainer=createCaretContainer(!0),textNode=caretContainer.firstChild,rng.insertNode(caretContainer),offset=1,apply(name,vars,caretContainer)),selection.setCursorLocation(textNode,offset))}function removeCaretFormat(){var container,offset,bookmark,hasContentAfter,node,formatNode,i,caretContainer,rng=selection.getRng(!0),parents=[];for(container=rng.startContainer,offset=rng.startOffset,node=container,3==container.nodeType&&(offset!=container.nodeValue.length&&(hasContentAfter=!0),node=node.parentNode);node;){if(matchNode(node,name,vars,similar)){formatNode=node;break}node.nextSibling&&(hasContentAfter=!0),parents.push(node),node=node.parentNode}if(formatNode)if(hasContentAfter)bookmark=selection.getBookmark(),rng.collapse(!0),rng=expandRng(rng,get(name),!0),rng=rangeUtils.split(rng),remove(name,vars,rng),selection.moveToBookmark(bookmark);else{for(caretContainer=createCaretContainer(),node=caretContainer,i=parents.length-1;i>=0;i--)node.appendChild(dom.clone(parents[i],!1)),node=node.firstChild;node.appendChild(dom.doc.createTextNode(INVISIBLE_CHAR)),node=node.firstChild;var block=dom.getParent(formatNode,isTextBlock);block&&dom.isEmpty(block)?formatNode.parentNode.replaceChild(caretContainer,formatNode):dom.insertAfter(caretContainer,formatNode),selection.setCursorLocation(node,1),dom.isEmpty(formatNode)&&dom.remove(formatNode)}}function unmarkBogusCaretParents(){var caretContainer;caretContainer=getParentCaretContainer(selection.getStart()),caretContainer&&!dom.isEmpty(caretContainer)&&walk(caretContainer,function(node){1!=node.nodeType||node.id===caretContainerId||dom.isEmpty(node)||dom.setAttrib(node,"data-mce-bogus",null)},"childNodes")}var caretContainerId="_mce_caret",debug=ed.settings.caret_debug;ed._hasCaretEvents||(markCaretContainersBogus=function(){var i,nodes=[];if(isCaretContainerEmpty(getParentCaretContainer(selection.getStart()),nodes))for(i=nodes.length;i--;)dom.setAttrib(nodes[i],"data-mce-bogus","1")},disableCaretContainer=function(e){var keyCode=e.keyCode;removeCaretContainer(),8==keyCode&&selection.isCollapsed()&&selection.getStart().innerHTML==INVISIBLE_CHAR&&removeCaretContainer(getParentCaretContainer(selection.getStart())),37!=keyCode&&39!=keyCode||removeCaretContainer(getParentCaretContainer(selection.getStart())),unmarkBogusCaretParents()},ed.on("SetContent",function(e){e.selection&&unmarkBogusCaretParents()}),ed._hasCaretEvents=!0),"apply"==type?applyCaretFormat():removeCaretFormat()}function moveStart(rng){var isAtEndOfText,walker,node,nodes,tmpNode,container=rng.startContainer,offset=rng.startOffset;if((rng.startContainer!=rng.endContainer||!isInlineBlock(rng.startContainer.childNodes[rng.startOffset]))&&(3==container.nodeType&&offset>=container.nodeValue.length&&(offset=nodeIndex(container),container=container.parentNode,isAtEndOfText=!0),1==container.nodeType))for(nodes=container.childNodes,container=nodes[Math.min(offset,nodes.length-1)],walker=new TreeWalker(container,dom.getParent(container,dom.isBlock)),(offset>nodes.length-1||isAtEndOfText)&&walker.next(),node=walker.current();node;node=walker.next())if(3==node.nodeType&&!isWhiteSpaceNode(node))return tmpNode=dom.create("a",{"data-mce-bogus":"all"},INVISIBLE_CHAR),node.parentNode.insertBefore(tmpNode,node),rng.setStart(node,0),selection.setRng(rng),void dom.remove(tmpNode)}var formatChangeData,undef,disableCaretContainer,markCaretContainersBogus,formats={},dom=ed.dom,selection=ed.selection,rangeUtils=new RangeUtils(dom),isValid=ed.schema.isValidChild,isBlock=dom.isBlock,forcedRootBlock=ed.settings.forced_root_block,nodeIndex=dom.nodeIndex,INVISIBLE_CHAR="\ufeff",MCE_ATTR_RE=/^(src|href|style)$/,FALSE=!1,TRUE=!0,getContentEditable=dom.getContentEditable,isBookmarkNode=BookmarkManager.isBookmarkNode,each=Tools.each,grep=Tools.grep,walk=Tools.walk,extend=Tools.extend;extend(this,{get:get,register:register,unregister:unregister,apply:apply,remove:remove,toggle:toggle,match:match,matchAll:matchAll,matchNode:matchNode,canApply:canApply,formatChanged:formatChanged,getCssText:getCssText}),defaultFormats(),addKeyboardShortcuts(),ed.on("BeforeGetContent",function(e){markCaretContainersBogus&&"raw"!=e.format&&markCaretContainersBogus()}),ed.on("mouseup keydown",function(e){disableCaretContainer&&disableCaretContainer(e)})}}),define("tinymce/UndoManager",["tinymce/util/VK","tinymce/Env"],function(VK,Env){return function(editor){function getContent(){return editor.serializer.getTrimmedContent()}function setDirty(state){editor.setDirty(state)}function addNonTypingUndoLevel(e){self.typing=!1,self.add({},e)}var beforeBookmark,isFirstTypedCharacter,self=this,index=0,data=[],locks=0;return editor.on("init",function(){self.add()}),editor.on("BeforeExecCommand",function(e){var cmd=e.command;"Undo"!=cmd&&"Redo"!=cmd&&"mceRepaint"!=cmd&&self.beforeChange()}),editor.on("ExecCommand",function(e){var cmd=e.command;"Undo"!=cmd&&"Redo"!=cmd&&"mceRepaint"!=cmd&&addNonTypingUndoLevel(e)}),editor.on("ObjectResizeStart Cut",function(){self.beforeChange()}),editor.on("SaveContent ObjectResized blur",addNonTypingUndoLevel),editor.on("DragEnd",addNonTypingUndoLevel),editor.on("KeyUp",function(e){var keyCode=e.keyCode;e.isDefaultPrevented()||((keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45==keyCode||13==keyCode||e.ctrlKey)&&(addNonTypingUndoLevel(),editor.nodeChanged()),(46==keyCode||8==keyCode||Env.mac&&(91==keyCode||93==keyCode))&&editor.nodeChanged(),isFirstTypedCharacter&&self.typing&&(editor.isDirty()||(setDirty(data[0]&&getContent()!=data[0].content),editor.isDirty()&&editor.fire("change",{level:data[0],lastLevel:null})),editor.fire("TypingUndo"),isFirstTypedCharacter=!1,editor.nodeChanged()))}),editor.on("KeyDown",function(e){var keyCode=e.keyCode;if(!e.isDefaultPrevented()){if(keyCode>=33&&keyCode<=36||keyCode>=37&&keyCode<=40||45==keyCode)return void(self.typing&&addNonTypingUndoLevel(e));var modKey=e.ctrlKey&&!e.altKey||e.metaKey;!(keyCode<16||keyCode>20)||224==keyCode||91==keyCode||self.typing||modKey||(self.beforeChange(),self.typing=!0,self.add({},e),isFirstTypedCharacter=!0)}}),editor.on("MouseDown",function(e){self.typing&&addNonTypingUndoLevel(e)}),editor.addShortcut("meta+z","","Undo"),editor.addShortcut("meta+y,meta+shift+z","","Redo"),editor.on("AddUndo Undo Redo ClearUndos",function(e){e.isDefaultPrevented()||editor.nodeChanged()}),self={data:data,typing:!1,beforeChange:function(){locks||(beforeBookmark=editor.selection.getBookmark(2,!0))},add:function(level,event){var i,lastLevel,settings=editor.settings;if(level=level||{},level.content=getContent(),locks||editor.removed)return null;if(lastLevel=data[index],editor.fire("BeforeAddUndo",{level:level,lastLevel:lastLevel,originalEvent:event}).isDefaultPrevented())return null;if(lastLevel&&lastLevel.content==level.content)return null;if(data[index]&&(data[index].beforeBookmark=beforeBookmark),settings.custom_undo_redo_levels&&data.length>settings.custom_undo_redo_levels){for(i=0;i<data.length-1;i++)data[i]=data[i+1];data.length--,index=data.length}level.bookmark=editor.selection.getBookmark(2,!0),index<data.length-1&&(data.length=index+1),data.push(level),index=data.length-1;var args={level:level,lastLevel:lastLevel,originalEvent:event};return editor.fire("AddUndo",args),index>0&&(setDirty(!0),editor.fire("change",args)),level},undo:function(){var level;return self.typing&&(self.add(),self.typing=!1),index>0&&(level=data[--index],editor.setContent(level.content,{format:"raw"}),editor.selection.moveToBookmark(level.beforeBookmark),setDirty(!0),editor.fire("undo",{level:level})),level},redo:function(){var level;return index<data.length-1&&(level=data[++index],editor.setContent(level.content,{format:"raw"}),editor.selection.moveToBookmark(level.bookmark),setDirty(!0),editor.fire("redo",{level:level})),level},clear:function(){data=[],index=0,self.typing=!1,editor.fire("ClearUndos")},hasUndo:function(){return index>0||self.typing&&data[0]&&getContent()!=data[0].content},hasRedo:function(){return index<data.length-1&&!this.typing},transact:function(callback){self.beforeChange();try{locks++,callback()}finally{locks--}self.add()}}}}),define("tinymce/EnterKey",["tinymce/dom/TreeWalker","tinymce/dom/RangeUtils","tinymce/Env"],function(TreeWalker,RangeUtils,Env){var isIE=Env.ie&&Env.ie<11;return function(editor){function handleEnterKey(evt){function canSplitBlock(node){return node&&dom.isBlock(node)&&!/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName)&&!/^(fixed|absolute)/i.test(node.style.position)&&"true"!==dom.getContentEditable(node)}function isTableCell(node){return node&&/^(TD|TH|CAPTION)$/.test(node.nodeName)}function renderBlockOnIE(block){var oldRng;dom.isBlock(block)&&(oldRng=selection.getRng(),block.appendChild(dom.create("span",null,"")),selection.select(block),block.lastChild.outerHTML="",selection.setRng(oldRng))}function trimInlineElementsOnLeftSideOfBlock(block){var i,node=block,firstChilds=[];if(node){for(;node=node.firstChild;){if(dom.isBlock(node))return;1!=node.nodeType||nonEmptyElementsMap[node.nodeName.toLowerCase()]||firstChilds.push(node)}for(i=firstChilds.length;i--;)node=firstChilds[i],!node.hasChildNodes()||node.firstChild==node.lastChild&&""===node.firstChild.nodeValue?dom.remove(node):"A"==node.nodeName&&" "===(node.innerText||node.textContent)&&dom.remove(node)}}function moveToCaretPosition(root){function firstNonWhiteSpaceNodeSibling(node){for(;node;){if(1==node.nodeType||3==node.nodeType&&node.data&&/[\r\n\s]/.test(node.data))return node;node=node.nextSibling}}var walker,node,rng,tempElm,lastNode=root;if(root){if(Env.ie&&Env.ie<9&&parentBlock&&parentBlock.firstChild&&parentBlock.firstChild==parentBlock.lastChild&&"BR"==parentBlock.firstChild.tagName&&dom.remove(parentBlock.firstChild),/^(LI|DT|DD)$/.test(root.nodeName)){var firstChild=firstNonWhiteSpaceNodeSibling(root.firstChild);firstChild&&/^(UL|OL|DL)$/.test(firstChild.nodeName)&&root.insertBefore(dom.doc.createTextNode(""),root.firstChild)}if(rng=dom.createRng(),Env.ie||root.normalize(),root.hasChildNodes()){for(walker=new TreeWalker(root,root);node=walker.current();){if(3==node.nodeType){rng.setStart(node,0),rng.setEnd(node,0);break}if(moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]){rng.setStartBefore(node),rng.setEndBefore(node);break}lastNode=node,node=walker.next()}node||(rng.setStart(lastNode,0),rng.setEnd(lastNode,0))}else"BR"==root.nodeName?root.nextSibling&&dom.isBlock(root.nextSibling)?((!documentMode||documentMode<9)&&(tempElm=dom.create("br"),root.parentNode.insertBefore(tempElm,root)),rng.setStartBefore(root),rng.setEndBefore(root)):(rng.setStartAfter(root),rng.setEndAfter(root)):(rng.setStart(root,0),rng.setEnd(root,0));selection.setRng(rng),dom.remove(tempElm),selection.scrollIntoView(root)}}function setForcedBlockAttrs(node){var forcedRootBlockName=settings.forced_root_block;forcedRootBlockName&&forcedRootBlockName.toLowerCase()===node.tagName.toLowerCase()&&dom.setAttribs(node,settings.forced_root_block_attrs)}function emptyBlock(elm){elm.innerHTML=isIE?"":'<br data-mce-bogus="1">'}function createNewBlock(name){var block,clonedNode,caretNode,node=container,textInlineElements=schema.getTextInlineElements();if(name||"TABLE"==parentBlockName?(block=dom.create(name||newBlockName),setForcedBlockAttrs(block)):block=parentBlock.cloneNode(!1),caretNode=block,settings.keep_styles!==!1)do if(textInlineElements[node.nodeName]){if("_mce_caret"==node.id)continue;clonedNode=node.cloneNode(!1),dom.setAttrib(clonedNode,"id",""),block.hasChildNodes()?(clonedNode.appendChild(block.firstChild),block.appendChild(clonedNode)):(caretNode=clonedNode,block.appendChild(clonedNode))}while((node=node.parentNode)&&node!=editableRoot);return isIE||(caretNode.innerHTML='<br data-mce-bogus="1">'),block}function isCaretAtStartOrEndOfBlock(start){var walker,node,name;if(3==container.nodeType&&(start?offset>0:offset<container.nodeValue.length))return!1;if(container.parentNode==parentBlock&&isAfterLastNodeInContainer&&!start)return!0;if(start&&1==container.nodeType&&container==parentBlock.firstChild)return!0;if("TABLE"===container.nodeName||container.previousSibling&&"TABLE"==container.previousSibling.nodeName)return isAfterLastNodeInContainer&&!start||!isAfterLastNodeInContainer&&start;for(walker=new TreeWalker(container,parentBlock),3==container.nodeType&&(start&&0===offset?walker.prev():start||offset!=container.nodeValue.length||walker.next());node=walker.current();){if(1===node.nodeType){if(!node.getAttribute("data-mce-bogus")&&(name=node.nodeName.toLowerCase(),nonEmptyElementsMap[name]&&"br"!==name))return!1}else if(3===node.nodeType&&!/^[ \t\r\n]*$/.test(node.nodeValue))return!1;start?walker.prev():walker.next()}return!0}function wrapSelfAndSiblingsInDefaultBlock(container,offset){var newBlock,parentBlock,startNode,node,next,rootBlockName,blockName=newBlockName||"P";if(parentBlock=dom.getParent(container,dom.isBlock),!parentBlock||!canSplitBlock(parentBlock)){if(parentBlock=parentBlock||editableRoot,rootBlockName=parentBlock==editor.getBody()||isTableCell(parentBlock)?parentBlock.nodeName.toLowerCase():parentBlock.parentNode.nodeName.toLowerCase(),!parentBlock.hasChildNodes())return newBlock=dom.create(blockName),setForcedBlockAttrs(newBlock),parentBlock.appendChild(newBlock),rng.setStart(newBlock,0),rng.setEnd(newBlock,0),newBlock;for(node=container;node.parentNode!=parentBlock;)node=node.parentNode;for(;node&&!dom.isBlock(node);)startNode=node,node=node.previousSibling;if(startNode&&schema.isValidChild(rootBlockName,blockName.toLowerCase())){for(newBlock=dom.create(blockName),setForcedBlockAttrs(newBlock),startNode.parentNode.insertBefore(newBlock,startNode),node=startNode;node&&!dom.isBlock(node);)next=node.nextSibling,newBlock.appendChild(node),node=next;rng.setStart(container,offset),rng.setEnd(container,offset)}}return container}function handleEmptyListItem(){function isFirstOrLastLi(first){for(var node=containerBlock[first?"firstChild":"lastChild"];node&&1!=node.nodeType;)node=node[first?"nextSibling":"previousSibling"];return node===parentBlock}function getContainerBlock(){var containerBlockParent=containerBlock.parentNode;return/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)?containerBlockParent:containerBlock}if(containerBlock!=editor.getBody()){var containerBlockParentName=containerBlock.parentNode.nodeName;/^(OL|UL|LI)$/.test(containerBlockParentName)&&(newBlockName="LI"),newBlock=newBlockName?createNewBlock(newBlockName):dom.create("BR"),isFirstOrLastLi(!0)&&isFirstOrLastLi()?"LI"==containerBlockParentName?dom.insertAfter(newBlock,getContainerBlock()):dom.replace(newBlock,containerBlock):isFirstOrLastLi(!0)?"LI"==containerBlockParentName?(dom.insertAfter(newBlock,getContainerBlock()),newBlock.appendChild(dom.doc.createTextNode(" ")),newBlock.appendChild(containerBlock)):containerBlock.parentNode.insertBefore(newBlock,containerBlock):isFirstOrLastLi()?(dom.insertAfter(newBlock,getContainerBlock()),renderBlockOnIE(newBlock)):(containerBlock=getContainerBlock(),tmpRng=rng.cloneRange(),tmpRng.setStartAfter(parentBlock),tmpRng.setEndAfter(containerBlock),fragment=tmpRng.extractContents(),"LI"==newBlockName&&"LI"==fragment.firstChild.nodeName?(newBlock=fragment.firstChild,dom.insertAfter(fragment,containerBlock)):(dom.insertAfter(fragment,containerBlock),dom.insertAfter(newBlock,containerBlock))),dom.remove(parentBlock),moveToCaretPosition(newBlock),undoManager.add()}}function insertBr(){editor.execCommand("InsertLineBreak",!1,evt)}function trimLeadingLineBreaks(node){
do 3===node.nodeType&&(node.nodeValue=node.nodeValue.replace(/^[\r\n]+/,"")),node=node.firstChild;while(node)}function getEditableRoot(node){var parent,editableRoot,root=dom.getRoot();for(parent=node;parent!==root&&"false"!==dom.getContentEditable(parent);)"true"===dom.getContentEditable(parent)&&(editableRoot=parent),parent=parent.parentNode;return parent!==root?editableRoot:root}function addBrToBlockIfNeeded(block){var lastChild;isIE||(block.normalize(),lastChild=block.lastChild,lastChild&&!/^(left|right)$/gi.test(dom.getStyle(lastChild,"float",!0))||dom.add(block,"br"))}function insertNewBlockAfter(){newBlock=/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName)&&"HGROUP"!=containerBlockName?createNewBlock(newBlockName):createNewBlock(),settings.end_container_on_empty_block&&canSplitBlock(containerBlock)&&dom.isEmpty(parentBlock)?newBlock=dom.split(containerBlock,parentBlock):dom.insertAfter(newBlock,parentBlock),moveToCaretPosition(newBlock)}var rng,tmpRng,editableRoot,container,offset,parentBlock,documentMode,shiftKey,newBlock,fragment,containerBlock,parentBlockName,containerBlockName,newBlockName,isAfterLastNodeInContainer;if(rng=selection.getRng(!0),!evt.isDefaultPrevented()){if(!rng.collapsed)return void editor.execCommand("Delete");if(new RangeUtils(dom).normalize(rng),container=rng.startContainer,offset=rng.startOffset,newBlockName=(settings.force_p_newlines?"p":"")||settings.forced_root_block,newBlockName=newBlockName?newBlockName.toUpperCase():"",documentMode=dom.doc.documentMode,shiftKey=evt.shiftKey,1==container.nodeType&&container.hasChildNodes()&&(isAfterLastNodeInContainer=offset>container.childNodes.length-1,container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3==container.nodeType?container.nodeValue.length:0),editableRoot=getEditableRoot(container)){if(undoManager.beforeChange(),!dom.isBlock(editableRoot)&&editableRoot!=dom.getRoot())return void(newBlockName&&!shiftKey||insertBr());if((newBlockName&&!shiftKey||!newBlockName&&shiftKey)&&(container=wrapSelfAndSiblingsInDefaultBlock(container,offset)),parentBlock=dom.getParent(container,dom.isBlock),containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"",containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"","LI"!=containerBlockName||evt.ctrlKey||(parentBlock=containerBlock,parentBlockName=containerBlockName),/^(LI|DT|DD)$/.test(parentBlockName)){if(!newBlockName&&shiftKey)return void insertBr();if(dom.isEmpty(parentBlock))return void handleEmptyListItem()}if("PRE"==parentBlockName&&settings.br_in_pre!==!1){if(!shiftKey)return void insertBr()}else if(!newBlockName&&!shiftKey&&"LI"!=parentBlockName||newBlockName&&shiftKey)return void insertBr();newBlockName&&parentBlock===editor.getBody()||(newBlockName=newBlockName||"P",isCaretAtStartOrEndOfBlock()?insertNewBlockAfter():isCaretAtStartOrEndOfBlock(!0)?(newBlock=parentBlock.parentNode.insertBefore(createNewBlock(),parentBlock),renderBlockOnIE(newBlock),moveToCaretPosition(parentBlock)):(tmpRng=rng.cloneRange(),tmpRng.setEndAfter(parentBlock),fragment=tmpRng.extractContents(),trimLeadingLineBreaks(fragment),newBlock=fragment.firstChild,dom.insertAfter(fragment,parentBlock),trimInlineElementsOnLeftSideOfBlock(newBlock),addBrToBlockIfNeeded(parentBlock),dom.isEmpty(parentBlock)&&emptyBlock(parentBlock),newBlock.normalize(),dom.isEmpty(newBlock)?(dom.remove(newBlock),insertNewBlockAfter()):moveToCaretPosition(newBlock)),dom.setAttrib(newBlock,"id",""),editor.fire("NewBlock",{newBlock:newBlock}),undoManager.add())}}}var dom=editor.dom,selection=editor.selection,settings=editor.settings,undoManager=editor.undoManager,schema=editor.schema,nonEmptyElementsMap=schema.getNonEmptyElements(),moveCaretBeforeOnEnterElementsMap=schema.getMoveCaretBeforeOnEnterElements();editor.on("keydown",function(evt){13==evt.keyCode&&handleEnterKey(evt)!==!1&&evt.preventDefault()})}}),define("tinymce/ForceBlocks",[],function(){return function(editor){function addRootBlocks(){var rng,startContainer,startOffset,endContainer,endOffset,rootBlockNode,tempNode,wrapped,restoreSelection,tmpRng,rootNodeName,forcedRootBlock,node=selection.getStart(),rootNode=editor.getBody(),offset=-16777215;if(forcedRootBlock=settings.forced_root_block,node&&1===node.nodeType&&forcedRootBlock){for(;node&&node!=rootNode;){if(blockElements[node.nodeName])return;node=node.parentNode}if(rng=selection.getRng(),rng.setStart){startContainer=rng.startContainer,startOffset=rng.startOffset,endContainer=rng.endContainer,endOffset=rng.endOffset;try{restoreSelection=editor.getDoc().activeElement===rootNode}catch(ex){}}else rng.item&&(node=rng.item(0),rng=editor.getDoc().body.createTextRange(),rng.moveToElementText(node)),restoreSelection=rng.parentElement().ownerDocument===editor.getDoc(),tmpRng=rng.duplicate(),tmpRng.collapse(!0),startOffset=tmpRng.move("character",offset)*-1,tmpRng.collapsed||(tmpRng=rng.duplicate(),tmpRng.collapse(!1),endOffset=tmpRng.move("character",offset)*-1-startOffset);for(node=rootNode.firstChild,rootNodeName=rootNode.nodeName.toLowerCase();node;)if((3===node.nodeType||1==node.nodeType&&!blockElements[node.nodeName])&&schema.isValidChild(rootNodeName,forcedRootBlock.toLowerCase())){if(3===node.nodeType&&0===node.nodeValue.length){tempNode=node,node=node.nextSibling,dom.remove(tempNode);continue}rootBlockNode||(rootBlockNode=dom.create(forcedRootBlock,editor.settings.forced_root_block_attrs),node.parentNode.insertBefore(rootBlockNode,node),wrapped=!0),tempNode=node,node=node.nextSibling,rootBlockNode.appendChild(tempNode)}else rootBlockNode=null,node=node.nextSibling;if(wrapped&&restoreSelection){if(rng.setStart)rng.setStart(startContainer,startOffset),rng.setEnd(endContainer,endOffset),selection.setRng(rng);else try{rng=editor.getDoc().body.createTextRange(),rng.moveToElementText(rootNode),rng.collapse(!0),rng.moveStart("character",startOffset),endOffset>0&&rng.moveEnd("character",endOffset),rng.select()}catch(ex){}editor.nodeChanged()}}}var settings=editor.settings,dom=editor.dom,selection=editor.selection,schema=editor.schema,blockElements=schema.getBlockElements();settings.forced_root_block&&editor.on("NodeChange",addRootBlocks)}}),define("tinymce/caret/CaretUtils",["tinymce/util/Fun","tinymce/dom/TreeWalker","tinymce/dom/NodeType","tinymce/caret/CaretPosition","tinymce/caret/CaretContainer","tinymce/caret/CaretCandidate"],function(Fun,TreeWalker,NodeType,CaretPosition,CaretContainer,CaretCandidate){function isForwards(direction){return direction>0}function isBackwards(direction){return direction<0}function findNode(node,direction,predicateFn,rootNode,shallow){var walker=new TreeWalker(node,rootNode);if(isBackwards(direction)){if(isContentEditableFalse(node)&&(node=walker.prev(!0),predicateFn(node)))return node;for(;node=walker.prev(shallow);)if(predicateFn(node))return node}if(isForwards(direction)){if(isContentEditableFalse(node)&&(node=walker.next(!0),predicateFn(node)))return node;for(;node=walker.next(shallow);)if(predicateFn(node))return node}return null}function getEditingHost(node,rootNode){for(node=node.parentNode;node&&node!=rootNode;node=node.parentNode)if(isContentEditableTrue(node))return node;return rootNode}function getParentBlock(node,rootNode){for(;node&&node!=rootNode;){if(isBlockLike(node))return node;node=node.parentNode}return null}function isInSameBlock(caretPosition1,caretPosition2,rootNode){return getParentBlock(caretPosition1.container(),rootNode)==getParentBlock(caretPosition2.container(),rootNode)}function isInSameEditingHost(caretPosition1,caretPosition2,rootNode){return getEditingHost(caretPosition1.container(),rootNode)==getEditingHost(caretPosition2.container(),rootNode)}function getChildNodeAtRelativeOffset(relativeOffset,caretPosition){var container,offset;return caretPosition?(container=caretPosition.container(),offset=caretPosition.offset(),isElement(container)?container.childNodes[offset+relativeOffset]:null):null}function beforeAfter(before,node){var range=node.ownerDocument.createRange();return before?(range.setStartBefore(node),range.setEndBefore(node)):(range.setStartAfter(node),range.setEndAfter(node)),range}function isNodesInSameBlock(rootNode,node1,node2){return getParentBlock(node1,rootNode)==getParentBlock(node2,rootNode)}function lean(left,rootNode,node){var sibling,siblingName;for(siblingName=left?"previousSibling":"nextSibling";node&&node!=rootNode;){if(sibling=node[siblingName],isCaretContainer(sibling)&&(sibling=sibling[siblingName]),isContentEditableFalse(sibling)){if(isNodesInSameBlock(rootNode,sibling,node))return sibling;break}if(isCaretCandidate(sibling))break;node=node.parentNode}return null}function normalizeRange(direction,rootNode,range){var node,container,offset,location,leanLeft=curry(lean,!0,rootNode),leanRight=curry(lean,!1,rootNode);if(container=range.startContainer,offset=range.startOffset,CaretContainer.isCaretContainerBlock(container)){if(isElement(container)||(container=container.parentNode),location=container.getAttribute("data-mce-caret"),"before"==location&&(node=container.nextSibling,isContentEditableFalse(node)))return before(node);if("after"==location&&(node=container.previousSibling,isContentEditableFalse(node)))return after(node)}if(!range.collapsed)return range;if(NodeType.isText(container)){if(isCaretContainer(container)){if(1===direction){if(node=leanRight(container))return before(node);if(node=leanLeft(container))return after(node)}if(direction===-1){if(node=leanLeft(container))return after(node);if(node=leanRight(container))return before(node)}return range}if(CaretContainer.endsWithCaretContainer(container)&&offset>=container.data.length-1)return 1===direction&&(node=leanRight(container))?before(node):range;if(CaretContainer.startsWithCaretContainer(container)&&offset<=1)return direction===-1&&(node=leanLeft(container))?after(node):range;if(offset===container.data.length)return node=leanRight(container),node?before(node):range;if(0===offset)return node=leanLeft(container),node?after(node):range}return range}function isNextToContentEditableFalse(relativeOffset,caretPosition){return isContentEditableFalse(getChildNodeAtRelativeOffset(relativeOffset,caretPosition))}var isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isBlockLike=NodeType.matchStyleValues("display","block table table-cell table-caption"),isCaretContainer=CaretContainer.isCaretContainer,curry=Fun.curry,isElement=NodeType.isElement,isCaretCandidate=CaretCandidate.isCaretCandidate,before=curry(beforeAfter,!0),after=curry(beforeAfter,!1);return{isForwards:isForwards,isBackwards:isBackwards,findNode:findNode,getEditingHost:getEditingHost,getParentBlock:getParentBlock,isInSameBlock:isInSameBlock,isInSameEditingHost:isInSameEditingHost,isBeforeContentEditableFalse:curry(isNextToContentEditableFalse,0),isAfterContentEditableFalse:curry(isNextToContentEditableFalse,-1),normalizeRange:normalizeRange}}),define("tinymce/caret/CaretWalker",["tinymce/dom/NodeType","tinymce/caret/CaretCandidate","tinymce/caret/CaretPosition","tinymce/caret/CaretUtils","tinymce/util/Arr","tinymce/util/Fun"],function(NodeType,CaretCandidate,CaretPosition,CaretUtils,Arr,Fun){function getParents(node,rootNode){for(var parents=[];node&&node!=rootNode;)parents.push(node),node=node.parentNode;return parents}function nodeAtIndex(container,offset){return container.hasChildNodes()&&offset<container.childNodes.length?container.childNodes[offset]:null}function getCaretCandidatePosition(direction,node){if(isForwards(direction)){if(isCaretCandidate(node.previousSibling)&&!isText(node.previousSibling))return CaretPosition.before(node);if(isText(node))return CaretPosition(node,0)}if(isBackwards(direction)){if(isCaretCandidate(node.nextSibling)&&!isText(node.nextSibling))return CaretPosition.after(node);if(isText(node))return CaretPosition(node,node.data.length)}return isBackwards(direction)?isBr(node)?CaretPosition.before(node):CaretPosition.after(node):CaretPosition.before(node)}function isBrBeforeBlock(node,rootNode){var next;return!!NodeType.isBr(node)&&(next=findCaretPosition(1,CaretPosition.after(node),rootNode),!!next&&!CaretUtils.isInSameBlock(CaretPosition.before(node),CaretPosition.before(next),rootNode))}function findCaretPosition(direction,startCaretPosition,rootNode){var container,offset,node,nextNode,innerNode,rootContentEditableFalseElm,caretPosition;if(!isElement(rootNode)||!startCaretPosition)return null;if(caretPosition=startCaretPosition,container=caretPosition.container(),offset=caretPosition.offset(),isText(container)){if(isBackwards(direction)&&offset>0)return CaretPosition(container,--offset);if(isForwards(direction)&&offset<container.length)return CaretPosition(container,++offset);node=container}else{if(isBackwards(direction)&&offset>0&&(nextNode=nodeAtIndex(container,offset-1),isCaretCandidate(nextNode)))return!isAtomic(nextNode)&&(innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode))?isText(innerNode)?CaretPosition(innerNode,innerNode.data.length):CaretPosition.after(innerNode):isText(nextNode)?CaretPosition(nextNode,nextNode.data.length):CaretPosition.before(nextNode);if(isForwards(direction)&&offset<container.childNodes.length&&(nextNode=nodeAtIndex(container,offset),isCaretCandidate(nextNode)))return isBrBeforeBlock(nextNode,rootNode)?findCaretPosition(direction,CaretPosition.after(nextNode),rootNode):!isAtomic(nextNode)&&(innerNode=CaretUtils.findNode(nextNode,direction,isEditableCaretCandidate,nextNode))?isText(innerNode)?CaretPosition(innerNode,0):CaretPosition.before(innerNode):isText(nextNode)?CaretPosition(nextNode,0):CaretPosition.after(nextNode);node=caretPosition.getNode()}return(isForwards(direction)&&caretPosition.isAtEnd()||isBackwards(direction)&&caretPosition.isAtStart())&&(node=CaretUtils.findNode(node,direction,Fun.constant(!0),rootNode,!0),isEditableCaretCandidate(node))?getCaretCandidatePosition(direction,node):(nextNode=CaretUtils.findNode(node,direction,isEditableCaretCandidate,rootNode),rootContentEditableFalseElm=Arr.last(Arr.filter(getParents(container,rootNode),isContentEditableFalse)),!rootContentEditableFalseElm||nextNode&&rootContentEditableFalseElm.contains(nextNode)?nextNode?getCaretCandidatePosition(direction,nextNode):null:caretPosition=isForwards(direction)?CaretPosition.after(rootContentEditableFalseElm):CaretPosition.before(rootContentEditableFalseElm))}var isContentEditableFalse=NodeType.isContentEditableFalse,isText=NodeType.isText,isElement=NodeType.isElement,isBr=NodeType.isBr,isForwards=CaretUtils.isForwards,isBackwards=CaretUtils.isBackwards,isCaretCandidate=CaretCandidate.isCaretCandidate,isAtomic=CaretCandidate.isAtomic,isEditableCaretCandidate=CaretCandidate.isEditableCaretCandidate;return function(rootNode){return{next:function(caretPosition){return findCaretPosition(1,caretPosition,rootNode)},prev:function(caretPosition){return findCaretPosition(-1,caretPosition,rootNode)}}}}),define("tinymce/EditorCommands",["tinymce/html/Serializer","tinymce/Env","tinymce/util/Tools","tinymce/dom/ElementUtils","tinymce/dom/RangeUtils","tinymce/dom/TreeWalker","tinymce/caret/CaretWalker","tinymce/caret/CaretPosition","tinymce/dom/NodeType"],function(Serializer,Env,Tools,ElementUtils,RangeUtils,TreeWalker,CaretWalker,CaretPosition,NodeType){var each=Tools.each,extend=Tools.extend,map=Tools.map,inArray=Tools.inArray,explode=Tools.explode,isIE=Env.ie,isOldIE=Env.ie&&Env.ie<11,TRUE=!0,FALSE=!1,isTableCell=NodeType.matchNodeNames("td th");return function(editor){function execCommand(command,ui,value,args){var func,customCommand,state=0;if(/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command)||args&&args.skip_focus||editor.focus(),args=editor.fire("BeforeExecCommand",{command:command,ui:ui,value:value}),args.isDefaultPrevented())return!1;if(customCommand=command.toLowerCase(),func=commands.exec[customCommand])return func(customCommand,ui,value),editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;if(each(editor.plugins,function(p){if(p.execCommand&&p.execCommand(command,ui,value))return editor.fire("ExecCommand",{command:command,ui:ui,value:value}),state=!0,!1}),state)return state;if(editor.theme&&editor.theme.execCommand&&editor.theme.execCommand(command,ui,value))return editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0;try{state=editor.getDoc().execCommand(command,ui,value)}catch(ex){}return!!state&&(editor.fire("ExecCommand",{command:command,ui:ui,value:value}),!0)}function queryCommandState(command){var func;if(!editor.quirks.isHidden()){if(command=command.toLowerCase(),func=commands.state[command])return func(command);try{return editor.getDoc().queryCommandState(command)}catch(ex){}return!1}}function queryCommandValue(command){var func;if(!editor.quirks.isHidden()){if(command=command.toLowerCase(),func=commands.value[command])return func(command);try{return editor.getDoc().queryCommandValue(command)}catch(ex){}}}function addCommands(command_list,type){type=type||"exec",each(command_list,function(callback,command){each(command.toLowerCase().split(","),function(command){commands[type][command]=callback})})}function addCommand(command,callback,scope){command=command.toLowerCase(),commands.exec[command]=function(command,ui,value,args){return callback.call(scope||editor,ui,value,args)}}function queryCommandSupported(command){if(command=command.toLowerCase(),commands.exec[command])return!0;try{return editor.getDoc().queryCommandSupported(command)}catch(ex){}return!1}function addQueryStateHandler(command,callback,scope){command=command.toLowerCase(),commands.state[command]=function(){return callback.call(scope||editor)}}function addQueryValueHandler(command,callback,scope){command=command.toLowerCase(),commands.value[command]=function(){return callback.call(scope||editor)}}function hasCustomCommand(command){return command=command.toLowerCase(),!!commands.exec[command]}function execNativeCommand(command,ui,value){return ui===undefined&&(ui=FALSE),value===undefined&&(value=null),editor.getDoc().execCommand(command,ui,value)}function isFormatMatch(name){return formatter.match(name)}function toggleFormat(name,value){formatter.toggle(name,value?{value:value}:undefined),editor.nodeChanged()}function storeSelection(type){bookmark=selection.getBookmark(type)}function restoreSelection(){selection.moveToBookmark(bookmark)}var dom,selection,formatter,bookmark,commands={state:{},exec:{},value:{}},settings=editor.settings;editor.on("PreInit",function(){dom=editor.dom,selection=editor.selection,settings=editor.settings,formatter=editor.formatter}),extend(this,{execCommand:execCommand,queryCommandState:queryCommandState,queryCommandValue:queryCommandValue,queryCommandSupported:queryCommandSupported,addCommands:addCommands,addCommand:addCommand,addQueryStateHandler:addQueryStateHandler,addQueryValueHandler:addQueryValueHandler,hasCustomCommand:hasCustomCommand}),addCommands({"mceResetDesignMode,mceBeginUndoLevel":function(){},"mceEndUndoLevel,mceAddUndoLevel":function(){editor.undoManager.add()},"Cut,Copy,Paste":function(command){var failed,doc=editor.getDoc();try{execNativeCommand(command)}catch(ex){failed=TRUE}if("paste"!==command||doc.queryCommandEnabled(command)||(failed=!0),failed||!doc.queryCommandSupported(command)){var msg=editor.translate("Your browser doesn't support direct access to the clipboard. Please use the Ctrl+X/C/V keyboard shortcuts instead.");Env.mac&&(msg=msg.replace(/Ctrl\+/g,"+")),editor.notificationManager.open({text:msg,type:"error"})}},unlink:function(){if(selection.isCollapsed()){var elm=selection.getNode();return void("A"==elm.tagName&&editor.dom.remove(elm,!0))}formatter.remove("link")},"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone":function(command){var align=command.substring(7);"full"==align&&(align="justify"),each("left,center,right,justify".split(","),function(name){align!=name&&formatter.remove("align"+name)}),"none"!=align&&toggleFormat("align"+align)},"InsertUnorderedList,InsertOrderedList":function(command){var listElm,listParent;execNativeCommand(command),listElm=dom.getParent(selection.getNode(),"ol,ul"),listElm&&(listParent=listElm.parentNode,/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)&&(storeSelection(),dom.split(listParent,listElm),restoreSelection()))},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){toggleFormat(command)},"ForeColor,HiliteColor,FontName":function(command,ui,value){toggleFormat(command,value)},FontSize:function(command,ui,value){var fontClasses,fontSizes;value>=1&&value<=7&&(fontSizes=explode(settings.font_size_style_values),fontClasses=explode(settings.font_size_classes),value=fontClasses?fontClasses[value-1]||value:fontSizes[value-1]||value),toggleFormat(command,value)},RemoveFormat:function(command){formatter.remove(command)},mceBlockQuote:function(){toggleFormat("blockquote")},FormatBlock:function(command,ui,value){return toggleFormat(value||"p")},mceCleanup:function(){var bookmark=selection.getBookmark();editor.setContent(editor.getContent({cleanup:TRUE}),{cleanup:TRUE}),selection.moveToBookmark(bookmark)},mceRemoveNode:function(command,ui,value){var node=value||selection.getNode();node!=editor.getBody()&&(storeSelection(),editor.dom.remove(node,TRUE),restoreSelection())},mceSelectNodeDepth:function(command,ui,value){var counter=0;dom.getParent(selection.getNode(),function(node){if(1==node.nodeType&&counter++==value)return selection.select(node),FALSE},editor.getBody())},mceSelectNode:function(command,ui,value){selection.select(value)},mceInsertContent:function(command,ui,value){function trimOrPaddLeftRight(html){function hasSiblingText(siblingName){return container[siblingName]&&3==container[siblingName].nodeType}var rng,container,offset;return rng=selection.getRng(!0),container=rng.startContainer,offset=rng.startOffset,3==container.nodeType&&(offset>0?html=html.replace(/^&nbsp;/," "):hasSiblingText("previousSibling")||(html=html.replace(/^ /,"&nbsp;")),offset<container.length?html=html.replace(/&nbsp;(<br>|)$/," "):hasSiblingText("nextSibling")||(html=html.replace(/(&nbsp;| )(<br>|)$/,"&nbsp;"))),html}function trimNbspAfterDeleteAndPaddValue(){var rng,container,offset;rng=selection.getRng(!0),container=rng.startContainer,offset=rng.startOffset,3==container.nodeType&&rng.collapsed&&(""===container.data[offset]?(container.deleteData(offset,1),/[\u00a0| ]$/.test(value)||(value+=" ")):""===container.data[offset-1]&&(container.deleteData(offset-1,1),/[\u00a0| ]$/.test(value)||(value=" "+value)))}function markInlineFormatElements(fragment){if(merge)for(node=fragment.firstChild;node;node=node.walk(!0))textInlineElements[node.name]&&node.attr("data-mce-new","true")}function reduceInlineTextElements(){if(merge){var root=editor.getBody(),elementUtils=new ElementUtils(dom);each(dom.select("*[data-mce-new]"),function(node){node.removeAttribute("data-mce-new");for(var testNode=node.parentNode;testNode&&testNode!=root;testNode=testNode.parentNode)elementUtils.compare(testNode,node)&&dom.remove(node,!0)})}}function markFragmentElements(fragment){for(var node=fragment;node=node.walk();)1===node.type&&node.attr("data-mce-fragment","1")}function umarkFragmentElements(elm){Tools.each(elm.getElementsByTagName("*"),function(elm){elm.removeAttribute("data-mce-fragment")})}function isPartOfFragment(node){return!!node.getAttribute("data-mce-fragment")}function canHaveChildren(node){return node&&!editor.schema.getShortEndedElements()[node.nodeName]}function moveSelectionToMarker(marker){function getContentEditableFalseParent(node){for(var root=editor.getBody();node&&node!==root;node=node.parentNode)if("false"===editor.dom.getContentEditable(node))return node;return null}function findNextCaretRng(rng){var caretPos=CaretPosition.fromRangeStart(rng),caretWalker=new CaretWalker(editor.getBody());if(caretPos=caretWalker.next(caretPos))return caretPos.toRange()}var parentEditableFalseElm,parentBlock,nextRng;if(marker){if(selection.scrollIntoView(marker),parentEditableFalseElm=getContentEditableFalseParent(marker))return dom.remove(marker),void selection.select(parentEditableFalseElm);rng=dom.createRng(),node=marker.previousSibling,node&&3==node.nodeType?(rng.setStart(node,node.nodeValue.length),isIE||(node2=marker.nextSibling,node2&&3==node2.nodeType&&(node.appendData(node2.data),node2.parentNode.removeChild(node2)))):(rng.setStartBefore(marker),rng.setEndBefore(marker)),parentBlock=dom.getParent(marker,dom.isBlock),dom.remove(marker),parentBlock&&dom.isEmpty(parentBlock)&&(editor.$(parentBlock).empty(),rng.setStart(parentBlock,0),rng.setEnd(parentBlock,0),isTableCell(parentBlock)||isPartOfFragment(parentBlock)||!(nextRng=findNextCaretRng(rng))?dom.add(parentBlock,dom.create("br",{"data-mce-bogus":"1"})):(rng=nextRng,dom.remove(parentBlock))),selection.setRng(rng)}}var parser,serializer,parentNode,rootNode,fragment,args,marker,rng,node,node2,bookmarkHtml,merge,data,textInlineElements=editor.schema.getTextInlineElements();"string"!=typeof value&&(merge=value.merge,data=value.data,value=value.content),/^ | $/.test(value)&&(value=trimOrPaddLeftRight(value)),parser=editor.parser,serializer=new Serializer({validate:settings.validate},editor.schema),bookmarkHtml='<span id="mce_marker" data-mce-type="bookmark">&#xFEFF;&#x200B;</span>',args={content:value,format:"html",selection:!0},editor.fire("BeforeSetContent",args),value=args.content,value.indexOf("{$caret}")==-1&&(value+="{$caret}"),value=value.replace(/\{\$caret\}/,bookmarkHtml),rng=selection.getRng();var caretElement=rng.startContainer||(rng.parentElement?rng.parentElement():null),body=editor.getBody();caretElement===body&&selection.isCollapsed()&&dom.isBlock(body.firstChild)&&canHaveChildren(body.firstChild)&&dom.isEmpty(body.firstChild)&&(rng=dom.createRng(),rng.setStart(body.firstChild,0),rng.setEnd(body.firstChild,0),selection.setRng(rng)),selection.isCollapsed()||(editor.selection.setRng(editor.selection.getRng()),editor.getDoc().execCommand("Delete",!1,null),trimNbspAfterDeleteAndPaddValue()),parentNode=selection.getNode();var parserArgs={context:parentNode.nodeName.toLowerCase(),data:data};if(fragment=parser.parse(value,parserArgs),markFragmentElements(fragment),markInlineFormatElements(fragment),node=fragment.lastChild,"mce_marker"==node.attr("id"))for(marker=node,node=node.prev;node;node=node.walk(!0))if(3==node.type||!dom.isBlock(node.name)){editor.schema.isValidChild(node.parent.name,"span")&&node.parent.insert(marker,node,"br"===node.name);break}if(editor._selectionOverrides.showBlockCaretContainer(parentNode),parserArgs.invalid){for(selection.setContent(bookmarkHtml),parentNode=selection.getNode(),rootNode=editor.getBody(),9==parentNode.nodeType?parentNode=node=rootNode:node=parentNode;node!==rootNode;)parentNode=node,node=node.parentNode;value=parentNode==rootNode?rootNode.innerHTML:dom.getOuterHTML(parentNode),value=serializer.serialize(parser.parse(value.replace(/<span (id="mce_marker"|id=mce_marker).+?<\/span>/i,function(){return serializer.serialize(fragment)}))),parentNode==rootNode?dom.setHTML(rootNode,value):dom.setOuterHTML(parentNode,value)}else value=serializer.serialize(fragment),node=parentNode.firstChild,node2=parentNode.lastChild,!node||node===node2&&"BR"===node.nodeName?dom.setHTML(parentNode,value):selection.setContent(value);reduceInlineTextElements(),moveSelectionToMarker(dom.get("mce_marker")),umarkFragmentElements(editor.getBody()),editor.fire("SetContent",args),editor.addVisual()},mceInsertRawHTML:function(command,ui,value){selection.setContent("tiny_mce_marker"),editor.setContent(editor.getContent().replace(/tiny_mce_marker/g,function(){return value}))},mceToggleFormat:function(command,ui,value){toggleFormat(value)},mceSetContent:function(command,ui,value){editor.setContent(value)},"Indent,Outdent":function(command){var intentValue,indentUnit,value;intentValue=settings.indentation,indentUnit=/[a-z%]+$/i.exec(intentValue),intentValue=parseInt(intentValue,10),queryCommandState("InsertUnorderedList")||queryCommandState("InsertOrderedList")?execNativeCommand(command):(settings.forced_root_block||dom.getParent(selection.getNode(),dom.isBlock)||formatter.apply("div"),each(selection.getSelectedBlocks(),function(element){if("false"!==dom.getContentEditable(element)&&"LI"!=element.nodeName){var indentStyleName=editor.getParam("indent_use_margin",!1)?"margin":"padding";indentStyleName+="rtl"==dom.getStyle(element,"direction",!0)?"Right":"Left","outdent"==command?(value=Math.max(0,parseInt(element.style[indentStyleName]||0,10)-intentValue),dom.setStyle(element,indentStyleName,value?value+indentUnit:"")):(value=parseInt(element.style[indentStyleName]||0,10)+intentValue+indentUnit,dom.setStyle(element,indentStyleName,value))}}))},mceRepaint:function(){},InsertHorizontalRule:function(){editor.execCommand("mceInsertContent",!1,"<hr />")},mceToggleVisualAid:function(){editor.hasVisual=!editor.hasVisual,editor.addVisual()},mceReplaceContent:function(command,ui,value){editor.execCommand("mceInsertContent",!1,value.replace(/\{\$selection\}/g,selection.getContent({format:"text"})))},mceInsertLink:function(command,ui,value){var anchor;"string"==typeof value&&(value={href:value}),anchor=dom.getParent(selection.getNode(),"a"),value.href=value.href.replace(" ","%20"),anchor&&value.href||formatter.remove("link"),value.href&&formatter.apply("link",value,anchor)},selectAll:function(){var rng,root=dom.getRoot();selection.getRng().setStart?(rng=dom.createRng(),rng.setStart(root,0),rng.setEnd(root,root.childNodes.length),selection.setRng(rng)):(rng=selection.getRng(),rng.item||(rng.moveToElementText(root),rng.select()))},"delete":function(){execNativeCommand("Delete");var body=editor.getBody();dom.isEmpty(body)&&(editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0))},mceNewDocument:function(){editor.setContent("")},InsertLineBreak:function(command,ui,value){function hasRightSideContent(){for(var node,walker=new TreeWalker(container,parentBlock),nonEmptyElementsMap=editor.schema.getNonEmptyElements();node=walker.next();)if(nonEmptyElementsMap[node.nodeName.toLowerCase()]||node.length>0)return!0}var brElm,extraBr,marker,evt=value,rng=selection.getRng(!0);new RangeUtils(dom).normalize(rng);var offset=rng.startOffset,container=rng.startContainer;if(1==container.nodeType&&container.hasChildNodes()){var isAfterLastNodeInContainer=offset>container.childNodes.length-1;container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container,offset=isAfterLastNodeInContainer&&3==container.nodeType?container.nodeValue.length:0}var parentBlock=dom.getParent(container,dom.isBlock),parentBlockName=parentBlock?parentBlock.nodeName.toUpperCase():"",containerBlock=parentBlock?dom.getParent(parentBlock.parentNode,dom.isBlock):null,containerBlockName=containerBlock?containerBlock.nodeName.toUpperCase():"",isControlKey=evt&&evt.ctrlKey;"LI"!=containerBlockName||isControlKey||(parentBlock=containerBlock,parentBlockName=containerBlockName),container&&3==container.nodeType&&offset>=container.nodeValue.length&&(isOldIE||hasRightSideContent()||(brElm=dom.create("br"),rng.insertNode(brElm),rng.setStartAfter(brElm),rng.setEndAfter(brElm),extraBr=!0)),brElm=dom.create("br"),rng.insertNode(brElm);var documentMode=dom.doc.documentMode;return isOldIE&&"PRE"==parentBlockName&&(!documentMode||documentMode<8)&&brElm.parentNode.insertBefore(dom.doc.createTextNode("\r"),brElm),marker=dom.create("span",{},"&nbsp;"),brElm.parentNode.insertBefore(marker,brElm),selection.scrollIntoView(marker),dom.remove(marker),extraBr?(rng.setStartBefore(brElm),rng.setEndBefore(brElm)):(rng.setStartAfter(brElm),rng.setEndAfter(brElm)),selection.setRng(rng),editor.undoManager.add(),TRUE}}),addCommands({"JustifyLeft,JustifyCenter,JustifyRight,JustifyFull":function(command){
var name="align"+command.substring(7),nodes=selection.isCollapsed()?[dom.getParent(selection.getNode(),dom.isBlock)]:selection.getSelectedBlocks(),matches=map(nodes,function(node){return!!formatter.matchNode(node,name)});return inArray(matches,TRUE)!==-1},"Bold,Italic,Underline,Strikethrough,Superscript,Subscript":function(command){return isFormatMatch(command)},mceBlockQuote:function(){return isFormatMatch("blockquote")},Outdent:function(){var node;if(settings.inline_styles){if((node=dom.getParent(selection.getStart(),dom.isBlock))&&parseInt(node.style.paddingLeft,10)>0)return TRUE;if((node=dom.getParent(selection.getEnd(),dom.isBlock))&&parseInt(node.style.paddingLeft,10)>0)return TRUE}return queryCommandState("InsertUnorderedList")||queryCommandState("InsertOrderedList")||!settings.inline_styles&&!!dom.getParent(selection.getNode(),"BLOCKQUOTE")},"InsertUnorderedList,InsertOrderedList":function(command){var list=dom.getParent(selection.getNode(),"ul,ol");return list&&("insertunorderedlist"===command&&"UL"===list.tagName||"insertorderedlist"===command&&"OL"===list.tagName)}},"state"),addCommands({"FontSize,FontName":function(command){var parent,value=0;return(parent=dom.getParent(selection.getNode(),"span"))&&(value="fontsize"==command?parent.style.fontSize:parent.style.fontFamily.replace(/, /g,",").replace(/[\'\"]/g,"").toLowerCase()),value}},"value"),addCommands({Undo:function(){editor.undoManager.undo()},Redo:function(){editor.undoManager.redo()}})}}),define("tinymce/util/URI",["tinymce/util/Tools"],function(Tools){function URI(url,settings){var baseUri,base_url,self=this;if(url=trim(url),settings=self.settings=settings||{},baseUri=settings.base_uri,/^([\w\-]+):([^\/]{2})/i.test(url)||/^\s*#/.test(url))return void(self.source=url);var isProtocolRelative=0===url.indexOf("//");0!==url.indexOf("/")||isProtocolRelative||(url=(baseUri?baseUri.protocol||"http":"http")+"://mce_host"+url),/^[\w\-]*:?\/\//.test(url)||(base_url=settings.base_uri?settings.base_uri.path:new URI(location.href).directory,""===settings.base_uri.protocol?url="//mce_host"+self.toAbsPath(base_url,url):(url=/([^#?]*)([#?]?.*)/.exec(url),url=(baseUri&&baseUri.protocol||"http")+"://mce_host"+self.toAbsPath(base_url,url[1])+url[2])),url=url.replace(/@@/g,"(mce_at)"),url=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/.exec(url),each(queryParts,function(v,i){var part=url[i];part&&(part=part.replace(/\(mce_at\)/g,"@@")),self[v]=part}),baseUri&&(self.protocol||(self.protocol=baseUri.protocol),self.userInfo||(self.userInfo=baseUri.userInfo),self.port||"mce_host"!==self.host||(self.port=baseUri.port),self.host&&"mce_host"!==self.host||(self.host=baseUri.host),self.source=""),isProtocolRelative&&(self.protocol="")}var each=Tools.each,trim=Tools.trim,queryParts="source protocol authority userInfo user password host port relative path directory file query anchor".split(" "),DEFAULT_PORTS={ftp:21,http:80,https:443,mailto:25};return URI.prototype={setPath:function(path){var self=this;path=/^(.*?)\/?(\w+)?$/.exec(path),self.path=path[0],self.directory=path[1],self.file=path[2],self.source="",self.getURI()},toRelative:function(uri){var output,self=this;if("./"===uri)return uri;if(uri=new URI(uri,{base_uri:self}),"mce_host"!=uri.host&&self.host!=uri.host&&uri.host||self.port!=uri.port||self.protocol!=uri.protocol&&""!==uri.protocol)return uri.getURI();var tu=self.getURI(),uu=uri.getURI();return tu==uu||"/"==tu.charAt(tu.length-1)&&tu.substr(0,tu.length-1)==uu?tu:(output=self.toRelPath(self.path,uri.path),uri.query&&(output+="?"+uri.query),uri.anchor&&(output+="#"+uri.anchor),output)},toAbsolute:function(uri,noHost){return uri=new URI(uri,{base_uri:this}),uri.getURI(noHost&&this.isSameOrigin(uri))},isSameOrigin:function(uri){if(this.host==uri.host&&this.protocol==uri.protocol){if(this.port==uri.port)return!0;var defaultPort=DEFAULT_PORTS[this.protocol];if(defaultPort&&(this.port||defaultPort)==(uri.port||defaultPort))return!0}return!1},toRelPath:function(base,path){var items,i,l,breakPoint=0,out="";if(base=base.substring(0,base.lastIndexOf("/")),base=base.split("/"),items=path.split("/"),base.length>=items.length)for(i=0,l=base.length;i<l;i++)if(i>=items.length||base[i]!=items[i]){breakPoint=i+1;break}if(base.length<items.length)for(i=0,l=items.length;i<l;i++)if(i>=base.length||base[i]!=items[i]){breakPoint=i+1;break}if(1===breakPoint)return path;for(i=0,l=base.length-(breakPoint-1);i<l;i++)out+="../";for(i=breakPoint-1,l=items.length;i<l;i++)out+=i!=breakPoint-1?"/"+items[i]:items[i];return out},toAbsPath:function(base,path){var i,tr,outPath,nb=0,o=[];for(tr=/\/$/.test(path)?"/":"",base=base.split("/"),path=path.split("/"),each(base,function(k){k&&o.push(k)}),base=o,i=path.length-1,o=[];i>=0;i--)0!==path[i].length&&"."!==path[i]&&(".."!==path[i]?nb>0?nb--:o.push(path[i]):nb++);return i=base.length-nb,outPath=i<=0?o.reverse().join("/"):base.slice(0,i).join("/")+"/"+o.reverse().join("/"),0!==outPath.indexOf("/")&&(outPath="/"+outPath),tr&&outPath.lastIndexOf("/")!==outPath.length-1&&(outPath+=tr),outPath},getURI:function(noProtoHost){var s,self=this;return self.source&&!noProtoHost||(s="",noProtoHost||(s+=self.protocol?self.protocol+"://":"//",self.userInfo&&(s+=self.userInfo+"@"),self.host&&(s+=self.host),self.port&&(s+=":"+self.port)),self.path&&(s+=self.path),self.query&&(s+="?"+self.query),self.anchor&&(s+="#"+self.anchor),self.source=s),self.source}},URI.parseDataUri=function(uri){var type,matches;return uri=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uri[0]),matches&&(type=matches[1]),{type:type,data:uri[1]}},URI.getDocumentBaseUrl=function(loc){var baseUrl;return baseUrl=0!==loc.protocol.indexOf("http")&&"file:"!==loc.protocol?loc.href:loc.protocol+"//"+loc.host+loc.pathname,/^[^:]+:\/\/\/?[^\/]+\//.test(baseUrl)&&(baseUrl=baseUrl.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(baseUrl)||(baseUrl+="/")),baseUrl},URI}),define("tinymce/util/Class",["tinymce/util/Tools"],function(Tools){function Class(){}var extendClass,initializing,each=Tools.each,extend=Tools.extend;return Class.extend=extendClass=function(prop){function Class(){var i,mixins,mixin,self=this;if(!initializing&&(self.init&&self.init.apply(self,arguments),mixins=self.Mixins))for(i=mixins.length;i--;)mixin=mixins[i],mixin.init&&mixin.init.apply(self,arguments)}function dummy(){return this}function createMethod(name,fn){return function(){var ret,self=this,tmp=self._super;return self._super=_super[name],ret=fn.apply(self,arguments),self._super=tmp,ret}}var prototype,name,member,self=this,_super=self.prototype;initializing=!0,prototype=new self,initializing=!1,prop.Mixins&&(each(prop.Mixins,function(mixin){for(var name in mixin)"init"!==name&&(prop[name]=mixin[name])}),_super.Mixins&&(prop.Mixins=_super.Mixins.concat(prop.Mixins))),prop.Methods&&each(prop.Methods.split(","),function(name){prop[name]=dummy}),prop.Properties&&each(prop.Properties.split(","),function(name){var fieldName="_"+name;prop[name]=function(value){var undef,self=this;return value!==undef?(self[fieldName]=value,self):self[fieldName]}}),prop.Statics&&each(prop.Statics,function(func,name){Class[name]=func}),prop.Defaults&&_super.Defaults&&(prop.Defaults=extend({},_super.Defaults,prop.Defaults));for(name in prop)member=prop[name],"function"==typeof member&&_super[name]?prototype[name]=createMethod(name,member):prototype[name]=member;return Class.prototype=prototype,Class.constructor=Class,Class.extend=extendClass,Class},Class}),define("tinymce/util/EventDispatcher",["tinymce/util/Tools"],function(Tools){function Dispatcher(settings){function returnFalse(){return!1}function returnTrue(){return!0}function fire(name,args){var handlers,i,l,callback;if(name=name.toLowerCase(),args=args||{},args.type=name,args.target||(args.target=scope),args.preventDefault||(args.preventDefault=function(){args.isDefaultPrevented=returnTrue},args.stopPropagation=function(){args.isPropagationStopped=returnTrue},args.stopImmediatePropagation=function(){args.isImmediatePropagationStopped=returnTrue},args.isDefaultPrevented=returnFalse,args.isPropagationStopped=returnFalse,args.isImmediatePropagationStopped=returnFalse),settings.beforeFire&&settings.beforeFire(args),handlers=bindings[name])for(i=0,l=handlers.length;i<l;i++){if(callback=handlers[i],callback.once&&off(name,callback.func),args.isImmediatePropagationStopped())return args.stopPropagation(),args;if(callback.func.call(scope,args)===!1)return args.preventDefault(),args}return args}function on(name,callback,prepend,extra){var handlers,names,i;if(callback===!1&&(callback=returnFalse),callback)for(callback={func:callback},extra&&Tools.extend(callback,extra),names=name.toLowerCase().split(" "),i=names.length;i--;)name=names[i],handlers=bindings[name],handlers||(handlers=bindings[name]=[],toggleEvent(name,!0)),prepend?handlers.unshift(callback):handlers.push(callback);return self}function off(name,callback){var i,handlers,bindingName,names,hi;if(name)for(names=name.toLowerCase().split(" "),i=names.length;i--;){if(name=names[i],handlers=bindings[name],!name){for(bindingName in bindings)toggleEvent(bindingName,!1),delete bindings[bindingName];return self}if(handlers){if(callback)for(hi=handlers.length;hi--;)handlers[hi].func===callback&&(handlers=handlers.slice(0,hi).concat(handlers.slice(hi+1)),bindings[name]=handlers);else handlers.length=0;handlers.length||(toggleEvent(name,!1),delete bindings[name])}}else{for(name in bindings)toggleEvent(name,!1);bindings={}}return self}function once(name,callback,prepend){return on(name,callback,prepend,{once:!0})}function has(name){return name=name.toLowerCase(),!(!bindings[name]||0===bindings[name].length)}var scope,toggleEvent,self=this,bindings={};settings=settings||{},scope=settings.scope||self,toggleEvent=settings.toggleEvent||returnFalse,self.fire=fire,self.on=on,self.off=off,self.once=once,self.has=has}var nativeEvents=Tools.makeMap("focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover draggesture dragdrop drop drag submit compositionstart compositionend compositionupdate touchstart touchend"," ");return Dispatcher.isNative=function(name){return!!nativeEvents[name.toLowerCase()]},Dispatcher}),define("tinymce/data/Binding",[],function(){function Binding(settings){this.create=settings.create}return Binding.create=function(model,name){return new Binding({create:function(otherModel,otherName){function fromSelfToOther(e){otherModel.set(otherName,e.value)}function fromOtherToSelf(e){model.set(name,e.value)}var bindings;return otherModel.on("change:"+otherName,fromOtherToSelf),model.on("change:"+name,fromSelfToOther),bindings=otherModel._bindings,bindings||(bindings=otherModel._bindings=[],otherModel.on("destroy",function(){for(var i=bindings.length;i--;)bindings[i]()})),bindings.push(function(){model.off("change:"+name,fromSelfToOther)}),model.get(name)}})},Binding}),define("tinymce/util/Observable",["tinymce/util/EventDispatcher"],function(EventDispatcher){function getEventDispatcher(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){EventDispatcher.isNative(name)&&obj.toggleNativeEvent&&obj.toggleNativeEvent(name,state)}})),obj._eventDispatcher}return{fire:function(name,args,bubble){var self=this;if(self.removed&&"remove"!==name)return args;if(args=getEventDispatcher(self).fire(name,args,bubble),bubble!==!1&&self.parent)for(var parent=self.parent();parent&&!args.isPropagationStopped();)parent.fire(name,args,!1),parent=parent.parent();return args},on:function(name,callback,prepend){return getEventDispatcher(this).on(name,callback,prepend)},off:function(name,callback){return getEventDispatcher(this).off(name,callback)},once:function(name,callback){return getEventDispatcher(this).once(name,callback)},hasEventListeners:function(name){return getEventDispatcher(this).has(name)}}}),define("tinymce/data/ObservableObject",["tinymce/data/Binding","tinymce/util/Observable","tinymce/util/Class","tinymce/util/Tools"],function(Binding,Observable,Class,Tools){function isNode(node){return node.nodeType>0}function isEqual(a,b){var k,checked;if(a===b)return!0;if(null===a||null===b)return a===b;if("object"!=typeof a||"object"!=typeof b)return a===b;if(Tools.isArray(b)){if(a.length!==b.length)return!1;for(k=a.length;k--;)if(!isEqual(a[k],b[k]))return!1}if(isNode(a)||isNode(b))return a===b;checked={};for(k in b){if(!isEqual(a[k],b[k]))return!1;checked[k]=!0}for(k in a)if(!checked[k]&&!isEqual(a[k],b[k]))return!1;return!0}return Class.extend({Mixins:[Observable],init:function(data){var name,value;data=data||{};for(name in data)value=data[name],value instanceof Binding&&(data[name]=value.create(this,name));this.data=data},set:function(name,value){var key,args,oldValue=this.data[name];if(value instanceof Binding&&(value=value.create(this,name)),"object"==typeof name){for(key in name)this.set(key,name[key]);return this}return isEqual(oldValue,value)||(this.data[name]=value,args={target:this,name:name,value:value,oldValue:oldValue},this.fire("change:"+name,args),this.fire("change",args)),this},get:function(name){return this.data[name]},has:function(name){return name in this.data},bind:function(name){return Binding.create(this,name)},destroy:function(){this.fire("destroy")}})}),define("tinymce/ui/Selector",["tinymce/util/Class"],function(Class){function unique(array){for(var item,uniqueItems=[],i=array.length;i--;)item=array[i],item.__checked||(uniqueItems.push(item),item.__checked=1);for(i=uniqueItems.length;i--;)delete uniqueItems[i].__checked;return uniqueItems}var Collection,expression=/^([\w\\*]+)?(?:#([\w\-\\]+))?(?:\.([\w\\\.]+))?(?:\[\@?([\w\\]+)([\^\$\*!~]?=)([\w\\]+)\])?(?:\:(.+))?/i,chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,whiteSpace=/^\s*|\s*$/g,Selector=Class.extend({init:function(selector){function compileNameFilter(name){if(name)return name=name.toLowerCase(),function(item){return"*"===name||item.type===name}}function compileIdFilter(id){if(id)return function(item){return item._name===id}}function compileClassesFilter(classes){if(classes)return classes=classes.split("."),function(item){for(var i=classes.length;i--;)if(!item.classes.contains(classes[i]))return!1;return!0}}function compileAttrFilter(name,cmp,check){if(name)return function(item){var value=item[name]?item[name]():"";return cmp?"="===cmp?value===check:"*="===cmp?value.indexOf(check)>=0:"~="===cmp?(" "+value+" ").indexOf(" "+check+" ")>=0:"!="===cmp?value!=check:"^="===cmp?0===value.indexOf(check):"$="===cmp&&value.substr(value.length-check.length)===check:!!check}}function compilePsuedoFilter(name){var notSelectors;if(name)return name=/(?:not\((.+)\))|(.+)/i.exec(name),name[1]?(notSelectors=parseChunks(name[1],[]),function(item){return!match(item,notSelectors)}):(name=name[2],function(item,index,length){return"first"===name?0===index:"last"===name?index===length-1:"even"===name?index%2===0:"odd"===name?index%2===1:!!item[name]&&item[name]()})}function compile(selector,filters,direct){function add(filter){filter&&filters.push(filter)}var parts;return parts=expression.exec(selector.replace(whiteSpace,"")),add(compileNameFilter(parts[1])),add(compileIdFilter(parts[2])),add(compileClassesFilter(parts[3])),add(compileAttrFilter(parts[4],parts[5],parts[6])),add(compilePsuedoFilter(parts[7])),filters.pseudo=!!parts[7],filters.direct=direct,filters}function parseChunks(selector,selectors){var extra,matches,i,parts=[];do if(chunker.exec(""),matches=chunker.exec(selector),matches&&(selector=matches[3],parts.push(matches[1]),matches[2])){extra=matches[3];break}while(matches);for(extra&&parseChunks(extra,selectors),selector=[],i=0;i<parts.length;i++)">"!=parts[i]&&selector.push(compile(parts[i],[],">"===parts[i-1]));return selectors.push(selector),selectors}var match=this.match;this._selectors=parseChunks(selector,[])},match:function(control,selectors){var i,l,si,sl,selector,fi,fl,filters,index,length,siblings,count,item;for(selectors=selectors||this._selectors,i=0,l=selectors.length;i<l;i++){for(selector=selectors[i],sl=selector.length,item=control,count=0,si=sl-1;si>=0;si--)for(filters=selector[si];item;){if(filters.pseudo)for(siblings=item.parent().items(),index=length=siblings.length;index--&&siblings[index]!==item;);for(fi=0,fl=filters.length;fi<fl;fi++)if(!filters[fi](item,index,length)){fi=fl+1;break}if(fi===fl){count++;break}if(si===sl-1)break;item=item.parent()}if(count===sl)return!0}return!1},find:function(container){function collect(items,selector,index){var i,l,fi,fl,item,filters=selector[index];for(i=0,l=items.length;i<l;i++){for(item=items[i],fi=0,fl=filters.length;fi<fl;fi++)if(!filters[fi](item,i,l)){fi=fl+1;break}if(fi===fl)index==selector.length-1?matches.push(item):item.items&&collect(item.items(),selector,index+1);else if(filters.direct)return;item.items&&collect(item.items(),selector,index)}}var i,l,matches=[],selectors=this._selectors;if(container.items){for(i=0,l=selectors.length;i<l;i++)collect(container.items(),selectors[i],0);l>1&&(matches=unique(matches))}return Collection||(Collection=Selector.Collection),new Collection(matches)}});return Selector}),define("tinymce/ui/Collection",["tinymce/util/Tools","tinymce/ui/Selector","tinymce/util/Class"],function(Tools,Selector,Class){var Collection,proto,push=Array.prototype.push,slice=Array.prototype.slice;return proto={length:0,init:function(items){items&&this.add(items)},add:function(items){var self=this;return Tools.isArray(items)?push.apply(self,items):items instanceof Collection?self.add(items.toArray()):push.call(self,items),self},set:function(items){var i,self=this,len=self.length;for(self.length=0,self.add(items),i=self.length;i<len;i++)delete self[i];return self},filter:function(selector){var i,l,item,match,self=this,matches=[];for("string"==typeof selector?(selector=new Selector(selector),match=function(item){return selector.match(item)}):match=selector,i=0,l=self.length;i<l;i++)item=self[i],match(item)&&matches.push(item);return new Collection(matches)},slice:function(){return new Collection(slice.apply(this,arguments))},eq:function(index){return index===-1?this.slice(index):this.slice(index,+index+1)},each:function(callback){return Tools.each(this,callback),this},toArray:function(){return Tools.toArray(this)},indexOf:function(ctrl){for(var self=this,i=self.length;i--&&self[i]!==ctrl;);return i},reverse:function(){return new Collection(Tools.toArray(this).reverse())},hasClass:function(cls){return!!this[0]&&this[0].classes.contains(cls)},prop:function(name,value){var undef,item,self=this;return value!==undef?(self.each(function(item){item[name]&&item[name](value)}),self):(item=self[0],item&&item[name]?item[name]():void 0)},exec:function(name){var self=this,args=Tools.toArray(arguments).slice(1);return self.each(function(item){item[name]&&item[name].apply(item,args)}),self},remove:function(){for(var i=this.length;i--;)this[i].remove();return this},addClass:function(cls){return this.each(function(item){item.classes.add(cls)})},removeClass:function(cls){return this.each(function(item){item.classes.remove(cls)})}},Tools.each("fire on off show hide append prepend before after reflow".split(" "),function(name){proto[name]=function(){var args=Tools.toArray(arguments);return this.each(function(ctrl){name in ctrl&&ctrl[name].apply(ctrl,args)}),this}}),Tools.each("text name disabled active selected checked visible parent value data".split(" "),function(name){proto[name]=function(value){return this.prop(name,value)}}),Collection=Class.extend(proto),Selector.Collection=Collection,Collection}),define("tinymce/ui/DomUtils",["tinymce/util/Tools","tinymce/dom/DOMUtils"],function(Tools,DOMUtils){var count=0;return{id:function(){return"mceu_"+count++},create:function(name,attrs,children){var elm=document.createElement(name);return DOMUtils.DOM.setAttribs(elm,attrs),"string"==typeof children?elm.innerHTML=children:Tools.each(children,function(child){child.nodeType&&elm.appendChild(child)}),elm},createFragment:function(html){return DOMUtils.DOM.createFragment(html)},getWindowSize:function(){return DOMUtils.DOM.getViewPort()},getSize:function(elm){var width,height;if(elm.getBoundingClientRect){var rect=elm.getBoundingClientRect();width=Math.max(rect.width||rect.right-rect.left,elm.offsetWidth),height=Math.max(rect.height||rect.bottom-rect.bottom,elm.offsetHeight)}else width=elm.offsetWidth,height=elm.offsetHeight;return{width:width,height:height}},getPos:function(elm,root){return DOMUtils.DOM.getPos(elm,root)},getViewPort:function(win){return DOMUtils.DOM.getViewPort(win)},get:function(id){return document.getElementById(id)},addClass:function(elm,cls){return DOMUtils.DOM.addClass(elm,cls)},removeClass:function(elm,cls){return DOMUtils.DOM.removeClass(elm,cls)},hasClass:function(elm,cls){return DOMUtils.DOM.hasClass(elm,cls)},toggleClass:function(elm,cls,state){return DOMUtils.DOM.toggleClass(elm,cls,state)},css:function(elm,name,value){return DOMUtils.DOM.setStyle(elm,name,value)},getRuntimeStyle:function(elm,name){return DOMUtils.DOM.getStyle(elm,name,!0)},on:function(target,name,callback,scope){return DOMUtils.DOM.bind(target,name,callback,scope)},off:function(target,name,callback){return DOMUtils.DOM.unbind(target,name,callback)},fire:function(target,name,args){return DOMUtils.DOM.fire(target,name,args)},innerHtml:function(elm,html){DOMUtils.DOM.setHTML(elm,html)}}}),define("tinymce/ui/BoxUtils",[],function(){return{parseBox:function(value){var len,radix=10;if(value)return"number"==typeof value?(value=value||0,{top:value,left:value,bottom:value,right:value}):(value=value.split(" "),len=value.length,1===len?value[1]=value[2]=value[3]=value[0]:2===len?(value[2]=value[0],value[3]=value[1]):3===len&&(value[3]=value[1]),{top:parseInt(value[0],radix)||0,right:parseInt(value[1],radix)||0,bottom:parseInt(value[2],radix)||0,left:parseInt(value[3],radix)||0})},measureBox:function(elm,prefix){function getStyle(name){var defaultView=document.defaultView;return defaultView?(name=name.replace(/[A-Z]/g,function(a){return"-"+a}),defaultView.getComputedStyle(elm,null).getPropertyValue(name)):elm.currentStyle[name]}function getSide(name){var val=parseFloat(getStyle(name),10);return isNaN(val)?0:val}return{top:getSide(prefix+"TopWidth"),right:getSide(prefix+"RightWidth"),bottom:getSide(prefix+"BottomWidth"),left:getSide(prefix+"LeftWidth")}}}}),define("tinymce/ui/ClassList",["tinymce/util/Tools"],function(Tools){function noop(){}function ClassList(onchange){this.cls=[],this.cls._map={},this.onchange=onchange||noop,this.prefix=""}return Tools.extend(ClassList.prototype,{add:function(cls){return cls&&!this.contains(cls)&&(this.cls._map[cls]=!0,this.cls.push(cls),this._change()),this},remove:function(cls){if(this.contains(cls)){for(var i=0;i<this.cls.length&&this.cls[i]!==cls;i++);this.cls.splice(i,1),delete this.cls._map[cls],this._change()}return this},toggle:function(cls,state){var curState=this.contains(cls);return curState!==state&&(curState?this.remove(cls):this.add(cls),this._change()),this},contains:function(cls){return!!this.cls._map[cls]},_change:function(){delete this.clsValue,this.onchange.call(this)}}),ClassList.prototype.toString=function(){var value;if(this.clsValue)return this.clsValue;value="";for(var i=0;i<this.cls.length;i++)i>0&&(value+=" "),value+=this.prefix+this.cls[i];return value},ClassList}),define("tinymce/ui/ReflowQueue",["tinymce/util/Delay"],function(Delay){var animationFrameRequested,dirtyCtrls={};return{add:function(ctrl){var parent=ctrl.parent();if(parent){if(!parent._layout||parent._layout.isNative())return;dirtyCtrls[parent._id]||(dirtyCtrls[parent._id]=parent),animationFrameRequested||(animationFrameRequested=!0,Delay.requestAnimationFrame(function(){var id,ctrl;animationFrameRequested=!1;for(id in dirtyCtrls)ctrl=dirtyCtrls[id],ctrl.state.get("rendered")&&ctrl.reflow();dirtyCtrls={}},document.body))}},remove:function(ctrl){dirtyCtrls[ctrl._id]&&delete dirtyCtrls[ctrl._id]}}}),define("tinymce/ui/Control",["tinymce/util/Class","tinymce/util/Tools","tinymce/util/EventDispatcher","tinymce/data/ObservableObject","tinymce/ui/Collection","tinymce/ui/DomUtils","tinymce/dom/DomQuery","tinymce/ui/BoxUtils","tinymce/ui/ClassList","tinymce/ui/ReflowQueue"],function(Class,Tools,EventDispatcher,ObservableObject,Collection,DomUtils,$,BoxUtils,ClassList,ReflowQueue){function getEventDispatcher(obj){return obj._eventDispatcher||(obj._eventDispatcher=new EventDispatcher({scope:obj,toggleEvent:function(name,state){state&&EventDispatcher.isNative(name)&&(obj._nativeEvents||(obj._nativeEvents={}),obj._nativeEvents[name]=!0,obj.state.get("rendered")&&bindPendingEvents(obj))}})),obj._eventDispatcher}function bindPendingEvents(eventCtrl){function delegate(e){var control=eventCtrl.getParentCtrl(e.target);control&&control.fire(e.type,e)}function mouseLeaveHandler(){var ctrl=eventRootCtrl._lastHoverCtrl;ctrl&&(ctrl.fire("mouseleave",{target:ctrl.getEl()}),ctrl.parents().each(function(ctrl){ctrl.fire("mouseleave",{target:ctrl.getEl()})}),eventRootCtrl._lastHoverCtrl=null)}function mouseEnterHandler(e){var i,parents,lastParents,ctrl=eventCtrl.getParentCtrl(e.target),lastCtrl=eventRootCtrl._lastHoverCtrl,idx=0;if(ctrl!==lastCtrl){if(eventRootCtrl._lastHoverCtrl=ctrl,parents=ctrl.parents().toArray().reverse(),parents.push(ctrl),lastCtrl){for(lastParents=lastCtrl.parents().toArray().reverse(),lastParents.push(lastCtrl),idx=0;idx<lastParents.length&&parents[idx]===lastParents[idx];idx++);for(i=lastParents.length-1;i>=idx;i--)lastCtrl=lastParents[i],lastCtrl.fire("mouseleave",{target:lastCtrl.getEl()})}for(i=idx;i<parents.length;i++)ctrl=parents[i],ctrl.fire("mouseenter",{target:ctrl.getEl()})}}function fixWheelEvent(e){e.preventDefault(),"mousewheel"==e.type?(e.deltaY=-.025*e.wheelDelta,e.wheelDeltaX&&(e.deltaX=-.025*e.wheelDeltaX)):(e.deltaX=0,e.deltaY=e.detail),e=eventCtrl.fire("wheel",e)}var i,l,parents,eventRootCtrl,nativeEvents,name;if(nativeEvents=eventCtrl._nativeEvents){for(parents=eventCtrl.parents().toArray(),parents.unshift(eventCtrl),i=0,l=parents.length;!eventRootCtrl&&i<l;i++)eventRootCtrl=parents[i]._eventsRoot;for(eventRootCtrl||(eventRootCtrl=parents[parents.length-1]||eventCtrl),eventCtrl._eventsRoot=eventRootCtrl,l=i,i=0;i<l;i++)parents[i]._eventsRoot=eventRootCtrl;var eventRootDelegates=eventRootCtrl._delegates;eventRootDelegates||(eventRootDelegates=eventRootCtrl._delegates={});for(name in nativeEvents){if(!nativeEvents)return!1;"wheel"!==name||hasWheelEventSupport?("mouseenter"===name||"mouseleave"===name?eventRootCtrl._hasMouseEnter||($(eventRootCtrl.getEl()).on("mouseleave",mouseLeaveHandler).on("mouseover",mouseEnterHandler),eventRootCtrl._hasMouseEnter=1):eventRootDelegates[name]||($(eventRootCtrl.getEl()).on(name,delegate),eventRootDelegates[name]=!0),nativeEvents[name]=!1):hasMouseWheelEventSupport?$(eventCtrl.getEl()).on("mousewheel",fixWheelEvent):$(eventCtrl.getEl()).on("DOMMouseScroll",fixWheelEvent)}}}var Control,hasMouseWheelEventSupport="onmousewheel"in document,hasWheelEventSupport=!1,classPrefix="mce-",idCounter=0,proto={Statics:{classPrefix:classPrefix},isRtl:function(){return Control.rtl},classPrefix:classPrefix,init:function(settings){function applyClasses(classes){var i;for(classes=classes.split(" "),i=0;i<classes.length;i++)self.classes.add(classes[i])}var classes,defaultClasses,self=this;self.settings=settings=Tools.extend({},self.Defaults,settings),self._id=settings.id||"mceu_"+idCounter++,self._aria={role:settings.role},self._elmCache={},self.$=$,self.state=new ObservableObject({visible:!0,active:!1,disabled:!1,value:""}),self.data=new ObservableObject(settings.data),self.classes=new ClassList(function(){self.state.get("rendered")&&(self.getEl().className=this.toString())}),self.classes.prefix=self.classPrefix,classes=settings.classes,classes&&(self.Defaults&&(defaultClasses=self.Defaults.classes,defaultClasses&&classes!=defaultClasses&&applyClasses(defaultClasses)),applyClasses(classes)),Tools.each("title text name visible disabled active value".split(" "),function(name){name in settings&&self[name](settings[name])}),self.on("click",function(){if(self.disabled())return!1}),self.settings=settings,self.borderBox=BoxUtils.parseBox(settings.border),self.paddingBox=BoxUtils.parseBox(settings.padding),self.marginBox=BoxUtils.parseBox(settings.margin),settings.hidden&&self.hide()},Properties:"parent,name",getContainerElm:function(){return document.body},getParentCtrl:function(elm){for(var ctrl,lookup=this.getRoot().controlIdLookup;elm&&lookup&&!(ctrl=lookup[elm.id]);)elm=elm.parentNode;return ctrl},initLayoutRect:function(){var borderBox,layoutRect,width,height,minWidth,minHeight,autoResize,startMinWidth,startMinHeight,initialSize,self=this,settings=self.settings,elm=self.getEl();borderBox=self.borderBox=self.borderBox||BoxUtils.measureBox(elm,"border"),self.paddingBox=self.paddingBox||BoxUtils.measureBox(elm,"padding"),self.marginBox=self.marginBox||BoxUtils.measureBox(elm,"margin"),initialSize=DomUtils.getSize(elm),startMinWidth=settings.minWidth,startMinHeight=settings.minHeight,minWidth=startMinWidth||initialSize.width,minHeight=startMinHeight||initialSize.height,width=settings.width,height=settings.height,autoResize=settings.autoResize,autoResize="undefined"!=typeof autoResize?autoResize:!width&&!height,width=width||minWidth,height=height||minHeight;var deltaW=borderBox.left+borderBox.right,deltaH=borderBox.top+borderBox.bottom,maxW=settings.maxWidth||65535,maxH=settings.maxHeight||65535;return self._layoutRect=layoutRect={x:settings.x||0,y:settings.y||0,w:width,h:height,deltaW:deltaW,deltaH:deltaH,contentW:width-deltaW,contentH:height-deltaH,innerW:width-deltaW,innerH:height-deltaH,startMinWidth:startMinWidth||0,startMinHeight:startMinHeight||0,minW:Math.min(minWidth,maxW),minH:Math.min(minHeight,maxH),maxW:maxW,maxH:maxH,autoResize:autoResize,scrollW:0},self._lastLayoutRect={},layoutRect},layoutRect:function(newRect){var lastLayoutRect,size,deltaWidth,deltaHeight,undef,repaintControls,self=this,curRect=self._layoutRect;return curRect||(curRect=self.initLayoutRect()),newRect?(deltaWidth=curRect.deltaW,deltaHeight=curRect.deltaH,newRect.x!==undef&&(curRect.x=newRect.x),newRect.y!==undef&&(curRect.y=newRect.y),newRect.minW!==undef&&(curRect.minW=newRect.minW),newRect.minH!==undef&&(curRect.minH=newRect.minH),size=newRect.w,size!==undef&&(size=size<curRect.minW?curRect.minW:size,size=size>curRect.maxW?curRect.maxW:size,curRect.w=size,curRect.innerW=size-deltaWidth),size=newRect.h,size!==undef&&(size=size<curRect.minH?curRect.minH:size,size=size>curRect.maxH?curRect.maxH:size,curRect.h=size,curRect.innerH=size-deltaHeight),size=newRect.innerW,size!==undef&&(size=size<curRect.minW-deltaWidth?curRect.minW-deltaWidth:size,size=size>curRect.maxW-deltaWidth?curRect.maxW-deltaWidth:size,curRect.innerW=size,curRect.w=size+deltaWidth),size=newRect.innerH,size!==undef&&(size=size<curRect.minH-deltaHeight?curRect.minH-deltaHeight:size,size=size>curRect.maxH-deltaHeight?curRect.maxH-deltaHeight:size,curRect.innerH=size,curRect.h=size+deltaHeight),newRect.contentW!==undef&&(curRect.contentW=newRect.contentW),newRect.contentH!==undef&&(curRect.contentH=newRect.contentH),lastLayoutRect=self._lastLayoutRect,lastLayoutRect.x===curRect.x&&lastLayoutRect.y===curRect.y&&lastLayoutRect.w===curRect.w&&lastLayoutRect.h===curRect.h||(repaintControls=Control.repaintControls,repaintControls&&repaintControls.map&&!repaintControls.map[self._id]&&(repaintControls.push(self),repaintControls.map[self._id]=!0),lastLayoutRect.x=curRect.x,lastLayoutRect.y=curRect.y,lastLayoutRect.w=curRect.w,lastLayoutRect.h=curRect.h),
self):curRect},repaint:function(){var style,bodyStyle,bodyElm,rect,borderBox,borderW,borderH,lastRepaintRect,round,value,self=this;round=document.createRange?function(value){return value}:Math.round,style=self.getEl().style,rect=self._layoutRect,lastRepaintRect=self._lastRepaintRect||{},borderBox=self.borderBox,borderW=borderBox.left+borderBox.right,borderH=borderBox.top+borderBox.bottom,rect.x!==lastRepaintRect.x&&(style.left=round(rect.x)+"px",lastRepaintRect.x=rect.x),rect.y!==lastRepaintRect.y&&(style.top=round(rect.y)+"px",lastRepaintRect.y=rect.y),rect.w!==lastRepaintRect.w&&(value=round(rect.w-borderW),style.width=(value>=0?value:0)+"px",lastRepaintRect.w=rect.w),rect.h!==lastRepaintRect.h&&(value=round(rect.h-borderH),style.height=(value>=0?value:0)+"px",lastRepaintRect.h=rect.h),self._hasBody&&rect.innerW!==lastRepaintRect.innerW&&(value=round(rect.innerW),bodyElm=self.getEl("body"),bodyElm&&(bodyStyle=bodyElm.style,bodyStyle.width=(value>=0?value:0)+"px"),lastRepaintRect.innerW=rect.innerW),self._hasBody&&rect.innerH!==lastRepaintRect.innerH&&(value=round(rect.innerH),bodyElm=bodyElm||self.getEl("body"),bodyElm&&(bodyStyle=bodyStyle||bodyElm.style,bodyStyle.height=(value>=0?value:0)+"px"),lastRepaintRect.innerH=rect.innerH),self._lastRepaintRect=lastRepaintRect,self.fire("repaint",{},!1)},updateLayoutRect:function(){var self=this;self.parent()._lastRect=null,DomUtils.css(self.getEl(),{width:"",height:""}),self._layoutRect=self._lastRepaintRect=self._lastLayoutRect=null,self.initLayoutRect()},on:function(name,callback){function resolveCallbackName(name){var callback,scope;return"string"!=typeof name?name:function(e){return callback||self.parentsAndSelf().each(function(ctrl){var callbacks=ctrl.settings.callbacks;if(callbacks&&(callback=callbacks[name]))return scope=ctrl,!1}),callback?callback.call(scope,e):(e.action=name,void this.fire("execute",e))}}var self=this;return getEventDispatcher(self).on(name,resolveCallbackName(callback)),self},off:function(name,callback){return getEventDispatcher(this).off(name,callback),this},fire:function(name,args,bubble){var self=this;if(args=args||{},args.control||(args.control=self),args=getEventDispatcher(self).fire(name,args),bubble!==!1&&self.parent)for(var parent=self.parent();parent&&!args.isPropagationStopped();)parent.fire(name,args,!1),parent=parent.parent();return args},hasEventListeners:function(name){return getEventDispatcher(this).has(name)},parents:function(selector){var ctrl,self=this,parents=new Collection;for(ctrl=self.parent();ctrl;ctrl=ctrl.parent())parents.add(ctrl);return selector&&(parents=parents.filter(selector)),parents},parentsAndSelf:function(selector){return new Collection(this).add(this.parents(selector))},next:function(){var parentControls=this.parent().items();return parentControls[parentControls.indexOf(this)+1]},prev:function(){var parentControls=this.parent().items();return parentControls[parentControls.indexOf(this)-1]},innerHtml:function(html){return this.$el.html(html),this},getEl:function(suffix){var id=suffix?this._id+"-"+suffix:this._id;return this._elmCache[id]||(this._elmCache[id]=$("#"+id)[0]),this._elmCache[id]},show:function(){return this.visible(!0)},hide:function(){return this.visible(!1)},focus:function(){try{this.getEl().focus()}catch(ex){}return this},blur:function(){return this.getEl().blur(),this},aria:function(name,value){var self=this,elm=self.getEl(self.ariaTarget);return"undefined"==typeof value?self._aria[name]:(self._aria[name]=value,self.state.get("rendered")&&elm.setAttribute("role"==name?name:"aria-"+name,value),self)},encode:function(text,translate){return translate!==!1&&(text=this.translate(text)),(text||"").replace(/[&<>"]/g,function(match){return"&#"+match.charCodeAt(0)+";"})},translate:function(text){return Control.translate?Control.translate(text):text},before:function(items){var self=this,parent=self.parent();return parent&&parent.insert(items,parent.items().indexOf(self),!0),self},after:function(items){var self=this,parent=self.parent();return parent&&parent.insert(items,parent.items().indexOf(self)),self},remove:function(){var newItems,i,self=this,elm=self.getEl(),parent=self.parent();if(self.items){var controls=self.items().toArray();for(i=controls.length;i--;)controls[i].remove()}parent&&parent.items&&(newItems=[],parent.items().each(function(item){item!==self&&newItems.push(item)}),parent.items().set(newItems),parent._lastRect=null),self._eventsRoot&&self._eventsRoot==self&&$(elm).off();var lookup=self.getRoot().controlIdLookup;return lookup&&delete lookup[self._id],elm&&elm.parentNode&&elm.parentNode.removeChild(elm),self.state.set("rendered",!1),self.state.destroy(),self.fire("remove"),self},renderBefore:function(elm){return $(elm).before(this.renderHtml()),this.postRender(),this},renderTo:function(elm){return $(elm||this.getContainerElm()).append(this.renderHtml()),this.postRender(),this},preRender:function(){},render:function(){},renderHtml:function(){return'<div id="'+this._id+'" class="'+this.classes+'"></div>'},postRender:function(){var elm,box,parent,name,parentEventsRoot,self=this,settings=self.settings;self.$el=$(self.getEl()),self.state.set("rendered",!0);for(name in settings)0===name.indexOf("on")&&self.on(name.substr(2),settings[name]);if(self._eventsRoot){for(parent=self.parent();!parentEventsRoot&&parent;parent=parent.parent())parentEventsRoot=parent._eventsRoot;if(parentEventsRoot)for(name in parentEventsRoot._nativeEvents)self._nativeEvents[name]=!0}bindPendingEvents(self),settings.style&&(elm=self.getEl(),elm&&(elm.setAttribute("style",settings.style),elm.style.cssText=settings.style)),self.settings.border&&(box=self.borderBox,self.$el.css({"border-top-width":box.top,"border-right-width":box.right,"border-bottom-width":box.bottom,"border-left-width":box.left}));var root=self.getRoot();root.controlIdLookup||(root.controlIdLookup={}),root.controlIdLookup[self._id]=self;for(var key in self._aria)self.aria(key,self._aria[key]);self.state.get("visible")===!1&&(self.getEl().style.display="none"),self.bindStates(),self.state.on("change:visible",function(e){var parentCtrl,state=e.value;self.state.get("rendered")&&(self.getEl().style.display=state===!1?"none":"",self.getEl().getBoundingClientRect()),parentCtrl=self.parent(),parentCtrl&&(parentCtrl._lastRect=null),self.fire(state?"show":"hide"),ReflowQueue.add(self)}),self.fire("postrender",{},!1)},bindStates:function(){},scrollIntoView:function(align){function getOffset(elm,rootElm){var x,y,parent=elm;for(x=y=0;parent&&parent!=rootElm&&parent.nodeType;)x+=parent.offsetLeft||0,y+=parent.offsetTop||0,parent=parent.offsetParent;return{x:x,y:y}}var x,y,width,height,parentWidth,parentHeight,elm=this.getEl(),parentElm=elm.parentNode,pos=getOffset(elm,parentElm);return x=pos.x,y=pos.y,width=elm.offsetWidth,height=elm.offsetHeight,parentWidth=parentElm.clientWidth,parentHeight=parentElm.clientHeight,"end"==align?(x-=parentWidth-width,y-=parentHeight-height):"center"==align&&(x-=parentWidth/2-width/2,y-=parentHeight/2-height/2),parentElm.scrollLeft=x,parentElm.scrollTop=y,this},getRoot:function(){for(var rootControl,ctrl=this,parents=[];ctrl;){if(ctrl.rootControl){rootControl=ctrl.rootControl;break}parents.push(ctrl),rootControl=ctrl,ctrl=ctrl.parent()}rootControl||(rootControl=this);for(var i=parents.length;i--;)parents[i].rootControl=rootControl;return rootControl},reflow:function(){ReflowQueue.remove(this);var parent=this.parent();return parent._layout&&!parent._layout.isNative()&&parent.reflow(),this}};return Tools.each("text title visible disabled active value".split(" "),function(name){proto[name]=function(value){return 0===arguments.length?this.state.get(name):("undefined"!=typeof value&&this.state.set(name,value),this)}}),Control=Class.extend(proto)}),define("tinymce/ui/Factory",[],function(){var namespaceInit,types={};return{add:function(type,typeClass){types[type.toLowerCase()]=typeClass},has:function(type){return!!types[type.toLowerCase()]},create:function(type,settings){var ControlType,name,namespace;if(!namespaceInit){namespace=tinymce.ui;for(name in namespace)types[name.toLowerCase()]=namespace[name];namespaceInit=!0}if("string"==typeof type?(settings=settings||{},settings.type=type):(settings=type,type=settings.type),type=type.toLowerCase(),ControlType=types[type],!ControlType)throw new Error("Could not find control by type: "+type);return ControlType=new ControlType(settings),ControlType.type=type,ControlType}}}),define("tinymce/ui/KeyboardNavigation",[],function(){return function(settings){function isElement(node){return node&&1===node.nodeType}function getRole(elm){return elm=elm||focusedElement,isElement(elm)?elm.getAttribute("role"):null}function getParentRole(elm){for(var role,parent=elm||focusedElement;parent=parent.parentNode;)if(role=getRole(parent))return role}function getAriaProp(name){var elm=focusedElement;if(isElement(elm))return elm.getAttribute("aria-"+name)}function isTextInputElement(elm){var tagName=elm.tagName.toUpperCase();return"INPUT"==tagName||"TEXTAREA"==tagName||"SELECT"==tagName}function canFocus(elm){return!(!isTextInputElement(elm)||elm.hidden)||!!/^(button|menuitem|checkbox|tab|menuitemcheckbox|option|gridcell|slider)$/.test(getRole(elm))}function getFocusElements(elm){function collect(elm){if(1==elm.nodeType&&"none"!=elm.style.display){canFocus(elm)&&elements.push(elm);for(var i=0;i<elm.childNodes.length;i++)collect(elm.childNodes[i])}}var elements=[];return collect(elm||root.getEl()),elements}function getNavigationRoot(targetControl){var navigationRoot,controls;targetControl=targetControl||focusedControl,controls=targetControl.parents().toArray(),controls.unshift(targetControl);for(var i=0;i<controls.length&&(navigationRoot=controls[i],!navigationRoot.settings.ariaRoot);i++);return navigationRoot}function focusFirst(targetControl){var navigationRoot=getNavigationRoot(targetControl),focusElements=getFocusElements(navigationRoot.getEl());navigationRoot.settings.ariaRemember&&"lastAriaIndex"in navigationRoot?moveFocusToIndex(navigationRoot.lastAriaIndex,focusElements):moveFocusToIndex(0,focusElements)}function moveFocusToIndex(idx,elements){return idx<0?idx=elements.length-1:idx>=elements.length&&(idx=0),elements[idx]&&elements[idx].focus(),idx}function moveFocus(dir,elements){var idx=-1,navigationRoot=getNavigationRoot();elements=elements||getFocusElements(navigationRoot.getEl());for(var i=0;i<elements.length;i++)elements[i]===focusedElement&&(idx=i);idx+=dir,navigationRoot.lastAriaIndex=moveFocusToIndex(idx,elements)}function left(){var parentRole=getParentRole();"tablist"==parentRole?moveFocus(-1,getFocusElements(focusedElement.parentNode)):focusedControl.parent().submenu?cancel():moveFocus(-1)}function right(){var role=getRole(),parentRole=getParentRole();"tablist"==parentRole?moveFocus(1,getFocusElements(focusedElement.parentNode)):"menuitem"==role&&"menu"==parentRole&&getAriaProp("haspopup")?enter():moveFocus(1)}function up(){moveFocus(-1)}function down(){var role=getRole(),parentRole=getParentRole();"menuitem"==role&&"menubar"==parentRole?enter():"button"==role&&getAriaProp("haspopup")?enter({key:"down"}):moveFocus(1)}function tab(e){var parentRole=getParentRole();if("tablist"==parentRole){var elm=getFocusElements(focusedControl.getEl("body"))[0];elm&&elm.focus()}else moveFocus(e.shiftKey?-1:1)}function cancel(){focusedControl.fire("cancel")}function enter(aria){aria=aria||{},focusedControl.fire("click",{target:focusedElement,aria:aria})}var focusedElement,focusedControl,root=settings.root;try{focusedElement=document.activeElement}catch(ex){focusedElement=document.body}return focusedControl=root.getParentCtrl(focusedElement),root.on("keydown",function(e){function handleNonTabOrEscEvent(e,handler){isTextInputElement(focusedElement)||"slider"!==getRole(focusedElement)&&handler(e)!==!1&&e.preventDefault()}if(!e.isDefaultPrevented())switch(e.keyCode){case 37:handleNonTabOrEscEvent(e,left);break;case 39:handleNonTabOrEscEvent(e,right);break;case 38:handleNonTabOrEscEvent(e,up);break;case 40:handleNonTabOrEscEvent(e,down);break;case 27:cancel();break;case 14:case 13:case 32:handleNonTabOrEscEvent(e,enter);break;case 9:tab(e)!==!1&&e.preventDefault()}}),root.on("focusin",function(e){focusedElement=e.target,focusedControl=e.control}),{focusFirst:focusFirst}}}),define("tinymce/ui/Container",["tinymce/ui/Control","tinymce/ui/Collection","tinymce/ui/Selector","tinymce/ui/Factory","tinymce/ui/KeyboardNavigation","tinymce/util/Tools","tinymce/dom/DomQuery","tinymce/ui/ClassList","tinymce/ui/ReflowQueue"],function(Control,Collection,Selector,Factory,KeyboardNavigation,Tools,$,ClassList,ReflowQueue){var selectorCache={};return Control.extend({init:function(settings){var self=this;self._super(settings),settings=self.settings,settings.fixed&&self.state.set("fixed",!0),self._items=new Collection,self.isRtl()&&self.classes.add("rtl"),self.bodyClasses=new ClassList(function(){self.state.get("rendered")&&(self.getEl("body").className=this.toString())}),self.bodyClasses.prefix=self.classPrefix,self.classes.add("container"),self.bodyClasses.add("container-body"),settings.containerCls&&self.classes.add(settings.containerCls),self._layout=Factory.create((settings.layout||"")+"layout"),self.settings.items?self.add(self.settings.items):self.add(self.render()),self._hasBody=!0},items:function(){return this._items},find:function(selector){return selector=selectorCache[selector]=selectorCache[selector]||new Selector(selector),selector.find(this)},add:function(items){var self=this;return self.items().add(self.create(items)).parent(self),self},focus:function(keyboard){var focusCtrl,keyboardNav,items,self=this;return keyboard&&(keyboardNav=self.keyboardNav||self.parents().eq(-1)[0].keyboardNav)?void keyboardNav.focusFirst(self):(items=self.find("*"),self.statusbar&&items.add(self.statusbar.items()),items.each(function(ctrl){return ctrl.settings.autofocus?(focusCtrl=null,!1):void(ctrl.canFocus&&(focusCtrl=focusCtrl||ctrl))}),focusCtrl&&focusCtrl.focus(),self)},replace:function(oldItem,newItem){for(var ctrlElm,items=this.items(),i=items.length;i--;)if(items[i]===oldItem){items[i]=newItem;break}i>=0&&(ctrlElm=newItem.getEl(),ctrlElm&&ctrlElm.parentNode.removeChild(ctrlElm),ctrlElm=oldItem.getEl(),ctrlElm&&ctrlElm.parentNode.removeChild(ctrlElm)),newItem.parent(this)},create:function(items){var settings,self=this,ctrlItems=[];return Tools.isArray(items)||(items=[items]),Tools.each(items,function(item){item&&(item instanceof Control||("string"==typeof item&&(item={type:item}),settings=Tools.extend({},self.settings.defaults,item),item.type=settings.type=settings.type||item.type||self.settings.defaultType||(settings.defaults?settings.defaults.type:null),item=Factory.create(settings)),ctrlItems.push(item))}),ctrlItems},renderNew:function(){var self=this;return self.items().each(function(ctrl,index){var containerElm;ctrl.parent(self),ctrl.state.get("rendered")||(containerElm=self.getEl("body"),containerElm.hasChildNodes()&&index<=containerElm.childNodes.length-1?$(containerElm.childNodes[index]).before(ctrl.renderHtml()):$(containerElm).append(ctrl.renderHtml()),ctrl.postRender(),ReflowQueue.add(ctrl))}),self._layout.applyClasses(self.items().filter(":visible")),self._lastRect=null,self},append:function(items){return this.add(items).renderNew()},prepend:function(items){var self=this;return self.items().set(self.create(items).concat(self.items().toArray())),self.renderNew()},insert:function(items,index,before){var curItems,beforeItems,afterItems,self=this;return items=self.create(items),curItems=self.items(),!before&&index<curItems.length-1&&(index+=1),index>=0&&index<curItems.length&&(beforeItems=curItems.slice(0,index).toArray(),afterItems=curItems.slice(index).toArray(),curItems.set(beforeItems.concat(items,afterItems))),self.renderNew()},fromJSON:function(data){var self=this;for(var name in data)self.find("#"+name).value(data[name]);return self},toJSON:function(){var self=this,data={};return self.find("*").each(function(ctrl){var name=ctrl.name(),value=ctrl.value();name&&"undefined"!=typeof value&&(data[name]=value)}),data},renderHtml:function(){var self=this,layout=self._layout,role=this.settings.role;return self.preRender(),layout.preRender(self),'<div id="'+self._id+'" class="'+self.classes+'"'+(role?' role="'+this.settings.role+'"':"")+'><div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div></div>"},postRender:function(){var box,self=this;return self.items().exec("postRender"),self._super(),self._layout.postRender(self),self.state.set("rendered",!0),self.settings.style&&self.$el.css(self.settings.style),self.settings.border&&(box=self.borderBox,self.$el.css({"border-top-width":box.top,"border-right-width":box.right,"border-bottom-width":box.bottom,"border-left-width":box.left})),self.parent()||(self.keyboardNav=new KeyboardNavigation({root:self})),self},initLayoutRect:function(){var self=this,layoutRect=self._super();return self._layout.recalc(self),layoutRect},recalc:function(){var self=this,rect=self._layoutRect,lastRect=self._lastRect;if(!lastRect||lastRect.w!=rect.w||lastRect.h!=rect.h)return self._layout.recalc(self),rect=self.layoutRect(),self._lastRect={x:rect.x,y:rect.y,w:rect.w,h:rect.h},!0},reflow:function(){var i;if(ReflowQueue.remove(this),this.visible()){for(Control.repaintControls=[],Control.repaintControls.map={},this.recalc(),i=Control.repaintControls.length;i--;)Control.repaintControls[i].repaint();"flow"!==this.settings.layout&&"stack"!==this.settings.layout&&this.repaint(),Control.repaintControls=[]}return this}})}),define("tinymce/ui/DragHelper",["tinymce/dom/DomQuery"],function($){function getDocumentSize(doc){var documentElement,body,scrollWidth,clientWidth,offsetWidth,scrollHeight,clientHeight,offsetHeight,max=Math.max;return documentElement=doc.documentElement,body=doc.body,scrollWidth=max(documentElement.scrollWidth,body.scrollWidth),clientWidth=max(documentElement.clientWidth,body.clientWidth),offsetWidth=max(documentElement.offsetWidth,body.offsetWidth),scrollHeight=max(documentElement.scrollHeight,body.scrollHeight),clientHeight=max(documentElement.clientHeight,body.clientHeight),offsetHeight=max(documentElement.offsetHeight,body.offsetHeight),{width:scrollWidth<offsetWidth?clientWidth:scrollWidth,height:scrollHeight<offsetHeight?clientHeight:scrollHeight}}function updateWithTouchData(e){var keys,i;if(e.changedTouches)for(keys="screenX screenY pageX pageY clientX clientY".split(" "),i=0;i<keys.length;i++)e[keys[i]]=e.changedTouches[0][keys[i]]}return function(id,settings){function getHandleElm(){return doc.getElementById(settings.handle||id)}var $eventOverlay,downButton,start,stop,drag,startX,startY,doc=settings.document||document;settings=settings||{},start=function(e){var handleElm,cursor,docSize=getDocumentSize(doc);updateWithTouchData(e),e.preventDefault(),downButton=e.button,handleElm=getHandleElm(),startX=e.screenX,startY=e.screenY,cursor=window.getComputedStyle?window.getComputedStyle(handleElm,null).getPropertyValue("cursor"):handleElm.runtimeStyle.cursor,$eventOverlay=$("<div>").css({position:"absolute",top:0,left:0,width:docSize.width,height:docSize.height,zIndex:2147483647,opacity:1e-4,cursor:cursor}).appendTo(doc.body),$(doc).on("mousemove touchmove",drag).on("mouseup touchend",stop),settings.start(e)},drag=function(e){return updateWithTouchData(e),e.button!==downButton?stop(e):(e.deltaX=e.screenX-startX,e.deltaY=e.screenY-startY,e.preventDefault(),void settings.drag(e))},stop=function(e){updateWithTouchData(e),$(doc).off("mousemove touchmove",drag).off("mouseup touchend",stop),$eventOverlay.remove(),settings.stop&&settings.stop(e)},this.destroy=function(){$(getHandleElm()).off()},$(getHandleElm()).on("mousedown touchstart",start)}}),define("tinymce/ui/Scrollable",["tinymce/dom/DomQuery","tinymce/ui/DragHelper"],function($,DragHelper){return{init:function(){var self=this;self.on("repaint",self.renderScroll)},renderScroll:function(){function repaintScroll(){function repaintAxis(axisName,posName,sizeName,contentSizeName,hasScroll,ax){var containerElm,scrollBarElm,scrollThumbElm,containerSize,scrollSize,ratio,rect,posNameLower,sizeNameLower;if(scrollBarElm=self.getEl("scroll"+axisName)){if(posNameLower=posName.toLowerCase(),sizeNameLower=sizeName.toLowerCase(),$(self.getEl("absend")).css(posNameLower,self.layoutRect()[contentSizeName]-1),!hasScroll)return void $(scrollBarElm).css("display","none");$(scrollBarElm).css("display","block"),containerElm=self.getEl("body"),scrollThumbElm=self.getEl("scroll"+axisName+"t"),containerSize=containerElm["client"+sizeName]-2*margin,containerSize-=hasScrollH&&hasScrollV?scrollBarElm["client"+ax]:0,scrollSize=containerElm["scroll"+sizeName],ratio=containerSize/scrollSize,rect={},rect[posNameLower]=containerElm["offset"+posName]+margin,rect[sizeNameLower]=containerSize,$(scrollBarElm).css(rect),rect={},rect[posNameLower]=containerElm["scroll"+posName]*ratio,rect[sizeNameLower]=containerSize*ratio,$(scrollThumbElm).css(rect)}}var hasScrollH,hasScrollV,bodyElm;bodyElm=self.getEl("body"),hasScrollH=bodyElm.scrollWidth>bodyElm.clientWidth,hasScrollV=bodyElm.scrollHeight>bodyElm.clientHeight,repaintAxis("h","Left","Width","contentW",hasScrollH,"Height"),repaintAxis("v","Top","Height","contentH",hasScrollV,"Width")}function addScroll(){function addScrollAxis(axisName,posName,sizeName,deltaPosName,ax){var scrollStart,axisId=self._id+"-scroll"+axisName,prefix=self.classPrefix;$(self.getEl()).append('<div id="'+axisId+'" class="'+prefix+"scrollbar "+prefix+"scrollbar-"+axisName+'"><div id="'+axisId+'t" class="'+prefix+'scrollbar-thumb"></div></div>'),self.draghelper=new DragHelper(axisId+"t",{start:function(){scrollStart=self.getEl("body")["scroll"+posName],$("#"+axisId).addClass(prefix+"active")},drag:function(e){var ratio,hasScrollH,hasScrollV,containerSize,layoutRect=self.layoutRect();hasScrollH=layoutRect.contentW>layoutRect.innerW,hasScrollV=layoutRect.contentH>layoutRect.innerH,containerSize=self.getEl("body")["client"+sizeName]-2*margin,containerSize-=hasScrollH&&hasScrollV?self.getEl("scroll"+axisName)["client"+ax]:0,ratio=containerSize/self.getEl("body")["scroll"+sizeName],self.getEl("body")["scroll"+posName]=scrollStart+e["delta"+deltaPosName]/ratio},stop:function(){$("#"+axisId).removeClass(prefix+"active")}})}self.classes.add("scroll"),addScrollAxis("v","Top","Height","Y","Width"),addScrollAxis("h","Left","Width","X","Height")}var self=this,margin=2;self.settings.autoScroll&&(self._hasScroll||(self._hasScroll=!0,addScroll(),self.on("wheel",function(e){var bodyEl=self.getEl("body");bodyEl.scrollLeft+=10*(e.deltaX||0),bodyEl.scrollTop+=10*e.deltaY,repaintScroll()}),$(self.getEl("body")).on("scroll",repaintScroll)),repaintScroll())}}}),define("tinymce/ui/Panel",["tinymce/ui/Container","tinymce/ui/Scrollable"],function(Container,Scrollable){return Container.extend({Defaults:{layout:"fit",containerCls:"panel"},Mixins:[Scrollable],renderHtml:function(){var self=this,layout=self._layout,innerHtml=self.settings.html;return self.preRender(),layout.preRender(self),"undefined"==typeof innerHtml?innerHtml='<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+layout.renderHtml(self)+"</div>":("function"==typeof innerHtml&&(innerHtml=innerHtml.call(self)),self._hasBody=!1),'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1" role="group">'+(self._preBodyHtml||"")+innerHtml+"</div>"}})}),define("tinymce/ui/Movable",["tinymce/ui/DomUtils"],function(DomUtils){function calculateRelativePosition(ctrl,targetElm,rel){var ctrlElm,pos,x,y,selfW,selfH,targetW,targetH,viewport,size;return viewport=DomUtils.getViewPort(),pos=DomUtils.getPos(targetElm),x=pos.x,y=pos.y,ctrl.state.get("fixed")&&"static"==DomUtils.getRuntimeStyle(document.body,"position")&&(x-=viewport.x,y-=viewport.y),ctrlElm=ctrl.getEl(),size=DomUtils.getSize(ctrlElm),selfW=size.width,selfH=size.height,size=DomUtils.getSize(targetElm),targetW=size.width,targetH=size.height,rel=(rel||"").split(""),"b"===rel[0]&&(y+=targetH),"r"===rel[1]&&(x+=targetW),"c"===rel[0]&&(y+=Math.round(targetH/2)),"c"===rel[1]&&(x+=Math.round(targetW/2)),"b"===rel[3]&&(y-=selfH),"r"===rel[4]&&(x-=selfW),"c"===rel[3]&&(y-=Math.round(selfH/2)),"c"===rel[4]&&(x-=Math.round(selfW/2)),{x:x,y:y,w:selfW,h:selfH}}return{testMoveRel:function(elm,rels){for(var viewPortRect=DomUtils.getViewPort(),i=0;i<rels.length;i++){var pos=calculateRelativePosition(this,elm,rels[i]);if(this.state.get("fixed")){if(pos.x>0&&pos.x+pos.w<viewPortRect.w&&pos.y>0&&pos.y+pos.h<viewPortRect.h)return rels[i]}else if(pos.x>viewPortRect.x&&pos.x+pos.w<viewPortRect.w+viewPortRect.x&&pos.y>viewPortRect.y&&pos.y+pos.h<viewPortRect.h+viewPortRect.y)return rels[i]}return rels[0]},moveRel:function(elm,rel){"string"!=typeof rel&&(rel=this.testMoveRel(elm,rel));var pos=calculateRelativePosition(this,elm,rel);return this.moveTo(pos.x,pos.y)},moveBy:function(dx,dy){var self=this,rect=self.layoutRect();return self.moveTo(rect.x+dx,rect.y+dy),self},moveTo:function(x,y){function constrain(value,max,size){return value<0?0:value+size>max?(value=max-size,value<0?0:value):value}var self=this;if(self.settings.constrainToViewport){var viewPortRect=DomUtils.getViewPort(window),layoutRect=self.layoutRect();x=constrain(x,viewPortRect.w+viewPortRect.x,layoutRect.w),y=constrain(y,viewPortRect.h+viewPortRect.y,layoutRect.h)}return self.state.get("rendered")?self.layoutRect({x:x,y:y}).repaint():(self.settings.x=x,self.settings.y=y),self.fire("move",{x:x,y:y}),self}}}),define("tinymce/ui/Resizable",["tinymce/ui/DomUtils"],function(DomUtils){return{resizeToContent:function(){this._layoutRect.autoResize=!0,this._lastRect=null,this.reflow()},resizeTo:function(w,h){if(w<=1||h<=1){var rect=DomUtils.getWindowSize();w=w<=1?w*rect.w:w,h=h<=1?h*rect.h:h}return this._layoutRect.autoResize=!1,this.layoutRect({minW:w,minH:h,w:w,h:h}).reflow()},resizeBy:function(dw,dh){var self=this,rect=self.layoutRect();return self.resizeTo(rect.w+dw,rect.h+dh)}}}),define("tinymce/ui/FloatPanel",["tinymce/ui/Panel","tinymce/ui/Movable","tinymce/ui/Resizable","tinymce/ui/DomUtils","tinymce/dom/DomQuery","tinymce/util/Delay"],function(Panel,Movable,Resizable,DomUtils,$,Delay){function isChildOf(ctrl,parent){for(;ctrl;){if(ctrl==parent)return!0;ctrl=ctrl.parent()}}function skipOrHidePanels(e){for(var i=visiblePanels.length;i--;){var panel=visiblePanels[i],clickCtrl=panel.getParentCtrl(e.target);if(panel.settings.autohide){if(clickCtrl&&(isChildOf(clickCtrl,panel)||panel.parent()===clickCtrl))continue;e=panel.fire("autohide",{target:e.target}),e.isDefaultPrevented()||panel.hide()}}}function bindDocumentClickHandler(){documentClickHandler||(documentClickHandler=function(e){2!=e.button&&skipOrHidePanels(e)},$(document).on("click touchstart",documentClickHandler))}function bindDocumentScrollHandler(){documentScrollHandler||(documentScrollHandler=function(){var i;for(i=visiblePanels.length;i--;)repositionPanel(visiblePanels[i])},$(window).on("scroll",documentScrollHandler))}function bindWindowResizeHandler(){if(!windowResizeHandler){var docElm=document.documentElement,clientWidth=docElm.clientWidth,clientHeight=docElm.clientHeight;windowResizeHandler=function(){document.all&&clientWidth==docElm.clientWidth&&clientHeight==docElm.clientHeight||(clientWidth=docElm.clientWidth,clientHeight=docElm.clientHeight,FloatPanel.hideAll())},$(window).on("resize",windowResizeHandler)}}function repositionPanel(panel){function toggleFixedChildPanels(fixed,deltaY){for(var parent,i=0;i<visiblePanels.length;i++)if(visiblePanels[i]!=panel)for(parent=visiblePanels[i].parent();parent&&(parent=parent.parent());)parent==panel&&visiblePanels[i].fixed(fixed).moveBy(0,deltaY).repaint()}var scrollY=DomUtils.getViewPort().y;panel.settings.autofix&&(panel.state.get("fixed")?panel._autoFixY>scrollY&&(panel.fixed(!1).layoutRect({y:panel._autoFixY}).repaint(),toggleFixedChildPanels(!1,panel._autoFixY-scrollY)):(panel._autoFixY=panel.layoutRect().y,panel._autoFixY<scrollY&&(panel.fixed(!0).layoutRect({y:0}).repaint(),toggleFixedChildPanels(!0,scrollY-panel._autoFixY))))}function addRemove(add,ctrl){var i,topModal,zIndex=FloatPanel.zIndex||65535;if(add)zOrder.push(ctrl);else for(i=zOrder.length;i--;)zOrder[i]===ctrl&&zOrder.splice(i,1);if(zOrder.length)for(i=0;i<zOrder.length;i++)zOrder[i].modal&&(zIndex++,topModal=zOrder[i]),zOrder[i].getEl().style.zIndex=zIndex,zOrder[i].zIndex=zIndex,zIndex++;var modalBlockEl=$("#"+ctrl.classPrefix+"modal-block",ctrl.getContainerElm())[0];topModal?$(modalBlockEl).css("z-index",topModal.zIndex-1):modalBlockEl&&(modalBlockEl.parentNode.removeChild(modalBlockEl),hasModal=!1),FloatPanel.currentZIndex=zIndex}function removeVisiblePanel(panel){var i;for(i=visiblePanels.length;i--;)visiblePanels[i]===panel&&visiblePanels.splice(i,1);for(i=zOrder.length;i--;)zOrder[i]===panel&&zOrder.splice(i,1)}var documentClickHandler,documentScrollHandler,windowResizeHandler,hasModal,visiblePanels=[],zOrder=[],FloatPanel=Panel.extend({Mixins:[Movable,Resizable],init:function(settings){var self=this;self._super(settings),self._eventsRoot=self,self.classes.add("floatpanel"),settings.autohide&&(bindDocumentClickHandler(),bindWindowResizeHandler(),visiblePanels.push(self)),settings.autofix&&(bindDocumentScrollHandler(),self.on("move",function(){repositionPanel(this)})),self.on("postrender show",function(e){if(e.control==self){var $modalBlockEl,prefix=self.classPrefix;self.modal&&!hasModal&&($modalBlockEl=$("#"+prefix+"modal-block",self.getContainerElm()),$modalBlockEl[0]||($modalBlockEl=$('<div id="'+prefix+'modal-block" class="'+prefix+"reset "+prefix+'fade"></div>').appendTo(self.getContainerElm())),Delay.setTimeout(function(){$modalBlockEl.addClass(prefix+"in"),$(self.getEl()).addClass(prefix+"in")}),hasModal=!0),addRemove(!0,self)}}),self.on("show",function(){self.parents().each(function(ctrl){if(ctrl.state.get("fixed"))return self.fixed(!0),!1})}),settings.popover&&(self._preBodyHtml='<div class="'+self.classPrefix+'arrow"></div>',self.classes.add("popover").add("bottom").add(self.isRtl()?"end":"start")),self.aria("label",settings.ariaLabel),self.aria("labelledby",self._id),self.aria("describedby",self.describedBy||self._id+"-none")},fixed:function(state){var self=this;if(self.state.get("fixed")!=state){if(self.state.get("rendered")){var viewport=DomUtils.getViewPort();state?self.layoutRect().y-=viewport.y:self.layoutRect().y+=viewport.y}self.classes.toggle("fixed",state),self.state.set("fixed",state)}return self},show:function(){var i,self=this,state=self._super();for(i=visiblePanels.length;i--&&visiblePanels[i]!==self;);return i===-1&&visiblePanels.push(self),state},hide:function(){return removeVisiblePanel(this),addRemove(!1,this),this._super()},hideAll:function(){FloatPanel.hideAll()},close:function(){var self=this;return self.fire("close").isDefaultPrevented()||(self.remove(),addRemove(!1,self)),self},remove:function(){removeVisiblePanel(this),this._super()},postRender:function(){var self=this;return self.settings.bodyRole&&this.getEl("body").setAttribute("role",self.settings.bodyRole),self._super()}});return FloatPanel.hideAll=function(){for(var i=visiblePanels.length;i--;){var panel=visiblePanels[i];panel&&panel.settings.autohide&&(panel.hide(),visiblePanels.splice(i,1))}},FloatPanel}),define("tinymce/ui/Window",["tinymce/ui/FloatPanel","tinymce/ui/Panel","tinymce/ui/DomUtils","tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/ui/BoxUtils","tinymce/Env","tinymce/util/Delay"],function(FloatPanel,Panel,DomUtils,$,DragHelper,BoxUtils,Env,Delay){function toggleFullScreenState(state){var contentValue,noScaleMetaValue="width=device-width,initial-scale=1.0,user-scalable=0,minimum-scale=1.0,maximum-scale=1.0",viewport=$("meta[name=viewport]")[0];Env.overrideViewPort!==!1&&(viewport||(viewport=document.createElement("meta"),viewport.setAttribute("name","viewport"),document.getElementsByTagName("head")[0].appendChild(viewport)),contentValue=viewport.getAttribute("content"),
contentValue&&"undefined"!=typeof oldMetaValue&&(oldMetaValue=contentValue),viewport.setAttribute("content",state?noScaleMetaValue:oldMetaValue))}function toggleBodyFullScreenClasses(classPrefix){for(var i=0;i<windows.length;i++)if(windows[i]._fullscreen)return;$([document.documentElement,document.body]).removeClass(classPrefix+"fullscreen")}function handleWindowResize(){function reposition(){var i,layoutRect,rect=DomUtils.getWindowSize();for(i=0;i<windows.length;i++)layoutRect=windows[i].layoutRect(),windows[i].moveTo(windows[i].settings.x||Math.max(0,rect.w/2-layoutRect.w/2),windows[i].settings.y||Math.max(0,rect.h/2-layoutRect.h/2))}if(!Env.desktop){var lastSize={w:window.innerWidth,h:window.innerHeight};Delay.setInterval(function(){var w=window.innerWidth,h=window.innerHeight;lastSize.w==w&&lastSize.h==h||(lastSize={w:w,h:h},$(window).trigger("resize"))},100)}$(window).on("resize",reposition)}var windows=[],oldMetaValue="",Window=FloatPanel.extend({modal:!0,Defaults:{border:1,layout:"flex",containerCls:"panel",role:"dialog",callbacks:{submit:function(){this.fire("submit",{data:this.toJSON()})},close:function(){this.close()}}},init:function(settings){var self=this;self._super(settings),self.isRtl()&&self.classes.add("rtl"),self.classes.add("window"),self.bodyClasses.add("window-body"),self.state.set("fixed",!0),settings.buttons&&(self.statusbar=new Panel({layout:"flex",border:"1 0 0 0",spacing:3,padding:10,align:"center",pack:self.isRtl()?"start":"end",defaults:{type:"button"},items:settings.buttons}),self.statusbar.classes.add("foot"),self.statusbar.parent(self)),self.on("click",function(e){var closeClass=self.classPrefix+"close";(DomUtils.hasClass(e.target,closeClass)||DomUtils.hasClass(e.target.parentNode,closeClass))&&self.close()}),self.on("cancel",function(){self.close()}),self.aria("describedby",self.describedBy||self._id+"-none"),self.aria("label",settings.title),self._fullscreen=!1},recalc:function(){var layoutRect,width,x,needsRecalc,self=this,statusbar=self.statusbar;self._fullscreen&&(self.layoutRect(DomUtils.getWindowSize()),self.layoutRect().contentH=self.layoutRect().innerH),self._super(),layoutRect=self.layoutRect(),self.settings.title&&!self._fullscreen&&(width=layoutRect.headerW,width>layoutRect.w&&(x=layoutRect.x-Math.max(0,width/2),self.layoutRect({w:width,x:x}),needsRecalc=!0)),statusbar&&(statusbar.layoutRect({w:self.layoutRect().innerW}).recalc(),width=statusbar.layoutRect().minW+layoutRect.deltaW,width>layoutRect.w&&(x=layoutRect.x-Math.max(0,width-layoutRect.w),self.layoutRect({w:width,x:x}),needsRecalc=!0)),needsRecalc&&self.recalc()},initLayoutRect:function(){var headEl,self=this,layoutRect=self._super(),deltaH=0;if(self.settings.title&&!self._fullscreen){headEl=self.getEl("head");var size=DomUtils.getSize(headEl);layoutRect.headerW=size.width,layoutRect.headerH=size.height,deltaH+=layoutRect.headerH}self.statusbar&&(deltaH+=self.statusbar.layoutRect().h),layoutRect.deltaH+=deltaH,layoutRect.minH+=deltaH,layoutRect.h+=deltaH;var rect=DomUtils.getWindowSize();return layoutRect.x=self.settings.x||Math.max(0,rect.w/2-layoutRect.w/2),layoutRect.y=self.settings.y||Math.max(0,rect.h/2-layoutRect.h/2),layoutRect},renderHtml:function(){var self=this,layout=self._layout,id=self._id,prefix=self.classPrefix,settings=self.settings,headerHtml="",footerHtml="",html=settings.html;return self.preRender(),layout.preRender(self),settings.title&&(headerHtml='<div id="'+id+'-head" class="'+prefix+'window-head"><div id="'+id+'-title" class="'+prefix+'title">'+self.encode(settings.title)+'</div><div id="'+id+'-dragh" class="'+prefix+'dragh"></div><button type="button" class="'+prefix+'close" aria-hidden="true"><i class="mce-ico mce-i-remove"></i></button></div>'),settings.url&&(html='<iframe src="'+settings.url+'" tabindex="-1"></iframe>'),"undefined"==typeof html&&(html=layout.renderHtml(self)),self.statusbar&&(footerHtml=self.statusbar.renderHtml()),'<div id="'+id+'" class="'+self.classes+'" hidefocus="1"><div class="'+self.classPrefix+'reset" role="application">'+headerHtml+'<div id="'+id+'-body" class="'+self.bodyClasses+'">'+html+"</div>"+footerHtml+"</div></div>"},fullscreen:function(state){var slowRendering,layoutRect,self=this,documentElement=document.documentElement,prefix=self.classPrefix;if(state!=self._fullscreen)if($(window).on("resize",function(){var time;if(self._fullscreen)if(slowRendering)self._timer||(self._timer=Delay.setTimeout(function(){var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h),self._timer=0},50));else{time=(new Date).getTime();var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h),(new Date).getTime()-time>50&&(slowRendering=!0)}}),layoutRect=self.layoutRect(),self._fullscreen=state,state){self._initial={x:layoutRect.x,y:layoutRect.y,w:layoutRect.w,h:layoutRect.h},self.borderBox=BoxUtils.parseBox("0"),self.getEl("head").style.display="none",layoutRect.deltaH-=layoutRect.headerH+2,$([documentElement,document.body]).addClass(prefix+"fullscreen"),self.classes.add("fullscreen");var rect=DomUtils.getWindowSize();self.moveTo(0,0).resizeTo(rect.w,rect.h)}else self.borderBox=BoxUtils.parseBox(self.settings.border),self.getEl("head").style.display="",layoutRect.deltaH+=layoutRect.headerH,$([documentElement,document.body]).removeClass(prefix+"fullscreen"),self.classes.remove("fullscreen"),self.moveTo(self._initial.x,self._initial.y).resizeTo(self._initial.w,self._initial.h);return self.reflow()},postRender:function(){var startPos,self=this;setTimeout(function(){self.classes.add("in"),self.fire("open")},0),self._super(),self.statusbar&&self.statusbar.postRender(),self.focus(),this.dragHelper=new DragHelper(self._id+"-dragh",{start:function(){startPos={x:self.layoutRect().x,y:self.layoutRect().y}},drag:function(e){self.moveTo(startPos.x+e.deltaX,startPos.y+e.deltaY)}}),self.on("submit",function(e){e.isDefaultPrevented()||self.close()}),windows.push(self),toggleFullScreenState(!0)},submit:function(){return this.fire("submit",{data:this.toJSON()})},remove:function(){var i,self=this;for(self.dragHelper.destroy(),self._super(),self.statusbar&&this.statusbar.remove(),i=windows.length;i--;)windows[i]===self&&windows.splice(i,1);toggleFullScreenState(windows.length>0),toggleBodyFullScreenClasses(self.classPrefix)},getContentWindow:function(){var ifr=this.getEl().getElementsByTagName("iframe")[0];return ifr?ifr.contentWindow:null}});return handleWindowResize(),Window}),define("tinymce/ui/MessageBox",["tinymce/ui/Window"],function(Window){var MessageBox=Window.extend({init:function(settings){settings={border:1,padding:20,layout:"flex",pack:"center",align:"center",containerCls:"panel",autoScroll:!0,buttons:{type:"button",text:"Ok",action:"ok"},items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200}},this._super(settings)},Statics:{OK:1,OK_CANCEL:2,YES_NO:3,YES_NO_CANCEL:4,msgBox:function(settings){function createButton(text,status,primary){return{type:"button",text:text,subtype:primary?"primary":"",onClick:function(e){e.control.parents()[1].close(),callback(status)}}}var buttons,callback=settings.callback||function(){};switch(settings.buttons){case MessageBox.OK_CANCEL:buttons=[createButton("Ok",!0,!0),createButton("Cancel",!1)];break;case MessageBox.YES_NO:case MessageBox.YES_NO_CANCEL:buttons=[createButton("Yes",1,!0),createButton("No",0)],settings.buttons==MessageBox.YES_NO_CANCEL&&buttons.push(createButton("Cancel",-1));break;default:buttons=[createButton("Ok",!0,!0)]}return new Window({padding:20,x:settings.x,y:settings.y,minWidth:300,minHeight:100,layout:"flex",pack:"center",align:"center",buttons:buttons,title:settings.title,role:"alertdialog",items:{type:"label",multiline:!0,maxWidth:500,maxHeight:200,text:settings.text},onPostRender:function(){this.aria("describedby",this.items()[0]._id)},onClose:settings.onClose,onCancel:function(){callback(!1)}}).renderTo(document.body).reflow()},alert:function(settings,callback){return"string"==typeof settings&&(settings={text:settings}),settings.callback=callback,MessageBox.msgBox(settings)},confirm:function(settings,callback){return"string"==typeof settings&&(settings={text:settings}),settings.callback=callback,settings.buttons=MessageBox.OK_CANCEL,MessageBox.msgBox(settings)}}});return MessageBox}),define("tinymce/WindowManager",["tinymce/ui/Window","tinymce/ui/MessageBox"],function(Window,MessageBox){return function(editor){function getTopMostWindow(){if(windows.length)return windows[windows.length-1]}function fireOpenEvent(win){editor.fire("OpenWindow",{win:win})}function fireCloseEvent(win){editor.fire("CloseWindow",{win:win})}var self=this,windows=[];self.windows=windows,editor.on("remove",function(){for(var i=windows.length;i--;)windows[i].close()}),self.open=function(args,params){var win;return editor.editorManager.setActive(editor),args.title=args.title||" ",args.url=args.url||args.file,args.url&&(args.width=parseInt(args.width||320,10),args.height=parseInt(args.height||240,10)),args.body&&(args.items={defaults:args.defaults,type:args.bodyType||"form",items:args.body,data:args.data,callbacks:args.commands}),args.url||args.buttons||(args.buttons=[{text:"Ok",subtype:"primary",onclick:function(){win.find("form")[0].submit()}},{text:"Cancel",onclick:function(){win.close()}}]),win=new Window(args),windows.push(win),win.on("close",function(){for(var i=windows.length;i--;)windows[i]===win&&windows.splice(i,1);windows.length||editor.focus(),fireCloseEvent(win)}),args.data&&win.on("postRender",function(){this.find("*").each(function(ctrl){var name=ctrl.name();name in args.data&&ctrl.value(args.data[name])})}),win.features=args||{},win.params=params||{},1===windows.length&&editor.nodeChanged(),win=win.renderTo().reflow(),fireOpenEvent(win),win},self.alert=function(message,callback,scope){var win;win=MessageBox.alert(message,function(){callback?callback.call(scope||this):editor.focus()}),win.on("close",function(){fireCloseEvent(win)}),fireOpenEvent(win)},self.confirm=function(message,callback,scope){var win;win=MessageBox.confirm(message,function(state){callback.call(scope||this,state)}),win.on("close",function(){fireCloseEvent(win)}),fireOpenEvent(win)},self.close=function(){getTopMostWindow()&&getTopMostWindow().close()},self.getParams=function(){return getTopMostWindow()?getTopMostWindow().params:null},self.setParams=function(params){getTopMostWindow()&&(getTopMostWindow().params=params)},self.getWindows=function(){return windows}}}),define("tinymce/ui/Tooltip",["tinymce/ui/Control","tinymce/ui/Movable"],function(Control,Movable){return Control.extend({Mixins:[Movable],Defaults:{classes:"widget tooltip tooltip-n"},renderHtml:function(){var self=this,prefix=self.classPrefix;return'<div id="'+self._id+'" class="'+self.classes+'" role="presentation"><div class="'+prefix+'tooltip-arrow"></div><div class="'+prefix+'tooltip-inner">'+self.encode(self.state.get("text"))+"</div></div>"},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl().lastChild.innerHTML=self.encode(e.value)}),self._super()},repaint:function(){var style,rect,self=this;style=self.getEl().style,rect=self._layoutRect,style.left=rect.x+"px",style.top=rect.y+"px",style.zIndex=131070}})}),define("tinymce/ui/Widget",["tinymce/ui/Control","tinymce/ui/Tooltip"],function(Control,Tooltip){var tooltip,Widget=Control.extend({init:function(settings){var self=this;self._super(settings),settings=self.settings,self.canFocus=!0,settings.tooltip&&Widget.tooltips!==!1&&(self.on("mouseenter",function(e){var tooltip=self.tooltip().moveTo(-65535);if(e.control==self){var rel=tooltip.text(settings.tooltip).show().testMoveRel(self.getEl(),["bc-tc","bc-tl","bc-tr"]);tooltip.classes.toggle("tooltip-n","bc-tc"==rel),tooltip.classes.toggle("tooltip-nw","bc-tl"==rel),tooltip.classes.toggle("tooltip-ne","bc-tr"==rel),tooltip.moveRel(self.getEl(),rel)}else tooltip.hide()}),self.on("mouseleave mousedown click",function(){self.tooltip().hide()})),self.aria("label",settings.ariaLabel||settings.tooltip)},tooltip:function(){return tooltip||(tooltip=new Tooltip({type:"tooltip"}),tooltip.renderTo()),tooltip},postRender:function(){var self=this,settings=self.settings;self._super(),self.parent()||!settings.width&&!settings.height||(self.initLayoutRect(),self.repaint()),settings.autofocus&&self.focus()},bindStates:function(){function disable(state){self.aria("disabled",state),self.classes.toggle("disabled",state)}function active(state){self.aria("pressed",state),self.classes.toggle("active",state)}var self=this;return self.state.on("change:disabled",function(e){disable(e.value)}),self.state.on("change:active",function(e){active(e.value)}),self.state.get("disabled")&&disable(!0),self.state.get("active")&&active(!0),self._super()},remove:function(){this._super(),tooltip&&(tooltip.remove(),tooltip=null)}});return Widget}),define("tinymce/ui/Progress",["tinymce/ui/Widget"],function(Widget){return Widget.extend({Defaults:{value:0},init:function(settings){var self=this;self._super(settings),self.classes.add("progress"),self.settings.filter||(self.settings.filter=function(value){return Math.round(value)})},renderHtml:function(){var self=this,id=self._id,prefix=this.classPrefix;return'<div id="'+id+'" class="'+self.classes+'"><div class="'+prefix+'bar-container"><div class="'+prefix+'bar"></div></div><div class="'+prefix+'text">0%</div></div>'},postRender:function(){var self=this;return self._super(),self.value(self.settings.value),self},bindStates:function(){function setValue(value){value=self.settings.filter(value),self.getEl().lastChild.innerHTML=value+"%",self.getEl().firstChild.firstChild.style.width=value+"%"}var self=this;return self.state.on("change:value",function(e){setValue(e.value)}),setValue(self.state.get("value")),self._super()}})}),define("tinymce/ui/Notification",["tinymce/ui/Control","tinymce/ui/Movable","tinymce/ui/Progress","tinymce/util/Delay"],function(Control,Movable,Progress,Delay){return Control.extend({Mixins:[Movable],Defaults:{classes:"widget notification"},init:function(settings){var self=this;self._super(settings),settings.text&&self.text(settings.text),settings.icon&&(self.icon=settings.icon),settings.color&&(self.color=settings.color),settings.type&&self.classes.add("notification-"+settings.type),settings.timeout&&(settings.timeout<0||settings.timeout>0)&&!settings.closeButton?self.closeButton=!1:(self.classes.add("has-close"),self.closeButton=!0),settings.progressBar&&(self.progressBar=new Progress),self.on("click",function(e){e.target.className.indexOf(self.classPrefix+"close")!=-1&&self.close()})},renderHtml:function(){var self=this,prefix=self.classPrefix,icon="",closeButton="",progressBar="",notificationStyle="";return self.icon&&(icon='<i class="'+prefix+"ico "+prefix+"i-"+self.icon+'"></i>'),self.color&&(notificationStyle=' style="background-color: '+self.color+'"'),self.closeButton&&(closeButton='<button type="button" class="'+prefix+'close" aria-hidden="true"></button>'),self.progressBar&&(progressBar=self.progressBar.renderHtml()),'<div id="'+self._id+'" class="'+self.classes+'"'+notificationStyle+' role="presentation">'+icon+'<div class="'+prefix+'notification-inner">'+self.state.get("text")+"</div>"+progressBar+closeButton+"</div>"},postRender:function(){var self=this;return Delay.setTimeout(function(){self.$el.addClass(self.classPrefix+"in")}),self._super()},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl().childNodes[1].innerHTML=e.value}),self.progressBar&&self.progressBar.bindStates(),self._super()},close:function(){var self=this;return self.fire("close").isDefaultPrevented()||self.remove(),self},repaint:function(){var style,rect,self=this;style=self.getEl().style,rect=self._layoutRect,style.left=rect.x+"px",style.top=rect.y+"px",style.zIndex=131070}})}),define("tinymce/NotificationManager",["tinymce/ui/Notification","tinymce/util/Delay"],function(Notification,Delay){return function(editor){function getLastNotification(){if(notifications.length)return notifications[notifications.length-1]}function resizeWindowEvent(){Delay.requestAnimationFrame(function(){prePositionNotifications(),positionNotifications()})}function prePositionNotifications(){for(var i=0;i<notifications.length;i++)notifications[i].moveTo(0,0)}function positionNotifications(){if(notifications.length>0){var firstItem=notifications.slice(0,1)[0],container=editor.inline?editor.getElement():editor.getContentAreaContainer();if(firstItem.moveRel(container,"tc-tc"),notifications.length>1)for(var i=1;i<notifications.length;i++)notifications[i].moveRel(notifications[i-1].getEl(),"bc-tc")}}var self=this,notifications=[];self.notifications=notifications,editor.on("remove",function(){for(var i=notifications.length;i--;)notifications[i].close()}),editor.on("ResizeEditor",positionNotifications),editor.on("ResizeWindow",resizeWindowEvent),self.open=function(args){var notif;return editor.editorManager.setActive(editor),notif=new Notification(args),notifications.push(notif),args.timeout>0&&(notif.timer=setTimeout(function(){notif.close()},args.timeout)),notif.on("close",function(){var i=notifications.length;for(notif.timer&&editor.getWin().clearTimeout(notif.timer);i--;)notifications[i]===notif&&notifications.splice(i,1);positionNotifications()}),notif.renderTo(),positionNotifications(),notif},self.close=function(){getLastNotification()&&getLastNotification().close()},self.getNotifications=function(){return notifications},editor.on("SkinLoaded",function(){var serviceMessage=editor.settings.service_message;serviceMessage&&editor.notificationManager.open({text:serviceMessage,type:"warning",timeout:0,icon:""})})}}),define("tinymce/dom/NodePath",["tinymce/dom/DOMUtils"],function(DOMUtils){function create(rootNode,targetNode,normalized){for(var path=[];targetNode&&targetNode!=rootNode;targetNode=targetNode.parentNode)path.push(DOMUtils.nodeIndex(targetNode,normalized));return path}function resolve(rootNode,path){var i,node,children;for(node=rootNode,i=path.length-1;i>=0;i--){if(children=node.childNodes,path[i]>children.length-1)return null;node=children[path[i]]}return node}return{create:create,resolve:resolve}}),define("tinymce/util/Quirks",["tinymce/util/VK","tinymce/dom/RangeUtils","tinymce/dom/TreeWalker","tinymce/dom/NodePath","tinymce/html/Node","tinymce/html/Entities","tinymce/Env","tinymce/util/Tools","tinymce/util/Delay","tinymce/caret/CaretContainer"],function(VK,RangeUtils,TreeWalker,NodePath,Node,Entities,Env,Tools,Delay,CaretContainer){return function(editor){function setEditorCommandState(cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}}function getDocumentMode(){var documentMode=editor.getDoc().documentMode;return documentMode?documentMode:6}function isDefaultPrevented(e){return e.isDefaultPrevented()}function setMceInternalContent(e){var selectionHtml,internalContent;e.dataTransfer&&(editor.selection.isCollapsed()&&"IMG"==e.target.tagName&&selection.select(e.target),selectionHtml=editor.selection.getContent(),selectionHtml.length>0&&(internalContent=mceInternalUrlPrefix+escape(editor.id)+","+escape(selectionHtml),e.dataTransfer.setData(mceInternalDataType,internalContent)))}function getMceInternalContent(e){var internalContent;return e.dataTransfer&&(internalContent=e.dataTransfer.getData(mceInternalDataType),internalContent&&internalContent.indexOf(mceInternalUrlPrefix)>=0)?(internalContent=internalContent.substr(mceInternalUrlPrefix.length).split(","),{id:unescape(internalContent[0]),html:unescape(internalContent[1])}):null}function insertClipboardContents(content){editor.queryCommandSupported("mceInsertClipboardContent")?editor.execCommand("mceInsertClipboardContent",!1,{content:content}):editor.execCommand("mceInsertContent",!1,content)}function cleanupStylesWhenDeleting(){function isTrailingBr(node){var blockElements=dom.schema.getBlockElements(),rootNode=editor.getBody();if("BR"!=node.nodeName)return!1;for(;node!=rootNode&&!blockElements[node.nodeName];node=node.parentNode)if(node.nextSibling)return!1;return!0}function isSiblingsIgnoreWhiteSpace(node1,node2){var node;for(node=node1.nextSibling;node&&node!=node2;node=node.nextSibling)if((3!=node.nodeType||0!==$.trim(node.data).length)&&node!==node2)return!1;return node===node2}function findCaretNode(node,forward,startNode){var walker,current,nonEmptyElements;for(nonEmptyElements=dom.schema.getNonEmptyElements(),walker=new TreeWalker(startNode||node,node);current=walker[forward?"next":"prev"]();){if(nonEmptyElements[current.nodeName]&&!isTrailingBr(current))return current;if(3==current.nodeType&&current.data.length>0)return current}}function deleteRangeBetweenTextBlocks(rng){var startBlock,endBlock,caretNodeBefore,caretNodeAfter,textBlockElements;if(!rng.collapsed&&(startBlock=dom.getParent(RangeUtils.getNode(rng.startContainer,rng.startOffset),dom.isBlock),endBlock=dom.getParent(RangeUtils.getNode(rng.endContainer,rng.endOffset),dom.isBlock),textBlockElements=editor.schema.getTextBlockElements(),startBlock!=endBlock&&textBlockElements[startBlock.nodeName]&&textBlockElements[endBlock.nodeName]&&"false"!==dom.getContentEditable(startBlock)&&"false"!==dom.getContentEditable(endBlock)))return rng.deleteContents(),caretNodeBefore=findCaretNode(startBlock,!1),caretNodeAfter=findCaretNode(endBlock,!0),dom.isEmpty(endBlock)||$(startBlock).append(endBlock.childNodes),$(endBlock).remove(),caretNodeBefore?1==caretNodeBefore.nodeType?"BR"==caretNodeBefore.nodeName?(rng.setStartBefore(caretNodeBefore),rng.setEndBefore(caretNodeBefore)):(rng.setStartAfter(caretNodeBefore),rng.setEndAfter(caretNodeBefore)):(rng.setStart(caretNodeBefore,caretNodeBefore.data.length),rng.setEnd(caretNodeBefore,caretNodeBefore.data.length)):caretNodeAfter&&(1==caretNodeAfter.nodeType?(rng.setStartBefore(caretNodeAfter),rng.setEndBefore(caretNodeAfter)):(rng.setStart(caretNodeAfter,0),rng.setEnd(caretNodeAfter,0))),selection.setRng(rng),!0}function expandBetweenBlocks(rng,isForward){var caretNode,targetCaretNode,textBlock,targetTextBlock,container,offset;if(!rng.collapsed)return rng;if(container=rng.startContainer,offset=rng.startOffset,3==container.nodeType)if(isForward){if(offset<container.data.length)return rng}else if(offset>0)return rng;if(caretNode=RangeUtils.getNode(rng.startContainer,rng.startOffset),textBlock=dom.getParent(caretNode,dom.isBlock),targetCaretNode=findCaretNode(editor.getBody(),isForward,caretNode),targetTextBlock=dom.getParent(targetCaretNode,dom.isBlock),!caretNode||!targetCaretNode)return rng;if(targetTextBlock&&textBlock!=targetTextBlock)if(isForward){if(!isSiblingsIgnoreWhiteSpace(textBlock,targetTextBlock))return rng;1==caretNode.nodeType?"BR"==caretNode.nodeName?rng.setStartBefore(caretNode):rng.setStartAfter(caretNode):rng.setStart(caretNode,caretNode.data.length),1==targetCaretNode.nodeType?rng.setEnd(targetCaretNode,0):rng.setEndBefore(targetCaretNode)}else{if(!isSiblingsIgnoreWhiteSpace(targetTextBlock,textBlock))return rng;1==targetCaretNode.nodeType?"BR"==targetCaretNode.nodeName?rng.setStartBefore(targetCaretNode):rng.setStartAfter(targetCaretNode):rng.setStart(targetCaretNode,targetCaretNode.data.length),1==caretNode.nodeType?rng.setEnd(caretNode,0):rng.setEndBefore(caretNode)}return rng}function handleTextBlockMergeDelete(isForward){var rng=selection.getRng();if(rng=expandBetweenBlocks(rng,isForward),deleteRangeBetweenTextBlocks(rng))return!0}function handleLastBlockCharacterDelete(isForward,rng){function cloneTextBlockWithFormats(blockElm,node){return currentFormatNodes=$(node).parents().filter(function(idx,node){return!!editor.schema.getTextInlineElements()[node.nodeName]}),newBlockElm=blockElm.cloneNode(!1),currentFormatNodes=Tools.map(currentFormatNodes,function(formatNode){return formatNode=formatNode.cloneNode(!1),newBlockElm.hasChildNodes()?(formatNode.appendChild(newBlockElm.firstChild),newBlockElm.appendChild(formatNode)):newBlockElm.appendChild(formatNode),newBlockElm.appendChild(formatNode),formatNode}),currentFormatNodes.length?(br=dom.create("br"),currentFormatNodes[0].appendChild(br),dom.replace(newBlockElm,blockElm),rng.setStartBefore(br),rng.setEndBefore(br),editor.selection.setRng(rng),br):null}function isTextBlock(node){return node&&editor.schema.getTextBlockElements()[node.tagName]}var path,blockElm,newBlockElm,clonedBlockElm,sibling,container,offset,br,currentFormatNodes;if(rng.collapsed&&(container=rng.startContainer,offset=rng.startOffset,blockElm=dom.getParent(container,dom.isBlock),isTextBlock(blockElm)))if(1==container.nodeType){if(container=container.childNodes[offset],container&&"BR"!=container.tagName)return;if(sibling=isForward?blockElm.nextSibling:blockElm.previousSibling,dom.isEmpty(blockElm)&&isTextBlock(sibling)&&dom.isEmpty(sibling)&&cloneTextBlockWithFormats(blockElm,container))return dom.remove(sibling),!0}else if(3==container.nodeType){if(path=NodePath.create(blockElm,container),clonedBlockElm=blockElm.cloneNode(!0),container=NodePath.resolve(clonedBlockElm,path),isForward){if(offset>=container.data.length)return;container.deleteData(offset,1)}else{if(offset<=0)return;container.deleteData(offset-1,1)}if(dom.isEmpty(clonedBlockElm))return cloneTextBlockWithFormats(blockElm,container)}}function customDelete(isForward){var mutationObserver,rng,caretElement;handleTextBlockMergeDelete(isForward)||(Tools.each(editor.getBody().getElementsByTagName("*"),function(elm){"SPAN"==elm.tagName&&elm.setAttribute("mce-data-marked",1),!elm.hasAttribute("data-mce-style")&&elm.hasAttribute("style")&&editor.dom.setAttrib(elm,"style",editor.dom.getAttrib(elm,"style"))}),mutationObserver=new MutationObserver(function(){}),mutationObserver.observe(editor.getDoc(),{childList:!0,attributes:!0,subtree:!0,attributeFilter:["style"]}),editor.getDoc().execCommand(isForward?"ForwardDelete":"Delete",!1,null),rng=editor.selection.getRng(),caretElement=rng.startContainer.parentNode,Tools.each(mutationObserver.takeRecords(),function(record){if(dom.isChildOf(record.target,editor.getBody())){if("style"==record.attributeName){var oldValue=record.target.getAttribute("data-mce-style");oldValue?record.target.setAttribute("style",oldValue):record.target.removeAttribute("style")}Tools.each(record.addedNodes,function(node){if("SPAN"==node.nodeName&&!node.getAttribute("mce-data-marked")){var offset,container;node==caretElement&&(offset=rng.startOffset,container=node.firstChild),dom.remove(node,!0),container&&(rng.setStart(container,offset),rng.setEnd(container,offset),editor.selection.setRng(rng))}})}}),mutationObserver.disconnect(),Tools.each(editor.dom.select("span[mce-data-marked]"),function(span){span.removeAttribute("mce-data-marked")}))}var olderWebKit,dragStartRng,doc=editor.getDoc(),dom=editor.dom,selection=editor.selection,MutationObserver=window.MutationObserver;MutationObserver||(olderWebKit=!0,MutationObserver=function(){function nodeInsert(e){var target=e.relatedNode||e.target;records.push({target:target,addedNodes:[target]})}function attrModified(e){var target=e.relatedNode||e.target;records.push({target:target,attributeName:e.attrName})}var target,records=[];this.observe=function(node){target=node,target.addEventListener("DOMSubtreeModified",nodeInsert,!1),target.addEventListener("DOMNodeInsertedIntoDocument",nodeInsert,!1),target.addEventListener("DOMNodeInserted",nodeInsert,!1),target.addEventListener("DOMAttrModified",attrModified,!1)},this.disconnect=function(){target.removeEventListener("DOMSubtreeModified",nodeInsert,!1),target.removeEventListener("DOMNodeInsertedIntoDocument",nodeInsert,!1),target.removeEventListener("DOMNodeInserted",nodeInsert,!1),target.removeEventListener("DOMAttrModified",attrModified,!1)},this.takeRecords=function(){return records}}),editor.on("keydown",function(e){var isForward=e.keyCode==DELETE,isMetaOrCtrl=e.ctrlKey||e.metaKey;if(!isDefaultPrevented(e)&&(isForward||e.keyCode==BACKSPACE)){var rng=editor.selection.getRng(),container=rng.startContainer,offset=rng.startOffset;if(isForward&&e.shiftKey)return;if(handleLastBlockCharacterDelete(isForward,rng))return void e.preventDefault();if(!isMetaOrCtrl&&rng.collapsed&&3==container.nodeType&&(isForward?offset<container.data.length:offset>0))return;e.preventDefault(),isMetaOrCtrl&&editor.selection.getSel().modify("extend",isForward?"forward":"backward",e.metaKey?"lineboundary":"word"),customDelete(isForward)}}),editor.on("keypress",function(e){if(!isDefaultPrevented(e)&&!selection.isCollapsed()&&e.charCode>31&&!VK.metaKeyPressed(e)){var rng,currentFormatNodes,fragmentNode,blockParent,caretNode,charText;rng=editor.selection.getRng(),charText=String.fromCharCode(e.charCode),e.preventDefault(),currentFormatNodes=$(rng.startContainer).parents().filter(function(idx,node){return!!editor.schema.getTextInlineElements()[node.nodeName]}),customDelete(!0),currentFormatNodes=currentFormatNodes.filter(function(idx,node){return!$.contains(editor.getBody(),node)}),currentFormatNodes.length?(fragmentNode=dom.createFragment(),currentFormatNodes.each(function(idx,formatNode){formatNode=formatNode.cloneNode(!1),fragmentNode.hasChildNodes()?(formatNode.appendChild(fragmentNode.firstChild),fragmentNode.appendChild(formatNode)):(caretNode=formatNode,fragmentNode.appendChild(formatNode)),fragmentNode.appendChild(formatNode)}),caretNode.appendChild(editor.getDoc().createTextNode(charText)),blockParent=dom.getParent(rng.startContainer,dom.isBlock),dom.isEmpty(blockParent)?$(blockParent).empty().append(fragmentNode):rng.insertNode(fragmentNode),rng.setStart(caretNode.firstChild,1),rng.setEnd(caretNode.firstChild,1),editor.selection.setRng(rng)):editor.selection.setContent(charText)}}),editor.addCommand("Delete",function(){customDelete()}),editor.addCommand("ForwardDelete",function(){customDelete(!0)}),olderWebKit||(editor.on("dragstart",function(e){dragStartRng=selection.getRng(),setMceInternalContent(e)}),editor.on("drop",function(e){if(!isDefaultPrevented(e)){var internalContent=getMceInternalContent(e);internalContent&&(e.preventDefault(),Delay.setEditorTimeout(editor,function(){var pointRng=RangeUtils.getCaretRangeFromPoint(e.x,e.y,doc);dragStartRng&&(selection.setRng(dragStartRng),dragStartRng=null),customDelete(),selection.setRng(pointRng),insertClipboardContents(internalContent.html)}))}}),editor.on("cut",function(e){isDefaultPrevented(e)||!e.clipboardData||editor.selection.isCollapsed()||(e.preventDefault(),e.clipboardData.clearData(),e.clipboardData.setData("text/html",editor.selection.getContent()),e.clipboardData.setData("text/plain",editor.selection.getContent({format:"text"})),Delay.setEditorTimeout(editor,function(){customDelete(!0)}))}))}function emptyEditorWhenDeleting(){function serializeRng(rng){var body=dom.create("body"),contents=rng.cloneContents();return body.appendChild(contents),selection.serializer.serialize(body,{format:"html"})}function allContentsSelected(rng){if(!rng.setStart){if(rng.item)return!1;var bodyRng=rng.duplicate();return bodyRng.moveToElementText(editor.getBody()),RangeUtils.compareRanges(rng,bodyRng)}var selection=serializeRng(rng),allRng=dom.createRng();allRng.selectNode(editor.getBody());var allSelection=serializeRng(allRng);return selection===allSelection}editor.on("keydown",function(e){var isCollapsed,body,keyCode=e.keyCode;if(!isDefaultPrevented(e)&&(keyCode==DELETE||keyCode==BACKSPACE)){if(isCollapsed=editor.selection.isCollapsed(),body=editor.getBody(),isCollapsed&&!dom.isEmpty(body))return;if(!isCollapsed&&!allContentsSelected(editor.selection.getRng()))return;e.preventDefault(),editor.setContent(""),body.firstChild&&dom.isBlock(body.firstChild)?editor.selection.setCursorLocation(body.firstChild,0):editor.selection.setCursorLocation(body,0),editor.nodeChanged()}})}function selectAll(){editor.shortcuts.add("meta+a",null,"SelectAll")}function inputMethodFocus(){editor.settings.content_editable||dom.bind(editor.getDoc(),"mousedown mouseup",function(e){var rng;if(e.target==editor.getDoc().documentElement)if(rng=selection.getRng(),editor.getBody().focus(),"mousedown"==e.type){if(CaretContainer.isCaretContainer(rng.startContainer))return;
selection.placeCaretAt(e.clientX,e.clientY)}else selection.setRng(rng)})}function removeHrOnBackspace(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE){if(!editor.getBody().getElementsByTagName("hr").length)return;if(selection.isCollapsed()&&0===selection.getRng(!0).startOffset){var node=selection.getNode(),previousSibling=node.previousSibling;if("HR"==node.nodeName)return dom.remove(node),void e.preventDefault();previousSibling&&previousSibling.nodeName&&"hr"===previousSibling.nodeName.toLowerCase()&&(dom.remove(previousSibling),e.preventDefault())}}})}function focusBody(){window.Range.prototype.getClientRects||editor.on("mousedown",function(e){if(!isDefaultPrevented(e)&&"HTML"===e.target.nodeName){var body=editor.getBody();body.blur(),Delay.setEditorTimeout(editor,function(){body.focus()})}})}function selectControlElements(){editor.on("click",function(e){var target=e.target;/^(IMG|HR)$/.test(target.nodeName)&&"false"!==dom.getContentEditableParent(target)&&(e.preventDefault(),selection.getSel().setBaseAndExtent(target,0,target,1),editor.nodeChanged()),"A"==target.nodeName&&dom.hasClass(target,"mce-item-anchor")&&(e.preventDefault(),selection.select(target))})}function removeStylesWhenDeletingAcrossBlockElements(){function getAttributeApplyFunction(){var template=dom.getAttribs(selection.getStart().cloneNode(!1));return function(){var target=selection.getStart();target!==editor.getBody()&&(dom.setAttrib(target,"style",null),each(template,function(attr){target.setAttributeNode(attr.cloneNode(!0))}))}}function isSelectionAcrossElements(){return!selection.isCollapsed()&&dom.getParent(selection.getStart(),dom.isBlock)!=dom.getParent(selection.getEnd(),dom.isBlock)}editor.on("keypress",function(e){var applyAttributes;if(!isDefaultPrevented(e)&&(8==e.keyCode||46==e.keyCode)&&isSelectionAcrossElements())return applyAttributes=getAttributeApplyFunction(),editor.getDoc().execCommand("delete",!1,null),applyAttributes(),e.preventDefault(),!1}),dom.bind(editor.getDoc(),"cut",function(e){var applyAttributes;!isDefaultPrevented(e)&&isSelectionAcrossElements()&&(applyAttributes=getAttributeApplyFunction(),Delay.setEditorTimeout(editor,function(){applyAttributes()}))})}function ensureBodyHasRoleApplication(){document.body.setAttribute("role","application")}function disableBackspaceIntoATable(){editor.on("keydown",function(e){if(!isDefaultPrevented(e)&&e.keyCode===BACKSPACE&&selection.isCollapsed()&&0===selection.getRng(!0).startOffset){var previousSibling=selection.getNode().previousSibling;if(previousSibling&&previousSibling.nodeName&&"table"===previousSibling.nodeName.toLowerCase())return e.preventDefault(),!1}})}function addNewLinesBeforeBrInPre(){getDocumentMode()>7||(setEditorCommandState("RespectVisibilityInDesign",!0),editor.contentStyles.push(".mceHideBrInPre pre br {display: none}"),dom.addClass(editor.getBody(),"mceHideBrInPre"),parser.addNodeFilter("pre",function(nodes){for(var brNodes,j,brElm,sibling,i=nodes.length;i--;)for(brNodes=nodes[i].getAll("br"),j=brNodes.length;j--;)brElm=brNodes[j],sibling=brElm.prev,sibling&&3===sibling.type&&"\n"!=sibling.value.charAt(sibling.value-1)?sibling.value+="\n":brElm.parent.insert(new Node("#text",3),brElm,!0).value="\n"}),serializer.addNodeFilter("pre",function(nodes){for(var brNodes,j,brElm,sibling,i=nodes.length;i--;)for(brNodes=nodes[i].getAll("br"),j=brNodes.length;j--;)brElm=brNodes[j],sibling=brElm.prev,sibling&&3==sibling.type&&(sibling.value=sibling.value.replace(/\r?\n$/,""))}))}function removePreSerializedStylesWhenSelectingControls(){dom.bind(editor.getBody(),"mouseup",function(){var value,node=selection.getNode();"IMG"==node.nodeName&&((value=dom.getStyle(node,"width"))&&(dom.setAttrib(node,"width",value.replace(/[^0-9%]+/g,"")),dom.setStyle(node,"width","")),(value=dom.getStyle(node,"height"))&&(dom.setAttrib(node,"height",value.replace(/[^0-9%]+/g,"")),dom.setStyle(node,"height","")))})}function removeBlockQuoteOnBackSpace(){editor.on("keydown",function(e){var rng,container,offset,root,parent;if(!isDefaultPrevented(e)&&e.keyCode==VK.BACKSPACE&&(rng=selection.getRng(),container=rng.startContainer,offset=rng.startOffset,root=dom.getRoot(),parent=container,rng.collapsed&&0===offset)){for(;parent&&parent.parentNode&&parent.parentNode.firstChild==parent&&parent.parentNode!=root;)parent=parent.parentNode;"BLOCKQUOTE"===parent.tagName&&(editor.formatter.toggle("blockquote",null,parent),rng=dom.createRng(),rng.setStart(container,0),rng.setEnd(container,0),selection.setRng(rng))}})}function setGeckoEditingOptions(){function setOpts(){refreshContentEditable(),setEditorCommandState("StyleWithCSS",!1),setEditorCommandState("enableInlineTableEditing",!1),settings.object_resizing||setEditorCommandState("enableObjectResizing",!1)}settings.readonly||editor.on("BeforeExecCommand MouseDown",setOpts)}function addBrAfterLastLinks(){function fixLinks(){each(dom.select("a"),function(node){var parentNode=node.parentNode,root=dom.getRoot();if(parentNode.lastChild===node){for(;parentNode&&!dom.isBlock(parentNode);){if(parentNode.parentNode.lastChild!==parentNode||parentNode===root)return;parentNode=parentNode.parentNode}dom.add(parentNode,"br",{"data-mce-bogus":1})}})}editor.on("SetContent ExecCommand",function(e){"setcontent"!=e.type&&"mceInsertLink"!==e.command||fixLinks()})}function setDefaultBlockType(){settings.forced_root_block&&editor.on("init",function(){setEditorCommandState("DefaultParagraphSeparator",settings.forced_root_block)})}function deleteControlItemOnBackSpace(){editor.on("keydown",function(e){var rng;isDefaultPrevented(e)||e.keyCode!=BACKSPACE||(rng=editor.getDoc().selection.createRange(),rng&&rng.item&&(e.preventDefault(),editor.undoManager.beforeChange(),dom.remove(rng.item(0)),editor.undoManager.add()))})}function renderEmptyBlocksFix(){var emptyBlocksCSS;getDocumentMode()>=10&&(emptyBlocksCSS="",each("p div h1 h2 h3 h4 h5 h6".split(" "),function(name,i){emptyBlocksCSS+=(i>0?",":"")+name+":empty"}),editor.contentStyles.push(emptyBlocksCSS+"{padding-right: 1px !important}"))}function keepNoScriptContents(){getDocumentMode()<9&&(parser.addNodeFilter("noscript",function(nodes){for(var node,textNode,i=nodes.length;i--;)node=nodes[i],textNode=node.firstChild,textNode&&node.attr("data-mce-innertext",textNode.value)}),serializer.addNodeFilter("noscript",function(nodes){for(var node,textNode,value,i=nodes.length;i--;)node=nodes[i],textNode=nodes[i].firstChild,textNode?textNode.value=Entities.decode(textNode.value):(value=node.attributes.map["data-mce-innertext"],value&&(node.attr("data-mce-innertext",null),textNode=new Node("#text",3),textNode.value=value,textNode.raw=!0,node.append(textNode)))}))}function fixCaretSelectionOfDocumentElementOnIe(){function rngFromPoint(x,y){var rng=body.createTextRange();try{rng.moveToPoint(x,y)}catch(ex){rng=null}return rng}function selectionChange(e){var pointRng;e.button?(pointRng=rngFromPoint(e.x,e.y),pointRng&&(pointRng.compareEndPoints("StartToStart",startRng)>0?pointRng.setEndPoint("StartToStart",startRng):pointRng.setEndPoint("EndToEnd",startRng),pointRng.select())):endSelection()}function endSelection(){var rng=doc.selection.createRange();startRng&&!rng.item&&0===rng.compareEndPoints("StartToEnd",rng)&&startRng.select(),dom.unbind(doc,"mouseup",endSelection),dom.unbind(doc,"mousemove",selectionChange),startRng=started=0}var started,startRng,htmlElm,doc=dom.doc,body=doc.body;doc.documentElement.unselectable=!0,dom.bind(doc,"mousedown contextmenu",function(e){if("HTML"===e.target.nodeName){if(started&&endSelection(),htmlElm=doc.documentElement,htmlElm.scrollHeight>htmlElm.clientHeight)return;started=1,startRng=rngFromPoint(e.x,e.y),startRng&&(dom.bind(doc,"mouseup",endSelection),dom.bind(doc,"mousemove",selectionChange),dom.getRoot().focus(),startRng.select())}})}function normalizeSelection(){editor.on("keyup focusin mouseup",function(e){65==e.keyCode&&VK.metaKeyPressed(e)||selection.normalize()},!0)}function showBrokenImageIcon(){editor.contentStyles.push("img:-moz-broken {-moz-force-broken-image-icon:1;min-width:24px;min-height:24px}")}function restoreFocusOnKeyDown(){editor.inline||editor.on("keydown",function(){document.activeElement==document.body&&editor.getWin().focus()})}function bodyHeight(){editor.inline||(editor.contentStyles.push("body {min-height: 150px}"),editor.on("click",function(e){var rng;if("HTML"==e.target.nodeName){if(Env.ie>11)return void editor.getBody().focus();rng=editor.selection.getRng(),editor.getBody().focus(),editor.selection.setRng(rng),editor.selection.normalize(),editor.nodeChanged()}}))}function blockCmdArrowNavigation(){Env.mac&&editor.on("keydown",function(e){!VK.metaKeyPressed(e)||e.shiftKey||37!=e.keyCode&&39!=e.keyCode||(e.preventDefault(),editor.selection.getSel().modify("move",37==e.keyCode?"backward":"forward","lineboundary"))})}function disableAutoUrlDetect(){setEditorCommandState("AutoUrlDetect",!1)}function tapLinksAndImages(){editor.on("click",function(e){var elm=e.target;do if("A"===elm.tagName)return void e.preventDefault();while(elm=elm.parentNode)}),editor.contentStyles.push(".mce-content-body {-webkit-touch-callout: none}")}function blockFormSubmitInsideEditor(){editor.on("init",function(){editor.dom.bind(editor.getBody(),"submit",function(e){e.preventDefault()})})}function removeAppleInterchangeBrs(){parser.addNodeFilter("br",function(nodes){for(var i=nodes.length;i--;)"Apple-interchange-newline"==nodes[i].attr("class")&&nodes[i].remove()})}function ieInternalDragAndDrop(){editor.on("dragstart",function(e){setMceInternalContent(e)}),editor.on("drop",function(e){if(!isDefaultPrevented(e)){var internalContent=getMceInternalContent(e);if(internalContent&&internalContent.id!=editor.id){e.preventDefault();var rng=RangeUtils.getCaretRangeFromPoint(e.x,e.y,editor.getDoc());selection.setRng(rng),insertClipboardContents(internalContent.html)}}})}function refreshContentEditable(){var body,parent;isHidden()&&(body=editor.getBody(),parent=body.parentNode,parent.removeChild(body),parent.appendChild(body),body.focus())}function isHidden(){var sel;return isGecko?(sel=editor.selection.getSel(),!sel||!sel.rangeCount||0===sel.rangeCount):0}var each=Tools.each,$=editor.$,BACKSPACE=VK.BACKSPACE,DELETE=VK.DELETE,dom=editor.dom,selection=editor.selection,settings=editor.settings,parser=editor.parser,serializer=editor.serializer,isGecko=Env.gecko,isIE=Env.ie,isWebKit=Env.webkit,mceInternalUrlPrefix="data:text/mce-internal,",mceInternalDataType=isIE?"Text":"URL";return removeBlockQuoteOnBackSpace(),emptyEditorWhenDeleting(),Env.windowsPhone||normalizeSelection(),isWebKit&&(cleanupStylesWhenDeleting(),inputMethodFocus(),selectControlElements(),setDefaultBlockType(),blockFormSubmitInsideEditor(),disableBackspaceIntoATable(),removeAppleInterchangeBrs(),Env.iOS?(restoreFocusOnKeyDown(),bodyHeight(),tapLinksAndImages()):selectAll()),isIE&&Env.ie<11&&(removeHrOnBackspace(),ensureBodyHasRoleApplication(),addNewLinesBeforeBrInPre(),removePreSerializedStylesWhenSelectingControls(),deleteControlItemOnBackSpace(),renderEmptyBlocksFix(),keepNoScriptContents(),fixCaretSelectionOfDocumentElementOnIe()),Env.ie>=11&&(bodyHeight(),disableBackspaceIntoATable()),Env.ie&&(selectAll(),disableAutoUrlDetect(),ieInternalDragAndDrop()),isGecko&&(removeHrOnBackspace(),focusBody(),removeStylesWhenDeletingAcrossBlockElements(),setGeckoEditingOptions(),addBrAfterLastLinks(),showBrokenImageIcon(),blockCmdArrowNavigation(),disableBackspaceIntoATable()),{refreshContentEditable:refreshContentEditable,isHidden:isHidden}}}),define("tinymce/EditorObservable",["tinymce/util/Observable","tinymce/dom/DOMUtils","tinymce/util/Tools"],function(Observable,DOMUtils,Tools){function getEventTarget(editor,eventName){return"selectionchange"==eventName?editor.getDoc():!editor.inline&&/^mouse|click|contextmenu|drop|dragover|dragend/.test(eventName)?editor.getDoc().documentElement:editor.settings.event_root?(editor.eventRoot||(editor.eventRoot=DOM.select(editor.settings.event_root)[0]),editor.eventRoot):editor.getBody()}function bindEventDelegate(editor,eventName){function isListening(editor){return!editor.hidden&&!editor.readonly}var delegate,eventRootElm=getEventTarget(editor,eventName);if(editor.delegates||(editor.delegates={}),!editor.delegates[eventName])if(editor.settings.event_root){if(customEventRootDelegates||(customEventRootDelegates={},editor.editorManager.on("removeEditor",function(){var name;if(!editor.editorManager.activeEditor&&customEventRootDelegates){for(name in customEventRootDelegates)editor.dom.unbind(getEventTarget(editor,name));customEventRootDelegates=null}})),customEventRootDelegates[eventName])return;delegate=function(e){for(var target=e.target,editors=editor.editorManager.editors,i=editors.length;i--;){var body=editors[i].getBody();(body===target||DOM.isChildOf(target,body))&&isListening(editors[i])&&editors[i].fire(eventName,e)}},customEventRootDelegates[eventName]=delegate,DOM.bind(eventRootElm,eventName,delegate)}else delegate=function(e){isListening(editor)&&editor.fire(eventName,e)},DOM.bind(eventRootElm,eventName,delegate),editor.delegates[eventName]=delegate}var customEventRootDelegates,DOM=DOMUtils.DOM,EditorObservable={bindPendingEventDelegates:function(){var self=this;Tools.each(self._pendingNativeEvents,function(name){bindEventDelegate(self,name)})},toggleNativeEvent:function(name,state){var self=this;"focus"!=name&&"blur"!=name&&(state?self.initialized?bindEventDelegate(self,name):self._pendingNativeEvents?self._pendingNativeEvents.push(name):self._pendingNativeEvents=[name]:self.initialized&&(self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]),delete self.delegates[name]))},unbindAllNativeEvents:function(){var name,self=this;if(self.delegates){for(name in self.delegates)self.dom.unbind(getEventTarget(self,name),name,self.delegates[name]);delete self.delegates}self.inline||(self.getBody().onload=null,self.dom.unbind(self.getWin()),self.dom.unbind(self.getDoc())),self.dom.unbind(self.getBody()),self.dom.unbind(self.getContainer())}};return EditorObservable=Tools.extend({},Observable,EditorObservable)}),define("tinymce/Mode",[],function(){function setEditorCommandState(editor,cmd,state){try{editor.getDoc().execCommand(cmd,!1,state)}catch(ex){}}function clickBlocker(editor){var target,handler;return target=editor.getBody(),handler=function(e){editor.dom.getParents(e.target,"a").length>0&&e.preventDefault()},editor.dom.bind(target,"click",handler),{unbind:function(){editor.dom.unbind(target,"click",handler)}}}function toggleReadOnly(editor,state){editor._clickBlocker&&(editor._clickBlocker.unbind(),editor._clickBlocker=null),state?(editor._clickBlocker=clickBlocker(editor),editor.selection.controlSelection.hideResizeRect(),editor.readonly=!0,editor.getBody().contentEditable=!1):(editor.readonly=!1,editor.getBody().contentEditable=!0,setEditorCommandState(editor,"StyleWithCSS",!1),setEditorCommandState(editor,"enableInlineTableEditing",!1),setEditorCommandState(editor,"enableObjectResizing",!1),editor.focus(),editor.nodeChanged())}function setMode(editor,mode){var currentMode=editor.readonly?"readonly":"design";mode!=currentMode&&(editor.initialized?toggleReadOnly(editor,"readonly"==mode):editor.on("init",function(){toggleReadOnly(editor,"readonly"==mode)}),editor.fire("SwitchMode",{mode:mode}))}return{setMode:setMode}}),define("tinymce/Shortcuts",["tinymce/util/Tools","tinymce/Env"],function(Tools,Env){var each=Tools.each,explode=Tools.explode,keyCodeLookup={f9:120,f10:121,f11:122},modifierNames=Tools.makeMap("alt,ctrl,shift,meta,access");return function(editor){function parseShortcut(pattern){var id,key,shortcut={};each(explode(pattern,"+"),function(value){value in modifierNames?shortcut[value]=!0:/^[0-9]{2,}$/.test(value)?shortcut.keyCode=parseInt(value,10):(shortcut.charCode=value.charCodeAt(0),shortcut.keyCode=keyCodeLookup[value]||value.toUpperCase().charCodeAt(0))}),id=[shortcut.keyCode];for(key in modifierNames)shortcut[key]?id.push(key):shortcut[key]=!1;return shortcut.id=id.join(","),shortcut.access&&(shortcut.alt=!0,Env.mac?shortcut.ctrl=!0:shortcut.shift=!0),shortcut.meta&&(Env.mac?shortcut.meta=!0:(shortcut.ctrl=!0,shortcut.meta=!1)),shortcut}function createShortcut(pattern,desc,cmdFunc,scope){var shortcuts;return shortcuts=Tools.map(explode(pattern,">"),parseShortcut),shortcuts[shortcuts.length-1]=Tools.extend(shortcuts[shortcuts.length-1],{func:cmdFunc,scope:scope||editor}),Tools.extend(shortcuts[0],{desc:editor.translate(desc),subpatterns:shortcuts.slice(1)})}function hasModifier(e){return e.altKey||e.ctrlKey||e.metaKey}function isFunctionKey(e){return e.keyCode>=112&&e.keyCode<=123}function matchShortcut(e,shortcut){return!!shortcut&&(shortcut.ctrl==e.ctrlKey&&shortcut.meta==e.metaKey&&(shortcut.alt==e.altKey&&shortcut.shift==e.shiftKey&&(!!(e.keyCode==shortcut.keyCode||e.charCode&&e.charCode==shortcut.charCode)&&(e.preventDefault(),!0))))}function executeShortcutAction(shortcut){return shortcut.func?shortcut.func.call(shortcut.scope):null}var self=this,shortcuts={},pendingPatterns=[];editor.on("keyup keypress keydown",function(e){!hasModifier(e)&&!isFunctionKey(e)||e.isDefaultPrevented()||(each(shortcuts,function(shortcut){if(matchShortcut(e,shortcut))return pendingPatterns=shortcut.subpatterns.slice(0),"keydown"==e.type&&executeShortcutAction(shortcut),!0}),matchShortcut(e,pendingPatterns[0])&&(1===pendingPatterns.length&&"keydown"==e.type&&executeShortcutAction(pendingPatterns[0]),pendingPatterns.shift()))}),self.add=function(pattern,desc,cmdFunc,scope){var cmd;return cmd=cmdFunc,"string"==typeof cmdFunc?cmdFunc=function(){editor.execCommand(cmd,!1,null)}:Tools.isArray(cmd)&&(cmdFunc=function(){editor.execCommand(cmd[0],cmd[1],cmd[2])}),each(explode(Tools.trim(pattern.toLowerCase())),function(pattern){var shortcut=createShortcut(pattern,desc,cmdFunc,scope);shortcuts[shortcut.id]=shortcut}),!0},self.remove=function(pattern){var shortcut=createShortcut(pattern);return!!shortcuts[shortcut.id]&&(delete shortcuts[shortcut.id],!0)}}}),define("tinymce/file/Uploader",["tinymce/util/Promise","tinymce/util/Tools","tinymce/util/Fun"],function(Promise,Tools,Fun){return function(settings){function fileName(blobInfo){var ext,extensions;return extensions={"image/jpeg":"jpg","image/jpg":"jpg","image/gif":"gif","image/png":"png"},ext=extensions[blobInfo.blob().type.toLowerCase()]||"dat",blobInfo.id()+"."+ext}function pathJoin(path1,path2){return path1?path1.replace(/\/$/,"")+"/"+path2.replace(/^\//,""):path2}function blobInfoToData(blobInfo){return{id:blobInfo.id,blob:blobInfo.blob,base64:blobInfo.base64,filename:Fun.constant(fileName(blobInfo))}}function defaultHandler(blobInfo,success,failure,openNotification){var xhr,formData,notification;xhr=new XMLHttpRequest,xhr.open("POST",settings.url),xhr.withCredentials=settings.credentials,notification=openNotification(),xhr.upload.onprogress=function(e){var percentLoaded=Math.round(e.loaded/e.total*100);notification.progressBar.value(percentLoaded)},xhr.onerror=function(){notification.close(),failure("Image upload failed due to a XHR Transport error. Code: "+xhr.status)},xhr.onload=function(){var json;return notification.close(),200!=xhr.status?void failure("HTTP Error: "+xhr.status):(json=JSON.parse(xhr.responseText),json&&"string"==typeof json.location?void success(pathJoin(settings.basePath,json.location)):void failure("Invalid JSON: "+xhr.responseText))},formData=new FormData,formData.append("file",blobInfo.blob(),fileName(blobInfo)),xhr.send(formData)}function noUpload(){return new Promise(function(resolve){resolve([])})}function interpretResult(promise){return promise.then(function(result){return result})["catch"](function(error){return error})}function registerPromise(handler,id,blobInfo){var response=handler(blobInfo),promise=interpretResult(response);return delete cachedPromises[id],cachedPromises[id]=promise,promise}function collectUploads(blobInfos,uploadBlobInfo){return Tools.map(blobInfos,function(blobInfo){var id=blobInfo.id();return cachedPromises[id]?cachedPromises[id]:registerPromise(uploadBlobInfo,id,blobInfo)})}function uploadBlobs(blobInfos,openNotification){function uploadBlobInfo(blobInfo){return new Promise(function(resolve){var handler=settings.handler;try{handler(blobInfoToData(blobInfo),function(url){resolve({url:url,blobInfo:blobInfo,status:!0})},function(failure){resolve({url:"",blobInfo:blobInfo,status:!1,error:failure})},openNotification)}catch(ex){resolve({url:"",blobInfo:blobInfo,status:!1,error:ex.message})}})}var promises=collectUploads(blobInfos,uploadBlobInfo);return Promise.all(promises)}function upload(blobInfos,openNotification){return settings.url||settings.handler!==defaultHandler?uploadBlobs(blobInfos,openNotification):noUpload()}var cachedPromises={};return settings=Tools.extend({credentials:!1,handler:defaultHandler},settings),{upload:upload}}}),define("tinymce/file/Conversions",["tinymce/util/Promise"],function(Promise){function blobUriToBlob(url){return new Promise(function(resolve){var xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="blob",xhr.onload=function(){200==this.status&&resolve(this.response)},xhr.send()})}function parseDataUri(uri){var type,matches;return uri=decodeURIComponent(uri).split(","),matches=/data:([^;]+)/.exec(uri[0]),matches&&(type=matches[1]),{type:type,data:uri[1]}}function dataUriToBlob(uri){return new Promise(function(resolve){var str,arr,i;uri=parseDataUri(uri);try{str=atob(uri.data)}catch(e){return void resolve(new Blob([]))}for(arr=new Uint8Array(str.length),i=0;i<arr.length;i++)arr[i]=str.charCodeAt(i);resolve(new Blob([arr],{type:uri.type}))})}function uriToBlob(url){return 0===url.indexOf("blob:")?blobUriToBlob(url):0===url.indexOf("data:")?dataUriToBlob(url):null}function blobToDataUri(blob){return new Promise(function(resolve){var reader=new FileReader;reader.onloadend=function(){resolve(reader.result)},reader.readAsDataURL(blob)})}return{uriToBlob:uriToBlob,blobToDataUri:blobToDataUri,parseDataUri:parseDataUri}}),define("tinymce/file/ImageScanner",["tinymce/util/Promise","tinymce/util/Arr","tinymce/util/Fun","tinymce/file/Conversions","tinymce/Env"],function(Promise,Arr,Fun,Conversions,Env){var count=0;return function(blobCache){function findAll(elm,predicate){function imageToBlobInfo(img,resolve){var base64,blobInfo;return 0===img.src.indexOf("blob:")?(blobInfo=blobCache.getByUri(img.src),void(blobInfo&&resolve({image:img,blobInfo:blobInfo}))):(base64=Conversions.parseDataUri(img.src).data,blobInfo=blobCache.findFirst(function(cachedBlobInfo){return cachedBlobInfo.base64()===base64}),void(blobInfo?resolve({image:img,blobInfo:blobInfo}):Conversions.uriToBlob(img.src).then(function(blob){var blobInfoId="blobid"+count++,blobInfo=blobCache.create(blobInfoId,blob,base64);blobCache.add(blobInfo),resolve({image:img,blobInfo:blobInfo})})))}var images,promises;return predicate||(predicate=Fun.constant(!0)),images=Arr.filter(elm.getElementsByTagName("img"),function(img){var src=img.src;return!!Env.fileApi&&(!img.hasAttribute("data-mce-bogus")&&(!img.hasAttribute("data-mce-placeholder")&&(!(!src||src==Env.transparentSrc)&&(0===src.indexOf("blob:")||0===src.indexOf("data:")&&predicate(img)))))}),promises=Arr.map(images,function(img){var newPromise;return cachedPromises[img.src]?new Promise(function(resolve){cachedPromises[img.src].then(function(imageInfo){resolve({image:img,blobInfo:imageInfo.blobInfo})})}):(newPromise=new Promise(function(resolve){imageToBlobInfo(img,resolve)}).then(function(result){return delete cachedPromises[result.image.src],result})["catch"](function(error){return delete cachedPromises[img.src],error}),cachedPromises[img.src]=newPromise,newPromise)}),Promise.all(promises)}var cachedPromises={};return{findAll:findAll}}}),define("tinymce/file/BlobCache",["tinymce/util/Arr","tinymce/util/Fun"],function(Arr,Fun){return function(){function create(id,blob,base64){return{id:constant(id),blob:constant(blob),base64:constant(base64),blobUri:constant(URL.createObjectURL(blob))}}function add(blobInfo){get(blobInfo.id())||cache.push(blobInfo)}function get(id){return findFirst(function(cachedBlobInfo){return cachedBlobInfo.id()===id})}function findFirst(predicate){return Arr.filter(cache,predicate)[0]}function getByUri(blobUri){return findFirst(function(blobInfo){return blobInfo.blobUri()==blobUri})}function destroy(){Arr.each(cache,function(cachedBlobInfo){URL.revokeObjectURL(cachedBlobInfo.blobUri())}),cache=[]}var cache=[],constant=Fun.constant;return{create:create,add:add,get:get,getByUri:getByUri,findFirst:findFirst,destroy:destroy}}}),define("tinymce/EditorUpload",["tinymce/util/Arr","tinymce/file/Uploader","tinymce/file/ImageScanner","tinymce/file/BlobCache"],function(Arr,Uploader,ImageScanner,BlobCache){return function(editor){function aliveGuard(callback){return function(result){return editor.selection?callback(result):[]}}function replaceString(content,search,replace){var index=0;do index=content.indexOf(search,index),index!==-1&&(content=content.substring(0,index)+replace+content.substr(index+search.length),index+=replace.length-search.length+1);while(index!==-1);return content}function replaceImageUrl(content,targetUrl,replacementUrl){return content=replaceString(content,'src="'+targetUrl+'"','src="'+replacementUrl+'"'),content=replaceString(content,'data-mce-src="'+targetUrl+'"','data-mce-src="'+replacementUrl+'"')}function replaceUrlInUndoStack(targetUrl,replacementUrl){Arr.each(editor.undoManager.data,function(level){level.content=replaceImageUrl(level.content,targetUrl,replacementUrl)})}function openNotification(){return editor.notificationManager.open({text:editor.translate("Image uploading..."),type:"info",timeout:-1,progressBar:!0})}function uploadImages(callback){return uploader||(uploader=new Uploader({url:settings.images_upload_url,basePath:settings.images_upload_base_path,credentials:settings.images_upload_credentials,handler:settings.images_upload_handler})),scanForImages().then(aliveGuard(function(imageInfos){var blobInfos;return blobInfos=Arr.map(imageInfos,function(imageInfo){return imageInfo.blobInfo}),uploader.upload(blobInfos,openNotification).then(aliveGuard(function(result){return result=Arr.map(result,function(uploadInfo,index){var image=imageInfos[index].image;return uploadInfo.status&&(replaceUrlInUndoStack(image.src,uploadInfo.url),editor.$(image).attr({src:uploadInfo.url,"data-mce-src":editor.convertURL(uploadInfo.url,"src")})),{element:image,status:uploadInfo.status}}),callback&&callback(result),result}))}))}function uploadImagesAuto(callback){if(settings.automatic_uploads!==!1)return uploadImages(callback)}function scanForImages(){return imageScanner||(imageScanner=new ImageScanner(blobCache)),imageScanner.findAll(editor.getBody(),settings.images_dataimg_filter).then(aliveGuard(function(result){return Arr.each(result,function(resultItem){replaceUrlInUndoStack(resultItem.image.src,resultItem.blobInfo.blobUri()),resultItem.image.src=resultItem.blobInfo.blobUri()}),result}))}function destroy(){blobCache.destroy(),imageScanner=uploader=null}function replaceBlobWithBase64(content){return content.replace(/src="(blob:[^"]+)"/g,function(match,blobUri){var blobInfo=blobCache.getByUri(blobUri);return blobInfo||(blobInfo=Arr.reduce(editor.editorManager.editors,function(result,editor){return result||editor.editorUpload.blobCache.getByUri(blobUri)},null)),blobInfo?'src="data:'+blobInfo.blob().type+";base64,"+blobInfo.base64()+'"':match})}var uploader,imageScanner,blobCache=new BlobCache,settings=editor.settings;return editor.on("setContent",function(){editor.settings.automatic_uploads!==!1?uploadImagesAuto():scanForImages()}),editor.on("RawSaveContent",function(e){e.content=replaceBlobWithBase64(e.content)}),editor.on("getContent",function(e){e.source_view||"raw"==e.format||(e.content=replaceBlobWithBase64(e.content))}),{blobCache:blobCache,uploadImages:uploadImages,uploadImagesAuto:uploadImagesAuto,scanForImages:scanForImages,destroy:destroy}}}),define("tinymce/caret/FakeCaret",["tinymce/caret/CaretContainer","tinymce/caret/CaretPosition","tinymce/dom/NodeType","tinymce/dom/RangeUtils","tinymce/dom/DomQuery","tinymce/geom/ClientRect","tinymce/util/Delay"],function(CaretContainer,CaretPosition,NodeType,RangeUtils,$,ClientRect,Delay){var isContentEditableFalse=NodeType.isContentEditableFalse;return function(rootNode,isBlock){function getAbsoluteClientRect(node,before){var docElm,scrollX,scrollY,margin,rootRect,clientRect=ClientRect.collapse(node.getBoundingClientRect(),before);return"BODY"==rootNode.tagName?(docElm=rootNode.ownerDocument.documentElement,scrollX=rootNode.scrollLeft||docElm.scrollLeft,scrollY=rootNode.scrollTop||docElm.scrollTop):(rootRect=rootNode.getBoundingClientRect(),scrollX=rootNode.scrollLeft-rootRect.left,scrollY=rootNode.scrollTop-rootRect.top),clientRect.left+=scrollX,clientRect.right+=scrollX,clientRect.top+=scrollY,clientRect.bottom+=scrollY,clientRect.width=1,margin=node.offsetWidth-node.clientWidth,margin>0&&(before&&(margin*=-1),clientRect.left+=margin,clientRect.right+=margin),clientRect}function trimInlineCaretContainers(){var contentEditableFalseNodes,node,sibling,i,data;for(contentEditableFalseNodes=$("*[contentEditable=false]",rootNode),i=0;i<contentEditableFalseNodes.length;i++)node=contentEditableFalseNodes[i],sibling=node.previousSibling,CaretContainer.endsWithCaretContainer(sibling)&&(data=sibling.data,1==data.length?sibling.parentNode.removeChild(sibling):sibling.deleteData(data.length-1,1)),sibling=node.nextSibling,CaretContainer.startsWithCaretContainer(sibling)&&(data=sibling.data,1==data.length?sibling.parentNode.removeChild(sibling):sibling.deleteData(0,1));return null}function show(before,node){var clientRect,rng,container;return hide(),isBlock(node)?(caretContainerNode=CaretContainer.insertBlock("p",node,before),clientRect=getAbsoluteClientRect(node,before),$(caretContainerNode).css("top",clientRect.top),$lastVisualCaret=$('<div class="mce-visual-caret" data-mce-bogus="all"></div>').css(clientRect).appendTo(rootNode),before&&$lastVisualCaret.addClass("mce-visual-caret-before"),startBlink(),rng=node.ownerDocument.createRange(),container=caretContainerNode.firstChild,rng.setStart(container,0),rng.setEnd(container,1),rng):(caretContainerNode=CaretContainer.insertInline(node,before),rng=node.ownerDocument.createRange(),isContentEditableFalse(caretContainerNode.nextSibling)?(rng.setStart(caretContainerNode,0),rng.setEnd(caretContainerNode,0)):(rng.setStart(caretContainerNode,1),rng.setEnd(caretContainerNode,1)),rng)}function hide(){trimInlineCaretContainers(),caretContainerNode&&(CaretContainer.remove(caretContainerNode),caretContainerNode=null),$lastVisualCaret&&($lastVisualCaret.remove(),$lastVisualCaret=null),clearInterval(cursorInterval)}function startBlink(){cursorInterval=Delay.setInterval(function(){$("div.mce-visual-caret",rootNode).toggleClass("mce-visual-caret-hidden")},500)}function destroy(){Delay.clearInterval(cursorInterval)}function getCss(){return".mce-visual-caret {position: absolute;background-color: black;background-color: currentcolor;}.mce-visual-caret-hidden {display: none;}*[data-mce-caret] {position: absolute;left: -1000px;right: auto;top: 0;margin: 0;padding: 0;}"}var cursorInterval,$lastVisualCaret,caretContainerNode;return{show:show,hide:hide,getCss:getCss,destroy:destroy}}}),define("tinymce/dom/Dimensions",["tinymce/util/Arr","tinymce/dom/NodeType","tinymce/geom/ClientRect"],function(Arr,NodeType,ClientRect){function getClientRects(node){function toArrayWithNode(clientRects){return Arr.map(clientRects,function(clientRect){return clientRect=ClientRect.clone(clientRect),clientRect.node=node,clientRect})}if(Arr.isArray(node))return Arr.reduce(node,function(result,node){return result.concat(getClientRects(node))},[]);if(NodeType.isElement(node))return toArrayWithNode(node.getClientRects());if(NodeType.isText(node)){var rng=node.ownerDocument.createRange();return rng.setStart(node,0),rng.setEnd(node,node.data.length),
toArrayWithNode(rng.getClientRects())}}return{getClientRects:getClientRects}}),define("tinymce/caret/LineWalker",["tinymce/util/Fun","tinymce/util/Arr","tinymce/dom/Dimensions","tinymce/caret/CaretCandidate","tinymce/caret/CaretUtils","tinymce/caret/CaretWalker","tinymce/caret/CaretPosition","tinymce/geom/ClientRect"],function(Fun,Arr,Dimensions,CaretCandidate,CaretUtils,CaretWalker,CaretPosition,ClientRect){function findUntil(direction,rootNode,predicateFn,node){for(;node=CaretUtils.findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode);)if(predicateFn(node))return}function walkUntil(direction,isAboveFn,isBeflowFn,rootNode,predicateFn,caretPosition){function add(node){var i,clientRect,clientRects;for(clientRects=Dimensions.getClientRects(node),direction==-1&&(clientRects=clientRects.reverse()),i=0;i<clientRects.length;i++)if(clientRect=clientRects[i],!isBeflowFn(clientRect,targetClientRect)){if(result.length>0&&isAboveFn(clientRect,Arr.last(result))&&line++,clientRect.line=line,predicateFn(clientRect))return!0;result.push(clientRect)}}var node,targetClientRect,line=0,result=[];return(targetClientRect=Arr.last(caretPosition.getClientRects()))?(node=caretPosition.getNode(),add(node),findUntil(direction,rootNode,add,node),result):result}function aboveLineNumber(lineNumber,clientRect){return clientRect.line>lineNumber}function isLine(lineNumber,clientRect){return clientRect.line===lineNumber}function positionsUntil(direction,rootNode,predicateFn,node){function getClientRect(caretPosition){return 1==direction?Arr.last(caretPosition.getClientRects()):Arr.last(caretPosition.getClientRects())}var walkFn,isBelowFn,isAboveFn,caretPosition,clientRect,targetClientRect,caretWalker=new CaretWalker(rootNode),result=[],line=0;1==direction?(walkFn=caretWalker.next,isBelowFn=ClientRect.isBelow,isAboveFn=ClientRect.isAbove,caretPosition=CaretPosition.after(node)):(walkFn=caretWalker.prev,isBelowFn=ClientRect.isAbove,isAboveFn=ClientRect.isBelow,caretPosition=CaretPosition.before(node)),targetClientRect=getClientRect(caretPosition);do if(caretPosition.isVisible()&&(clientRect=getClientRect(caretPosition),!isAboveFn(clientRect,targetClientRect))){if(result.length>0&&isBelowFn(clientRect,Arr.last(result))&&line++,clientRect=ClientRect.clone(clientRect),clientRect.position=caretPosition,clientRect.line=line,predicateFn(clientRect))return result;result.push(clientRect)}while(caretPosition=walkFn(caretPosition));return result}var curry=Fun.curry,upUntil=curry(walkUntil,-1,ClientRect.isAbove,ClientRect.isBelow),downUntil=curry(walkUntil,1,ClientRect.isBelow,ClientRect.isAbove);return{upUntil:upUntil,downUntil:downUntil,positionsUntil:positionsUntil,isAboveLine:curry(aboveLineNumber),isLine:curry(isLine)}}),define("tinymce/caret/LineUtils",["tinymce/util/Fun","tinymce/util/Arr","tinymce/dom/NodeType","tinymce/dom/Dimensions","tinymce/geom/ClientRect","tinymce/caret/CaretUtils","tinymce/caret/CaretCandidate"],function(Fun,Arr,NodeType,Dimensions,ClientRect,CaretUtils,CaretCandidate){function distanceToRectLeft(clientRect,clientX){return Math.abs(clientRect.left-clientX)}function distanceToRectRight(clientRect,clientX){return Math.abs(clientRect.right-clientX)}function findClosestClientRect(clientRects,clientX){function isInside(clientX,clientRect){return clientX>=clientRect.left&&clientX<=clientRect.right}return Arr.reduce(clientRects,function(oldClientRect,clientRect){var oldDistance,newDistance;return oldDistance=Math.min(distanceToRectLeft(oldClientRect,clientX),distanceToRectRight(oldClientRect,clientX)),newDistance=Math.min(distanceToRectLeft(clientRect,clientX),distanceToRectRight(clientRect,clientX)),isInside(clientX,clientRect)?clientRect:isInside(clientX,oldClientRect)?oldClientRect:newDistance==oldDistance&&isContentEditableFalse(clientRect.node)?clientRect:newDistance<oldDistance?clientRect:oldClientRect})}function walkUntil(direction,rootNode,predicateFn,node){for(;node=findNode(node,direction,CaretCandidate.isEditableCaretCandidate,rootNode);)if(predicateFn(node))return}function findLineNodeRects(rootNode,targetNodeRect){function collect(checkPosFn,node){var lineRects;return lineRects=Arr.filter(Dimensions.getClientRects(node),function(clientRect){return!checkPosFn(clientRect,targetNodeRect)}),clientRects=clientRects.concat(lineRects),0===lineRects.length}var clientRects=[];return clientRects.push(targetNodeRect),walkUntil(-1,rootNode,curry(collect,ClientRect.isAbove),targetNodeRect.node),walkUntil(1,rootNode,curry(collect,ClientRect.isBelow),targetNodeRect.node),clientRects}function getContentEditableFalseChildren(rootNode){return Arr.filter(Arr.toArray(rootNode.getElementsByTagName("*")),isContentEditableFalse)}function caretInfo(clientRect,clientX){return{node:clientRect.node,before:distanceToRectLeft(clientRect,clientX)<distanceToRectRight(clientRect,clientX)}}function closestCaret(rootNode,clientX,clientY){var contentEditableFalseNodeRects,closestNodeRect;return contentEditableFalseNodeRects=Dimensions.getClientRects(getContentEditableFalseChildren(rootNode)),contentEditableFalseNodeRects=Arr.filter(contentEditableFalseNodeRects,function(clientRect){return clientY>=clientRect.top&&clientY<=clientRect.bottom}),closestNodeRect=findClosestClientRect(contentEditableFalseNodeRects,clientX),closestNodeRect&&(closestNodeRect=findClosestClientRect(findLineNodeRects(rootNode,closestNodeRect),clientX),closestNodeRect&&isContentEditableFalse(closestNodeRect.node))?caretInfo(closestNodeRect,clientX):null}var isContentEditableFalse=NodeType.isContentEditableFalse,findNode=CaretUtils.findNode,curry=Fun.curry;return{findClosestClientRect:findClosestClientRect,findLineNodeRects:findLineNodeRects,closestCaret:closestCaret}}),define("tinymce/DragDropOverrides",["tinymce/dom/NodeType","tinymce/util/Arr","tinymce/util/Fun"],function(NodeType,Arr,Fun){function init(editor){function isDraggable(elm){return isContentEditableFalse(elm)}function setBodyCursor(cursor){$(editor.getBody()).css("cursor",cursor)}function isValidDropTarget(elm){return elm!=state.element&&!editor.dom.isChildOf(elm,state.element)&&!isContentEditableFalse(elm)}function move(e){var deltaX,deltaY,pos,viewPort,movement,clientX,clientY,rootClientRect,overflowX=0,overflowY=0;0===e.button&&(deltaX=e.screenX-state.screenX,deltaY=e.screenY-state.screenY,movement=Math.max(Math.abs(deltaX),Math.abs(deltaY)),!state.dragging&&movement>10&&(state.dragging=!0,setBodyCursor("default"),state.clone=state.element.cloneNode(!0),pos=dom.getPos(state.element),state.relX=state.clientX-pos.x,state.relY=state.clientY-pos.y,state.width=state.element.offsetWidth,state.height=state.element.offsetHeight,$(state.clone).css({width:state.width,height:state.height}).removeAttr("data-mce-selected"),state.ghost=$("<div>").css({position:"absolute",opacity:.5,overflow:"hidden",width:state.width,height:state.height}).attr({"data-mce-bogus":"all",unselectable:"on",contenteditable:"false"}).addClass("mce-drag-container mce-reset").append(state.clone).appendTo(editor.getBody())[0],viewPort=editor.dom.getViewPort(editor.getWin()),state.maxX=viewPort.w,state.maxY=viewPort.h),state.dragging&&(editor.selection.placeCaretAt(e.clientX,e.clientY),clientX=state.clientX+deltaX-state.relX,clientY=state.clientY+deltaY+5,clientX+state.width>state.maxX&&(overflowX=clientX+state.width-state.maxX),clientY+state.height>state.maxY&&(overflowY=clientY+state.height-state.maxY),rootClientRect="BODY"!=editor.getBody().nodeName?editor.getBody().getBoundingClientRect():{left:0,top:0},$(state.ghost).css({left:clientX-rootClientRect.left,top:clientY-rootClientRect.top,width:state.width-overflowX,height:state.height-overflowY})))}function drop(){var evt;if(state.dragging&&(editor.selection.setRng(editor.selection.getSel().getRangeAt(0)),isValidDropTarget(editor.selection.getNode()))){var targetClone=state.element;if(evt=editor.fire("drop",{targetClone:targetClone}),evt.isDefaultPrevented())return;targetClone=evt.targetClone,editor.undoManager.transact(function(){editor.insertContent(dom.getOuterHTML(targetClone)),$(state.element).remove()})}stop()}function start(e){var ceElm,evt;if(stop(),0===e.button&&(ceElm=Arr.find(editor.dom.getParents(e.target),Fun.or(isContentEditableFalse,isContentEditableTrue)),isDraggable(ceElm))){if(evt=editor.fire("dragstart",{target:ceElm}),evt.isDefaultPrevented())return;editor.on("mousemove",move),editor.on("mouseup",drop),rootDocument!=editableDoc&&(dom.bind(rootDocument,"mousemove",move),dom.bind(rootDocument,"mouseup",drop)),state={screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY,element:ceElm}}}function stop(){$(state.ghost).remove(),setBodyCursor(null),editor.off("mousemove",move),editor.off("mouseup",stop),rootDocument!=editableDoc&&(dom.unbind(rootDocument,"mousemove",move),dom.unbind(rootDocument,"mouseup",stop)),state={}}var $=editor.$,rootDocument=document,editableDoc=editor.getDoc(),dom=editor.dom,state={};editor.on("mousedown",start),editor.on("drop",function(e){var realTarget=editor.getDoc().elementFromPoint(e.clientX,e.clientY);(isContentEditableFalse(realTarget)||isContentEditableFalse(editor.dom.getContentEditableParent(realTarget)))&&e.preventDefault()})}var isContentEditableFalse=NodeType.isContentEditableFalse,isContentEditableTrue=NodeType.isContentEditableTrue;return{init:init}}),define("tinymce/SelectionOverrides",["tinymce/Env","tinymce/caret/CaretWalker","tinymce/caret/CaretPosition","tinymce/caret/CaretContainer","tinymce/caret/CaretUtils","tinymce/caret/FakeCaret","tinymce/caret/LineWalker","tinymce/caret/LineUtils","tinymce/dom/NodeType","tinymce/dom/RangeUtils","tinymce/geom/ClientRect","tinymce/util/VK","tinymce/util/Fun","tinymce/util/Arr","tinymce/util/Delay","tinymce/DragDropOverrides","tinymce/text/Zwsp"],function(Env,CaretWalker,CaretPosition,CaretContainer,CaretUtils,FakeCaret,LineWalker,LineUtils,NodeType,RangeUtils,ClientRect,VK,Fun,Arr,Delay,DragDropOverrides,Zwsp){function getVisualCaretPosition(walkFn,caretPosition){for(;caretPosition=walkFn(caretPosition);)if(caretPosition.isVisible())return caretPosition;return caretPosition}function SelectionOverrides(editor){function isBlock(node){return editor.dom.isBlock(node)}function setRange(range){range&&editor.selection.setRng(range)}function getRange(){return editor.selection.getRng()}function scrollIntoView(node,alignToTop){editor.selection.scrollIntoView(node,alignToTop)}function showCaret(direction,node,before){var e;return e=editor.fire("ShowCaret",{target:node,direction:direction,before:before}),e.isDefaultPrevented()?null:(scrollIntoView(node,direction===-1),fakeCaret.show(before,node))}function selectNode(node){var e;return fakeCaret.hide(),e=editor.fire("BeforeObjectSelected",{target:node}),e.isDefaultPrevented()?null:getNodeRange(node)}function getNodeRange(node){var rng=node.ownerDocument.createRange();return rng.selectNode(node),rng}function isMoveInsideSameBlock(fromCaretPosition,toCaretPosition){var inSameBlock=CaretUtils.isInSameBlock(fromCaretPosition,toCaretPosition);return!(inSameBlock||!NodeType.isBr(fromCaretPosition.getNode()))||inSameBlock}function getNormalizedRangeEndPoint(direction,range){return range=CaretUtils.normalizeRange(direction,rootNode,range),direction==-1?CaretPosition.fromRangeStart(range):CaretPosition.fromRangeEnd(range)}function isRangeInCaretContainerBlock(range){return CaretContainer.isCaretContainerBlock(range.startContainer)}function moveToCeFalseHorizontally(direction,getNextPosFn,isBeforeContentEditableFalseFn,range){var node,caretPosition,peekCaretPosition,rangeIsInContainerBlock;return!range.collapsed&&(node=getSelectedNode(range),isContentEditableFalse(node))?showCaret(direction,node,direction==-1):(rangeIsInContainerBlock=isRangeInCaretContainerBlock(range),caretPosition=getNormalizedRangeEndPoint(direction,range),isBeforeContentEditableFalseFn(caretPosition)?selectNode(caretPosition.getNode(direction==-1)):(caretPosition=getNextPosFn(caretPosition))?isBeforeContentEditableFalseFn(caretPosition)?showCaret(direction,caretPosition.getNode(direction==-1),1==direction):(peekCaretPosition=getNextPosFn(caretPosition),isBeforeContentEditableFalseFn(peekCaretPosition)&&isMoveInsideSameBlock(caretPosition,peekCaretPosition)?showCaret(direction,peekCaretPosition.getNode(direction==-1),1==direction):rangeIsInContainerBlock?renderRangeCaret(caretPosition.toRange()):null):rangeIsInContainerBlock?range:null)}function moveToCeFalseVertically(direction,walkerFn,range){var caretPosition,linePositions,nextLinePositions,closestNextLineRect,caretClientRect,clientX,dist1,dist2,contentEditableFalseNode;if(contentEditableFalseNode=getSelectedNode(range),caretPosition=getNormalizedRangeEndPoint(direction,range),linePositions=walkerFn(rootNode,LineWalker.isAboveLine(1),caretPosition),nextLinePositions=Arr.filter(linePositions,LineWalker.isLine(1)),caretClientRect=Arr.last(caretPosition.getClientRects()),isBeforeContentEditableFalse(caretPosition)&&(contentEditableFalseNode=caretPosition.getNode()),isAfterContentEditableFalse(caretPosition)&&(contentEditableFalseNode=caretPosition.getNode(!0)),!caretClientRect)return null;if(clientX=caretClientRect.left,closestNextLineRect=LineUtils.findClosestClientRect(nextLinePositions,clientX),closestNextLineRect&&isContentEditableFalse(closestNextLineRect.node))return dist1=Math.abs(clientX-closestNextLineRect.left),dist2=Math.abs(clientX-closestNextLineRect.right),showCaret(direction,closestNextLineRect.node,dist1<dist2);if(contentEditableFalseNode){var caretPositions=LineWalker.positionsUntil(direction,rootNode,LineWalker.isAboveLine(1),contentEditableFalseNode);if(closestNextLineRect=LineUtils.findClosestClientRect(Arr.filter(caretPositions,LineWalker.isLine(1)),clientX))return renderRangeCaret(closestNextLineRect.position.toRange());if(closestNextLineRect=Arr.last(Arr.filter(caretPositions,LineWalker.isLine(0))))return renderRangeCaret(closestNextLineRect.position.toRange())}}function exitPreBlock(direction,range){function createTextBlock(){var textBlock=editor.dom.create(editor.settings.forced_root_block);return(!Env.ie||Env.ie>=11)&&(textBlock.innerHTML='<br data-mce-bogus="1">'),textBlock}var pre,caretPos,newBlock;if(range.collapsed&&editor.settings.forced_root_block){if(pre=editor.dom.getParent(range.startContainer,"PRE"),!pre)return;caretPos=1==direction?getNextVisualCaretPosition(CaretPosition.fromRangeStart(range)):getPrevVisualCaretPosition(CaretPosition.fromRangeStart(range)),caretPos||(newBlock=createTextBlock(),1==direction?editor.$(pre).after(newBlock):editor.$(pre).before(newBlock),editor.selection.select(newBlock,!0),editor.selection.collapse())}}function moveH(direction,getNextPosFn,isBeforeContentEditableFalseFn,range){var newRange;return(newRange=moveToCeFalseHorizontally(direction,getNextPosFn,isBeforeContentEditableFalseFn,range))?newRange:(newRange=exitPreBlock(direction,range),newRange?newRange:null)}function moveV(direction,walkerFn,range){var newRange;return(newRange=moveToCeFalseVertically(direction,walkerFn,range))?newRange:(newRange=exitPreBlock(direction,range),newRange?newRange:null)}function getBlockCaretContainer(){return $("*[data-mce-caret]")[0]}function showBlockCaretContainer(blockCaretContainer){blockCaretContainer=$(blockCaretContainer),blockCaretContainer.attr("data-mce-caret")&&(fakeCaret.hide(),blockCaretContainer.removeAttr("data-mce-caret"),blockCaretContainer.removeAttr("data-mce-bogus"),blockCaretContainer.removeAttr("style"),setRange(getRange()),scrollIntoView(blockCaretContainer[0]))}function renderCaretAtRange(range){var caretPosition,ceRoot;return range=CaretUtils.normalizeRange(1,rootNode,range),caretPosition=CaretPosition.fromRangeStart(range),isContentEditableFalse(caretPosition.getNode())?showCaret(1,caretPosition.getNode(),!caretPosition.isAtEnd()):isContentEditableFalse(caretPosition.getNode(!0))?showCaret(1,caretPosition.getNode(!0),!1):(ceRoot=editor.dom.getParent(caretPosition.getNode(),Fun.or(isContentEditableFalse,isContentEditableTrue)),isContentEditableFalse(ceRoot)?showCaret(1,ceRoot,!1):(fakeCaret.hide(),null))}function renderRangeCaret(range){var caretRange;return range&&range.collapsed?(caretRange=renderCaretAtRange(range),caretRange?caretRange:range):range}function deleteContentEditableNode(node){var nextCaretPosition,prevCaretPosition,prevCeFalseElm,nextElement;return isContentEditableFalse(node)?(isContentEditableFalse(node.previousSibling)&&(prevCeFalseElm=node.previousSibling),prevCaretPosition=getPrevVisualCaretPosition(CaretPosition.before(node)),prevCaretPosition||(nextCaretPosition=getNextVisualCaretPosition(CaretPosition.after(node))),nextCaretPosition&&isElement(nextCaretPosition.getNode())&&(nextElement=nextCaretPosition.getNode()),CaretContainer.remove(node.previousSibling),CaretContainer.remove(node.nextSibling),editor.dom.remove(node),clearContentEditableSelection(),editor.dom.isEmpty(editor.getBody())?(editor.setContent(""),void editor.focus()):prevCeFalseElm?CaretPosition.after(prevCeFalseElm).toRange():nextElement?CaretPosition.before(nextElement).toRange():prevCaretPosition?prevCaretPosition.toRange():nextCaretPosition?nextCaretPosition.toRange():null):null}function mergeTextBlocks(direction,fromCaretPosition,toCaretPosition){var fromBlock,toBlock,node,textBlocks,dom=editor.dom;if(direction===-1){if(isAfterContentEditableFalse(toCaretPosition)&&isBlock(toCaretPosition.getNode(!0)))return deleteContentEditableNode(toCaretPosition.getNode(!0))}else if(isBeforeContentEditableFalse(fromCaretPosition)&&isBlock(fromCaretPosition.getNode()))return deleteContentEditableNode(fromCaretPosition.getNode());if(textBlocks=editor.schema.getTextBlockElements(),fromBlock=dom.getParent(fromCaretPosition.getNode(),dom.isBlock),toBlock=dom.getParent(toCaretPosition.getNode(),dom.isBlock),fromBlock===toBlock||!textBlocks[fromBlock.nodeName]||!textBlocks[toBlock.nodeName])return null;for(;node=fromBlock.firstChild;)toBlock.appendChild(node);return editor.dom.remove(fromBlock),toCaretPosition.toRange()}function backspaceDelete(direction,beforeFn,range){var node,caretPosition,peekCaretPosition;return!range.collapsed&&(node=getSelectedNode(range),isContentEditableFalse(node))?renderRangeCaret(deleteContentEditableNode(node)):(caretPosition=getNormalizedRangeEndPoint(direction,range),beforeFn(caretPosition)?renderRangeCaret(deleteContentEditableNode(caretPosition.getNode(direction==-1))):(peekCaretPosition=direction==-1?caretWalker.prev(caretPosition):caretWalker.next(caretPosition),beforeFn(peekCaretPosition)?direction===-1?mergeTextBlocks(direction,caretPosition,peekCaretPosition):mergeTextBlocks(direction,peekCaretPosition,caretPosition):void 0))}function registerEvents(){function override(evt,moveFn){var range=moveFn(getRange());range&&!evt.isDefaultPrevented()&&(evt.preventDefault(),setRange(range))}function getContentEditableRoot(node){for(var root=editor.getBody();node&&node!=root;){if(isContentEditableTrue(node)||isContentEditableFalse(node))return node;node=node.parentNode}return null}function isXYWithinRange(clientX,clientY,range){return!range.collapsed&&Arr.reduce(range.getClientRects(),function(state,rect){return state||ClientRect.containsXY(rect,clientX,clientY)},!1)}function paddEmptyContentEditableArea(){var br,ceRoot=getContentEditableRoot(editor.selection.getNode());isContentEditableTrue(ceRoot)&&isBlock(ceRoot)&&editor.dom.isEmpty(ceRoot)&&(br=editor.dom.create("br",{"data-mce-bogus":"1"}),editor.$(ceRoot).empty().append(br),editor.selection.setRng(CaretPosition.before(br).toRange()))}function handleBlockContainer(e){var blockCaretContainer=getBlockCaretContainer();if(blockCaretContainer)return"compositionstart"==e.type?(e.preventDefault(),e.stopPropagation(),void showBlockCaretContainer(blockCaretContainer)):void("&nbsp;"!=blockCaretContainer.innerHTML&&showBlockCaretContainer(blockCaretContainer))}function handleEmptyBackspaceDelete(e){var prevent;switch(e.keyCode){case VK.DELETE:prevent=paddEmptyContentEditableArea();break;case VK.BACKSPACE:prevent=paddEmptyContentEditableArea()}prevent&&e.preventDefault()}var right=curry(moveH,1,getNextVisualCaretPosition,isBeforeContentEditableFalse),left=curry(moveH,-1,getPrevVisualCaretPosition,isAfterContentEditableFalse),deleteForward=curry(backspaceDelete,1,isBeforeContentEditableFalse),backspace=curry(backspaceDelete,-1,isAfterContentEditableFalse),up=curry(moveV,-1,LineWalker.upUntil),down=curry(moveV,1,LineWalker.downUntil);editor.on("mouseup",function(){var range=getRange();range.collapsed&&setRange(renderCaretAtRange(range))}),editor.on("click",function(e){var contentEditableRoot;contentEditableRoot=getContentEditableRoot(e.target),contentEditableRoot&&isContentEditableFalse(contentEditableRoot)&&e.preventDefault()}),editor.on("mousedown",function(e){var contentEditableRoot;if(contentEditableRoot=getContentEditableRoot(e.target))isContentEditableFalse(contentEditableRoot)?(e.preventDefault(),setContentEditableSelection(selectNode(contentEditableRoot))):(clearContentEditableSelection(),isXYWithinRange(e.clientX,e.clientY,editor.selection.getRng())||editor.selection.placeCaretAt(e.clientX,e.clientY));else{clearContentEditableSelection(),fakeCaret.hide();var caretInfo=LineUtils.closestCaret(rootNode,e.clientX,e.clientY);caretInfo&&(e.preventDefault(),editor.getBody().focus(),setRange(showCaret(1,caretInfo.node,caretInfo.before)))}}),editor.on("keydown",function(e){if(!VK.modifierPressed(e))switch(e.keyCode){case VK.RIGHT:override(e,right);break;case VK.DOWN:override(e,down);break;case VK.LEFT:override(e,left);break;case VK.UP:override(e,up);break;case VK.DELETE:override(e,deleteForward);break;case VK.BACKSPACE:override(e,backspace);break;default:isContentEditableFalse(editor.selection.getNode())&&e.preventDefault()}}),editor.on("keyup compositionstart",function(e){handleBlockContainer(e),handleEmptyBackspaceDelete(e)},!0),editor.on("cut",function(){var node=editor.selection.getNode();isContentEditableFalse(node)&&Delay.setEditorTimeout(editor,function(){setRange(renderRangeCaret(deleteContentEditableNode(node)))})}),editor.on("getSelectionRange",function(e){var rng=e.range;if(selectedContentEditableNode){if(!selectedContentEditableNode.parentNode)return void(selectedContentEditableNode=null);rng=rng.cloneRange(),rng.selectNode(selectedContentEditableNode),e.range=rng}}),editor.on("setSelectionRange",function(e){var rng;rng=setContentEditableSelection(e.range),rng&&(e.range=rng)}),editor.on("focus",function(){Delay.setEditorTimeout(editor,function(){editor.selection.setRng(renderRangeCaret(editor.selection.getRng()))},0)}),DragDropOverrides.init(editor)}function addCss(){var styles=editor.contentStyles,rootClass=".mce-content-body";styles.push(fakeCaret.getCss()),styles.push(rootClass+" .mce-offscreen-selection {position: absolute;left: -9999999999px;width: 100px;height: 100px;}"+rootClass+" *[contentEditable=false] {cursor: default;}"+rootClass+" *[contentEditable=true] {cursor: text;}")}function isRangeInCaretContainer(rng){return CaretContainer.isCaretContainer(rng.startContainer)||CaretContainer.isCaretContainer(rng.endContainer)}function setContentEditableSelection(range){var node,$realSelectionContainer,sel,startContainer,startOffset,endOffset,e,caretPosition,targetClone,origTargetClone,$=editor.$,dom=editor.dom;if(!range)return clearContentEditableSelection(),null;if(range.collapsed){if(clearContentEditableSelection(),!isRangeInCaretContainer(range)){if(caretPosition=getNormalizedRangeEndPoint(1,range),isContentEditableFalse(caretPosition.getNode()))return showCaret(1,caretPosition.getNode(),!caretPosition.isAtEnd());if(isContentEditableFalse(caretPosition.getNode(!0)))return showCaret(1,caretPosition.getNode(!0),!1)}return null}return startContainer=range.startContainer,startOffset=range.startOffset,endOffset=range.endOffset,3==startContainer.nodeType&&0==startOffset&&isContentEditableFalse(startContainer.parentNode)&&(startContainer=startContainer.parentNode,startOffset=dom.nodeIndex(startContainer),startContainer=startContainer.parentNode),1!=startContainer.nodeType?(clearContentEditableSelection(),null):(endOffset==startOffset+1&&(node=startContainer.childNodes[startOffset]),isContentEditableFalse(node)?(targetClone=origTargetClone=node.cloneNode(!0),e=editor.fire("ObjectSelected",{target:node,targetClone:targetClone}),e.isDefaultPrevented()?(clearContentEditableSelection(),null):(targetClone=e.targetClone,$realSelectionContainer=$("#"+realSelectionId),0===$realSelectionContainer.length&&($realSelectionContainer=$('<div data-mce-bogus="all" class="mce-offscreen-selection"></div>').attr("id",realSelectionId),$realSelectionContainer.appendTo(editor.getBody())),range=editor.dom.createRng(),targetClone===origTargetClone&&Env.ie?($realSelectionContainer.empty().append(Zwsp.ZWSP).append(targetClone).append(Zwsp.ZWSP),range.setStart($realSelectionContainer[0].firstChild,0),range.setEnd($realSelectionContainer[0].lastChild,1)):($realSelectionContainer.empty().append("").append(targetClone).append(""),range.setStart($realSelectionContainer[0].firstChild,1),range.setEnd($realSelectionContainer[0].lastChild,0)),$realSelectionContainer.css({top:dom.getPos(node,editor.getBody()).y}),editor.getBody().focus(),$realSelectionContainer[0].focus(),sel=editor.selection.getSel(),sel.removeAllRanges(),sel.addRange(range),editor.$("*[data-mce-selected]").removeAttr("data-mce-selected"),node.setAttribute("data-mce-selected",1),selectedContentEditableNode=node,range)):(clearContentEditableSelection(),null))}function clearContentEditableSelection(){selectedContentEditableNode&&(selectedContentEditableNode.removeAttribute("data-mce-selected"),editor.$("#"+realSelectionId).remove(),selectedContentEditableNode=null)}function destroy(){fakeCaret.destroy(),selectedContentEditableNode=null}var selectedContentEditableNode,rootNode=editor.getBody(),caretWalker=new CaretWalker(rootNode),getNextVisualCaretPosition=curry(getVisualCaretPosition,caretWalker.next),getPrevVisualCaretPosition=curry(getVisualCaretPosition,caretWalker.prev),fakeCaret=new FakeCaret(editor.getBody(),isBlock),realSelectionId="sel-"+editor.dom.uniqueId(),$=editor.$;return Env.ceFalse&&(registerEvents(),addCss()),{showBlockCaretContainer:showBlockCaretContainer,destroy:destroy}}var curry=Fun.curry,isContentEditableTrue=NodeType.isContentEditableTrue,isContentEditableFalse=NodeType.isContentEditableFalse,isElement=NodeType.isElement,isAfterContentEditableFalse=CaretUtils.isAfterContentEditableFalse,isBeforeContentEditableFalse=CaretUtils.isBeforeContentEditableFalse,getSelectedNode=RangeUtils.getSelectedNode;return SelectionOverrides}),define("tinymce/Editor",["tinymce/dom/DOMUtils","tinymce/dom/DomQuery","tinymce/AddOnManager","tinymce/NodeChange","tinymce/html/Node","tinymce/dom/Serializer","tinymce/html/Serializer","tinymce/dom/Selection","tinymce/Formatter","tinymce/UndoManager","tinymce/EnterKey","tinymce/ForceBlocks","tinymce/EditorCommands","tinymce/util/URI","tinymce/dom/ScriptLoader","tinymce/dom/EventUtils","tinymce/WindowManager","tinymce/NotificationManager","tinymce/html/Schema","tinymce/html/DomParser","tinymce/util/Quirks","tinymce/Env","tinymce/util/Tools","tinymce/util/Delay","tinymce/EditorObservable","tinymce/Mode","tinymce/Shortcuts","tinymce/EditorUpload","tinymce/SelectionOverrides"],function(DOMUtils,DomQuery,AddOnManager,NodeChange,Node,DomSerializer,Serializer,Selection,Formatter,UndoManager,EnterKey,ForceBlocks,EditorCommands,URI,ScriptLoader,EventUtils,WindowManager,NotificationManager,Schema,DomParser,Quirks,Env,Tools,Delay,EditorObservable,Mode,Shortcuts,EditorUpload,SelectionOverrides){function Editor(id,settings,editorManager){var documentBaseUrl,baseUri,defaultSettings,self=this;documentBaseUrl=self.documentBaseUrl=editorManager.documentBaseURL,baseUri=editorManager.baseURI,defaultSettings=editorManager.defaultSettings,settings=extend({id:id,theme:"modern",delta_width:0,delta_height:0,popup_css:"",plugins:"",document_base_url:documentBaseUrl,add_form_submit_trigger:!0,submit_patch:!0,add_unload_trigger:!0,convert_urls:!0,relative_urls:!0,remove_script_host:!0,object_resizing:!0,doctype:"<!DOCTYPE html>",visual:!0,font_size_style_values:"xx-small,x-small,small,medium,large,x-large,xx-large",font_size_legacy_values:"xx-small,small,medium,large,x-large,xx-large,300%",forced_root_block:"p",hidden_input:!0,padd_empty_editor:!0,render_ui:!0,indentation:"30px",inline_styles:!0,convert_fonts_to_spans:!0,indent:"simple",indent_before:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",indent_after:"p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,tfoot,tbody,tr,section,article,hgroup,aside,figure,figcaption,option,optgroup,datalist",validate:!0,entity_encoding:"named",url_converter:self.convertURL,url_converter_scope:self,ie7_compat:!0},defaultSettings,settings),defaultSettings&&defaultSettings.external_plugins&&settings.external_plugins&&(settings.external_plugins=extend({},defaultSettings.external_plugins,settings.external_plugins)),self.settings=settings,AddOnManager.language=settings.language||"en",AddOnManager.languageLoad=settings.language_load,AddOnManager.baseURL=editorManager.baseURL,self.id=settings.id=id,self.setDirty(!1),self.plugins={},self.documentBaseURI=new URI(settings.document_base_url||documentBaseUrl,{base_uri:baseUri}),self.baseURI=baseUri,self.contentCSS=[],self.contentStyles=[],self.shortcuts=new Shortcuts(self),self.loadedCSS={},self.editorCommands=new EditorCommands(self),settings.target&&(self.targetElm=settings.target),self.suffix=editorManager.suffix,self.editorManager=editorManager,self.inline=settings.inline,settings.cache_suffix&&(Env.cacheSuffix=settings.cache_suffix.replace(/^[\?\&]+/,"")),settings.override_viewport===!1&&(Env.overrideViewPort=!1),editorManager.fire("SetupEditor",self),self.execCallback("setup",self),self.$=DomQuery.overrideDefaults(function(){return{context:self.inline?self.getBody():self.getDoc(),element:self.getBody()}})}var DOM=DOMUtils.DOM,ThemeManager=AddOnManager.ThemeManager,PluginManager=AddOnManager.PluginManager,extend=Tools.extend,each=Tools.each,explode=Tools.explode,inArray=Tools.inArray,trim=Tools.trim,resolve=Tools.resolve,Event=EventUtils.Event,isGecko=Env.gecko,ie=Env.ie;return Editor.prototype={render:function(){function readyHandler(){DOM.unbind(window,"ready",readyHandler),self.render()}function loadScripts(){var scriptLoader=ScriptLoader.ScriptLoader;if(settings.language&&"en"!=settings.language&&!settings.language_url&&(settings.language_url=self.editorManager.baseURL+"/langs/"+settings.language+".js"),settings.language_url&&scriptLoader.add(settings.language_url),settings.theme&&"function"!=typeof settings.theme&&"-"!=settings.theme.charAt(0)&&!ThemeManager.urls[settings.theme]){var themeUrl=settings.theme_url;themeUrl=themeUrl?self.documentBaseURI.toAbsolute(themeUrl):"themes/"+settings.theme+"/theme"+suffix+".js",ThemeManager.load(settings.theme,themeUrl)}Tools.isArray(settings.plugins)&&(settings.plugins=settings.plugins.join(" ")),each(settings.external_plugins,function(url,name){PluginManager.load(name,url),settings.plugins+=" "+name}),each(settings.plugins.split(/[ ,]/),function(plugin){if(plugin=trim(plugin),plugin&&!PluginManager.urls[plugin])if("-"==plugin.charAt(0)){plugin=plugin.substr(1,plugin.length);var dependencies=PluginManager.dependencies(plugin);each(dependencies,function(dep){var defaultSettings={prefix:"plugins/",resource:dep,suffix:"/plugin"+suffix+".js"};dep=PluginManager.createUrl(defaultSettings,dep),PluginManager.load(dep.resource,dep)})}else PluginManager.load(plugin,{prefix:"plugins/",resource:plugin,suffix:"/plugin"+suffix+".js"})}),scriptLoader.loadQueue(function(){self.removed||self.init()})}var self=this,settings=self.settings,id=self.id,suffix=self.suffix;if(!Event.domLoaded)return void DOM.bind(window,"ready",readyHandler);
if(self.getElement()&&Env.contentEditable){settings.inline?self.inline=!0:(self.orgVisibility=self.getElement().style.visibility,self.getElement().style.visibility="hidden");var form=self.getElement().form||DOM.getParent(id,"form");form&&(self.formElement=form,settings.hidden_input&&!/TEXTAREA|INPUT/i.test(self.getElement().nodeName)&&(DOM.insertAfter(DOM.create("input",{type:"hidden",name:id}),id),self.hasHiddenInput=!0),self.formEventDelegate=function(e){self.fire(e.type,e)},DOM.bind(form,"submit reset",self.formEventDelegate),self.on("reset",function(){self.setContent(self.startContent,{format:"raw"})}),!settings.submit_patch||form.submit.nodeType||form.submit.length||form._mceOldSubmit||(form._mceOldSubmit=form.submit,form.submit=function(){return self.editorManager.triggerSave(),self.setDirty(!1),form._mceOldSubmit(form)})),self.windowManager=new WindowManager(self),self.notificationManager=new NotificationManager(self),"xml"==settings.encoding&&self.on("GetContent",function(e){e.save&&(e.content=DOM.encode(e.content))}),settings.add_form_submit_trigger&&self.on("submit",function(){self.initialized&&self.save()}),settings.add_unload_trigger&&(self._beforeUnload=function(){!self.initialized||self.destroyed||self.isHidden()||self.save({format:"raw",no_events:!0,set_dirty:!1})},self.editorManager.on("BeforeUnload",self._beforeUnload)),loadScripts()}},init:function(){function initPlugin(plugin){var pluginUrl,pluginInstance,Plugin=PluginManager.get(plugin);if(pluginUrl=PluginManager.urls[plugin]||self.documentBaseUrl.replace(/\/$/,""),plugin=trim(plugin),Plugin&&inArray(initializedPlugins,plugin)===-1){if(each(PluginManager.dependencies(plugin),function(dep){initPlugin(dep)}),self.plugins[plugin])return;pluginInstance=new Plugin(self,pluginUrl,self.$),self.plugins[plugin]=pluginInstance,pluginInstance.init&&(pluginInstance.init(self,pluginUrl),initializedPlugins.push(plugin))}}var w,h,minHeight,n,o,Theme,url,bodyId,bodyClass,re,i,self=this,settings=self.settings,elm=self.getElement(),initializedPlugins=[];if(this.editorManager.i18n.setCode(settings.language),self.rtl=settings.rtl_ui||this.editorManager.i18n.rtl,self.editorManager.add(self),settings.aria_label=settings.aria_label||DOM.getAttrib(elm,"aria-label",self.getLang("aria.rich_text_area")),settings.theme&&("function"!=typeof settings.theme?(settings.theme=settings.theme.replace(/-/,""),Theme=ThemeManager.get(settings.theme),self.theme=new Theme(self,ThemeManager.urls[settings.theme]),self.theme.init&&self.theme.init(self,ThemeManager.urls[settings.theme]||self.documentBaseUrl.replace(/\/$/,""),self.$)):self.theme=settings.theme),each(settings.plugins.replace(/\-/g,"").split(/[ ,]/),initPlugin),settings.render_ui&&self.theme&&(self.orgDisplay=elm.style.display,"function"!=typeof settings.theme?(w=settings.width||elm.style.width||elm.offsetWidth,h=settings.height||elm.style.height||elm.offsetHeight,minHeight=settings.min_height||100,re=/^[0-9\.]+(|px)$/i,re.test(""+w)&&(w=Math.max(parseInt(w,10),100)),re.test(""+h)&&(h=Math.max(parseInt(h,10),minHeight)),o=self.theme.renderUI({targetNode:elm,width:w,height:h,deltaWidth:settings.delta_width,deltaHeight:settings.delta_height}),settings.content_editable||(h=(o.iframeHeight||h)+("number"==typeof h?o.deltaHeight||0:""),h<minHeight&&(h=minHeight))):(o=settings.theme(self,elm),o.editorContainer.nodeType&&(o.editorContainer=o.editorContainer.id=o.editorContainer.id||self.id+"_parent"),o.iframeContainer.nodeType&&(o.iframeContainer=o.iframeContainer.id=o.iframeContainer.id||self.id+"_iframecontainer"),h=o.iframeHeight||elm.offsetHeight),self.editorContainer=o.editorContainer),settings.content_css&&each(explode(settings.content_css),function(u){self.contentCSS.push(self.documentBaseURI.toAbsolute(u))}),settings.content_style&&self.contentStyles.push(settings.content_style),settings.content_editable)return elm=n=o=null,self.initContentBody();if(self.iframeHTML=settings.doctype+"<html><head>",settings.document_base_url!=self.documentBaseUrl&&(self.iframeHTML+='<base href="'+self.documentBaseURI.getURI()+'" />'),!Env.caretAfter&&settings.ie7_compat&&(self.iframeHTML+='<meta http-equiv="X-UA-Compatible" content="IE=7" />'),self.iframeHTML+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />',!/#$/.test(document.location.href))for(i=0;i<self.contentCSS.length;i++){var cssUrl=self.contentCSS[i];self.iframeHTML+='<link type="text/css" rel="stylesheet" href="'+Tools._addCacheSuffix(cssUrl)+'" />',self.loadedCSS[cssUrl]=!0}bodyId=settings.body_id||"tinymce",bodyId.indexOf("=")!=-1&&(bodyId=self.getParam("body_id","","hash"),bodyId=bodyId[self.id]||bodyId),bodyClass=settings.body_class||"",bodyClass.indexOf("=")!=-1&&(bodyClass=self.getParam("body_class","","hash"),bodyClass=bodyClass[self.id]||""),settings.content_security_policy&&(self.iframeHTML+='<meta http-equiv="Content-Security-Policy" content="'+settings.content_security_policy+'" />'),self.iframeHTML+='</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'" data-id="'+self.id+'"><br></body></html>';var domainRelaxUrl='javascript:(function(){document.open();document.domain="'+document.domain+'";var ed = window.parent.tinymce.get("'+self.id+'");document.write(ed.iframeHTML);document.close();ed.initContentBody(true);})()';document.domain!=location.hostname&&Env.ie&&Env.ie<12&&(url=domainRelaxUrl);var ifr=DOM.create("iframe",{id:self.id+"_ifr",frameBorder:"0",allowTransparency:"true",title:self.editorManager.translate("Rich Text Area. Press ALT-F9 for menu. Press ALT-F10 for toolbar. Press ALT-0 for help"),style:{width:"100%",height:h,display:"block"}});if(ifr.onload=function(){ifr.onload=null,self.fire("load")},DOM.setAttrib(ifr,"src",url||'javascript:""'),self.contentAreaContainer=o.iframeContainer,self.iframeElement=ifr,n=DOM.add(o.iframeContainer,ifr),ie)try{self.getDoc()}catch(e){n.src=url=domainRelaxUrl}o.editorContainer&&(DOM.get(o.editorContainer).style.display=self.orgDisplay,self.hidden=DOM.isHidden(o.editorContainer)),self.getElement().style.display="none",DOM.setAttrib(self.id,"aria-hidden",!0),url||self.initContentBody(),elm=n=o=null},initContentBody:function(skipWrite){var body,contentCssText,self=this,settings=self.settings,targetElm=self.getElement(),doc=self.getDoc();settings.inline||(self.getElement().style.visibility=self.orgVisibility),skipWrite||settings.content_editable||(doc.open(),doc.write(self.iframeHTML),doc.close()),settings.content_editable&&(self.on("remove",function(){var bodyEl=this.getBody();DOM.removeClass(bodyEl,"mce-content-body"),DOM.removeClass(bodyEl,"mce-edit-focus"),DOM.setAttrib(bodyEl,"contentEditable",null)}),DOM.addClass(targetElm,"mce-content-body"),self.contentDocument=doc=settings.content_document||document,self.contentWindow=settings.content_window||window,self.bodyElement=targetElm,settings.content_document=settings.content_window=null,settings.root_name=targetElm.nodeName.toLowerCase()),body=self.getBody(),body.disabled=!0,self.readonly=settings.readonly,self.readonly||(self.inline&&"static"==DOM.getStyle(body,"position",!0)&&(body.style.position="relative"),body.contentEditable=self.getParam("content_editable_state",!0)),body.disabled=!1,self.editorUpload=new EditorUpload(self),self.schema=new Schema(settings),self.dom=new DOMUtils(doc,{keep_values:!0,url_converter:self.convertURL,url_converter_scope:self,hex_colors:settings.force_hex_style_colors,class_filter:settings.class_filter,update_styles:!0,root_element:self.inline?self.getBody():null,collect:settings.content_editable,schema:self.schema,onSetAttrib:function(e){self.fire("SetAttrib",e)}}),self.parser=new DomParser(settings,self.schema),self.parser.addAttributeFilter("src,href,style,tabindex",function(nodes,name){for(var node,value,internalName,i=nodes.length,dom=self.dom;i--;)if(node=nodes[i],value=node.attr(name),internalName="data-mce-"+name,!node.attributes.map[internalName]){if(0===value.indexOf("data:")||0===value.indexOf("blob:"))continue;"style"===name?(value=dom.serializeStyle(dom.parseStyle(value),node.name),value.length||(value=null),node.attr(internalName,value),node.attr(name,value)):"tabindex"===name?(node.attr(internalName,value),node.attr(name,null)):node.attr(internalName,self.convertURL(value,name,node.name))}}),self.parser.addNodeFilter("script",function(nodes){for(var node,type,i=nodes.length;i--;)node=nodes[i],type=node.attr("type")||"no/type",0!==type.indexOf("mce-")&&node.attr("type","mce-"+type)}),self.parser.addNodeFilter("#cdata",function(nodes){for(var node,i=nodes.length;i--;)node=nodes[i],node.type=8,node.name="#comment",node.value="[CDATA["+node.value+"]]"}),self.parser.addNodeFilter("p,h1,h2,h3,h4,h5,h6,div",function(nodes){for(var node,i=nodes.length,nonEmptyElements=self.schema.getNonEmptyElements();i--;)node=nodes[i],node.isEmpty(nonEmptyElements)&&(node.append(new Node("br",1)).shortEnded=!0)}),self.serializer=new DomSerializer(settings,self),self.selection=new Selection(self.dom,self.getWin(),self.serializer,self),self.formatter=new Formatter(self),self.undoManager=new UndoManager(self),self.forceBlocks=new ForceBlocks(self),self.enterKey=new EnterKey(self),self._nodeChangeDispatcher=new NodeChange(self),self._selectionOverrides=new SelectionOverrides(self),self.fire("PreInit"),settings.browser_spellcheck||settings.gecko_spellcheck||(doc.body.spellcheck=!1,DOM.setAttrib(body,"spellcheck","false")),self.quirks=new Quirks(self),self.fire("PostRender"),settings.directionality&&(body.dir=settings.directionality),settings.nowrap&&(body.style.whiteSpace="nowrap"),settings.protect&&self.on("BeforeSetContent",function(e){each(settings.protect,function(pattern){e.content=e.content.replace(pattern,function(str){return"<!--mce:protected "+escape(str)+"-->"})})}),self.on("SetContent",function(){self.addVisual(self.getBody())}),settings.padd_empty_editor&&self.on("PostProcess",function(e){e.content=e.content.replace(/^(<p[^>]*>(&nbsp;|&#160;|\s|\u00a0|)<\/p>[\r\n]*|<br \/>[\r\n]*)$/,"")}),self.load({initial:!0,format:"html"}),self.startContent=self.getContent({format:"raw"}),self.initialized=!0,self.bindPendingEventDelegates(),self.fire("init"),self.focus(!0),self.nodeChanged({initial:!0}),self.execCallback("init_instance_callback",self),self.on("compositionstart compositionend",function(e){self.composing="compositionstart"===e.type}),self.contentStyles.length>0&&(contentCssText="",each(self.contentStyles,function(style){contentCssText+=style+"\r\n"}),self.dom.addStyle(contentCssText)),each(self.contentCSS,function(cssUrl){self.loadedCSS[cssUrl]||(self.dom.loadCSS(cssUrl),self.loadedCSS[cssUrl]=!0)}),settings.auto_focus&&Delay.setEditorTimeout(self,function(){var editor;editor=settings.auto_focus===!0?self:self.editorManager.get(settings.auto_focus),editor.destroyed||editor.focus()},100),targetElm=doc=body=null},focus:function(skipFocus){function getContentEditableHost(node){return self.dom.getParent(node,function(node){return"true"===self.dom.getContentEditable(node)})}var rng,controlElm,contentEditableHost,self=this,selection=self.selection,contentEditable=self.settings.content_editable,doc=self.getDoc(),body=self.getBody();if(!skipFocus){if(rng=selection.getRng(),rng.item&&(controlElm=rng.item(0)),self.quirks.refreshContentEditable(),contentEditableHost=getContentEditableHost(selection.getNode()),self.$.contains(body,contentEditableHost))return contentEditableHost.focus(),selection.normalize(),void self.editorManager.setActive(self);if(contentEditable||(Env.opera||self.getBody().focus(),self.getWin().focus()),isGecko||contentEditable){if(body.setActive)try{body.setActive()}catch(ex){body.focus()}else body.focus();contentEditable&&selection.normalize()}controlElm&&controlElm.ownerDocument==doc&&(rng=doc.body.createControlRange(),rng.addElement(controlElm),rng.select())}self.editorManager.setActive(self)},execCallback:function(name){var scope,self=this,callback=self.settings[name];if(callback)return self.callbackLookup&&(scope=self.callbackLookup[name])&&(callback=scope.func,scope=scope.scope),"string"==typeof callback&&(scope=callback.replace(/\.\w+$/,""),scope=scope?resolve(scope):0,callback=resolve(callback),self.callbackLookup=self.callbackLookup||{},self.callbackLookup[name]={func:callback,scope:scope}),callback.apply(scope||self,Array.prototype.slice.call(arguments,1))},translate:function(text){var lang=this.settings.language||"en",i18n=this.editorManager.i18n;return text?(text=i18n.data[lang+"."+text]||text.replace(/\{\#([^\}]+)\}/g,function(a,b){return i18n.data[lang+"."+b]||"{#"+b+"}"}),this.editorManager.translate(text)):""},getLang:function(name,defaultVal){return this.editorManager.i18n.data[(this.settings.language||"en")+"."+name]||(defaultVal!==undefined?defaultVal:"{#"+name+"}")},getParam:function(name,defaultVal,type){var output,value=name in this.settings?this.settings[name]:defaultVal;return"hash"===type?(output={},"string"==typeof value?each(value.indexOf("=")>0?value.split(/[;,](?![^=;,]*(?:[;,]|$))/):value.split(","),function(value){value=value.split("="),value.length>1?output[trim(value[0])]=trim(value[1]):output[trim(value[0])]=trim(value)}):output=value,output):value},nodeChanged:function(args){this._nodeChangeDispatcher.nodeChanged(args)},addButton:function(name,settings){var self=this;settings.cmd&&(settings.onclick=function(){self.execCommand(settings.cmd)}),settings.text||settings.icon||(settings.icon=name),self.buttons=self.buttons||{},settings.tooltip=settings.tooltip||settings.title,self.buttons[name]=settings},addMenuItem:function(name,settings){var self=this;settings.cmd&&(settings.onclick=function(){self.execCommand(settings.cmd)}),self.menuItems=self.menuItems||{},self.menuItems[name]=settings},addContextToolbar:function(predicate,items){var selector,self=this;self.contextToolbars=self.contextToolbars||[],"string"==typeof predicate&&(selector=predicate,predicate=function(elm){return self.dom.is(elm,selector)}),self.contextToolbars.push({predicate:predicate,items:items})},addCommand:function(name,callback,scope){this.editorCommands.addCommand(name,callback,scope)},addQueryStateHandler:function(name,callback,scope){this.editorCommands.addQueryStateHandler(name,callback,scope)},addQueryValueHandler:function(name,callback,scope){this.editorCommands.addQueryValueHandler(name,callback,scope)},addShortcut:function(pattern,desc,cmdFunc,scope){this.shortcuts.add(pattern,desc,cmdFunc,scope)},execCommand:function(cmd,ui,value,args){return this.editorCommands.execCommand(cmd,ui,value,args)},queryCommandState:function(cmd){return this.editorCommands.queryCommandState(cmd)},queryCommandValue:function(cmd){return this.editorCommands.queryCommandValue(cmd)},queryCommandSupported:function(cmd){return this.editorCommands.queryCommandSupported(cmd)},show:function(){var self=this;self.hidden&&(self.hidden=!1,self.inline?self.getBody().contentEditable=!0:(DOM.show(self.getContainer()),DOM.hide(self.id)),self.load(),self.fire("show"))},hide:function(){var self=this,doc=self.getDoc();self.hidden||(ie&&doc&&!self.inline&&doc.execCommand("SelectAll"),self.save(),self.inline?(self.getBody().contentEditable=!1,self==self.editorManager.focusedEditor&&(self.editorManager.focusedEditor=null)):(DOM.hide(self.getContainer()),DOM.setStyle(self.id,"display",self.orgDisplay)),self.hidden=!0,self.fire("hide"))},isHidden:function(){return!!this.hidden},setProgressState:function(state,time){this.fire("ProgressState",{state:state,time:time})},load:function(args){var html,self=this,elm=self.getElement();if(elm)return args=args||{},args.load=!0,html=self.setContent(elm.value!==undefined?elm.value:elm.innerHTML,args),args.element=elm,args.no_events||self.fire("LoadContent",args),args.element=elm=null,html},save:function(args){var html,form,self=this,elm=self.getElement();if(elm&&self.initialized)return args=args||{},args.save=!0,args.element=elm,html=args.content=self.getContent(args),args.no_events||self.fire("SaveContent",args),"raw"==args.format&&self.fire("RawSaveContent",args),html=args.content,/TEXTAREA|INPUT/i.test(elm.nodeName)?elm.value=html:(self.inline||(elm.innerHTML=html),(form=DOM.getParent(self.id,"form"))&&each(form.elements,function(elm){if(elm.name==self.id)return elm.value=html,!1})),args.element=elm=null,args.set_dirty!==!1&&self.setDirty(!1),html},setContent:function(content,args){var forcedRootBlockName,padd,self=this,body=self.getBody();return args=args||{},args.format=args.format||"html",args.set=!0,args.content=content,args.no_events||self.fire("BeforeSetContent",args),content=args.content,0===content.length||/^\s+$/.test(content)?(padd=ie&&ie<11?"":'<br data-mce-bogus="1">',"TABLE"==body.nodeName?content="<tr><td>"+padd+"</td></tr>":/^(UL|OL)$/.test(body.nodeName)&&(content="<li>"+padd+"</li>"),forcedRootBlockName=self.settings.forced_root_block,forcedRootBlockName&&self.schema.isValidChild(body.nodeName.toLowerCase(),forcedRootBlockName.toLowerCase())?(content=padd,content=self.dom.createHTML(forcedRootBlockName,self.settings.forced_root_block_attrs,content)):ie||content||(content='<br data-mce-bogus="1">'),self.dom.setHTML(body,content),self.fire("SetContent",args)):("raw"!==args.format&&(content=new Serializer({validate:self.validate},self.schema).serialize(self.parser.parse(content,{isRootContent:!0}))),args.content=trim(content),self.dom.setHTML(body,args.content),args.no_events||self.fire("SetContent",args)),args.content},getContent:function(args){var content,self=this,body=self.getBody();return args=args||{},args.format=args.format||"html",args.get=!0,args.getInner=!0,args.no_events||self.fire("BeforeGetContent",args),content="raw"==args.format?self.serializer.getTrimmedContent():"text"==args.format?body.innerText||body.textContent:self.serializer.serialize(body,args),"text"!=args.format?args.content=trim(content):args.content=content,args.no_events||self.fire("GetContent",args),args.content},insertContent:function(content,args){args&&(content=extend({content:content},args)),this.execCommand("mceInsertContent",!1,content)},isDirty:function(){return!this.isNotDirty},setDirty:function(state){var oldState=!this.isNotDirty;this.isNotDirty=!state,state&&state!=oldState&&this.fire("dirty")},setMode:function(mode){Mode.setMode(this,mode)},getContainer:function(){var self=this;return self.container||(self.container=DOM.get(self.editorContainer||self.id+"_parent")),self.container},getContentAreaContainer:function(){return this.contentAreaContainer},getElement:function(){return this.targetElm||(this.targetElm=DOM.get(this.id)),this.targetElm},getWin:function(){var elm,self=this;return self.contentWindow||(elm=self.iframeElement,elm&&(self.contentWindow=elm.contentWindow)),self.contentWindow},getDoc:function(){var win,self=this;return self.contentDocument||(win=self.getWin(),win&&(self.contentDocument=win.document)),self.contentDocument},getBody:function(){return this.bodyElement||this.getDoc().body},convertURL:function(url,name,elm){var self=this,settings=self.settings;return settings.urlconverter_callback?self.execCallback("urlconverter_callback",url,elm,!0,name):!settings.convert_urls||elm&&"LINK"==elm.nodeName||0===url.indexOf("file:")||0===url.length?url:settings.relative_urls?self.documentBaseURI.toRelative(url):url=self.documentBaseURI.toAbsolute(url,settings.remove_script_host)},addVisual:function(elm){var cls,self=this,settings=self.settings,dom=self.dom;elm=elm||self.getBody(),self.hasVisual===undefined&&(self.hasVisual=settings.visual),each(dom.select("table,a",elm),function(elm){var value;switch(elm.nodeName){case"TABLE":return cls=settings.visual_table_class||"mce-item-table",value=dom.getAttrib(elm,"border"),void(value&&"0"!=value||!self.hasVisual?dom.removeClass(elm,cls):dom.addClass(elm,cls));case"A":return void(dom.getAttrib(elm,"href",!1)||(value=dom.getAttrib(elm,"name")||elm.id,cls=settings.visual_anchor_class||"mce-item-anchor",value&&self.hasVisual?dom.addClass(elm,cls):dom.removeClass(elm,cls)))}}),self.fire("VisualAid",{element:elm,hasVisual:self.hasVisual})},remove:function(){var self=this;self.removed||(self.save(),self.removed=1,self.unbindAllNativeEvents(),self.hasHiddenInput&&DOM.remove(self.getElement().nextSibling),self.inline||(ie&&ie<10&&self.getDoc().execCommand("SelectAll",!1,null),DOM.setStyle(self.id,"display",self.orgDisplay),self.getBody().onload=null),self.fire("remove"),self.editorManager.remove(self),DOM.remove(self.getContainer()),self._selectionOverrides.destroy(),self.editorUpload.destroy(),self.destroy())},destroy:function(automatic){var form,self=this;if(!self.destroyed){if(!automatic&&!self.removed)return void self.remove();automatic||(self.editorManager.off("beforeunload",self._beforeUnload),self.theme&&self.theme.destroy&&self.theme.destroy(),self.selection.destroy(),self.dom.destroy()),form=self.formElement,form&&(form._mceOldSubmit&&(form.submit=form._mceOldSubmit,form._mceOldSubmit=null),DOM.unbind(form,"submit reset",self.formEventDelegate)),self.contentAreaContainer=self.formElement=self.container=self.editorContainer=null,self.bodyElement=self.contentDocument=self.contentWindow=null,self.iframeElement=self.targetElm=null,self.selection&&(self.selection=self.selection.win=self.selection.dom=self.selection.dom.doc=null),self.destroyed=1}},uploadImages:function(callback){return this.editorUpload.uploadImages(callback)},_scanForImages:function(){return this.editorUpload.scanForImages()}},extend(Editor.prototype,EditorObservable),Editor}),define("tinymce/util/I18n",[],function(){var data={},code="en";return{setCode:function(newCode){newCode&&(code=newCode,this.rtl=!!this.data[newCode]&&"rtl"===this.data[newCode]._dir)},getCode:function(){return code},rtl:!1,add:function(code,items){var langData=data[code];langData||(data[code]=langData={});for(var name in items)langData[name]=items[name];this.setCode(code)},translate:function(text){var langData;if(langData=data[code],langData||(langData={}),"undefined"==typeof text)return text;if("string"!=typeof text&&text.raw)return text.raw;if(text.push){var values=text.slice(1);text=(langData[text[0]]||text[0]).replace(/\{([0-9]+)\}/g,function(match1,match2){return values[match2]})}return(langData[text]||text).replace(/{context:\w+}$/,"")},data:data}}),define("tinymce/FocusManager",["tinymce/dom/DOMUtils","tinymce/util/Delay","tinymce/Env"],function(DOMUtils,Delay,Env){function FocusManager(editorManager){function getActiveElement(){try{return document.activeElement}catch(ex){return document.body}}function createBookmark(dom,rng){if(rng&&rng.startContainer){if(!dom.isChildOf(rng.startContainer,dom.getRoot())||!dom.isChildOf(rng.endContainer,dom.getRoot()))return;return{startContainer:rng.startContainer,startOffset:rng.startOffset,endContainer:rng.endContainer,endOffset:rng.endOffset}}return rng}function bookmarkToRng(editor,bookmark){var rng;return bookmark.startContainer?(rng=editor.getDoc().createRange(),rng.setStart(bookmark.startContainer,bookmark.startOffset),rng.setEnd(bookmark.endContainer,bookmark.endOffset)):rng=bookmark,rng}function isUIElement(elm){return!!DOM.getParent(elm,FocusManager.isEditorUIElement)}function registerEvents(e){var editor=e.editor;editor.on("init",function(){(editor.inline||Env.ie)&&("onbeforedeactivate"in document&&Env.ie<9?editor.dom.bind(editor.getBody(),"beforedeactivate",function(e){if(e.target==editor.getBody())try{editor.lastRng=editor.selection.getRng()}catch(ex){}}):editor.on("nodechange mouseup keyup",function(e){var node=getActiveElement();"nodechange"==e.type&&e.selectionChange||(node&&node.id==editor.id+"_ifr"&&(node=editor.getBody()),editor.dom.isChildOf(node,editor.getBody())&&(editor.lastRng=editor.selection.getRng()))}),Env.webkit&&!selectionChangeHandler&&(selectionChangeHandler=function(){var activeEditor=editorManager.activeEditor;if(activeEditor&&activeEditor.selection){var rng=activeEditor.selection.getRng();rng&&!rng.collapsed&&(editor.lastRng=rng)}},DOM.bind(document,"selectionchange",selectionChangeHandler)))}),editor.on("setcontent",function(){editor.lastRng=null}),editor.on("mousedown",function(){editor.selection.lastFocusBookmark=null}),editor.on("focusin",function(){var lastRng,focusedEditor=editorManager.focusedEditor;editor.selection.lastFocusBookmark&&(lastRng=bookmarkToRng(editor,editor.selection.lastFocusBookmark),editor.selection.lastFocusBookmark=null,editor.selection.setRng(lastRng)),focusedEditor!=editor&&(focusedEditor&&focusedEditor.fire("blur",{focusedEditor:editor}),editorManager.setActive(editor),editorManager.focusedEditor=editor,editor.fire("focus",{blurredEditor:focusedEditor}),editor.focus(!0)),editor.lastRng=null}),editor.on("focusout",function(){Delay.setEditorTimeout(editor,function(){var focusedEditor=editorManager.focusedEditor;isUIElement(getActiveElement())||focusedEditor!=editor||(editor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null,editor.selection&&(editor.selection.lastFocusBookmark=null))})}),documentFocusInHandler||(documentFocusInHandler=function(e){var target,activeEditor=editorManager.activeEditor;target=e.target,activeEditor&&target.ownerDocument==document&&(activeEditor.selection&&target!=activeEditor.getBody()&&(activeEditor.selection.lastFocusBookmark=createBookmark(activeEditor.dom,activeEditor.lastRng)),target==document.body||isUIElement(target)||editorManager.focusedEditor!=activeEditor||(activeEditor.fire("blur",{focusedEditor:null}),editorManager.focusedEditor=null))},DOM.bind(document,"focusin",documentFocusInHandler)),editor.inline&&!documentMouseUpHandler&&(documentMouseUpHandler=function(e){var activeEditor=editorManager.activeEditor;if(activeEditor.inline&&!activeEditor.dom.isChildOf(e.target,activeEditor.getBody())){var rng=activeEditor.selection.getRng();rng.collapsed||(activeEditor.lastRng=rng)}},DOM.bind(document,"mouseup",documentMouseUpHandler))}function unregisterDocumentEvents(e){editorManager.focusedEditor==e.editor&&(editorManager.focusedEditor=null),editorManager.activeEditor||(DOM.unbind(document,"selectionchange",selectionChangeHandler),DOM.unbind(document,"focusin",documentFocusInHandler),DOM.unbind(document,"mouseup",documentMouseUpHandler),selectionChangeHandler=documentFocusInHandler=documentMouseUpHandler=null)}editorManager.on("AddEditor",registerEvents),editorManager.on("RemoveEditor",unregisterDocumentEvents)}var selectionChangeHandler,documentFocusInHandler,documentMouseUpHandler,DOM=DOMUtils.DOM;return FocusManager.isEditorUIElement=function(elm){return elm.className.toString().indexOf("mce-")!==-1},FocusManager}),define("tinymce/EditorManager",["tinymce/Editor","tinymce/dom/DomQuery","tinymce/dom/DOMUtils","tinymce/util/URI","tinymce/Env","tinymce/util/Tools","tinymce/util/Promise","tinymce/util/Observable","tinymce/util/I18n","tinymce/FocusManager"],function(Editor,$,DOMUtils,URI,Env,Tools,Promise,Observable,I18n,FocusManager){function globalEventDelegate(e){each(EditorManager.editors,function(editor){"scroll"===e.type?editor.fire("ScrollWindow",e):editor.fire("ResizeWindow",e)})}function toggleGlobalEvents(editors,state){state!==boundGlobalEvents&&(state?$(window).on("resize scroll",globalEventDelegate):$(window).off("resize scroll",globalEventDelegate),boundGlobalEvents=state)}function removeEditorFromList(editor){var removedFromList,editors=EditorManager.editors;delete editors[editor.id];for(var i=0;i<editors.length;i++)if(editors[i]==editor){editors.splice(i,1),removedFromList=!0;break}return EditorManager.activeEditor==editor&&(EditorManager.activeEditor=editors[0]),EditorManager.focusedEditor==editor&&(EditorManager.focusedEditor=null),removedFromList}function purgeDestroyedEditor(editor){return editor&&!(editor.getContainer()||editor.getBody()).parentNode&&(removeEditorFromList(editor),editor.unbindAllNativeEvents(),editor.destroy(!0),editor.removed=!0,editor=null),editor}var beforeUnloadDelegate,EditorManager,DOM=DOMUtils.DOM,explode=Tools.explode,each=Tools.each,extend=Tools.extend,instanceCounter=0,boundGlobalEvents=!1;return EditorManager={$:$,majorVersion:"4",minorVersion:"3.12",releaseDate:"2016-05-10",editors:[],i18n:I18n,activeEditor:null,setup:function(){var baseURL,documentBaseURL,preInit,src,self=this,suffix="";if(documentBaseURL=URI.getDocumentBaseUrl(document.location),/^[^:]+:\/\/\/?[^\/]+\//.test(documentBaseURL)&&(documentBaseURL=documentBaseURL.replace(/[\?#].*$/,"").replace(/[\/\\][^\/]+$/,""),/[\/\\]$/.test(documentBaseURL)||(documentBaseURL+="/")),preInit=window.tinymce||window.tinyMCEPreInit)baseURL=preInit.base||preInit.baseURL,suffix=preInit.suffix;else{for(var scripts=document.getElementsByTagName("script"),i=0;i<scripts.length;i++){src=scripts[i].src;var srcScript=src.substring(src.lastIndexOf("/"));if(/tinymce(\.full|\.jquery|)(\.min|\.dev|)\.js/.test(src)){srcScript.indexOf(".min")!=-1&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/"));break}}!baseURL&&document.currentScript&&(src=document.currentScript.src,src.indexOf(".min")!=-1&&(suffix=".min"),baseURL=src.substring(0,src.lastIndexOf("/")))}self.baseURL=new URI(documentBaseURL).toAbsolute(baseURL),self.documentBaseURL=documentBaseURL,self.baseURI=new URI(self.baseURL),self.suffix=suffix,self.focusManager=new FocusManager(self)},overrideDefaults:function(defaultSettings){var baseUrl,suffix;baseUrl=defaultSettings.base_url,baseUrl&&(this.baseURL=new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\/+$/,"")),this.baseURI=new URI(this.baseURL)),suffix=defaultSettings.suffix,defaultSettings.suffix&&(this.suffix=suffix),this.defaultSettings=defaultSettings},init:function(settings){function createId(elm){var id=elm.id;return id||(id=elm.name,id=id&&!DOM.get(id)?elm.name:DOM.uniqueId(),elm.setAttribute("id",id)),id}function execCallback(name){var callback=settings[name];if(callback)return callback.apply(self,Array.prototype.slice.call(arguments,2))}function hasClass(elm,className){return className.constructor===RegExp?className.test(elm.className):DOM.hasClass(elm,className)}function findTargets(settings){var l,targets=[];if(settings.types)return each(settings.types,function(type){targets=targets.concat(DOM.select(type.selector))}),targets;if(settings.selector)return DOM.select(settings.selector);if(settings.target)return[settings.target];switch(settings.mode){case"exact":l=settings.elements||"",l.length>0&&each(explode(l),function(id){var elm;(elm=DOM.get(id))?targets.push(elm):each(document.forms,function(f){each(f.elements,function(e){e.name===id&&(id="mce_editor_"+instanceCounter++,DOM.setAttrib(e,"id",id),targets.push(e))})})});break;case"textareas":case"specific_textareas":each(DOM.select("textarea"),function(elm){settings.editor_deselector&&hasClass(elm,settings.editor_deselector)||settings.editor_selector&&!hasClass(elm,settings.editor_selector)||targets.push(elm)})}return targets}function initEditors(){function createEditor(id,settings,targetElm){if(!purgeDestroyedEditor(self.get(id))){var editor=new Editor(id,settings,self);editors.push(editor),editor.on("init",function(){++initCount===targets.length&&provideResults(editors)}),editor.targetElm=editor.targetElm||targetElm,editor.render()}}var targets,initCount=0,editors=[];return DOM.unbind(window,"ready",initEditors),execCallback("onpageload"),targets=$.unique(findTargets(settings)),settings.types?void each(settings.types,function(type){Tools.each(targets,function(elm){return!DOM.is(elm,type.selector)||(createEditor(createId(elm),extend({},settings,type),elm),!1)})}):void each(targets,function(elm){createEditor(createId(elm),settings,elm)})}var result,self=this,provideResults=function(editors){result=editors};return self.settings=settings,DOM.bind(window,"ready",initEditors),new Promise(function(resolve){result?resolve(result):provideResults=function(editors){resolve(editors)}})},get:function(id){return arguments.length?id in this.editors?this.editors[id]:null:this.editors},add:function(editor){var self=this,editors=self.editors;return editors[editor.id]=editor,editors.push(editor),toggleGlobalEvents(editors,!0),self.activeEditor=editor,self.fire("AddEditor",{editor:editor
}),beforeUnloadDelegate||(beforeUnloadDelegate=function(){self.fire("BeforeUnload")},DOM.bind(window,"beforeunload",beforeUnloadDelegate)),editor},createEditor:function(id,settings){return this.add(new Editor(id,settings,this))},remove:function(selector){var i,editor,self=this,editors=self.editors;{if(selector)return"string"==typeof selector?(selector=selector.selector||selector,void each(DOM.select(selector),function(elm){editor=editors[elm.id],editor&&self.remove(editor)})):(editor=selector,editors[editor.id]?(removeEditorFromList(editor)&&self.fire("RemoveEditor",{editor:editor}),editors.length||DOM.unbind(window,"beforeunload",beforeUnloadDelegate),editor.remove(),toggleGlobalEvents(editors,editors.length>0),editor):null);for(i=editors.length-1;i>=0;i--)self.remove(editors[i])}},execCommand:function(cmd,ui,value){var self=this,editor=self.get(value);switch(cmd){case"mceAddEditor":return self.get(value)||new Editor(value,self.settings,self).render(),!0;case"mceRemoveEditor":return editor&&editor.remove(),!0;case"mceToggleEditor":return editor?(editor.isHidden()?editor.show():editor.hide(),!0):(self.execCommand("mceAddEditor",0,value),!0)}return!!self.activeEditor&&self.activeEditor.execCommand(cmd,ui,value)},triggerSave:function(){each(this.editors,function(editor){editor.save()})},addI18n:function(code,items){I18n.add(code,items)},translate:function(text){return I18n.translate(text)},setActive:function(editor){var activeEditor=this.activeEditor;this.activeEditor!=editor&&(activeEditor&&activeEditor.fire("deactivate",{relatedTarget:editor}),editor.fire("activate",{relatedTarget:activeEditor})),this.activeEditor=editor}},extend(EditorManager,Observable),EditorManager.setup(),window.tinymce=window.tinyMCE=EditorManager,EditorManager}),define("tinymce/LegacyInput",["tinymce/EditorManager","tinymce/util/Tools"],function(EditorManager,Tools){var each=Tools.each,explode=Tools.explode;EditorManager.on("AddEditor",function(e){var editor=e.editor;editor.on("preInit",function(){function replaceWithSpan(node,styles){each(styles,function(value,name){value&&dom.setStyle(node,name,value)}),dom.rename(node,"span")}function convert(e){dom=editor.dom,settings.convert_fonts_to_spans&&each(dom.select("font,u,strike",e.node),function(node){filters[node.nodeName.toLowerCase()](dom,node)})}var filters,fontSizes,dom,settings=editor.settings;settings.inline_styles&&(fontSizes=explode(settings.font_size_legacy_values),filters={font:function(dom,node){replaceWithSpan(node,{backgroundColor:node.style.backgroundColor,color:node.color,fontFamily:node.face,fontSize:fontSizes[parseInt(node.size,10)-1]})},u:function(dom,node){"html4"===editor.settings.schema&&replaceWithSpan(node,{textDecoration:"underline"})},strike:function(dom,node){replaceWithSpan(node,{textDecoration:"line-through"})}},editor.on("PreProcess SetContent",convert))})})}),define("tinymce/util/XHR",["tinymce/util/Observable","tinymce/util/Tools"],function(Observable,Tools){var XHR={send:function(settings){function ready(){!settings.async||4==xhr.readyState||count++>1e4?(settings.success&&count<1e4&&200==xhr.status?settings.success.call(settings.success_scope,""+xhr.responseText,xhr,settings):settings.error&&settings.error.call(settings.error_scope,count>1e4?"TIMED_OUT":"GENERAL",xhr,settings),xhr=null):setTimeout(ready,10)}var xhr,count=0;if(settings.scope=settings.scope||this,settings.success_scope=settings.success_scope||settings.scope,settings.error_scope=settings.error_scope||settings.scope,settings.async=settings.async!==!1,settings.data=settings.data||"",XHR.fire("beforeInitialize",{settings:settings}),xhr=new XMLHttpRequest){if(xhr.overrideMimeType&&xhr.overrideMimeType(settings.content_type),xhr.open(settings.type||(settings.data?"POST":"GET"),settings.url,settings.async),settings.crossDomain&&(xhr.withCredentials=!0),settings.content_type&&xhr.setRequestHeader("Content-Type",settings.content_type),settings.requestheaders&&Tools.each(settings.requestheaders,function(header){xhr.setRequestHeader(header.key,header.value)}),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr=XHR.fire("beforeSend",{xhr:xhr,settings:settings}).xhr,xhr.send(settings.data),!settings.async)return ready();setTimeout(ready,10)}}};return Tools.extend(XHR,Observable),XHR}),define("tinymce/util/JSON",[],function(){function serialize(o,quote){var i,v,t,name;if(quote=quote||'"',null===o)return"null";if(t=typeof o,"string"==t)return v="\bb\tt\nn\ff\rr\"\"''\\\\",quote+o.replace(/([\u0080-\uFFFF\x00-\x1f\"\'\\])/g,function(a,b){return'"'===quote&&"'"===a?a:(i=v.indexOf(b),i+1?"\\"+v.charAt(i+1):(a=b.charCodeAt().toString(16),"\\u"+"0000".substring(a.length)+a))})+quote;if("object"==t){if(o.hasOwnProperty&&"[object Array]"===Object.prototype.toString.call(o)){for(i=0,v="[";i<o.length;i++)v+=(i>0?",":"")+serialize(o[i],quote);return v+"]"}v="{";for(name in o)o.hasOwnProperty(name)&&(v+="function"!=typeof o[name]?(v.length>1?","+quote:quote)+name+quote+":"+serialize(o[name],quote):"");return v+"}"}return""+o}return{serialize:serialize,parse:function(text){try{return window[String.fromCharCode(101)+"val"]("("+text+")")}catch(ex){}}}}),define("tinymce/util/JSONRequest",["tinymce/util/JSON","tinymce/util/XHR","tinymce/util/Tools"],function(JSON,XHR,Tools){function JSONRequest(settings){this.settings=extend({},settings),this.count=0}var extend=Tools.extend;return JSONRequest.sendRPC=function(o){return(new JSONRequest).send(o)},JSONRequest.prototype={send:function(args){var ecb=args.error,scb=args.success;args=extend(this.settings,args),args.success=function(c,x){c=JSON.parse(c),"undefined"==typeof c&&(c={error:"JSON Parse error."}),c.error?ecb.call(args.error_scope||args.scope,c.error,x):scb.call(args.success_scope||args.scope,c.result)},args.error=function(ty,x){ecb&&ecb.call(args.error_scope||args.scope,ty,x)},args.data=JSON.serialize({id:args.id||"c"+this.count++,method:args.method,params:args.params}),args.content_type="application/json",XHR.send(args)}},JSONRequest}),define("tinymce/util/JSONP",["tinymce/dom/DOMUtils"],function(DOMUtils){return{callbacks:{},count:0,send:function(settings){var self=this,dom=DOMUtils.DOM,count=settings.count!==undefined?settings.count:self.count,id="tinymce_jsonp_"+count;self.callbacks[count]=function(json){dom.remove(id),delete self.callbacks[count],settings.callback(json)},dom.add(dom.doc.body,"script",{id:id,src:settings.url,type:"text/javascript"}),self.count++}}}),define("tinymce/util/LocalStorage",[],function(){function updateKeys(){keys=[];for(var key in items)keys.push(key);LocalStorage.length=keys.length}function load(){function next(end){var value,nextPos;return nextPos=end!==undefined?pos+end:data.indexOf(",",pos),nextPos===-1||nextPos>data.length?null:(value=data.substring(pos,nextPos),pos=nextPos+1,value)}var key,data,value,pos=0;if(items={},hasOldIEDataSupport){storageElm.load(userDataKey),data=storageElm.getAttribute(userDataKey)||"";do{var offset=next();if(null===offset)break;if(key=next(parseInt(offset,32)||0),null!==key){if(offset=next(),null===offset)break;value=next(parseInt(offset,32)||0),key&&(items[key]=value)}}while(null!==key);updateKeys()}}function save(){var value,data="";if(hasOldIEDataSupport){for(var key in items)value=items[key],data+=(data?",":"")+key.length.toString(32)+","+key+","+value.length.toString(32)+","+value;storageElm.setAttribute(userDataKey,data);try{storageElm.save(userDataKey)}catch(ex){}updateKeys()}}var LocalStorage,storageElm,items,keys,userDataKey,hasOldIEDataSupport;try{if(window.localStorage)return localStorage}catch(ex){}return userDataKey="tinymce",storageElm=document.documentElement,hasOldIEDataSupport=!!storageElm.addBehavior,hasOldIEDataSupport&&storageElm.addBehavior("#default#userData"),LocalStorage={key:function(index){return keys[index]},getItem:function(key){return key in items?items[key]:null},setItem:function(key,value){items[key]=""+value,save()},removeItem:function(key){delete items[key],save()},clear:function(){items={},save()}},load(),LocalStorage}),define("tinymce/Compat",["tinymce/dom/DOMUtils","tinymce/dom/EventUtils","tinymce/dom/ScriptLoader","tinymce/AddOnManager","tinymce/util/Tools","tinymce/Env"],function(DOMUtils,EventUtils,ScriptLoader,AddOnManager,Tools,Env){var tinymce=window.tinymce;return tinymce.DOM=DOMUtils.DOM,tinymce.ScriptLoader=ScriptLoader.ScriptLoader,tinymce.PluginManager=AddOnManager.PluginManager,tinymce.ThemeManager=AddOnManager.ThemeManager,tinymce.dom=tinymce.dom||{},tinymce.dom.Event=EventUtils.Event,Tools.each(Tools,function(func,key){tinymce[key]=func}),Tools.each("isOpera isWebKit isIE isGecko isMac".split(" "),function(name){tinymce[name]=Env[name.substr(2).toLowerCase()]}),{}}),define("tinymce/ui/Layout",["tinymce/util/Class","tinymce/util/Tools"],function(Class,Tools){return Class.extend({Defaults:{firstControlClass:"first",lastControlClass:"last"},init:function(settings){this.settings=Tools.extend({},this.Defaults,settings)},preRender:function(container){container.bodyClasses.add(this.settings.containerClass)},applyClasses:function(items){var firstClass,lastClass,firstItem,lastItem,self=this,settings=self.settings;firstClass=settings.firstControlClass,lastClass=settings.lastControlClass,items.each(function(item){item.classes.remove(firstClass).remove(lastClass).add(settings.controlClass),item.visible()&&(firstItem||(firstItem=item),lastItem=item)}),firstItem&&firstItem.classes.add(firstClass),lastItem&&lastItem.classes.add(lastClass)},renderHtml:function(container){var self=this,html="";return self.applyClasses(container.items()),container.items().each(function(item){html+=item.renderHtml()}),html},recalc:function(){},postRender:function(){},isNative:function(){return!1}})}),define("tinymce/ui/AbsoluteLayout",["tinymce/ui/Layout"],function(Layout){return Layout.extend({Defaults:{containerClass:"abs-layout",controlClass:"abs-layout-item"},recalc:function(container){container.items().filter(":visible").each(function(ctrl){var settings=ctrl.settings;ctrl.layoutRect({x:settings.x,y:settings.y,w:settings.w,h:settings.h}),ctrl.recalc&&ctrl.recalc()})},renderHtml:function(container){return'<div id="'+container._id+'-absend" class="'+container.classPrefix+'abs-end"></div>'+this._super(container)}})}),define("tinymce/ui/Button",["tinymce/ui/Widget"],function(Widget){return Widget.extend({Defaults:{classes:"widget btn",role:"button"},init:function(settings){var size,self=this;self._super(settings),settings=self.settings,size=self.settings.size,self.on("click mousedown",function(e){e.preventDefault()}),self.on("touchstart",function(e){self.fire("click",e),e.preventDefault()}),settings.subtype&&self.classes.add(settings.subtype),size&&self.classes.add("btn-"+size),settings.icon&&self.icon(settings.icon)},icon:function(icon){return arguments.length?(this.state.set("icon",icon),this):this.state.get("icon")},repaint:function(){var btnStyle,btnElm=this.getEl().firstChild;btnElm&&(btnStyle=btnElm.style,btnStyle.width=btnStyle.height="100%"),this._super()},renderHtml:function(){var image,self=this,id=self._id,prefix=self.classPrefix,icon=self.state.get("icon"),text=self.state.get("text"),textHtml="";return image=self.settings.image,image?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1]),image=" style=\"background-image: url('"+image+"')\""):image="",text&&(self.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"),icon=self.settings.icon?prefix+"ico "+prefix+"i-"+icon:"",'<div id="'+id+'" class="'+self.classes+'" tabindex="-1" aria-labelledby="'+id+'"><button role="presentation" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+"</button></div>"},bindStates:function(){function setButtonText(text){var $span=$("span."+textCls,self.getEl());text?($span[0]||($("button:first",self.getEl()).append('<span class="'+textCls+'"></span>'),$span=$("span."+textCls,self.getEl())),$span.html(self.encode(text))):$span.remove(),self.classes.toggle("btn-has-text",!!text)}var self=this,$=self.$,textCls=self.classPrefix+"txt";return self.state.on("change:text",function(e){setButtonText(e.value)}),self.state.on("change:icon",function(e){var icon=e.value,prefix=self.classPrefix;self.settings.icon=icon,icon=icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var btnElm=self.getEl().firstChild,iconElm=btnElm.getElementsByTagName("i")[0];icon?(iconElm&&iconElm==btnElm.firstChild||(iconElm=document.createElement("i"),btnElm.insertBefore(iconElm,btnElm.firstChild)),iconElm.className=icon):iconElm&&btnElm.removeChild(iconElm),setButtonText(self.state.get("text"))}),self._super()}})}),define("tinymce/ui/ButtonGroup",["tinymce/ui/Container"],function(Container){return Container.extend({Defaults:{defaultType:"button",role:"group"},renderHtml:function(){var self=this,layout=self._layout;return self.classes.add("btn-group"),self.preRender(),layout.preRender(self),'<div id="'+self._id+'" class="'+self.classes+'"><div id="'+self._id+'-body">'+(self.settings.html||"")+layout.renderHtml(self)+"</div></div>"}})}),define("tinymce/ui/Checkbox",["tinymce/ui/Widget"],function(Widget){return Widget.extend({Defaults:{classes:"checkbox",role:"checkbox",checked:!1},init:function(settings){var self=this;self._super(settings),self.on("click mousedown",function(e){e.preventDefault()}),self.on("click",function(e){e.preventDefault(),self.disabled()||self.checked(!self.checked())}),self.checked(self.settings.checked)},checked:function(state){return arguments.length?(this.state.set("checked",state),this):this.state.get("checked")},value:function(state){return arguments.length?this.checked(state):this.checked()},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix;return'<div id="'+id+'" class="'+self.classes+'" unselectable="on" aria-labelledby="'+id+'-al" tabindex="-1"><i class="'+prefix+"ico "+prefix+'i-checkbox"></i><span id="'+id+'-al" class="'+prefix+'label">'+self.encode(self.state.get("text"))+"</span></div>"},bindStates:function(){function checked(state){self.classes.toggle("checked",state),self.aria("checked",state)}var self=this;return self.state.on("change:text",function(e){self.getEl("al").firstChild.data=self.translate(e.value)}),self.state.on("change:checked change:value",function(e){self.fire("change"),checked(e.value)}),self.state.on("change:icon",function(e){var icon=e.value,prefix=self.classPrefix;if("undefined"==typeof icon)return self.settings.icon;self.settings.icon=icon,icon=icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"";var btnElm=self.getEl().firstChild,iconElm=btnElm.getElementsByTagName("i")[0];icon?(iconElm&&iconElm==btnElm.firstChild||(iconElm=document.createElement("i"),btnElm.insertBefore(iconElm,btnElm.firstChild)),iconElm.className=icon):iconElm&&btnElm.removeChild(iconElm)}),self.state.get("checked")&&checked(!0),self._super()}})}),define("tinymce/ui/ComboBox",["tinymce/ui/Widget","tinymce/ui/Factory","tinymce/ui/DomUtils","tinymce/dom/DomQuery"],function(Widget,Factory,DomUtils,$){return Widget.extend({init:function(settings){var self=this;self._super(settings),settings=self.settings,self.classes.add("combobox"),self.subinput=!0,self.ariaTarget="inp",settings.menu=settings.menu||settings.values,settings.menu&&(settings.icon="caret"),self.on("click",function(e){var elm=e.target,root=self.getEl();if($.contains(root,elm)||elm==root)for(;elm&&elm!=root;)elm.id&&elm.id.indexOf("-open")!=-1&&(self.fire("action"),settings.menu&&(self.showMenu(),e.aria&&self.menu.items()[0].focus())),elm=elm.parentNode}),self.on("keydown",function(e){"INPUT"==e.target.nodeName&&13==e.keyCode&&self.parents().reverse().each(function(ctrl){var stateValue=self.state.get("value"),inputValue=self.getEl("inp").value;if(e.preventDefault(),self.state.set("value",inputValue),stateValue!=inputValue&&self.fire("change"),ctrl.hasEventListeners("submit")&&ctrl.toJSON)return ctrl.fire("submit",{data:ctrl.toJSON()}),!1})}),self.on("keyup",function(e){"INPUT"==e.target.nodeName&&self.state.set("value",e.target.value)})},showMenu:function(){var menu,self=this,settings=self.settings;self.menu||(menu=settings.menu||[],menu.length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",self.menu=Factory.create(menu).parent(self).renderTo(self.getContainerElm()),self.fire("createmenu"),self.menu.reflow(),self.menu.on("cancel",function(e){e.control===self.menu&&self.focus()}),self.menu.on("show hide",function(e){e.control.items().each(function(ctrl){ctrl.active(ctrl.value()==self.value())})}).fire("show"),self.menu.on("select",function(e){self.value(e.control.value())}),self.on("focusin",function(e){"INPUT"==e.target.tagName.toUpperCase()&&self.menu.hide()}),self.aria("expanded",!0)),self.menu.show(),self.menu.layoutRect({w:self.layoutRect().w}),self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"])},focus:function(){this.getEl("inp").focus()},repaint:function(){var width,lineHeight,self=this,elm=self.getEl(),openElm=self.getEl("open"),rect=self.layoutRect();width=openElm?rect.w-DomUtils.getSize(openElm).width-10:rect.w-10;var doc=document;return doc.all&&(!doc.documentMode||doc.documentMode<=8)&&(lineHeight=self.layoutRect().h-2+"px"),$(elm.firstChild).css({width:width,lineHeight:lineHeight}),self._super(),self},postRender:function(){var self=this;return $(this.getEl("inp")).on("change",function(e){self.state.set("value",e.target.value),self.fire("change",e)}),self._super()},renderHtml:function(){var icon,text,self=this,id=self._id,settings=self.settings,prefix=self.classPrefix,value=self.state.get("value")||"",openBtnHtml="",extraAttrs="";return"spellcheck"in settings&&(extraAttrs+=' spellcheck="'+settings.spellcheck+'"'),settings.maxLength&&(extraAttrs+=' maxlength="'+settings.maxLength+'"'),settings.size&&(extraAttrs+=' size="'+settings.size+'"'),settings.subtype&&(extraAttrs+=' type="'+settings.subtype+'"'),self.disabled()&&(extraAttrs+=' disabled="disabled"'),icon=settings.icon,icon&&"caret"!=icon&&(icon=prefix+"ico "+prefix+"i-"+settings.icon),text=self.state.get("text"),(icon||text)&&(openBtnHtml='<div id="'+id+'-open" class="'+prefix+"btn "+prefix+'open" tabIndex="-1" role="button"><button id="'+id+'-action" type="button" hidefocus="1" tabindex="-1">'+("caret"!=icon?'<i class="'+icon+'"></i>':'<i class="'+prefix+'caret"></i>')+(text?(icon?" ":"")+text:"")+"</button></div>",self.classes.add("has-open")),'<div id="'+id+'" class="'+self.classes+'"><input id="'+id+'-inp" class="'+prefix+'textbox" value="'+self.encode(value,!1)+'" hidefocus="1"'+extraAttrs+' placeholder="'+self.encode(settings.placeholder)+'" />'+openBtnHtml+"</div>"},value:function(value){return arguments.length?(this.state.set("value",value),this):(this.state.get("rendered")&&this.state.set("value",this.getEl("inp").value),this.state.get("value"))},bindStates:function(){var self=this;return self.state.on("change:value",function(e){self.getEl("inp").value!=e.value&&(self.getEl("inp").value=e.value)}),self.state.on("change:disabled",function(e){self.getEl("inp").disabled=e.value}),self._super()},remove:function(){$(this.getEl("inp")).off(),this._super()}})}),define("tinymce/ui/ColorBox",["tinymce/ui/ComboBox"],function(ComboBox){return ComboBox.extend({init:function(settings){var self=this;settings.spellcheck=!1,settings.onaction&&(settings.icon="none"),self._super(settings),self.classes.add("colorbox"),self.on("change keyup postrender",function(){self.repaintColor(self.value())})},repaintColor:function(value){var elm=this.getEl().getElementsByTagName("i")[0];if(elm)try{elm.style.background=value}catch(ex){}},bindStates:function(){var self=this;return self.state.on("change:value",function(e){self.state.get("rendered")&&self.repaintColor(e.value)}),self._super()}})}),define("tinymce/ui/PanelButton",["tinymce/ui/Button","tinymce/ui/FloatPanel"],function(Button,FloatPanel){return Button.extend({showPanel:function(){var self=this,settings=self.settings;if(self.active(!0),self.panel)self.panel.show();else{var panelSettings=settings.panel;panelSettings.type&&(panelSettings={layout:"grid",items:panelSettings}),panelSettings.role=panelSettings.role||"dialog",panelSettings.popover=!0,panelSettings.autohide=!0,panelSettings.ariaRoot=!0,self.panel=new FloatPanel(panelSettings).on("hide",function(){self.active(!1)}).on("cancel",function(e){e.stopPropagation(),self.focus(),self.hidePanel()}).parent(self).renderTo(self.getContainerElm()),self.panel.fire("show"),self.panel.reflow()}self.panel.moveRel(self.getEl(),settings.popoverAlign||(self.isRtl()?["bc-tr","bc-tc"]:["bc-tl","bc-tc"]))},hidePanel:function(){var self=this;self.panel&&self.panel.hide()},postRender:function(){var self=this;return self.aria("haspopup",!0),self.on("click",function(e){e.control===self&&(self.panel&&self.panel.visible()?self.hidePanel():(self.showPanel(),self.panel.focus(!!e.aria)))}),self._super()},remove:function(){return this.panel&&(this.panel.remove(),this.panel=null),this._super()}})}),define("tinymce/ui/ColorButton",["tinymce/ui/PanelButton","tinymce/dom/DOMUtils"],function(PanelButton,DomUtils){var DOM=DomUtils.DOM;return PanelButton.extend({init:function(settings){this._super(settings),this.classes.add("colorbutton")},color:function(color){return color?(this._color=color,this.getEl("preview").style.backgroundColor=color,this):this._color},resetColor:function(){return this._color=null,this.getEl("preview").style.backgroundColor=null,this},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix,text=self.state.get("text"),icon=self.settings.icon?prefix+"ico "+prefix+"i-"+self.settings.icon:"",image=self.settings.image?" style=\"background-image: url('"+self.settings.image+"')\"":"",textHtml="";return text&&(self.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"),'<div id="'+id+'" class="'+self.classes+'" role="button" tabindex="-1" aria-haspopup="true"><button role="presentation" hidefocus="1" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+'<span id="'+id+'-preview" class="'+prefix+'preview"></span>'+textHtml+'</button><button type="button" class="'+prefix+'open" hidefocus="1" tabindex="-1"> <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var self=this,onClickHandler=self.settings.onclick;return self.on("click",function(e){e.aria&&"down"==e.aria.key||e.control!=self||DOM.getParent(e.target,"."+self.classPrefix+"open")||(e.stopImmediatePropagation(),onClickHandler.call(self,e))}),delete self.settings.onclick,self._super()}})}),define("tinymce/util/Color",[],function(){function Color(value){function rgb2hsv(r,g,b){var h,s,v,d,minRGB,maxRGB;return h=0,s=0,v=0,r/=255,g/=255,b/=255,minRGB=min(r,min(g,b)),maxRGB=max(r,max(g,b)),minRGB==maxRGB?(v=minRGB,{h:0,s:0,v:100*v}):(d=r==minRGB?g-b:b==minRGB?r-g:b-r,h=r==minRGB?3:b==minRGB?1:5,h=60*(h-d/(maxRGB-minRGB)),s=(maxRGB-minRGB)/maxRGB,v=maxRGB,{h:round(h),s:round(100*s),v:round(100*v)})}function hsvToRgb(hue,saturation,brightness){var side,chroma,x,match;if(hue=(parseInt(hue,10)||0)%360,saturation=parseInt(saturation,10)/100,brightness=parseInt(brightness,10)/100,saturation=max(0,min(saturation,1)),brightness=max(0,min(brightness,1)),0===saturation)return void(r=g=b=round(255*brightness));switch(side=hue/60,chroma=brightness*saturation,x=chroma*(1-Math.abs(side%2-1)),match=brightness-chroma,Math.floor(side)){case 0:r=chroma,g=x,b=0;break;case 1:r=x,g=chroma,b=0;break;case 2:r=0,g=chroma,b=x;break;case 3:r=0,g=x,b=chroma;break;case 4:r=x,g=0,b=chroma;break;case 5:r=chroma,g=0,b=x;break;default:r=g=b=0}r=round(255*(r+match)),g=round(255*(g+match)),b=round(255*(b+match))}function toHex(){function hex(val){return val=parseInt(val,10).toString(16),val.length>1?val:"0"+val}return"#"+hex(r)+hex(g)+hex(b)}function toRgb(){return{r:r,g:g,b:b}}function toHsv(){return rgb2hsv(r,g,b)}function parse(value){var matches;return"object"==typeof value?"r"in value?(r=value.r,g=value.g,b=value.b):"v"in value&&hsvToRgb(value.h,value.s,value.v):(matches=/rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))?(r=parseInt(matches[1],10),g=parseInt(matches[2],10),b=parseInt(matches[3],10)):(matches=/#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))?(r=parseInt(matches[1],16),g=parseInt(matches[2],16),b=parseInt(matches[3],16)):(matches=/#([0-F])([0-F])([0-F])/gi.exec(value))&&(r=parseInt(matches[1]+matches[1],16),g=parseInt(matches[2]+matches[2],16),b=parseInt(matches[3]+matches[3],16)),r=r<0?0:r>255?255:r,g=g<0?0:g>255?255:g,b=b<0?0:b>255?255:b,self}var self=this,r=0,g=0,b=0;value&&parse(value),self.toRgb=toRgb,self.toHsv=toHsv,self.toHex=toHex,self.parse=parse}var min=Math.min,max=Math.max,round=Math.round;return Color}),define("tinymce/ui/ColorPicker",["tinymce/ui/Widget","tinymce/ui/DragHelper","tinymce/ui/DomUtils","tinymce/util/Color"],function(Widget,DragHelper,DomUtils,Color){return Widget.extend({Defaults:{classes:"widget colorpicker"},init:function(settings){this._super(settings)},postRender:function(){function getPos(elm,event){var x,y,pos=DomUtils.getPos(elm);return x=event.pageX-pos.x,y=event.pageY-pos.y,x=Math.max(0,Math.min(x/elm.clientWidth,1)),y=Math.max(0,Math.min(y/elm.clientHeight,1)),{x:x,y:y}}function updateColor(hsv,hueUpdate){var hue=(360-hsv.h)/360;DomUtils.css(huePointElm,{top:100*hue+"%"}),hueUpdate||DomUtils.css(svPointElm,{left:hsv.s+"%",top:100-hsv.v+"%"}),svRootElm.style.background=new Color({s:100,v:100,h:hsv.h}).toHex(),self.color().parse({s:hsv.s,v:hsv.v,h:hsv.h})}function updateSaturationAndValue(e){var pos;pos=getPos(svRootElm,e),hsv.s=100*pos.x,hsv.v=100*(1-pos.y),updateColor(hsv),self.fire("change")}function updateHue(e){var pos;pos=getPos(hueRootElm,e),hsv=color.toHsv(),hsv.h=360*(1-pos.y),updateColor(hsv,!0),self.fire("change")}var hsv,hueRootElm,huePointElm,svRootElm,svPointElm,self=this,color=self.color();hueRootElm=self.getEl("h"),huePointElm=self.getEl("hp"),svRootElm=self.getEl("sv"),svPointElm=self.getEl("svp"),self._repaint=function(){hsv=color.toHsv(),updateColor(hsv)},self._super(),self._svdraghelper=new DragHelper(self._id+"-sv",{start:updateSaturationAndValue,drag:updateSaturationAndValue}),self._hdraghelper=new DragHelper(self._id+"-h",{start:updateHue,drag:updateHue}),self._repaint()},rgb:function(){return this.color().toRgb()},value:function(value){var self=this;return arguments.length?(self.color().parse(value),void(self._rendered&&self._repaint())):self.color().toHex()},color:function(){return this._color||(this._color=new Color),this._color},renderHtml:function(){function getOldIeFallbackHtml(){var i,l,gradientPrefix,stopsList,html="";for(gradientPrefix="filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr=",stopsList=stops.split(","),i=0,l=stopsList.length-1;i<l;i++)html+='<div class="'+prefix+'colorpicker-h-chunk" style="height:'+100/l+"%;"+gradientPrefix+stopsList[i]+",endColorstr="+stopsList[i+1]+");-ms-"+gradientPrefix+stopsList[i]+",endColorstr="+stopsList[i+1]+')"></div>';return html}var hueHtml,self=this,id=self._id,prefix=self.classPrefix,stops="#ff0000,#ff0080,#ff00ff,#8000ff,#0000ff,#0080ff,#00ffff,#00ff80,#00ff00,#80ff00,#ffff00,#ff8000,#ff0000",gradientCssText="background: -ms-linear-gradient(top,"+stops+");background: linear-gradient(to bottom,"+stops+");";return hueHtml='<div id="'+id+'-h" class="'+prefix+'colorpicker-h" style="'+gradientCssText+'">'+getOldIeFallbackHtml()+'<div id="'+id+'-hp" class="'+prefix+'colorpicker-h-marker"></div></div>','<div id="'+id+'" class="'+self.classes+'"><div id="'+id+'-sv" class="'+prefix+'colorpicker-sv"><div class="'+prefix+'colorpicker-overlay1"><div class="'+prefix+'colorpicker-overlay2"><div id="'+id+'-svp" class="'+prefix+'colorpicker-selector1"><div class="'+prefix+'colorpicker-selector2"></div></div></div></div></div>'+hueHtml+"</div>"}})}),define("tinymce/ui/Path",["tinymce/ui/Widget"],function(Widget){return Widget.extend({init:function(settings){var self=this;settings.delimiter||(settings.delimiter=""),self._super(settings),self.classes.add("path"),self.canFocus=!0,self.on("click",function(e){var index,target=e.target;(index=target.getAttribute("data-index"))&&self.fire("select",{value:self.row()[index],index:index})}),self.row(self.settings.row)},focus:function(){var self=this;return self.getEl().firstChild.focus(),self},row:function(row){return arguments.length?(this.state.set("row",row),this):this.state.get("row")},renderHtml:function(){var self=this;return'<div id="'+self._id+'" class="'+self.classes+'">'+self._getDataPathHtml(self.state.get("row"))+"</div>"},bindStates:function(){var self=this;return self.state.on("change:row",function(e){self.innerHtml(self._getDataPathHtml(e.value))}),self._super()},_getDataPathHtml:function(data){var i,l,self=this,parts=data||[],html="",prefix=self.classPrefix;for(i=0,l=parts.length;i<l;i++)html+=(i>0?'<div class="'+prefix+'divider" aria-hidden="true"> '+self.settings.delimiter+" </div>":"")+'<div role="button" class="'+prefix+"path-item"+(i==l-1?" "+prefix+"last":"")+'" data-index="'+i+'" tabindex="-1" id="'+self._id+"-"+i+'" aria-level="'+i+'">'+parts[i].name+"</div>";return html||(html='<div class="'+prefix+'path-item"></div>'),html}})}),define("tinymce/ui/ElementPath",["tinymce/ui/Path","tinymce/EditorManager"],function(Path,EditorManager){return Path.extend({postRender:function(){function isHidden(elm){if(1===elm.nodeType){if("BR"==elm.nodeName||elm.getAttribute("data-mce-bogus"))return!0;if("bookmark"===elm.getAttribute("data-mce-type"))return!0}return!1}var self=this,editor=EditorManager.activeEditor;return editor.settings.elementpath!==!1&&(self.on("select",function(e){editor.focus(),editor.selection.select(this.row()[e.index].element),editor.nodeChanged()}),editor.on("nodeChange",function(e){for(var outParents=[],parents=e.parents,i=parents.length;i--;)if(1==parents[i].nodeType&&!isHidden(parents[i])){var args=editor.fire("ResolveName",{name:parents[i].nodeName.toLowerCase(),target:parents[i]});if(args.isDefaultPrevented()||outParents.push({name:args.name,element:parents[i]}),args.isPropagationStopped())break}self.row(outParents)})),self._super()}})}),define("tinymce/ui/FormItem",["tinymce/ui/Container"],function(Container){return Container.extend({Defaults:{layout:"flex",align:"center",defaults:{flex:1}},renderHtml:function(){var self=this,layout=self._layout,prefix=self.classPrefix;return self.classes.add("formitem"),layout.preRender(self),'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1">'+(self.settings.title?'<div id="'+self._id+'-title" class="'+prefix+'title">'+self.settings.title+"</div>":"")+'<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div></div>"}})}),define("tinymce/ui/Form",["tinymce/ui/Container","tinymce/ui/FormItem","tinymce/util/Tools"],function(Container,FormItem,Tools){return Container.extend({Defaults:{containerCls:"form",layout:"flex",direction:"column",align:"stretch",flex:1,padding:20,labelGap:30,spacing:10,callbacks:{submit:function(){this.submit()}}},preRender:function(){var self=this,items=self.items();self.settings.formItemDefaults||(self.settings.formItemDefaults={layout:"flex",autoResize:"overflow",defaults:{flex:1}}),items.each(function(ctrl){var formItem,label=ctrl.settings.label;label&&(formItem=new FormItem(Tools.extend({items:{type:"label",id:ctrl._id+"-l",text:label,flex:0,forId:ctrl._id,disabled:ctrl.disabled()}},self.settings.formItemDefaults)),formItem.type="formitem",ctrl.aria("labelledby",ctrl._id+"-l"),"undefined"==typeof ctrl.settings.flex&&(ctrl.settings.flex=1),self.replace(ctrl,formItem),formItem.add(ctrl))})},submit:function(){return this.fire("submit",{data:this.toJSON()})},postRender:function(){var self=this;self._super(),self.fromJSON(self.settings.data)},bindStates:function(){function recalcLabels(){var i,labelGap,items,maxLabelWidth=0,labels=[];if(self.settings.labelGapCalc!==!1)for(items="children"==self.settings.labelGapCalc?self.find("formitem"):self.items(),
items.filter("formitem").each(function(item){var labelCtrl=item.items()[0],labelWidth=labelCtrl.getEl().clientWidth;maxLabelWidth=labelWidth>maxLabelWidth?labelWidth:maxLabelWidth,labels.push(labelCtrl)}),labelGap=self.settings.labelGap||0,i=labels.length;i--;)labels[i].settings.minWidth=maxLabelWidth+labelGap}var self=this;self._super(),self.on("show",recalcLabels),recalcLabels()}})}),define("tinymce/ui/FieldSet",["tinymce/ui/Form"],function(Form){return Form.extend({Defaults:{containerCls:"fieldset",layout:"flex",direction:"column",align:"stretch",flex:1,padding:"25 15 5 15",labelGap:30,spacing:10,border:1},renderHtml:function(){var self=this,layout=self._layout,prefix=self.classPrefix;return self.preRender(),layout.preRender(self),'<fieldset id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1">'+(self.settings.title?'<legend id="'+self._id+'-title" class="'+prefix+'fieldset-title">'+self.settings.title+"</legend>":"")+'<div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+(self.settings.html||"")+layout.renderHtml(self)+"</div></fieldset>"}})}),define("tinymce/ui/FilePicker",["tinymce/ui/ComboBox","tinymce/util/Tools"],function(ComboBox,Tools){return ComboBox.extend({init:function(settings){var actionCallback,fileBrowserCallback,fileBrowserCallbackTypes,self=this,editor=tinymce.activeEditor,editorSettings=editor.settings;settings.spellcheck=!1,fileBrowserCallbackTypes=editorSettings.file_picker_types||editorSettings.file_browser_callback_types,fileBrowserCallbackTypes&&(fileBrowserCallbackTypes=Tools.makeMap(fileBrowserCallbackTypes,/[, ]/)),fileBrowserCallbackTypes&&!fileBrowserCallbackTypes[settings.filetype]||(fileBrowserCallback=editorSettings.file_picker_callback,!fileBrowserCallback||fileBrowserCallbackTypes&&!fileBrowserCallbackTypes[settings.filetype]?(fileBrowserCallback=editorSettings.file_browser_callback,!fileBrowserCallback||fileBrowserCallbackTypes&&!fileBrowserCallbackTypes[settings.filetype]||(actionCallback=function(){fileBrowserCallback(self.getEl("inp").id,self.value(),settings.filetype,window)})):actionCallback=function(){var meta=self.fire("beforecall").meta;meta=Tools.extend({filetype:settings.filetype},meta),fileBrowserCallback.call(editor,function(value,meta){self.value(value).fire("change",{meta:meta})},self.value(),meta)}),actionCallback&&(settings.icon="browse",settings.onaction=actionCallback),self._super(settings)}})}),define("tinymce/ui/FitLayout",["tinymce/ui/AbsoluteLayout"],function(AbsoluteLayout){return AbsoluteLayout.extend({recalc:function(container){var contLayoutRect=container.layoutRect(),paddingBox=container.paddingBox;container.items().filter(":visible").each(function(ctrl){ctrl.layoutRect({x:paddingBox.left,y:paddingBox.top,w:contLayoutRect.innerW-paddingBox.right-paddingBox.left,h:contLayoutRect.innerH-paddingBox.top-paddingBox.bottom}),ctrl.recalc&&ctrl.recalc()})}})}),define("tinymce/ui/FlexLayout",["tinymce/ui/AbsoluteLayout"],function(AbsoluteLayout){return AbsoluteLayout.extend({recalc:function(container){var i,l,items,contLayoutRect,contPaddingBox,contSettings,align,pack,spacing,totalFlex,availableSpace,direction,ctrl,ctrlLayoutRect,ctrlSettings,flex,size,maxSize,ratio,rect,pos,maxAlignEndPos,sizeName,minSizeName,posName,maxSizeName,beforeName,innerSizeName,deltaSizeName,contentSizeName,alignAxisName,alignInnerSizeName,alignSizeName,alignMinSizeName,alignBeforeName,alignAfterName,alignDeltaSizeName,alignContentSizeName,maxSizeItems=[],max=Math.max,min=Math.min;for(items=container.items().filter(":visible"),contLayoutRect=container.layoutRect(),contPaddingBox=container.paddingBox,contSettings=container.settings,direction=container.isRtl()?contSettings.direction||"row-reversed":contSettings.direction,align=contSettings.align,pack=container.isRtl()?contSettings.pack||"end":contSettings.pack,spacing=contSettings.spacing||0,"row-reversed"!=direction&&"column-reverse"!=direction||(items=items.set(items.toArray().reverse()),direction=direction.split("-")[0]),"column"==direction?(posName="y",sizeName="h",minSizeName="minH",maxSizeName="maxH",innerSizeName="innerH",beforeName="top",deltaSizeName="deltaH",contentSizeName="contentH",alignBeforeName="left",alignSizeName="w",alignAxisName="x",alignInnerSizeName="innerW",alignMinSizeName="minW",alignAfterName="right",alignDeltaSizeName="deltaW",alignContentSizeName="contentW"):(posName="x",sizeName="w",minSizeName="minW",maxSizeName="maxW",innerSizeName="innerW",beforeName="left",deltaSizeName="deltaW",contentSizeName="contentW",alignBeforeName="top",alignSizeName="h",alignAxisName="y",alignInnerSizeName="innerH",alignMinSizeName="minH",alignAfterName="bottom",alignDeltaSizeName="deltaH",alignContentSizeName="contentH"),availableSpace=contLayoutRect[innerSizeName]-contPaddingBox[beforeName]-contPaddingBox[beforeName],maxAlignEndPos=totalFlex=0,i=0,l=items.length;i<l;i++)ctrl=items[i],ctrlLayoutRect=ctrl.layoutRect(),ctrlSettings=ctrl.settings,flex=ctrlSettings.flex,availableSpace-=i<l-1?spacing:0,flex>0&&(totalFlex+=flex,ctrlLayoutRect[maxSizeName]&&maxSizeItems.push(ctrl),ctrlLayoutRect.flex=flex),availableSpace-=ctrlLayoutRect[minSizeName],size=contPaddingBox[alignBeforeName]+ctrlLayoutRect[alignMinSizeName]+contPaddingBox[alignAfterName],size>maxAlignEndPos&&(maxAlignEndPos=size);if(rect={},availableSpace<0?rect[minSizeName]=contLayoutRect[minSizeName]-availableSpace+contLayoutRect[deltaSizeName]:rect[minSizeName]=contLayoutRect[innerSizeName]-availableSpace+contLayoutRect[deltaSizeName],rect[alignMinSizeName]=maxAlignEndPos+contLayoutRect[alignDeltaSizeName],rect[contentSizeName]=contLayoutRect[innerSizeName]-availableSpace,rect[alignContentSizeName]=maxAlignEndPos,rect.minW=min(rect.minW,contLayoutRect.maxW),rect.minH=min(rect.minH,contLayoutRect.maxH),rect.minW=max(rect.minW,contLayoutRect.startMinWidth),rect.minH=max(rect.minH,contLayoutRect.startMinHeight),!contLayoutRect.autoResize||rect.minW==contLayoutRect.minW&&rect.minH==contLayoutRect.minH){for(ratio=availableSpace/totalFlex,i=0,l=maxSizeItems.length;i<l;i++)ctrl=maxSizeItems[i],ctrlLayoutRect=ctrl.layoutRect(),maxSize=ctrlLayoutRect[maxSizeName],size=ctrlLayoutRect[minSizeName]+ctrlLayoutRect.flex*ratio,size>maxSize?(availableSpace-=ctrlLayoutRect[maxSizeName]-ctrlLayoutRect[minSizeName],totalFlex-=ctrlLayoutRect.flex,ctrlLayoutRect.flex=0,ctrlLayoutRect.maxFlexSize=maxSize):ctrlLayoutRect.maxFlexSize=0;for(ratio=availableSpace/totalFlex,pos=contPaddingBox[beforeName],rect={},0===totalFlex&&("end"==pack?pos=availableSpace+contPaddingBox[beforeName]:"center"==pack?(pos=Math.round(contLayoutRect[innerSizeName]/2-(contLayoutRect[innerSizeName]-availableSpace)/2)+contPaddingBox[beforeName],pos<0&&(pos=contPaddingBox[beforeName])):"justify"==pack&&(pos=contPaddingBox[beforeName],spacing=Math.floor(availableSpace/(items.length-1)))),rect[alignAxisName]=contPaddingBox[alignBeforeName],i=0,l=items.length;i<l;i++)ctrl=items[i],ctrlLayoutRect=ctrl.layoutRect(),size=ctrlLayoutRect.maxFlexSize||ctrlLayoutRect[minSizeName],"center"===align?rect[alignAxisName]=Math.round(contLayoutRect[alignInnerSizeName]/2-ctrlLayoutRect[alignSizeName]/2):"stretch"===align?(rect[alignSizeName]=max(ctrlLayoutRect[alignMinSizeName]||0,contLayoutRect[alignInnerSizeName]-contPaddingBox[alignBeforeName]-contPaddingBox[alignAfterName]),rect[alignAxisName]=contPaddingBox[alignBeforeName]):"end"===align&&(rect[alignAxisName]=contLayoutRect[alignInnerSizeName]-ctrlLayoutRect[alignSizeName]-contPaddingBox.top),ctrlLayoutRect.flex>0&&(size+=ctrlLayoutRect.flex*ratio),rect[sizeName]=size,rect[posName]=pos,ctrl.layoutRect(rect),ctrl.recalc&&ctrl.recalc(),pos+=size+spacing}else if(rect.w=rect.minW,rect.h=rect.minH,container.layoutRect(rect),this.recalc(container),null===container._lastRect){var parentCtrl=container.parent();parentCtrl&&(parentCtrl._lastRect=null,parentCtrl.recalc())}}})}),define("tinymce/ui/FlowLayout",["tinymce/ui/Layout"],function(Layout){return Layout.extend({Defaults:{containerClass:"flow-layout",controlClass:"flow-layout-item",endClass:"break"},recalc:function(container){container.items().filter(":visible").each(function(ctrl){ctrl.recalc&&ctrl.recalc()})},isNative:function(){return!0}})}),define("tinymce/ui/FormatControls",["tinymce/ui/Control","tinymce/ui/Widget","tinymce/ui/FloatPanel","tinymce/util/Tools","tinymce/EditorManager","tinymce/Env"],function(Control,Widget,FloatPanel,Tools,EditorManager,Env){function registerControls(editor){function createListBoxChangeHandler(items,formatName){return function(){var self=this;editor.on("nodeChange",function(e){var formatter=editor.formatter,value=null;each(e.parents,function(node){if(each(items,function(item){if(formatName?formatter.matchNode(node,formatName,{value:item.value})&&(value=item.value):formatter.matchNode(node,item.value)&&(value=item.value),value)return!1}),value)return!1}),self.value(value)})}}function createFormats(formats){formats=formats.replace(/;$/,"").split(";");for(var i=formats.length;i--;)formats[i]=formats[i].split("=");return formats}function createFormatMenu(){function createMenu(formats){var menu=[];if(formats)return each(formats,function(format){var menuItem={text:format.title,icon:format.icon};if(format.items)menuItem.menu=createMenu(format.items);else{var formatName=format.format||"custom"+count++;format.format||(format.name=formatName,newFormats.push(format)),menuItem.format=formatName,menuItem.cmd=format.cmd}menu.push(menuItem)}),menu}function createStylesMenu(){var menu;return menu=createMenu(editor.settings.style_formats_merge?editor.settings.style_formats?defaultStyleFormats.concat(editor.settings.style_formats):defaultStyleFormats:editor.settings.style_formats||defaultStyleFormats)}var count=0,newFormats=[],defaultStyleFormats=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}];return editor.on("init",function(){each(newFormats,function(format){editor.formatter.register(format.name,format)})}),{type:"menu",items:createStylesMenu(),onPostRender:function(e){editor.fire("renderFormatsMenu",{control:e.control})},itemDefaults:{preview:!0,textStyle:function(){if(this.settings.format)return editor.formatter.getCssText(this.settings.format)},onPostRender:function(){var self=this;self.parent().on("show",function(){var formatName,command;formatName=self.settings.format,formatName&&(self.disabled(!editor.formatter.canApply(formatName)),self.active(editor.formatter.match(formatName))),command=self.settings.cmd,command&&self.active(editor.queryCommandState(command))})},onclick:function(){this.settings.format&&toggleFormat(this.settings.format),this.settings.cmd&&editor.execCommand(this.settings.cmd)}}}}function initOnPostRender(name){return function(){var self=this;editor.formatter?editor.formatter.formatChanged(name,function(state){self.active(state)}):editor.on("init",function(){editor.formatter.formatChanged(name,function(state){self.active(state)})})}}function toggleUndoRedoState(type){return function(){function checkState(){return!!editor.undoManager&&editor.undoManager[type]()}var self=this;type="redo"==type?"hasRedo":"hasUndo",self.disabled(!checkState()),editor.on("Undo Redo AddUndo TypingUndo ClearUndos SwitchMode",function(){self.disabled(editor.readonly||!checkState())})}}function toggleVisualAidState(){var self=this;editor.on("VisualAid",function(e){self.active(e.hasVisual)}),self.active(editor.hasVisual)}function toggleFormat(fmt){fmt.control&&(fmt=fmt.control.value()),fmt&&editor.execCommand("mceToggleFormat",!1,fmt)}var formatMenu;formatMenu=createFormatMenu(),each({bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",subscript:"Subscript",superscript:"Superscript"},function(text,name){editor.addButton(name,{tooltip:text,onPostRender:initOnPostRender(name),onclick:function(){toggleFormat(name)}})}),each({outdent:["Decrease indent","Outdent"],indent:["Increase indent","Indent"],cut:["Cut","Cut"],copy:["Copy","Copy"],paste:["Paste","Paste"],help:["Help","mceHelp"],selectall:["Select all","SelectAll"],removeformat:["Clear formatting","RemoveFormat"],visualaid:["Visual aids","mceToggleVisualAid"],newdocument:["New document","mceNewDocument"]},function(item,name){editor.addButton(name,{tooltip:item[0],cmd:item[1]})}),each({blockquote:["Blockquote","mceBlockQuote"],numlist:["Numbered list","InsertOrderedList"],bullist:["Bullet list","InsertUnorderedList"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],alignleft:["Align left","JustifyLeft"],aligncenter:["Align center","JustifyCenter"],alignright:["Align right","JustifyRight"],alignjustify:["Justify","JustifyFull"],alignnone:["No alignment","JustifyNone"]},function(item,name){editor.addButton(name,{tooltip:item[0],cmd:item[1],onPostRender:initOnPostRender(name)})}),editor.addButton("undo",{tooltip:"Undo",onPostRender:toggleUndoRedoState("undo"),cmd:"undo"}),editor.addButton("redo",{tooltip:"Redo",onPostRender:toggleUndoRedoState("redo"),cmd:"redo"}),editor.addMenuItem("newdocument",{text:"New document",icon:"newdocument",cmd:"mceNewDocument"}),editor.addMenuItem("undo",{text:"Undo",icon:"undo",shortcut:"Meta+Z",onPostRender:toggleUndoRedoState("undo"),cmd:"undo"}),editor.addMenuItem("redo",{text:"Redo",icon:"redo",shortcut:"Meta+Y",onPostRender:toggleUndoRedoState("redo"),cmd:"redo"}),editor.addMenuItem("visualaid",{text:"Visual aids",selectable:!0,onPostRender:toggleVisualAidState,cmd:"mceToggleVisualAid"}),editor.addButton("remove",{tooltip:"Remove",icon:"remove",cmd:"Delete"}),each({cut:["Cut","Cut","Meta+X"],copy:["Copy","Copy","Meta+C"],paste:["Paste","Paste","Meta+V"],selectall:["Select all","SelectAll","Meta+A"],bold:["Bold","Bold","Meta+B"],italic:["Italic","Italic","Meta+I"],underline:["Underline","Underline"],strikethrough:["Strikethrough","Strikethrough"],subscript:["Subscript","Subscript"],superscript:["Superscript","Superscript"],removeformat:["Clear formatting","RemoveFormat"]},function(item,name){editor.addMenuItem(name,{text:item[0],icon:name,shortcut:item[2],cmd:item[1]})}),editor.on("mousedown",function(){FloatPanel.hideAll()}),editor.addButton("styleselect",{type:"menubutton",text:"Formats",menu:formatMenu}),editor.addButton("formatselect",function(){var items=[],blocks=createFormats(editor.settings.block_formats||"Paragraph=p;Heading 1=h1;Heading 2=h2;Heading 3=h3;Heading 4=h4;Heading 5=h5;Heading 6=h6;Preformatted=pre");return each(blocks,function(block){items.push({text:block[0],value:block[1],textStyle:function(){return editor.formatter.getCssText(block[1])}})}),{type:"listbox",text:blocks[0][0],values:items,fixedWidth:!0,onselect:toggleFormat,onPostRender:createListBoxChangeHandler(items)}}),editor.addButton("fontselect",function(){var defaultFontsFormats="Andale Mono=andale mono,monospace;Arial=arial,helvetica,sans-serif;Arial Black=arial black,sans-serif;Book Antiqua=book antiqua,palatino,serif;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier,monospace;Georgia=georgia,palatino,serif;Helvetica=helvetica,arial,sans-serif;Impact=impact,sans-serif;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco,monospace;Times New Roman=times new roman,times,serif;Trebuchet MS=trebuchet ms,geneva,sans-serif;Verdana=verdana,geneva,sans-serif;Webdings=webdings;Wingdings=wingdings,zapf dingbats",items=[],fonts=createFormats(editor.settings.font_formats||defaultFontsFormats);return each(fonts,function(font){items.push({text:{raw:font[0]},value:font[1],textStyle:font[1].indexOf("dings")==-1?"font-family:"+font[1]:""})}),{type:"listbox",text:"Font Family",tooltip:"Font Family",values:items,fixedWidth:!0,onPostRender:createListBoxChangeHandler(items,"fontname"),onselect:function(e){e.control.settings.value&&editor.execCommand("FontName",!1,e.control.settings.value)}}}),editor.addButton("fontsizeselect",function(){var items=[],defaultFontsizeFormats="8pt 10pt 12pt 14pt 18pt 24pt 36pt",fontsize_formats=editor.settings.fontsize_formats||defaultFontsizeFormats;return each(fontsize_formats.split(" "),function(item){var text=item,value=item,values=item.split("=");values.length>1&&(text=values[0],value=values[1]),items.push({text:text,value:value})}),{type:"listbox",text:"Font Sizes",tooltip:"Font Sizes",values:items,fixedWidth:!0,onPostRender:createListBoxChangeHandler(items,"fontsize"),onclick:function(e){e.control.settings.value&&editor.execCommand("FontSize",!1,e.control.settings.value)}}}),editor.addMenuItem("formats",{text:"Formats",menu:formatMenu})}var each=Tools.each;EditorManager.on("AddEditor",function(e){e.editor.rtl&&(Control.rtl=!0),registerControls(e.editor)}),Control.translate=function(text){return EditorManager.translate(text)},Widget.tooltips=!Env.iOS}),define("tinymce/ui/GridLayout",["tinymce/ui/AbsoluteLayout"],function(AbsoluteLayout){return AbsoluteLayout.extend({recalc:function(container){var settings,rows,cols,items,contLayoutRect,width,height,rect,ctrlLayoutRect,ctrl,x,y,posX,posY,ctrlSettings,contPaddingBox,align,spacingH,spacingV,alignH,alignV,maxX,maxY,ctrlMinWidth,ctrlMinHeight,availableWidth,availableHeight,reverseRows,idx,colWidths=[],rowHeights=[];settings=container.settings,items=container.items().filter(":visible"),contLayoutRect=container.layoutRect(),cols=settings.columns||Math.ceil(Math.sqrt(items.length)),rows=Math.ceil(items.length/cols),spacingH=settings.spacingH||settings.spacing||0,spacingV=settings.spacingV||settings.spacing||0,alignH=settings.alignH||settings.align,alignV=settings.alignV||settings.align,contPaddingBox=container.paddingBox,reverseRows="reverseRows"in settings?settings.reverseRows:container.isRtl(),alignH&&"string"==typeof alignH&&(alignH=[alignH]),alignV&&"string"==typeof alignV&&(alignV=[alignV]);for(x=0;x<cols;x++)colWidths.push(0);for(y=0;y<rows;y++)rowHeights.push(0);for(y=0;y<rows;y++)for(x=0;x<cols&&(ctrl=items[y*cols+x],ctrl);x++)ctrlLayoutRect=ctrl.layoutRect(),ctrlMinWidth=ctrlLayoutRect.minW,ctrlMinHeight=ctrlLayoutRect.minH,colWidths[x]=ctrlMinWidth>colWidths[x]?ctrlMinWidth:colWidths[x],rowHeights[y]=ctrlMinHeight>rowHeights[y]?ctrlMinHeight:rowHeights[y];for(availableWidth=contLayoutRect.innerW-contPaddingBox.left-contPaddingBox.right,maxX=0,x=0;x<cols;x++)maxX+=colWidths[x]+(x>0?spacingH:0),availableWidth-=(x>0?spacingH:0)+colWidths[x];for(availableHeight=contLayoutRect.innerH-contPaddingBox.top-contPaddingBox.bottom,maxY=0,y=0;y<rows;y++)maxY+=rowHeights[y]+(y>0?spacingV:0),availableHeight-=(y>0?spacingV:0)+rowHeights[y];if(maxX+=contPaddingBox.left+contPaddingBox.right,maxY+=contPaddingBox.top+contPaddingBox.bottom,rect={},rect.minW=maxX+(contLayoutRect.w-contLayoutRect.innerW),rect.minH=maxY+(contLayoutRect.h-contLayoutRect.innerH),rect.contentW=rect.minW-contLayoutRect.deltaW,rect.contentH=rect.minH-contLayoutRect.deltaH,rect.minW=Math.min(rect.minW,contLayoutRect.maxW),rect.minH=Math.min(rect.minH,contLayoutRect.maxH),rect.minW=Math.max(rect.minW,contLayoutRect.startMinWidth),rect.minH=Math.max(rect.minH,contLayoutRect.startMinHeight),!contLayoutRect.autoResize||rect.minW==contLayoutRect.minW&&rect.minH==contLayoutRect.minH){contLayoutRect.autoResize&&(rect=container.layoutRect(rect),rect.contentW=rect.minW-contLayoutRect.deltaW,rect.contentH=rect.minH-contLayoutRect.deltaH);var flexV;flexV="start"==settings.packV?0:availableHeight>0?Math.floor(availableHeight/rows):0;var totalFlex=0,flexWidths=settings.flexWidths;if(flexWidths)for(x=0;x<flexWidths.length;x++)totalFlex+=flexWidths[x];else totalFlex=cols;var ratio=availableWidth/totalFlex;for(x=0;x<cols;x++)colWidths[x]+=flexWidths?flexWidths[x]*ratio:ratio;for(posY=contPaddingBox.top,y=0;y<rows;y++){for(posX=contPaddingBox.left,height=rowHeights[y]+flexV,x=0;x<cols&&(idx=reverseRows?y*cols+cols-1-x:y*cols+x,ctrl=items[idx],ctrl);x++)ctrlSettings=ctrl.settings,ctrlLayoutRect=ctrl.layoutRect(),width=Math.max(colWidths[x],ctrlLayoutRect.startMinWidth),ctrlLayoutRect.x=posX,ctrlLayoutRect.y=posY,align=ctrlSettings.alignH||(alignH?alignH[x]||alignH[0]:null),"center"==align?ctrlLayoutRect.x=posX+width/2-ctrlLayoutRect.w/2:"right"==align?ctrlLayoutRect.x=posX+width-ctrlLayoutRect.w:"stretch"==align&&(ctrlLayoutRect.w=width),align=ctrlSettings.alignV||(alignV?alignV[x]||alignV[0]:null),"center"==align?ctrlLayoutRect.y=posY+height/2-ctrlLayoutRect.h/2:"bottom"==align?ctrlLayoutRect.y=posY+height-ctrlLayoutRect.h:"stretch"==align&&(ctrlLayoutRect.h=height),ctrl.layoutRect(ctrlLayoutRect),posX+=width+spacingH,ctrl.recalc&&ctrl.recalc();posY+=height+spacingV}}else if(rect.w=rect.minW,rect.h=rect.minH,container.layoutRect(rect),this.recalc(container),null===container._lastRect){var parentCtrl=container.parent();parentCtrl&&(parentCtrl._lastRect=null,parentCtrl.recalc())}}})}),define("tinymce/ui/Iframe",["tinymce/ui/Widget","tinymce/util/Delay"],function(Widget,Delay){return Widget.extend({renderHtml:function(){var self=this;return self.classes.add("iframe"),self.canFocus=!1,'<iframe id="'+self._id+'" class="'+self.classes+'" tabindex="-1" src="'+(self.settings.url||"javascript:''")+'" frameborder="0"></iframe>'},src:function(src){this.getEl().src=src},html:function(html,callback){var self=this,body=this.getEl().contentWindow.document.body;return body?(body.innerHTML=html,callback&&callback()):Delay.setTimeout(function(){self.html(html)}),this}})}),define("tinymce/ui/InfoBox",["tinymce/ui/Widget"],function(Widget){return Widget.extend({init:function(settings){var self=this;self._super(settings),self.classes.add("widget").add("infobox"),self.canFocus=!1},severity:function(level){this.classes.remove("error"),this.classes.remove("warning"),this.classes.remove("success"),this.classes.add(level)},help:function(state){this.state.set("help",state)},renderHtml:function(){var self=this,prefix=self.classPrefix;return'<div id="'+self._id+'" class="'+self.classes+'"><div id="'+self._id+'-body">'+self.encode(self.state.get("text"))+'<button role="button" tabindex="-1"><i class="'+prefix+"ico "+prefix+'i-help"></i></button></div></div>'},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.getEl("body").firstChild.data=self.encode(e.value),self.state.get("rendered")&&self.updateLayoutRect()}),self.state.on("change:help",function(e){self.classes.toggle("has-help",e.value),self.state.get("rendered")&&self.updateLayoutRect()}),self._super()}})}),define("tinymce/ui/Label",["tinymce/ui/Widget","tinymce/ui/DomUtils"],function(Widget,DomUtils){return Widget.extend({init:function(settings){var self=this;self._super(settings),self.classes.add("widget").add("label"),self.canFocus=!1,settings.multiline&&self.classes.add("autoscroll"),settings.strong&&self.classes.add("strong")},initLayoutRect:function(){var self=this,layoutRect=self._super();if(self.settings.multiline){var size=DomUtils.getSize(self.getEl());size.width>layoutRect.maxW&&(layoutRect.minW=layoutRect.maxW,self.classes.add("multiline")),self.getEl().style.width=layoutRect.minW+"px",layoutRect.startMinH=layoutRect.h=layoutRect.minH=Math.min(layoutRect.maxH,DomUtils.getSize(self.getEl()).height)}return layoutRect},repaint:function(){var self=this;return self.settings.multiline||(self.getEl().style.lineHeight=self.layoutRect().h+"px"),self._super()},severity:function(level){this.classes.remove("error"),this.classes.remove("warning"),this.classes.remove("success"),this.classes.add(level)},renderHtml:function(){var targetCtrl,forName,self=this,forId=self.settings.forId;return!forId&&(forName=self.settings.forName)&&(targetCtrl=self.getRoot().find("#"+forName)[0],targetCtrl&&(forId=targetCtrl._id)),forId?'<label id="'+self._id+'" class="'+self.classes+'"'+(forId?' for="'+forId+'"':"")+">"+self.encode(self.state.get("text"))+"</label>":'<span id="'+self._id+'" class="'+self.classes+'">'+self.encode(self.state.get("text"))+"</span>"},bindStates:function(){var self=this;return self.state.on("change:text",function(e){self.innerHtml(self.encode(e.value)),self.state.get("rendered")&&self.updateLayoutRect()}),self._super()}})}),define("tinymce/ui/Toolbar",["tinymce/ui/Container"],function(Container){return Container.extend({Defaults:{role:"toolbar",layout:"flow"},init:function(settings){var self=this;self._super(settings),self.classes.add("toolbar")},postRender:function(){var self=this;return self.items().each(function(ctrl){ctrl.classes.add("toolbar-item")}),self._super()}})}),define("tinymce/ui/MenuBar",["tinymce/ui/Toolbar"],function(Toolbar){return Toolbar.extend({Defaults:{role:"menubar",containerCls:"menubar",ariaRoot:!0,defaults:{type:"menubutton"}}})}),define("tinymce/ui/MenuButton",["tinymce/ui/Button","tinymce/ui/Factory","tinymce/ui/MenuBar"],function(Button,Factory,MenuBar){function isChildOf(node,parent){for(;node;){if(parent===node)return!0;node=node.parentNode}return!1}var MenuButton=Button.extend({init:function(settings){var self=this;self._renderOpen=!0,self._super(settings),settings=self.settings,self.classes.add("menubtn"),settings.fixedWidth&&self.classes.add("fixed-width"),self.aria("haspopup",!0),self.state.set("menu",settings.menu||self.render())},showMenu:function(){var menu,self=this;return self.menu&&self.menu.visible()?self.hideMenu():(self.menu||(menu=self.state.get("menu")||[],menu.length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",menu.renderTo?self.menu=menu.parent(self).show().renderTo():self.menu=Factory.create(menu).parent(self).renderTo(),self.fire("createmenu"),self.menu.reflow(),self.menu.on("cancel",function(e){e.control.parent()===self.menu&&(e.stopPropagation(),self.focus(),self.hideMenu())}),self.menu.on("select",function(){self.focus()}),self.menu.on("show hide",function(e){e.control==self.menu&&self.activeMenu("show"==e.type),self.aria("expanded","show"==e.type)}).fire("show")),self.menu.show(),self.menu.layoutRect({w:self.layoutRect().w}),void self.menu.moveRel(self.getEl(),self.isRtl()?["br-tr","tr-br"]:["bl-tl","tl-bl"]))},hideMenu:function(){var self=this;self.menu&&(self.menu.items().each(function(item){item.hideMenu&&item.hideMenu()}),self.menu.hide())},activeMenu:function(state){this.classes.toggle("active",state)},renderHtml:function(){var image,self=this,id=self._id,prefix=self.classPrefix,icon=self.settings.icon,text=self.state.get("text"),textHtml="";return image=self.settings.image,image?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1]),image=" style=\"background-image: url('"+image+"')\""):image="",text&&(self.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"),icon=self.settings.icon?prefix+"ico "+prefix+"i-"+icon:"",self.aria("role",self.parent()instanceof MenuBar?"menuitem":"button"),'<div id="'+id+'" class="'+self.classes+'" tabindex="-1" aria-labelledby="'+id+'"><button id="'+id+'-open" role="presentation" type="button" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+' <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var self=this;return self.on("click",function(e){e.control===self&&isChildOf(e.target,self.getEl())&&(self.showMenu(),e.aria&&self.menu.items()[0].focus())}),self.on("mouseenter",function(e){var hasVisibleSiblingMenu,overCtrl=e.control,parent=self.parent();overCtrl&&parent&&overCtrl instanceof MenuButton&&overCtrl.parent()==parent&&(parent.items().filter("MenuButton").each(function(ctrl){ctrl.hideMenu&&ctrl!=overCtrl&&(ctrl.menu&&ctrl.menu.visible()&&(hasVisibleSiblingMenu=!0),ctrl.hideMenu())}),hasVisibleSiblingMenu&&(overCtrl.focus(),overCtrl.showMenu()))}),self._super()},bindStates:function(){var self=this;return self.state.on("change:menu",function(){self.menu&&self.menu.remove(),self.menu=null}),self._super()},remove:function(){this._super(),this.menu&&this.menu.remove()}});return MenuButton}),define("tinymce/ui/MenuItem",["tinymce/ui/Widget","tinymce/ui/Factory","tinymce/Env","tinymce/util/Delay"],function(Widget,Factory,Env,Delay){return Widget.extend({Defaults:{border:0,role:"menuitem"},init:function(settings){var text,self=this;self._super(settings),settings=self.settings,self.classes.add("menu-item"),settings.menu&&self.classes.add("menu-item-expand"),settings.preview&&self.classes.add("menu-item-preview"),text=self.state.get("text"),"-"!==text&&"|"!==text||(self.classes.add("menu-item-sep"),self.aria("role","separator"),self.state.set("text","-")),settings.selectable&&(self.aria("role","menuitemcheckbox"),self.classes.add("menu-item-checkbox"),settings.icon="selected"),settings.preview||settings.selectable||self.classes.add("menu-item-normal"),self.on("mousedown",function(e){e.preventDefault()}),settings.menu&&!settings.ariaHideMenu&&self.aria("haspopup",!0)},hasMenus:function(){return!!this.settings.menu},showMenu:function(){var menu,self=this,settings=self.settings,parent=self.parent();if(parent.items().each(function(ctrl){ctrl!==self&&ctrl.hideMenu()}),settings.menu){menu=self.menu,menu?menu.show():(menu=settings.menu,menu.length?menu={type:"menu",items:menu}:menu.type=menu.type||"menu",parent.settings.itemDefaults&&(menu.itemDefaults=parent.settings.itemDefaults),menu=self.menu=Factory.create(menu).parent(self).renderTo(),menu.reflow(),menu.on("cancel",function(e){e.stopPropagation(),self.focus(),menu.hide()}),menu.on("show hide",function(e){e.control.items().each(function(ctrl){ctrl.active(ctrl.settings.selected)})}).fire("show"),menu.on("hide",function(e){e.control===menu&&self.classes.remove("selected")}),menu.submenu=!0),menu._parentMenu=parent,menu.classes.add("menu-sub");var rel=menu.testMoveRel(self.getEl(),self.isRtl()?["tl-tr","bl-br","tr-tl","br-bl"]:["tr-tl","br-bl","tl-tr","bl-br"]);menu.moveRel(self.getEl(),rel),menu.rel=rel,rel="menu-sub-"+rel,menu.classes.remove(menu._lastRel).add(rel),menu._lastRel=rel,self.classes.add("selected"),self.aria("expanded",!0)}},hideMenu:function(){var self=this;return self.menu&&(self.menu.items().each(function(item){item.hideMenu&&item.hideMenu()}),self.menu.hide(),self.aria("expanded",!1)),self},renderHtml:function(){function convertShortcut(shortcut){var i,value,replace={};for(replace=Env.mac?{alt:"&#x2325;",ctrl:"&#x2318;",shift:"&#x21E7;",meta:"&#x2318;"}:{meta:"Ctrl"},shortcut=shortcut.split("+"),i=0;i<shortcut.length;i++)value=replace[shortcut[i].toLowerCase()],value&&(shortcut[i]=value);return shortcut.join("+")}var self=this,id=self._id,settings=self.settings,prefix=self.classPrefix,text=self.encode(self.state.get("text")),icon=self.settings.icon,image="",shortcut=settings.shortcut;return icon&&self.parent().classes.add("menu-has-icons"),settings.image&&(image=" style=\"background-image: url('"+settings.image+"')\""),shortcut&&(shortcut=convertShortcut(shortcut)),icon=prefix+"ico "+prefix+"i-"+(self.settings.icon||"none"),'<div id="'+id+'" class="'+self.classes+'" tabindex="-1">'+("-"!==text?'<i class="'+icon+'"'+image+"></i>":"")+("-"!==text?'<span id="'+id+'-text" class="'+prefix+'text">'+text+"</span>":"")+(shortcut?'<div id="'+id+'-shortcut" class="'+prefix+'menu-shortcut">'+shortcut+"</div>":"")+(settings.menu?'<div class="'+prefix+'caret"></div>':"")+"</div>"},postRender:function(){var self=this,settings=self.settings,textStyle=settings.textStyle;
if("function"==typeof textStyle&&(textStyle=textStyle.call(this)),textStyle){var textElm=self.getEl("text");textElm&&textElm.setAttribute("style",textStyle)}return self.on("mouseenter click",function(e){e.control===self&&(settings.menu||"click"!==e.type?(self.showMenu(),e.aria&&self.menu.focus(!0)):(self.fire("select"),Delay.requestAnimationFrame(function(){self.parent().hideAll()})))}),self._super(),self},hover:function(){var self=this;return self.parent().items().each(function(ctrl){ctrl.classes.remove("selected")}),self.classes.toggle("selected",!0),self},active:function(state){return"undefined"!=typeof state&&this.aria("checked",state),this._super(state)},remove:function(){this._super(),this.menu&&this.menu.remove()}})}),define("tinymce/ui/Throbber",["tinymce/dom/DomQuery","tinymce/ui/Control","tinymce/util/Delay"],function($,Control,Delay){return function(elm,inline){var state,timer,self=this,classPrefix=Control.classPrefix;self.show=function(time,callback){function render(){state&&($(elm).append('<div class="'+classPrefix+"throbber"+(inline?" "+classPrefix+"throbber-inline":"")+'"></div>'),callback&&callback())}return self.hide(),state=!0,time?timer=Delay.setTimeout(render,time):render(),self},self.hide=function(){var child=elm.lastChild;return Delay.clearTimeout(timer),child&&child.className.indexOf("throbber")!=-1&&child.parentNode.removeChild(child),state=!1,self}}}),define("tinymce/ui/Menu",["tinymce/ui/FloatPanel","tinymce/ui/MenuItem","tinymce/ui/Throbber","tinymce/util/Tools"],function(FloatPanel,MenuItem,Throbber,Tools){return FloatPanel.extend({Defaults:{defaultType:"menuitem",border:1,layout:"stack",role:"application",bodyRole:"menu",ariaRoot:!0},init:function(settings){var self=this;if(settings.autohide=!0,settings.constrainToViewport=!0,"function"==typeof settings.items&&(settings.itemsFactory=settings.items,settings.items=[]),settings.itemDefaults)for(var items=settings.items,i=items.length;i--;)items[i]=Tools.extend({},settings.itemDefaults,items[i]);self._super(settings),self.classes.add("menu")},repaint:function(){return this.classes.toggle("menu-align",!0),this._super(),this.getEl().style.height="",this.getEl("body").style.height="",this},cancel:function(){var self=this;self.hideAll(),self.fire("select")},load:function(){function hideThrobber(){self.throbber&&(self.throbber.hide(),self.throbber=null)}var time,factory,self=this;factory=self.settings.itemsFactory,factory&&(self.throbber||(self.throbber=new Throbber(self.getEl("body"),(!0)),0===self.items().length?(self.throbber.show(),self.fire("loading")):self.throbber.show(100,function(){self.items().remove(),self.fire("loading")}),self.on("hide close",hideThrobber)),self.requestTime=time=(new Date).getTime(),self.settings.itemsFactory(function(items){return 0===items.length?void self.hide():void(self.requestTime===time&&(self.getEl().style.width="",self.getEl("body").style.width="",hideThrobber(),self.items().remove(),self.getEl("body").innerHTML="",self.add(items),self.renderNew(),self.fire("loaded")))}))},hideAll:function(){var self=this;return this.find("menuitem").exec("hideMenu"),self._super()},preRender:function(){var self=this;return self.items().each(function(ctrl){var settings=ctrl.settings;if(settings.icon||settings.image||settings.selectable)return self._hasIcons=!0,!1}),self.settings.itemsFactory&&self.on("postrender",function(){self.settings.itemsFactory&&self.load()}),self._super()}})}),define("tinymce/ui/ListBox",["tinymce/ui/MenuButton","tinymce/ui/Menu"],function(MenuButton,Menu){return MenuButton.extend({init:function(settings){function setSelected(menuValues){for(var i=0;i<menuValues.length;i++){if(selected=menuValues[i].selected||settings.value===menuValues[i].value)return selectedText=selectedText||menuValues[i].text,self.state.set("value",menuValues[i].value),!0;if(menuValues[i].menu&&setSelected(menuValues[i].menu))return!0}}var values,selected,selectedText,lastItemCtrl,self=this;self._super(settings),settings=self.settings,self._values=values=settings.values,values&&("undefined"!=typeof settings.value&&setSelected(values),!selected&&values.length>0&&(selectedText=values[0].text,self.state.set("value",values[0].value)),self.state.set("menu",values)),self.state.set("text",settings.text||selectedText),self.classes.add("listbox"),self.on("select",function(e){var ctrl=e.control;lastItemCtrl&&(e.lastControl=lastItemCtrl),settings.multiple?ctrl.active(!ctrl.active()):self.value(e.control.value()),lastItemCtrl=ctrl})},bindStates:function(){function activateMenuItemsByValue(menu,value){menu instanceof Menu&&menu.items().each(function(ctrl){ctrl.hasMenus()||ctrl.active(ctrl.value()===value)})}function getSelectedItem(menuValues,value){var selectedItem;if(menuValues)for(var i=0;i<menuValues.length;i++){if(menuValues[i].value===value)return menuValues[i];if(menuValues[i].menu&&(selectedItem=getSelectedItem(menuValues[i].menu,value)))return selectedItem}}var self=this;return self.on("show",function(e){activateMenuItemsByValue(e.control,self.value())}),self.state.on("change:value",function(e){var selectedItem=getSelectedItem(self.state.get("menu"),e.value);selectedItem?self.text(selectedItem.text):self.text(self.settings.text)}),self._super()}})}),define("tinymce/ui/Radio",["tinymce/ui/Checkbox"],function(Checkbox){return Checkbox.extend({Defaults:{classes:"radio",role:"radio"}})}),define("tinymce/ui/ResizeHandle",["tinymce/ui/Widget","tinymce/ui/DragHelper"],function(Widget,DragHelper){return Widget.extend({renderHtml:function(){var self=this,prefix=self.classPrefix;return self.classes.add("resizehandle"),"both"==self.settings.direction&&self.classes.add("resizehandle-both"),self.canFocus=!1,'<div id="'+self._id+'" class="'+self.classes+'"><i class="'+prefix+"ico "+prefix+'i-resize"></i></div>'},postRender:function(){var self=this;self._super(),self.resizeDragHelper=new DragHelper(this._id,{start:function(){self.fire("ResizeStart")},drag:function(e){"both"!=self.settings.direction&&(e.deltaX=0),self.fire("Resize",e)},stop:function(){self.fire("ResizeEnd")}})},remove:function(){return this.resizeDragHelper&&this.resizeDragHelper.destroy(),this._super()}})}),define("tinymce/ui/SelectBox",["tinymce/ui/Widget"],function(Widget){function createOptions(options){var strOptions="";if(options)for(var i=0;i<options.length;i++)strOptions+='<option value="'+options[i]+'">'+options[i]+"</option>";return strOptions}return Widget.extend({Defaults:{classes:"selectbox",role:"selectbox",options:[]},init:function(settings){var self=this;self._super(settings),self.settings.size&&(self.size=self.settings.size),self.settings.options&&(self._options=self.settings.options),self.on("keydown",function(e){var rootControl;13==e.keyCode&&(e.preventDefault(),self.parents().reverse().each(function(ctrl){if(ctrl.toJSON)return rootControl=ctrl,!1}),self.fire("submit",{data:rootControl.toJSON()}))})},options:function(state){return arguments.length?(this.state.set("options",state),this):this.state.get("options")},renderHtml:function(){var options,self=this,size="";return options=createOptions(self._options),self.size&&(size=' size = "'+self.size+'"'),'<select id="'+self._id+'" class="'+self.classes+'"'+size+">"+options+"</select>"},bindStates:function(){var self=this;return self.state.on("change:options",function(e){self.getEl().innerHTML=createOptions(e.value)}),self._super()}})}),define("tinymce/ui/Slider",["tinymce/ui/Widget","tinymce/ui/DragHelper","tinymce/ui/DomUtils"],function(Widget,DragHelper,DomUtils){function constrain(value,minVal,maxVal){return value<minVal&&(value=minVal),value>maxVal&&(value=maxVal),value}function setAriaProp(el,name,value){el.setAttribute("aria-"+name,value)}function updateSliderHandle(ctrl,value){var maxHandlePos,shortSizeName,sizeName,stylePosName,styleValue,handleEl;"v"==ctrl.settings.orientation?(stylePosName="top",sizeName="height",shortSizeName="h"):(stylePosName="left",sizeName="width",shortSizeName="w"),handleEl=ctrl.getEl("handle"),maxHandlePos=(ctrl.layoutRect()[shortSizeName]||100)-DomUtils.getSize(handleEl)[sizeName],styleValue=maxHandlePos*((value-ctrl._minValue)/(ctrl._maxValue-ctrl._minValue))+"px",handleEl.style[stylePosName]=styleValue,handleEl.style.height=ctrl.layoutRect().h+"px",setAriaProp(handleEl,"valuenow",value),setAriaProp(handleEl,"valuetext",""+ctrl.settings.previewFilter(value)),setAriaProp(handleEl,"valuemin",ctrl._minValue),setAriaProp(handleEl,"valuemax",ctrl._maxValue)}return Widget.extend({init:function(settings){var self=this;settings.previewFilter||(settings.previewFilter=function(value){return Math.round(100*value)/100}),self._super(settings),self.classes.add("slider"),"v"==settings.orientation&&self.classes.add("vertical"),self._minValue=settings.minValue||0,self._maxValue=settings.maxValue||100,self._initValue=self.state.get("value")},renderHtml:function(){var self=this,id=self._id,prefix=self.classPrefix;return'<div id="'+id+'" class="'+self.classes+'"><div id="'+id+'-handle" class="'+prefix+'slider-handle" role="slider" tabindex="-1"></div></div>'},reset:function(){this.value(this._initValue).repaint()},postRender:function(){function toFraction(min,max,val){return(val+min)/(max-min)}function fromFraction(min,max,val){return val*(max-min)-min}function handleKeyboard(minValue,maxValue){function alter(delta){var value;value=self.value(),value=fromFraction(minValue,maxValue,toFraction(minValue,maxValue,value)+.05*delta),value=constrain(value,minValue,maxValue),self.value(value),self.fire("dragstart",{value:value}),self.fire("drag",{value:value}),self.fire("dragend",{value:value})}self.on("keydown",function(e){switch(e.keyCode){case 37:case 38:alter(-1);break;case 39:case 40:alter(1)}})}function handleDrag(minValue,maxValue,handleEl){var startPos,startHandlePos,maxHandlePos,handlePos,value;self._dragHelper=new DragHelper(self._id,{handle:self._id+"-handle",start:function(e){startPos=e[screenCordName],startHandlePos=parseInt(self.getEl("handle").style[stylePosName],10),maxHandlePos=(self.layoutRect()[shortSizeName]||100)-DomUtils.getSize(handleEl)[sizeName],self.fire("dragstart",{value:value})},drag:function(e){var delta=e[screenCordName]-startPos;handlePos=constrain(startHandlePos+delta,0,maxHandlePos),handleEl.style[stylePosName]=handlePos+"px",value=minValue+handlePos/maxHandlePos*(maxValue-minValue),self.value(value),self.tooltip().text(""+self.settings.previewFilter(value)).show().moveRel(handleEl,"bc tc"),self.fire("drag",{value:value})},stop:function(){self.tooltip().hide(),self.fire("dragend",{value:value})}})}var minValue,maxValue,screenCordName,stylePosName,sizeName,shortSizeName,self=this;minValue=self._minValue,maxValue=self._maxValue,"v"==self.settings.orientation?(screenCordName="screenY",stylePosName="top",sizeName="height",shortSizeName="h"):(screenCordName="screenX",stylePosName="left",sizeName="width",shortSizeName="w"),self._super(),handleKeyboard(minValue,maxValue,self.getEl("handle")),handleDrag(minValue,maxValue,self.getEl("handle"))},repaint:function(){this._super(),updateSliderHandle(this,this.value())},bindStates:function(){var self=this;return self.state.on("change:value",function(e){updateSliderHandle(self,e.value)}),self._super()}})}),define("tinymce/ui/Spacer",["tinymce/ui/Widget"],function(Widget){return Widget.extend({renderHtml:function(){var self=this;return self.classes.add("spacer"),self.canFocus=!1,'<div id="'+self._id+'" class="'+self.classes+'"></div>'}})}),define("tinymce/ui/SplitButton",["tinymce/ui/MenuButton","tinymce/ui/DomUtils","tinymce/dom/DomQuery"],function(MenuButton,DomUtils,$){return MenuButton.extend({Defaults:{classes:"widget btn splitbtn",role:"button"},repaint:function(){var mainButtonElm,menuButtonElm,self=this,elm=self.getEl(),rect=self.layoutRect();return self._super(),mainButtonElm=elm.firstChild,menuButtonElm=elm.lastChild,$(mainButtonElm).css({width:rect.w-DomUtils.getSize(menuButtonElm).width,height:rect.h-2}),$(menuButtonElm).css({height:rect.h-2}),self},activeMenu:function(state){var self=this;$(self.getEl().lastChild).toggleClass(self.classPrefix+"active",state)},renderHtml:function(){var image,self=this,id=self._id,prefix=self.classPrefix,icon=self.state.get("icon"),text=self.state.get("text"),textHtml="";return image=self.settings.image,image?(icon="none","string"!=typeof image&&(image=window.getSelection?image[0]:image[1]),image=" style=\"background-image: url('"+image+"')\""):image="",icon=self.settings.icon?prefix+"ico "+prefix+"i-"+icon:"",text&&(self.classes.add("btn-has-text"),textHtml='<span class="'+prefix+'txt">'+self.encode(text)+"</span>"),'<div id="'+id+'" class="'+self.classes+'" role="button" tabindex="-1"><button type="button" hidefocus="1" tabindex="-1">'+(icon?'<i class="'+icon+'"'+image+"></i>":"")+textHtml+'</button><button type="button" class="'+prefix+'open" hidefocus="1" tabindex="-1">'+(self._menuBtnText?(icon?"":"")+self._menuBtnText:"")+' <i class="'+prefix+'caret"></i></button></div>'},postRender:function(){var self=this,onClickHandler=self.settings.onclick;return self.on("click",function(e){var node=e.target;if(e.control==this)for(;node;){if(e.aria&&"down"!=e.aria.key||"BUTTON"==node.nodeName&&node.className.indexOf("open")==-1)return e.stopImmediatePropagation(),void(onClickHandler&&onClickHandler.call(this,e));node=node.parentNode}}),delete self.settings.onclick,self._super()}})}),define("tinymce/ui/StackLayout",["tinymce/ui/FlowLayout"],function(FlowLayout){return FlowLayout.extend({Defaults:{containerClass:"stack-layout",controlClass:"stack-layout-item",endClass:"break"},isNative:function(){return!0}})}),define("tinymce/ui/TabPanel",["tinymce/ui/Panel","tinymce/dom/DomQuery","tinymce/ui/DomUtils"],function(Panel,$,DomUtils){return Panel.extend({Defaults:{layout:"absolute",defaults:{type:"panel"}},activateTab:function(idx){var activeTabElm;this.activeTabId&&(activeTabElm=this.getEl(this.activeTabId),$(activeTabElm).removeClass(this.classPrefix+"active"),activeTabElm.setAttribute("aria-selected","false")),this.activeTabId="t"+idx,activeTabElm=this.getEl("t"+idx),activeTabElm.setAttribute("aria-selected","true"),$(activeTabElm).addClass(this.classPrefix+"active"),this.items()[idx].show().fire("showtab"),this.reflow(),this.items().each(function(item,i){idx!=i&&item.hide()})},renderHtml:function(){var self=this,layout=self._layout,tabsHtml="",prefix=self.classPrefix;return self.preRender(),layout.preRender(self),self.items().each(function(ctrl,i){var id=self._id+"-t"+i;ctrl.aria("role","tabpanel"),ctrl.aria("labelledby",id),tabsHtml+='<div id="'+id+'" class="'+prefix+'tab" unselectable="on" role="tab" aria-controls="'+ctrl._id+'" aria-selected="false" tabIndex="-1">'+self.encode(ctrl.settings.title)+"</div>"}),'<div id="'+self._id+'" class="'+self.classes+'" hidefocus="1" tabindex="-1"><div id="'+self._id+'-head" class="'+prefix+'tabs" role="tablist">'+tabsHtml+'</div><div id="'+self._id+'-body" class="'+self.bodyClasses+'">'+layout.renderHtml(self)+"</div></div>"},postRender:function(){var self=this;self._super(),self.settings.activeTab=self.settings.activeTab||0,self.activateTab(self.settings.activeTab),this.on("click",function(e){var targetParent=e.target.parentNode;if(e.target.parentNode.id==self._id+"-head")for(var i=targetParent.childNodes.length;i--;)targetParent.childNodes[i]==e.target&&self.activateTab(i)})},initLayoutRect:function(){var rect,minW,minH,self=this;minW=DomUtils.getSize(self.getEl("head")).width,minW=minW<0?0:minW,minH=0,self.items().each(function(item){minW=Math.max(minW,item.layoutRect().minW),minH=Math.max(minH,item.layoutRect().minH)}),self.items().each(function(ctrl){ctrl.settings.x=0,ctrl.settings.y=0,ctrl.settings.w=minW,ctrl.settings.h=minH,ctrl.layoutRect({x:0,y:0,w:minW,h:minH})});var headH=DomUtils.getSize(self.getEl("head")).height;return self.settings.minWidth=minW,self.settings.minHeight=minH+headH,rect=self._super(),rect.deltaH+=headH,rect.innerH=rect.h-rect.deltaH,rect}})}),define("tinymce/ui/TextBox",["tinymce/ui/Widget","tinymce/util/Tools","tinymce/ui/DomUtils"],function(Widget,Tools,DomUtils){return Widget.extend({init:function(settings){var self=this;self._super(settings),self.classes.add("textbox"),settings.multiline?self.classes.add("multiline"):(self.on("keydown",function(e){var rootControl;13==e.keyCode&&(e.preventDefault(),self.parents().reverse().each(function(ctrl){if(ctrl.toJSON)return rootControl=ctrl,!1}),self.fire("submit",{data:rootControl.toJSON()}))}),self.on("keyup",function(e){self.state.set("value",e.target.value)}))},repaint:function(){var style,rect,borderBox,borderW,lastRepaintRect,self=this,borderH=0;style=self.getEl().style,rect=self._layoutRect,lastRepaintRect=self._lastRepaintRect||{};var doc=document;return!self.settings.multiline&&doc.all&&(!doc.documentMode||doc.documentMode<=8)&&(style.lineHeight=rect.h-borderH+"px"),borderBox=self.borderBox,borderW=borderBox.left+borderBox.right+8,borderH=borderBox.top+borderBox.bottom+(self.settings.multiline?8:0),rect.x!==lastRepaintRect.x&&(style.left=rect.x+"px",lastRepaintRect.x=rect.x),rect.y!==lastRepaintRect.y&&(style.top=rect.y+"px",lastRepaintRect.y=rect.y),rect.w!==lastRepaintRect.w&&(style.width=rect.w-borderW+"px",lastRepaintRect.w=rect.w),rect.h!==lastRepaintRect.h&&(style.height=rect.h-borderH+"px",lastRepaintRect.h=rect.h),self._lastRepaintRect=lastRepaintRect,self.fire("repaint",{},!1),self},renderHtml:function(){var attrs,elm,self=this,settings=self.settings;return attrs={id:self._id,hidefocus:"1"},Tools.each(["rows","spellcheck","maxLength","size","readonly","min","max","step","list","pattern","placeholder","required","multiple"],function(name){attrs[name]=settings[name]}),self.disabled()&&(attrs.disabled="disabled"),settings.subtype&&(attrs.type=settings.subtype),elm=DomUtils.create(settings.multiline?"textarea":"input",attrs),elm.value=self.state.get("value"),elm.className=self.classes,elm.outerHTML},value:function(value){return arguments.length?(this.state.set("value",value),this):(this.state.get("rendered")&&this.state.set("value",this.getEl().value),this.state.get("value"))},postRender:function(){var self=this;self.getEl().value=self.state.get("value"),self._super(),self.$el.on("change",function(e){self.state.set("value",e.target.value),self.fire("change",e)})},bindStates:function(){var self=this;return self.state.on("change:value",function(e){self.getEl().value!=e.value&&(self.getEl().value=e.value)}),self.state.on("change:disabled",function(e){self.getEl().disabled=e.value}),self._super()},remove:function(){this.$el.off(),this._super()}})}),define("tinymce/Register",[],function(){var context=this||window,tinymce=function(){return context.tinymce};return"function"==typeof context.define&&(context.define.amd||context.define("ephox/tinymce",[],tinymce)),{}}),expose(["tinymce/geom/Rect","tinymce/util/Promise","tinymce/util/Delay","tinymce/Env","tinymce/dom/EventUtils","tinymce/dom/Sizzle","tinymce/util/Tools","tinymce/dom/DomQuery","tinymce/html/Styles","tinymce/dom/TreeWalker","tinymce/html/Entities","tinymce/dom/DOMUtils","tinymce/dom/ScriptLoader","tinymce/AddOnManager","tinymce/dom/RangeUtils","tinymce/html/Node","tinymce/html/Schema","tinymce/html/SaxParser","tinymce/html/DomParser","tinymce/html/Writer","tinymce/html/Serializer","tinymce/dom/Serializer","tinymce/util/VK","tinymce/dom/ControlSelection","tinymce/dom/BookmarkManager","tinymce/dom/Selection","tinymce/Formatter","tinymce/UndoManager","tinymce/EditorCommands","tinymce/util/URI","tinymce/util/Class","tinymce/util/EventDispatcher","tinymce/util/Observable","tinymce/ui/Selector","tinymce/ui/Collection","tinymce/ui/ReflowQueue","tinymce/ui/Control","tinymce/ui/Factory","tinymce/ui/KeyboardNavigation","tinymce/ui/Container","tinymce/ui/DragHelper","tinymce/ui/Scrollable","tinymce/ui/Panel","tinymce/ui/Movable","tinymce/ui/Resizable","tinymce/ui/FloatPanel","tinymce/ui/Window","tinymce/ui/MessageBox","tinymce/WindowManager","tinymce/ui/Tooltip","tinymce/ui/Widget","tinymce/ui/Progress","tinymce/ui/Notification","tinymce/NotificationManager","tinymce/EditorObservable","tinymce/Shortcuts","tinymce/Editor","tinymce/util/I18n","tinymce/FocusManager","tinymce/EditorManager","tinymce/util/XHR","tinymce/util/JSON","tinymce/util/JSONRequest","tinymce/util/JSONP","tinymce/util/LocalStorage","tinymce/Compat","tinymce/ui/Layout","tinymce/ui/AbsoluteLayout","tinymce/ui/Button","tinymce/ui/ButtonGroup","tinymce/ui/Checkbox","tinymce/ui/ComboBox","tinymce/ui/ColorBox","tinymce/ui/PanelButton","tinymce/ui/ColorButton","tinymce/util/Color","tinymce/ui/ColorPicker","tinymce/ui/Path","tinymce/ui/ElementPath","tinymce/ui/FormItem","tinymce/ui/Form","tinymce/ui/FieldSet","tinymce/ui/FilePicker","tinymce/ui/FitLayout","tinymce/ui/FlexLayout","tinymce/ui/FlowLayout","tinymce/ui/FormatControls","tinymce/ui/GridLayout","tinymce/ui/Iframe","tinymce/ui/InfoBox","tinymce/ui/Label","tinymce/ui/Toolbar","tinymce/ui/MenuBar","tinymce/ui/MenuButton","tinymce/ui/MenuItem","tinymce/ui/Throbber","tinymce/ui/Menu","tinymce/ui/ListBox","tinymce/ui/Radio","tinymce/ui/ResizeHandle","tinymce/ui/SelectBox","tinymce/ui/Slider","tinymce/ui/Spacer","tinymce/ui/SplitButton","tinymce/ui/StackLayout","tinymce/ui/TabPanel","tinymce/ui/TextBox"])}(this),function(){return this.tinyMCE.DOM.events.domLoaded=!0,this.tinyMCE}.apply(this,arguments)||window.tinyMCE}.apply(root,arguments)})}(this),define("text",["module"],function(module){"use strict";function useDefault(value,defaultValue){return void 0===value||""===value?defaultValue:value}function isSamePort(protocol1,port1,protocol2,port2){if(port1===port2)return!0;if(protocol1===protocol2){if("http"===protocol1)return useDefault(port1,"80")===useDefault(port2,"80");if("https"===protocol1)return useDefault(port1,"443")===useDefault(port2,"443")}return!1}var text,fs,Cc,Ci,xpcIsWindows,progIds=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],xmlRegExp=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,bodyRegExp=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,hasLocation="undefined"!=typeof location&&location.href,defaultProtocol=hasLocation&&location.protocol&&location.protocol.replace(/\:/,""),defaultHostName=hasLocation&&location.hostname,defaultPort=hasLocation&&(location.port||void 0),buildMap={},masterConfig=module.config&&module.config()||{};return text={version:"2.0.15",strip:function(content){if(content){content=content.replace(xmlRegExp,"");var matches=content.match(bodyRegExp);matches&&(content=matches[1])}else content="";return content},jsEscape:function(content){return content.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:masterConfig.createXhr||function(){var xhr,i,progId;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(i=0;i<3;i+=1){progId=progIds[i];try{xhr=new ActiveXObject(progId)}catch(e){}if(xhr){progIds=[progId];break}}return xhr},parseName:function(name){var modName,ext,temp,strip=!1,index=name.lastIndexOf("."),isRelative=0===name.indexOf("./")||0===name.indexOf("../");return index!==-1&&(!isRelative||index>1)?(modName=name.substring(0,index),ext=name.substring(index+1)):modName=name,temp=ext||modName,index=temp.indexOf("!"),index!==-1&&(strip="strip"===temp.substring(index+1),temp=temp.substring(0,index),ext?ext=temp:modName=temp),{moduleName:modName,ext:ext,strip:strip}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(url,protocol,hostname,port){var uProtocol,uHostName,uPort,match=text.xdRegExp.exec(url);return!match||(uProtocol=match[2],uHostName=match[3],uHostName=uHostName.split(":"),uPort=uHostName[1],uHostName=uHostName[0],(!uProtocol||uProtocol===protocol)&&(!uHostName||uHostName.toLowerCase()===hostname.toLowerCase())&&(!uPort&&!uHostName||isSamePort(uProtocol,uPort,protocol,port)))},finishLoad:function(name,strip,content,onLoad){content=strip?text.strip(content):content,masterConfig.isBuild&&(buildMap[name]=content),onLoad(content)},load:function(name,req,onLoad,config){if(config&&config.isBuild&&!config.inlineText)return void onLoad();masterConfig.isBuild=config&&config.isBuild;var parsed=text.parseName(name),nonStripName=parsed.moduleName+(parsed.ext?"."+parsed.ext:""),url=req.toUrl(nonStripName),useXhr=masterConfig.useXhr||text.useXhr;return 0===url.indexOf("empty:")?void onLoad():void(!hasLocation||useXhr(url,defaultProtocol,defaultHostName,defaultPort)?text.get(url,function(content){text.finishLoad(name,parsed.strip,content,onLoad)},function(err){onLoad.error&&onLoad.error(err)}):req([nonStripName],function(content){text.finishLoad(parsed.moduleName+"."+parsed.ext,parsed.strip,content,onLoad)}))},write:function(pluginName,moduleName,write,config){if(buildMap.hasOwnProperty(moduleName)){var content=text.jsEscape(buildMap[moduleName]);write.asModule(pluginName+"!"+moduleName,"define(function () { return '"+content+"';});\n")}},writeFile:function(pluginName,moduleName,req,write,config){var parsed=text.parseName(moduleName),extPart=parsed.ext?"."+parsed.ext:"",nonStripName=parsed.moduleName+extPart,fileName=req.toUrl(parsed.moduleName+extPart)+".js";text.load(nonStripName,req,function(value){var textWrite=function(contents){return write(fileName,contents)};textWrite.asModule=function(moduleName,contents){return write.asModule(moduleName,fileName,contents)},text.write(pluginName,nonStripName,textWrite,config)},config)}},"node"===masterConfig.env||!masterConfig.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(fs=require.nodeRequire("fs"),text.get=function(url,callback,errback){try{var file=fs.readFileSync(url,"utf8");"\ufeff"===file[0]&&(file=file.substring(1)),callback(file)}catch(e){errback&&errback(e)}}):"xhr"===masterConfig.env||!masterConfig.env&&text.createXhr()?text.get=function(url,callback,errback,headers){var header,xhr=text.createXhr();if(xhr.open("GET",url,!0),headers)for(header in headers)headers.hasOwnProperty(header)&&xhr.setRequestHeader(header.toLowerCase(),headers[header]);masterConfig.onXhr&&masterConfig.onXhr(xhr,url),xhr.onreadystatechange=function(evt){var status,err;4===xhr.readyState&&(status=xhr.status||0,status>399&&status<600?(err=new Error(url+" HTTP status: "+status),err.xhr=xhr,errback&&errback(err)):callback(xhr.responseText),masterConfig.onXhrComplete&&masterConfig.onXhrComplete(xhr,url))},xhr.send(null)}:"rhino"===masterConfig.env||!masterConfig.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?text.get=function(url,callback){var stringBuffer,line,encoding="utf-8",file=new java.io.File(url),lineSeparator=java.lang.System.getProperty("line.separator"),input=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(file),encoding)),content="";try{for(stringBuffer=new java.lang.StringBuffer,line=input.readLine(),line&&line.length()&&65279===line.charAt(0)&&(line=line.substring(1)),null!==line&&stringBuffer.append(line);null!==(line=input.readLine());)stringBuffer.append(lineSeparator),stringBuffer.append(line);content=String(stringBuffer.toString())}finally{input.close()}callback(content)}:("xpconnect"===masterConfig.env||!masterConfig.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(Cc=Components.classes,Ci=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),xpcIsWindows="@mozilla.org/windows-registry-key;1"in Cc,text.get=function(url,callback){var inStream,convertStream,fileObj,readData={};xpcIsWindows&&(url=url.replace(/\//g,"\\")),fileObj=new FileUtils.File(url);try{inStream=Cc["@mozilla.org/network/file-input-stream;1"].createInstance(Ci.nsIFileInputStream),inStream.init(fileObj,1,0,!1),convertStream=Cc["@mozilla.org/intl/converter-input-stream;1"].createInstance(Ci.nsIConverterInputStream),convertStream.init(inStream,"utf-8",inStream.available(),Ci.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),convertStream.readString(inStream.available(),readData),convertStream.close(),inStream.close(),callback(readData.value)}catch(e){throw new Error((fileObj&&fileObj.path||"")+": "+e)}}),text}),define("text!mockup-patterns-tinymce-url/templates/result.xml",[],function(){return'<div class="pattern-relateditems-result pattern-relateditems-type-<%= portal_type %> <% if (selected) { %>pattern-active<% } %>">\n  <a href="#" class="pattern-relateditems-result-select <% if (selectable) { %>selectable<% } %>">\n    <% if (!folderish) { %>\n    <span class="pattern-relateditems-result-image">\n      <img src="<%= generateImageUrl(_item, \'thumb\') %>" />\n    </span>\n    <% } %>\n    <span class="pattern-relateditems-result-title"><%= Title %></span>\n    <span class="pattern-relateditems-result-path"><%= path %></span>\n  </a>\n  <span class="pattern-relateditems-buttons">\n    <% if (folderish) { %>\n      <a class="pattern-relateditems-result-browse" href="#" data-path="<%= path %>"></a>\n    <% } %>\n  </span>\n</div>\n'}),define("text!mockup-patterns-tinymce-url/templates/selection.xml",[],function(){return'<span class="pattern-relateditems-item pattern-relateditems-type-<%= portal_type %>">\n <span class="pattern-relateditems-result-image">\n   <img src="<%= generateImageUrl(_item, \'thumb\') %>" />\n </span>\n <span class="pattern-relateditems-item-title"><%= Title %></span>\n <span class="pattern-relateditems-item-path"><%= path %></span>\n</span>\'\n'}),define("text!mockup-patterns-tinymce-url/templates/link.xml",[],function(){return'<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(upload){ %>\n    <p class="info">Specify the object to link to. It can be on this site already ("Internal"), an object you upload ("Upload"), from an external site ("External"), an email address ("Email"), or an anchor on this page ("Anchor").</p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n      <fieldset class="linkType internal" data-linkType="internal">\n        <legend id="tinylink-internal">Internal</legend>\n        <div>\n          <div class="form-group main">\n            <!-- this gives the name to the "linkType" -->\n            <input type="text" name="internal" />\n          </div>\n        </div>\n      </fieldset>\n\n      <% if(upload){ %>\n      <fieldset class="linkType upload" data-linkType="upload">\n        <legend id="tinylink-upload">Upload</legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <fieldset class="linkType external" data-linkType="external">\n        <legend id="tinylink-external">External</legend>\n        <div class="form-group main">\n          <label for="external"><%- externalText %></label>\n          <input type="text" name="external" />\n        </div>\n      </fieldset>\n\n      <fieldset class="linkType email" data-linkType="email">\n        <legend id="tinylink-email">Email</legend>\n        <div class="form-inline">\n          <div class="form-group main">\n            <label><%- emailText %></label>\n            <input type="text" name="email" />\n          </div>\n          <div class="form-group">\n            <label><%- subjectText %></label>\n            <input type="text" name="subject" />\n          </div>\n        </div>\n      </fieldset>\n\n      <fieldset class="linkType anchor" data-linkType="anchor">\n        <legend id="tinylink-anchor">Anchor</legend>\n        <div>\n          <div class="form-group main">\n            <label>Select an anchor</label>\n            <div class="input-wrapper">\n              <select name="anchor" class="pat-select2" data-pat-select2="width:500px" />\n            </div>\n          </div>\n        </div>\n      </fieldset>\n\n    </div><!-- / tabs -->\n\n    <div class="common-controls">\n      <div class="form-group">\n        <label>Target</label>\n        <select name="target">\n          <% _.each(targetList, function(target){ %>\n            <option value="<%- target.value %>"><%- target.text %></option>\n          <% }); %>\n        </select>\n      </div>\n      <div class="form-group">\n        <label><%- titleText %></label>\n        <input type="text" name="title" />\n      </div>\n    </div>\n\n    <input type="submit" class="plone-btn" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="plone-btn plone-btn-primary context" name="insert" value="<%- insertBtn %>" />\n  </div>\n</div>\n';
}),define("text!mockup-patterns-tinymce-url/templates/image.xml",[],function(){return'<div>\n  <div class="linkModal">\n    <h1><%- insertHeading %></h1>\n    <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n    <p class="info">Specify an image. It can be on this site already ("Internal Image"), an image you upload ("Upload"), or from an external site ("External Image").</p>\n    <% } %>\n\n    <div class="linkTypes pat-autotoc autotabs"\n         data-pat-autotoc="section:fieldset;levels:legend;IDPrefix:tinymce-autotoc-">\n\n        <% if(_.contains(linkTypes, \'image\')){ %>\n      <fieldset class="linkType image" data-linkType="image">\n        <legend id="tinylink-image">Internal Image</legend>\n        <div class="form-inline">\n          <div class="form-group main">\n            <input type="text" name="image" />\n          </div>\n          <div class="form-group scale">\n            <label><%- scaleText %></label>\n            <select name="scale">\n              <option value="">Original</option>\n                <% _.each(scales, function(scale){ %>\n                  <option value="<%- scale.part %>" <% if(scale.name === options.defaultScale){ %>selected<% } %> >\n                    <%- scale.label %>\n                  </option>\n                <% }); %>\n            </select>\n          </div>\n        </div>\n      </fieldset>\n        <% } %>\n\n      <% if(_.contains(linkTypes, \'uploadImage\')){ %>\n      <fieldset class="linkType uploadImage" data-linkType="uploadImage">\n        <legend id="tinylink-uploadImage">Upload</legend>\n        <div class="uploadify-me"></div>\n      </fieldset>\n      <% } %>\n\n      <% if(_.contains(linkTypes, \'externalImage\')){ %>\n      <fieldset class="linkType externalImage" data-linkType="externalImage">\n        <legend id="tinylink-externalImage">External Image</legend>\n        <div>\n          <div class="form-group main">\n            <label><%- externalImageText %></label>\n            <input type="text" name="externalImage" />\n          </div>\n        </div>\n      </fieldset>\n      <% } %>\n\n    </div><!-- / tabs -->\n\n    <div class="common-controls">\n      <div class="form-group title">\n        <label><%- titleText %></label>\n        <input type="text" name="title" />\n      </div>\n      <div class="form-group text">\n        <label><%- altText %></label>\n        <input type="text" name="alt" />\n      </div>\n      <div class="form-group align">\n        <label><%- imageAlignText %></label>\n        <select name="align">\n          <% _.each([\'inline\', \'right\', \'left\'], function(align){ %>\n              <option value="<%- align %>">\n              <%- align.charAt(0).toUpperCase() + align.slice(1) %>\n              </option>\n          <% }); %>\n        <select>\n      </div>\n    </div>\n\n    <input type="submit" class="plone-btn" name="cancel" value="<%- cancelBtn %>" />\n    <input type="submit" class="plone-btn plone-btn-primary context" name="insert" value="<%- insertBtn %>" />\n\n  </div>\n</div>\n'}),define("mockup-patterns-autotoc",["jquery","pat-base"],function($,Base){"use strict";var AutoTOC=Base.extend({name:"autotoc",trigger:".pat-autotoc",parser:"mockup",defaults:{section:"section",levels:"h1,h2,h3",IDPrefix:"autotoc-item-",classTOCName:"autotoc-nav",classSectionName:"autotoc-section",classLevelPrefixName:"autotoc-level-",classActiveName:"active",scrollDuration:"slow",scrollEasing:"swing"},init:function(){var self=this;self.$toc=$("<nav/>").addClass(self.options.classTOCName),self.options.prependTo?self.$toc.prependTo(self.options.prependTo):self.options.appendTo?self.$toc.appendTo(self.options.appendTo):self.$toc.prependTo(self.$el),self.options.className&&self.$el.addClass(self.options.className),$(self.options.section,self.$el).addClass(self.options.classSectionName);var asTabs=self.$el.hasClass("autotabs"),activeId=null;$(self.options.levels,self.$el).each(function(i){var $level=$(this),id=$level.prop("id")?$level.prop("id"):$level.parents(self.options.section).prop("id");(!id||$("#"+id).length>0)&&(id=self.options.IDPrefix+self.name+"-"+i),window.location.hash==="#"+id&&(activeId=id),$level.data("navref",id),$("<a/>").appendTo(self.$toc).text($level.text()).attr("id",id).attr("href","#"+id).addClass(self.options.classLevelPrefixName+self.getLevel($level)).on("click",function(e,options){e.stopPropagation(),e.preventDefault(),options||(options={doScroll:!0,skipHash:!1});var $el=$(this);self.$toc.children("."+self.options.classActiveName).removeClass(self.options.classActiveName),self.$el.children("."+self.options.classActiveName).removeClass(self.options.classActiveName),$(e.target).addClass(self.options.classActiveName),$level.parents(self.options.section).addClass(self.options.classActiveName),options.doScroll!==!1&&self.options.scrollDuration&&$level&&!asTabs&&$("body,html").animate({scrollTop:$level.offset().top},self.options.scrollDuration,self.options.scrollEasing),0!==self.$el.parents(".plone-modal").size()&&self.$el.trigger("resize.plone-modal.patterns"),$(this).trigger("clicked"),options.skipHash||window.history&&window.history.pushState&&window.history.pushState({},"","#"+$el.attr("id"))})}),activeId?$("a#"+activeId).trigger("click",{doScroll:!0,skipHash:!0}):self.$toc.find("a").first().trigger("click",{doScroll:!1,skipHash:!0})},getLevel:function($el){var elementLevel=0;return $.each(this.options.levels.split(","),function(level,levelSelector){if(1===$el.filter(levelSelector).size())return elementLevel=level+1,!1}),elementLevel}});return AutoTOC}),define("mockup-patterns-backdrop",["jquery","pat-base"],function($,Base){"use strict";var Backdrop=Base.extend({name:"backdrop",trigger:".pat-backdrop",parser:"mockup",defaults:{zIndex:null,opacity:.8,className:"plone-backdrop",classActiveName:"plone-backdrop-active",closeOnEsc:!0,closeOnClick:!0},init:function(){var self=this;self.$backdrop=$("> ."+self.options.className,self.$el),0===self.$backdrop.size()&&(self.$backdrop=$("<div/>").hide().appendTo(self.$el).addClass(self.options.className),null!==self.options.zIndex&&self.$backdrop.css("z-index",self.options.zIndex)),self.options.closeOnEsc===!0&&$(document).on("keydown",function(e,data){self.$el.is("."+self.options.classActiveName)&&27===e.keyCode&&self.hide()}),self.options.closeOnClick===!0&&self.$backdrop.on("click",function(){self.$el.is("."+self.options.classActiveName)&&self.hide()})},show:function(){var self=this;self.$el.hasClass(self.options.classActiveName)||(self.emit("show"),self.$backdrop.css("opacity","0").show(),self.$el.addClass(self.options.classActiveName),self.$backdrop.animate({opacity:self.options.opacity},500),self.emit("shown"))},hide:function(){var self=this;self.$el.hasClass(self.options.classActiveName)&&(self.emit("hide"),self.$backdrop.animate({opacity:"0"},500).hide(),self.$el.removeClass(self.options.classActiveName),self.emit("hidden"))}});return Backdrop}),function(root,factory){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)});else if("undefined"!=typeof exports){var _=require("underscore");factory(root,exports,_)}else root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}(this,function(root,Backbone,_,$){var previousBackbone=root.Backbone,array=[],slice=(array.push,array.slice);array.splice;Backbone.VERSION="1.1.2",Backbone.$=$,Backbone.noConflict=function(){return root.Backbone=previousBackbone,this},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events=void 0,this;for(names=name?[name]:_.keys(this._events),i=0,l=names.length;i<l;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;j<k;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;callback||"object"!=typeof name||(callback=this),obj&&((listeningTo={})[obj._listenId]=obj);for(var id in listeningTo)obj=listeningTo[id],obj.off(name,callback,this),(remove||_.isEmpty(obj._events))&&delete this._listeningTo[id];return this}},eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;i<l;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args);return}},listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={}),id=obj._listenId||(obj._listenId=_.uniqueId("l"));return listeningTo[id]=obj,callback||"object"!=typeof name||(callback=this),obj[implementation](name,callback,this),this}}),Events.bind=Events.on,Events.unbind=Events.off,_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={}),this.cid=_.uniqueId("c"),this.attributes={},options.collection&&(this.collection=options.collection),options.parse&&(attrs=this.parse(attrs,options)||{}),attrs=_.defaults({},attrs,_.result(this,"defaults")),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(null==key)return this;if("object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options||(options={}),!this._validate(attrs,options))return!1;unset=options.unset,silent=options.silent,changes=[],changing=this._changing,this._changing=!0,changing||(this._previousAttributes=_.clone(this.attributes),this.changed={}),current=this.attributes,prev=this._previousAttributes,this.idAttribute in attrs&&(this.id=attrs[this.idAttribute]);for(attr in attrs)val=attrs[attr],_.isEqual(current[attr],val)||changes.push(attr),_.isEqual(prev[attr],val)?delete this.changed[attr]:this.changed[attr]=val,unset?delete current[attr]:current[attr]=val;if(!silent){changes.length&&(this._pending=options);for(var i=0,l=changes.length;i<l;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;)options=this._pending,this._pending=!1,this.trigger("change",this,options);return this._pending=!1,this._changing=!1,this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return!!this.hasChanged()&&_.clone(this.changed);var val,changed=!1,old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff)_.isEqual(old[attr],val=diff[attr])||((changed||(changed={}))[attr]=val);return changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){return!!model.set(model.parse(resp,options),options)&&(success&&success(model,resp,options),void model.trigger("sync",model,resp,options))},wrapError(this,options),this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(null==key||"object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options=_.extend({validate:!0},options),attrs&&!options.wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;attrs&&options.wait&&(this.attributes=_.extend({},attributes,attrs)),void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);return options.wait&&(serverAttrs=_.extend(attrs||{},serverAttrs)),!(_.isObject(serverAttrs)&&!model.set(serverAttrs,options))&&(success&&success(model,resp,options),void model.trigger("sync",model,resp,options))},wrapError(this,options),method=this.isNew()?"create":options.patch?"patch":"update","patch"===method&&(options.attrs=attrs),xhr=this.sync(method,this,options),attrs&&options.wait&&(this.attributes=attributes),xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,destroy=function(){model.trigger("destroy",model,model.collection,options)};if(options.success=function(resp){(options.wait||model.isNew())&&destroy(),success&&success(model,resp,options),model.isNew()||model.trigger("sync",model,resp,options)},this.isNew())return options.success(),!1;wrapError(this,options);var xhr=this.sync("delete",this,options);return options.wait||destroy(),xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?base:base.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend(options||{},{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;return!error||(this.trigger("invalid",this,error,_.extend(options,{validationError:error})),!1)}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.attributes),_[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={}),options.model&&(this.model=options.model),void 0!==options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models),options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++)model=models[i]=this.get(models[i]),model&&(delete this._byId[model.id],delete this._byId[model.cid],index=this.indexOf(model),this.models.splice(index,1),this.length--,options.silent||(options.index=index,model.trigger("remove",model,this,options)),this._removeReference(model,options));return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions),options.parse&&(models=this.parse(models,options));var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort,at=options.at,targetModel=this.model,sortable=this.comparator&&null==at&&options.sort!==!1,sortAttr=_.isString(this.comparator)?this.comparator:null,toAdd=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,order=!(sortable||!add||!remove)&&[];for(i=0,l=models.length;i<l;i++){if(attrs=models[i]||{},id=attrs instanceof Model?model=attrs:attrs[targetModel.prototype.idAttribute||"id"],existing=this.get(id))remove&&(modelMap[existing.cid]=!0),merge&&(attrs=attrs===model?model.attributes:attrs,options.parse&&(attrs=existing.parse(attrs,options)),existing.set(attrs,options),sortable&&!sort&&existing.hasChanged(sortAttr)&&(sort=!0)),models[i]=existing;else if(add){if(model=models[i]=this._prepareModel(attrs,options),!model)continue;toAdd.push(model),this._addReference(model,options)}model=existing||model,!order||!model.isNew()&&modelMap[model.id]||order.push(model),modelMap[model.id]=!0}if(remove){for(i=0,l=this.length;i<l;++i)modelMap[(model=this.models[i]).cid]||toRemove.push(model);toRemove.length&&this.remove(toRemove,options)}if(toAdd.length||order&&order.length)if(sortable&&(sort=!0),this.length+=toAdd.length,null!=at)for(i=0,l=toAdd.length;i<l;i++)this.models.splice(at+i,0,toAdd[i]);else{order&&(this.models.length=0);var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++)this.models.push(orderedModels[i])}if(sort&&this.sort({silent:!0}),!options.silent){for(i=0,l=toAdd.length;i<l;i++)(model=toAdd[i]).trigger("add",model,this,options);(sort||order&&order.length)&&this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++)this._removeReference(this.models[i],options);return options.previousModels=this.models,this._reset(),models=this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options),model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options),model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(null!=obj)return this._byId[obj]||this._byId[obj.id]||this._byId[obj.cid]},at:function(index){return this.models[index]},where:function(attrs,first){return _.isEmpty(attrs)?first?void 0:[]:this[first?"find":"filter"](function(model){for(var key in attrs)if(attrs[key]!==model.get(key))return!1;return!0})},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return options||(options={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),options.silent||this.trigger("sort",this,options),this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var success=options.success,collection=this;return options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options),success&&success(collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.sync("read",this,options)},create:function(model,options){if(options=options?_.clone(options):{},!(model=this._prepareModel(model,options)))return!1;options.wait||this.add(model,options);var collection=this,success=options.success;return options.success=function(model,resp){options.wait&&collection.add(model,options),success&&success(model,resp,options)},model.save(null,options),model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs;options=options?_.clone(options):{},options.collection=this;var model=new this.model(attrs,options);return model.validationError?(this.trigger("invalid",this,model.validationError,options),!1):model},_addReference:function(model,options){this._byId[model.cid]=model,null!=model.id&&(this._byId[model.id]=model),model.collection||(model.collection=this),model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){("add"!==event&&"remove"!==event||collection===this)&&("destroy"===event&&this.remove(model,options),model&&event==="change:"+model.idAttribute&&(delete this._byId[model.previous(model.idAttribute)],null!=model.id&&(this._byId[model.id]=model)),this.trigger.apply(this,arguments))}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.models),_[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),options||(options={}),_.extend(this,_.pick(options,viewOptions)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(element,delegate){return this.$el&&this.undelegateEvents(),this.$el=element instanceof Backbone.$?element:Backbone.$(element),this.el=this.$el[0],delegate!==!1&&this.delegateEvents(),this},delegateEvents:function(events){if(!events&&!(events=_.result(this,"events")))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(_.isFunction(method)||(method=this[events[key]]),method){var match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2];method=_.bind(method,this),eventName+=".delegateEvents"+this.cid,""===selector?this.$el.on(eventName,method):this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"),!1);else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id")),this.className&&(attrs["class"]=_.result(this,"className"));var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,!1)}}}),Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(options.url||(params.url=_.result(model,"url")||urlError()),null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(params.contentType="application/json",params.data=JSON.stringify(options.attrs||model.toJSON(options))),options.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST",options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){if(xhr.setRequestHeader("X-HTTP-Method-Override",type),beforeSend)return beforeSend.apply(this,arguments)}}"GET"===params.type||options.emulateJSON||(params.processData=!1),"PATCH"===params.type&&noXhrPatch&&(params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var xhr=options.xhr=Backbone.ajax(_.extend(params,options));return model.trigger("request",model,xhr,options),xhr};var noXhrPatch=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route)),_.isFunction(name)&&(callback=name,name=""),callback||(callback=this[name]);var router=this;return Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);router.execute(callback,args),router.trigger.apply(router,["route:"+name].concat(args)),router.trigger("route",name,args),Backbone.history.trigger("route",router,name,args)}),this},execute:function(callback,args){callback&&callback.apply(this,args)},navigate:function(fragment,options){return Backbone.history.navigate(fragment,options),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)"),new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){return i===params.length-1?param||null:param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[],_.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,pathStripper=/#.*$/;History.started=!1,_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=decodeURI(this.location.pathname+this.location.search);var root=this.root.replace(trailingSlash,"");fragment.indexOf(root)||(fragment=fragment.slice(root.length))}else fragment=this.getHash();return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=!0,this.options=_.extend({root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment(),docMode=document.documentMode,oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);if(this.root=("/"+this.root+"/").replace(rootStripper,"/"),oldIE&&this._wantsHashChange){var frame=Backbone.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=frame.hide().appendTo("body")[0].contentWindow,this.navigate(fragment)}this._hasPushState?Backbone.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!oldIE?Backbone.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=fragment;var loc=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&loc.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();return current===this.fragment&&this.iframe&&(current=this.getFragment(this.getHash(this.iframe))),current!==this.fragment&&(this.iframe&&this.navigate(current),void this.loadUrl())},loadUrl:function(fragment){return fragment=this.fragment=this.getFragment(fragment),_.any(this.handlers,function(handler){if(handler.route.test(fragment))return handler.callback(fragment),!0})},navigate:function(fragment,options){if(!History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));if(fragment=fragment.replace(pathStripper,""),this.fragment!==fragment){if(this.fragment=fragment,""===fragment&&"/"!==url&&(url=url.slice(0,-1)),this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,fragment,options.replace))}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");
location.replace(href+"#"+fragment)}else location.hash="#"+fragment}}),Backbone.history=new History;var extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&_.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&_.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error(model,resp,options),model.trigger("error",model,resp,options)}};return Backbone}),define("mockup-router",["underscore","backbone"],function(_,Backbone){"use strict";var regexEscape=function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},Router=Backbone.Router.extend({actions:[],redirects:{},addRoute:function(patternName,id,callback,context,pathExp,expReplace){void 0===_.findWhere(this.patterns,{patternName:patternName,id:id})&&this.actions.push({patternName:patternName,id:id,callback:callback,context:context,pathExp:pathExp,expReplace:expReplace});var regex=new RegExp("("+regexEscape(patternName)+":"+regexEscape(id)+")");this.route(regex,"handleRoute")},addRedirect:function(pathExp,destination){this.redirects[pathExp]=destination},handleRoute:function(pattern){var parts=pattern.split(":"),patternName=parts[0],id=parts[1],action=_.findWhere(this.actions,{patternName:patternName,id:id});action&&action.callback.call(action.context)},redirect:function(){var newPath,regex,hash,path=window.parent.location.pathname;if(_.some(this.actions,function(action){if(action.pathExp&&(regex=new RegExp(action.pathExp),path.match(regex))){hash="!/"+action.patternName+":"+action.id;var replaceWith="";return action.expReplace&&(replaceWith=action.expReplace),newPath=path.replace(regex,replaceWith),!0}},this),void 0===hash)for(var pathExp in this.redirects)if(regex=new RegExp(pathExp),path.match(regex)){hash="!/"+this.redirects[pathExp],newPath=path.replace(regex,"");break}void 0!==hash&&this._changeLocation.apply(this,[newPath,hash])},_changeLocation:function(path,hash){window.parent.location.hash=hash,window.parent.location.pathname=path},start:function(){Backbone.history.start()},reset:function(){this.actions=[]}});return new Router}),function(factory){"function"==typeof define&&define.amd?define("jquery.form",["jquery"],factory):factory("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function($){"use strict";function doAjaxSubmit(e){var options=e.data;e.isDefaultPrevented()||(e.preventDefault(),$(e.target).ajaxSubmit(options))}function captureSubmittingElement(e){var target=e.target,$el=$(target);if(!$el.is("[type=submit],[type=image]")){var t=$el.closest("[type=submit]");if(0===t.length)return;target=t[0]}var form=this;if(form.clk=target,"image"==target.type)if(void 0!==e.offsetX)form.clk_x=e.offsetX,form.clk_y=e.offsetY;else if("function"==typeof $.fn.offset){var offset=$el.offset();form.clk_x=e.pageX-offset.left,form.clk_y=e.pageY-offset.top}else form.clk_x=e.pageX-target.offsetLeft,form.clk_y=e.pageY-target.offsetTop;setTimeout(function(){form.clk=form.clk_x=form.clk_y=null},100)}function log(){if($.fn.ajaxSubmit.debug){var msg="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(msg):window.opera&&window.opera.postError&&window.opera.postError(msg)}}var feature={};feature.fileapi=void 0!==$("<input type='file'/>").get(0).files,feature.formdata=void 0!==window.FormData;var hasProp=!!$.fn.prop;$.fn.attr2=function(){if(!hasProp)return this.attr.apply(this,arguments);var val=this.prop.apply(this,arguments);return val&&val.jquery||"string"==typeof val?val:this.attr.apply(this,arguments)},$.fn.ajaxSubmit=function(options){function deepSerialize(extraData){var i,part,serialized=$.param(extraData,options.traditional).split("&"),len=serialized.length,result=[];for(i=0;i<len;i++)serialized[i]=serialized[i].replace(/\+/g," "),part=serialized[i].split("="),result.push([decodeURIComponent(part[0]),decodeURIComponent(part[1])]);return result}function fileUploadXhr(a){for(var formdata=new FormData,i=0;i<a.length;i++)formdata.append(a[i].name,a[i].value);if(options.extraData){var serializedData=deepSerialize(options.extraData);for(i=0;i<serializedData.length;i++)serializedData[i]&&formdata.append(serializedData[i][0],serializedData[i][1])}options.data=null;var s=$.extend(!0,{},$.ajaxSettings,options,{contentType:!1,processData:!1,cache:!1,type:method||"POST"});options.uploadProgress&&(s.xhr=function(){var xhr=$.ajaxSettings.xhr();return xhr.upload&&xhr.upload.addEventListener("progress",function(event){var percent=0,position=event.loaded||event.position,total=event.total;event.lengthComputable&&(percent=Math.ceil(position/total*100)),options.uploadProgress(event,position,total,percent)},!1),xhr}),s.data=null;var beforeSend=s.beforeSend;return s.beforeSend=function(xhr,o){options.formData?o.data=options.formData:o.data=formdata,beforeSend&&beforeSend.call(this,xhr,o)},$.ajax(s)}function fileUploadIframe(a){function getDoc(frame){var doc=null;try{frame.contentWindow&&(doc=frame.contentWindow.document)}catch(err){log("cannot get iframe.contentWindow document: "+err)}if(doc)return doc;try{doc=frame.contentDocument?frame.contentDocument:frame.document}catch(err){log("cannot get iframe.contentDocument: "+err),doc=frame.document}return doc}function doSubmit(){function checkState(){try{var state=getDoc(io).readyState;log("state = "+state),state&&"uninitialized"==state.toLowerCase()&&setTimeout(checkState,50)}catch(e){log("Server abort: ",e," (",e.name,")"),cb(SERVER_ABORT),timeoutHandle&&clearTimeout(timeoutHandle),timeoutHandle=void 0}}var t=$form.attr2("target"),a=$form.attr2("action");form.setAttribute("target",id),method&&!/post/i.test(method)||form.setAttribute("method","POST"),a!=s.url&&form.setAttribute("action",s.url),s.skipEncodingOverride||method&&!/post/i.test(method)||$form.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),s.timeout&&(timeoutHandle=setTimeout(function(){timedOut=!0,cb(CLIENT_TIMEOUT_ABORT)},s.timeout));var extraInputs=[];try{if(s.extraData)for(var n in s.extraData)s.extraData.hasOwnProperty(n)&&($.isPlainObject(s.extraData[n])&&s.extraData[n].hasOwnProperty("name")&&s.extraData[n].hasOwnProperty("value")?extraInputs.push($('<input type="hidden" name="'+s.extraData[n].name+'">').val(s.extraData[n].value).appendTo(form)[0]):extraInputs.push($('<input type="hidden" name="'+n+'">').val(s.extraData[n]).appendTo(form)[0]));s.iframeTarget||$io.appendTo("body"),io.attachEvent?io.attachEvent("onload",cb):io.addEventListener("load",cb,!1),setTimeout(checkState,15);try{form.submit()}catch(err){var submitFn=document.createElement("form").submit;submitFn.apply(form)}}finally{form.setAttribute("action",a),t?form.setAttribute("target",t):$form.removeAttr("target"),$(extraInputs).remove()}}function cb(e){if(!xhr.aborted&&!callbackProcessed){if(doc=getDoc(io),doc||(log("cannot access response document"),e=SERVER_ABORT),e===CLIENT_TIMEOUT_ABORT&&xhr)return xhr.abort("timeout"),void deferred.reject(xhr,"timeout");if(e==SERVER_ABORT&&xhr)return xhr.abort("server abort"),void deferred.reject(xhr,"error","server abort");if(doc&&doc.location.href!=s.iframeSrc||timedOut){io.detachEvent?io.detachEvent("onload",cb):io.removeEventListener("load",cb,!1);var errMsg,status="success";try{if(timedOut)throw"timeout";var isXml="xml"==s.dataType||doc.XMLDocument||$.isXMLDoc(doc);if(log("isXml="+isXml),!isXml&&window.opera&&(null===doc.body||!doc.body.innerHTML)&&--domCheckCount)return log("requeing onLoad callback, DOM not available"),void setTimeout(cb,250);var docRoot=doc.body?doc.body:doc.documentElement;xhr.responseText=docRoot?docRoot.innerHTML:null,xhr.responseXML=doc.XMLDocument?doc.XMLDocument:doc,isXml&&(s.dataType="xml"),xhr.getResponseHeader=function(header){var headers={"content-type":s.dataType};return headers[header.toLowerCase()]},docRoot&&(xhr.status=Number(docRoot.getAttribute("status"))||xhr.status,xhr.statusText=docRoot.getAttribute("statusText")||xhr.statusText);var dt=(s.dataType||"").toLowerCase(),scr=/(json|script|text)/.test(dt);if(scr||s.textarea){var ta=doc.getElementsByTagName("textarea")[0];if(ta)xhr.responseText=ta.value,xhr.status=Number(ta.getAttribute("status"))||xhr.status,xhr.statusText=ta.getAttribute("statusText")||xhr.statusText;else if(scr){var pre=doc.getElementsByTagName("pre")[0],b=doc.getElementsByTagName("body")[0];pre?xhr.responseText=pre.textContent?pre.textContent:pre.innerText:b&&(xhr.responseText=b.textContent?b.textContent:b.innerText)}}else"xml"==dt&&!xhr.responseXML&&xhr.responseText&&(xhr.responseXML=toXml(xhr.responseText));try{data=httpData(xhr,dt,s)}catch(err){status="parsererror",xhr.error=errMsg=err||status}}catch(err){log("error caught: ",err),status="error",xhr.error=errMsg=err||status}xhr.aborted&&(log("upload aborted"),status=null),xhr.status&&(status=xhr.status>=200&&xhr.status<300||304===xhr.status?"success":"error"),"success"===status?(s.success&&s.success.call(s.context,data,"success",xhr),deferred.resolve(xhr.responseText,"success",xhr),g&&$.event.trigger("ajaxSuccess",[xhr,s])):status&&(void 0===errMsg&&(errMsg=xhr.statusText),s.error&&s.error.call(s.context,xhr,status,errMsg),deferred.reject(xhr,"error",errMsg),g&&$.event.trigger("ajaxError",[xhr,s,errMsg])),g&&$.event.trigger("ajaxComplete",[xhr,s]),g&&!--$.active&&$.event.trigger("ajaxStop"),s.complete&&s.complete.call(s.context,xhr,status),callbackProcessed=!0,s.timeout&&clearTimeout(timeoutHandle),setTimeout(function(){s.iframeTarget?$io.attr("src",s.iframeSrc):$io.remove(),xhr.responseXML=null},100)}}}var el,i,s,g,id,$io,io,xhr,sub,n,timedOut,timeoutHandle,form=$form[0],deferred=$.Deferred();if(deferred.abort=function(status){xhr.abort(status)},a)for(i=0;i<elements.length;i++)el=$(elements[i]),hasProp?el.prop("disabled",!1):el.removeAttr("disabled");if(s=$.extend(!0,{},$.ajaxSettings,options),s.context=s.context||s,id="jqFormIO"+(new Date).getTime(),s.iframeTarget?($io=$(s.iframeTarget),n=$io.attr2("name"),n?id=n:$io.attr2("name",id)):($io=$('<iframe name="'+id+'" src="'+s.iframeSrc+'" />'),$io.css({position:"absolute",top:"-1000px",left:"-1000px"})),io=$io[0],xhr={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(status){var e="timeout"===status?"timeout":"aborted";log("aborting upload... "+e),this.aborted=1;try{io.contentWindow.document.execCommand&&io.contentWindow.document.execCommand("Stop")}catch(ignore){}$io.attr("src",s.iframeSrc),xhr.error=e,s.error&&s.error.call(s.context,xhr,e,status),g&&$.event.trigger("ajaxError",[xhr,s,e]),s.complete&&s.complete.call(s.context,xhr,e)}},g=s.global,g&&0===$.active++&&$.event.trigger("ajaxStart"),g&&$.event.trigger("ajaxSend",[xhr,s]),s.beforeSend&&s.beforeSend.call(s.context,xhr,s)===!1)return s.global&&$.active--,deferred.reject(),deferred;if(xhr.aborted)return deferred.reject(),deferred;sub=form.clk,sub&&(n=sub.name,n&&!sub.disabled&&(s.extraData=s.extraData||{},s.extraData[n]=sub.value,"image"==sub.type&&(s.extraData[n+".x"]=form.clk_x,s.extraData[n+".y"]=form.clk_y)));var CLIENT_TIMEOUT_ABORT=1,SERVER_ABORT=2,csrf_token=$("meta[name=csrf-token]").attr("content"),csrf_param=$("meta[name=csrf-param]").attr("content");csrf_param&&csrf_token&&(s.extraData=s.extraData||{},s.extraData[csrf_param]=csrf_token),s.forceSync?doSubmit():setTimeout(doSubmit,10);var data,doc,callbackProcessed,domCheckCount=50,toXml=$.parseXML||function(s,doc){return window.ActiveXObject?(doc=new ActiveXObject("Microsoft.XMLDOM"),doc.async="false",doc.loadXML(s)):doc=(new DOMParser).parseFromString(s,"text/xml"),doc&&doc.documentElement&&"parsererror"!=doc.documentElement.nodeName?doc:null},parseJSON=$.parseJSON||function(s){return window.eval("("+s+")")},httpData=function(xhr,type,s){var ct=xhr.getResponseHeader("content-type")||"",xml="xml"===type||!type&&ct.indexOf("xml")>=0,data=xml?xhr.responseXML:xhr.responseText;return xml&&"parsererror"===data.documentElement.nodeName&&$.error&&$.error("parsererror"),s&&s.dataFilter&&(data=s.dataFilter(data,type)),"string"==typeof data&&("json"===type||!type&&ct.indexOf("json")>=0?data=parseJSON(data):("script"===type||!type&&ct.indexOf("javascript")>=0)&&$.globalEval(data)),data};return deferred}if(!this.length)return log("ajaxSubmit: skipping submit process - no element selected"),this;var method,action,url,$form=this;"function"==typeof options?options={success:options}:void 0===options&&(options={}),method=options.type||this.attr2("method"),action=options.url||this.attr2("action"),url="string"==typeof action?$.trim(action):"",url=url||window.location.href||"",url&&(url=(url.match(/^([^#]+)/)||[])[1]),options=$.extend(!0,{url:url,success:$.ajaxSettings.success,type:method||$.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},options);var veto={};if(this.trigger("form-pre-serialize",[this,options,veto]),veto.veto)return log("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(options.beforeSerialize&&options.beforeSerialize(this,options)===!1)return log("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var traditional=options.traditional;void 0===traditional&&(traditional=$.ajaxSettings.traditional);var qx,elements=[],a=this.formToArray(options.semantic,elements);if(options.data&&(options.extraData=options.data,qx=$.param(options.data,traditional)),options.beforeSubmit&&options.beforeSubmit(a,this,options)===!1)return log("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[a,this,options,veto]),veto.veto)return log("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var q=$.param(a,traditional);qx&&(q=q?q+"&"+qx:qx),"GET"==options.type.toUpperCase()?(options.url+=(options.url.indexOf("?")>=0?"&":"?")+q,options.data=null):options.data=q;var callbacks=[];if(options.resetForm&&callbacks.push(function(){$form.resetForm()}),options.clearForm&&callbacks.push(function(){$form.clearForm(options.includeHidden)}),!options.dataType&&options.target){var oldSuccess=options.success||function(){};callbacks.push(function(data){var fn=options.replaceTarget?"replaceWith":"html";$(options.target)[fn](data).each(oldSuccess,arguments)})}else options.success&&callbacks.push(options.success);if(options.success=function(data,status,xhr){for(var context=options.context||this,i=0,max=callbacks.length;i<max;i++)callbacks[i].apply(context,[data,status,xhr||$form,$form])},options.error){var oldError=options.error;options.error=function(xhr,status,error){var context=options.context||this;oldError.apply(context,[xhr,status,error,$form])}}if(options.complete){var oldComplete=options.complete;options.complete=function(xhr,status){var context=options.context||this;oldComplete.apply(context,[xhr,status,$form])}}var fileInputs=$("input[type=file]:enabled",this).filter(function(){return""!==$(this).val()}),hasFileInputs=fileInputs.length>0,mp="multipart/form-data",multipart=$form.attr("enctype")==mp||$form.attr("encoding")==mp,fileAPI=feature.fileapi&&feature.formdata;log("fileAPI :"+fileAPI);var jqxhr,shouldUseFrame=(hasFileInputs||multipart)&&!fileAPI;options.iframe!==!1&&(options.iframe||shouldUseFrame)?options.closeKeepAlive?$.get(options.closeKeepAlive,function(){jqxhr=fileUploadIframe(a)}):jqxhr=fileUploadIframe(a):jqxhr=(hasFileInputs||multipart)&&fileAPI?fileUploadXhr(a):$.ajax(options),$form.removeData("jqxhr").data("jqxhr",jqxhr);for(var k=0;k<elements.length;k++)elements[k]=null;return this.trigger("form-submit-notify",[this,options]),this},$.fn.ajaxForm=function(options){if(options=options||{},options.delegation=options.delegation&&$.isFunction($.fn.on),!options.delegation&&0===this.length){var o={s:this.selector,c:this.context};return!$.isReady&&o.s?(log("DOM not ready, queuing ajaxForm"),$(function(){$(o.s,o.c).ajaxForm(options)}),this):(log("terminating; zero elements found by selector"+($.isReady?"":" (DOM not ready)")),this)}return options.delegation?($(document).off("submit.form-plugin",this.selector,doAjaxSubmit).off("click.form-plugin",this.selector,captureSubmittingElement).on("submit.form-plugin",this.selector,options,doAjaxSubmit).on("click.form-plugin",this.selector,options,captureSubmittingElement),this):this.ajaxFormUnbind().bind("submit.form-plugin",options,doAjaxSubmit).bind("click.form-plugin",options,captureSubmittingElement)},$.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},$.fn.formToArray=function(semantic,elements){var a=[];if(0===this.length)return a;var form=this[0],els=semantic?form.getElementsByTagName("*"):form.elements;if(!els)return a;var i,j,n,v,el,max,jmax;for(i=0,max=els.length;i<max;i++)if(el=els[i],n=el.name,n&&!el.disabled)if(semantic&&form.clk&&"image"==el.type)form.clk==el&&(a.push({name:n,value:$(el).val(),type:el.type}),a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y}));else if(v=$.fieldValue(el,!0),v&&v.constructor==Array)for(elements&&elements.push(el),j=0,jmax=v.length;j<jmax;j++)a.push({name:n,value:v[j]});else if(feature.fileapi&&"file"==el.type){elements&&elements.push(el);var files=el.files;if(files.length)for(j=0;j<files.length;j++)a.push({name:n,value:files[j],type:el.type});else a.push({name:n,value:"",type:el.type})}else null!==v&&"undefined"!=typeof v&&(elements&&elements.push(el),a.push({name:n,value:v,type:el.type,required:el.required}));if(!semantic&&form.clk){var $input=$(form.clk),input=$input[0];n=input.name,n&&!input.disabled&&"image"==input.type&&(a.push({name:n,value:$input.val()}),a.push({name:n+".x",value:form.clk_x},{name:n+".y",value:form.clk_y}))}return a},$.fn.formSerialize=function(semantic){return $.param(this.formToArray(semantic))},$.fn.fieldSerialize=function(successful){var a=[];return this.each(function(){var n=this.name;if(n){var v=$.fieldValue(this,successful);if(v&&v.constructor==Array)for(var i=0,max=v.length;i<max;i++)a.push({name:n,value:v[i]});else null!==v&&"undefined"!=typeof v&&a.push({name:this.name,value:v})}}),$.param(a)},$.fn.fieldValue=function(successful){for(var val=[],i=0,max=this.length;i<max;i++){var el=this[i],v=$.fieldValue(el,successful);null===v||"undefined"==typeof v||v.constructor==Array&&!v.length||(v.constructor==Array?$.merge(val,v):val.push(v))}return val},$.fieldValue=function(el,successful){var n=el.name,t=el.type,tag=el.tagName.toLowerCase();if(void 0===successful&&(successful=!0),successful&&(!n||el.disabled||"reset"==t||"button"==t||("checkbox"==t||"radio"==t)&&!el.checked||("submit"==t||"image"==t)&&el.form&&el.form.clk!=el||"select"==tag&&el.selectedIndex==-1))return null;if("select"==tag){var index=el.selectedIndex;if(index<0)return null;for(var a=[],ops=el.options,one="select-one"==t,max=one?index+1:ops.length,i=one?index:0;i<max;i++){var op=ops[i];if(op.selected){var v=op.value;if(v||(v=op.attributes&&op.attributes.value&&!op.attributes.value.specified?op.text:op.value),one)return v;a.push(v)}}return a}return $(el).val()},$.fn.clearForm=function(includeHidden){return this.each(function(){$("input,select,textarea",this).clearFields(includeHidden)})},$.fn.clearFields=$.fn.clearInputs=function(includeHidden){var re=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var t=this.type,tag=this.tagName.toLowerCase();re.test(t)||"textarea"==tag?this.value="":"checkbox"==t||"radio"==t?this.checked=!1:"select"==tag?this.selectedIndex=-1:"file"==t?/MSIE/.test(navigator.userAgent)?$(this).replaceWith($(this).clone(!0)):$(this).val(""):includeHidden&&(includeHidden===!0&&/hidden/.test(t)||"string"==typeof includeHidden&&$(this).is(includeHidden))&&(this.value="")})},$.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},$.fn.enable=function(b){return void 0===b&&(b=!0),this.each(function(){this.disabled=!b})},$.fn.selected=function(select){return void 0===select&&(select=!0),this.each(function(){var t=this.type;if("checkbox"==t||"radio"==t)this.checked=select;else if("option"==this.tagName.toLowerCase()){var $sel=$(this).parent("select");select&&$sel[0]&&"select-one"==$sel[0].type&&$sel.find("option").selected(!1),this.selected=select}})},$.fn.ajaxSubmit.debug=!1}),define("mockup-patterns-modal",["jquery","underscore","pat-base","mockup-patterns-backdrop","pat-registry","mockup-router","mockup-utils","translate","jquery.form"],function($,_,Base,Backdrop,registry,Router,utils,_t){"use strict";var Modal=Base.extend({name:"plone-modal",trigger:".pat-plone-modal",parser:"mockup",createModal:null,$model:null,defaults:{width:"",height:"",margin:20,position:"center middle",triggers:[],zIndexSelector:".plone-modal-wrapper,.plone-modal-backdrop",backdrop:"body",backdropOptions:{zIndex:"1040",opacity:"0.85",className:"plone-modal-backdrop",classActiveName:"plone-backdrop-active",closeOnEsc:!0,closeOnClick:!0},title:null,titleSelector:"h1:first",buttons:'.formControls > input[type="submit"]',content:"#content",automaticallyAddButtonActions:!0,loadLinksWithinModal:!0,prependContent:".portalMessage",templateOptions:{className:"plone-modal fade",classDialog:"plone-modal-dialog",classModal:"plone-modal-content",classHeaderName:"plone-modal-header",classBodyName:"plone-modal-body",classFooterName:"plone-modal-footer",classWrapperName:"plone-modal-wrapper",classWrapperInnerName:"modal-wrapper-inner",classActiveName:"in",classPrependName:"",classContentName:"",template:'<div class="<%= options.className %>">  <div class="<%= options.classDialog %>">    <div class="<%= options.classModal %>">      <div class="<%= options.classHeaderName %>">        <a class="plone-modal-close">&times;</a>        <% if (title) { %><h2 class="plone-modal-title"><%= title %></h2><% } %>      </div>      <div class="<%= options.classBodyName %>">        <div class="<%= options.classPrependName %>"><%= prepend %></div>         <div class="<%= options.classContentName %>"><%= content %></div>      </div>      <div class="<%= options.classFooterName %>">         <% if (buttons) { %><%= buttons %><% } %>      </div>    </div>  </div></div>'},actions:{},actionOptions:{eventType:"click",disableAjaxFormSubmit:!1,target:null,ajaxUrl:null,modalFunction:null,isForm:!1,timeout:5e3,displayInModal:!0,reloadWindowOnClose:!0,error:".portalMessage.error",formFieldError:".field.error",onSuccess:null,onError:null,onFormError:null,onTimeout:null,redirectOnResponse:!1,redirectToUrl:function($action,response,options){var reg;return reg=/<body.*data-view-url=[\"'](.*)[\"'].*/im.exec(response),reg&&reg.length>1?reg[1].split('"')[0]:(reg=/<body.*data-base-url=[\"'](.*)[\"'].*/im.exec(response),reg&&reg.length>1?reg[1].split('"')[0]:(reg=/<base.*href=[\"'](.*)[\"'].*/im.exec(response),reg&&reg.length>1?reg[1]:""))}},routerOptions:{id:null,pathExp:null},form:function(actions){var self=this,$modal=self.$modal;self.options.automaticallyAddButtonActions&&(actions[self.options.buttons]={}),actions.a={},$.each(actions,function(action,options){var actionKeys=_.union(_.keys(self.options.actionOptions),["templateOptions"]),actionOptions=$.extend(!0,{},self.options.actionOptions,_.pick(options,actionKeys));options.templateOptions=$.extend(!0,options.templateOptions,self.options.templateOptions);var patternKeys=_.union(_.keys(self.options.actionOptions),["actions","actionOptions"]),patternOptions=$.extend(!0,_.omit(options,patternKeys),self.options);$(action,$("."+options.templateOptions.classBodyName,$modal)).each(function(action){var $action=$(this);$action.on(actionOptions.eventType,function(e){e.stopPropagation(),e.preventDefault(),self.loading.show(!1),null!==actionOptions.modalFunction?self[actionOptions.modalFunction]():$.nodeName($action[0],"input")||$.nodeName($action[0],"button")||options.isForm===!0?self.options.handleFormAction.apply(self,[$action,actionOptions,patternOptions]):(null!==options.ajaxUrl||$.nodeName($action[0],"a"))&&self.options.handleLinkAction.apply(self,[$action,actionOptions,patternOptions])})})})},handleFormAction:function($action,options,patternOptions){var self=this,extraData={};extraData[$action.attr("name")]=$action.attr("value");var $form;$form=$.nodeName($action[0],"form")?$action:$action.parents("form:not(.disableAutoSubmit)");var url;return url=null!==options.ajaxUrl?"function"==typeof options.ajaxUrl?options.ajaxUrl.apply(self,[$action,options]):options.ajaxUrl:$action.parents("form").attr("action"),options.disableAjaxFormSubmit?($action.attr("name")&&$action.attr("value")&&$form.append($('<input type="hidden" name="'+$action.attr("name")+'" value="'+$action.attr("value")+'" />')),void $form.trigger("submit")):($form.on("submit",function(e){e.preventDefault()}),$form.trigger("submit"),self.loading.show(!1),void $form.ajaxSubmit({timeout:options.timeout,data:extraData,url:url,error:function(xhr,textStatus,errorStatus){self.loading.hide(),"timeout"===textStatus&&options.onTimeout?options.onTimeout.apply(self,xhr,errorStatus):options.onError?options.onError(xhr,textStatus,errorStatus):(window.alert(_t("There was an error submitting the form.")),console.log("error happened do something")),self.emit("formActionError",[xhr,textStatus,errorStatus])},success:function(response,state,xhr,form){return self.loading.hide(),0!==$(options.error,response).size()||0!==$(options.formFieldError,response).size()?void(options.onFormError?options.onFormError(self,response,state,xhr,form):self.redraw(response,patternOptions)):options.redirectOnResponse===!0?void("function"==typeof options.redirectToUrl?window.parent.location.href=options.redirectToUrl.apply(self,[$action,response,options]):window.parent.location.href=options.redirectToUrl):(options.onSuccess&&options.onSuccess(self,response,state,xhr,form),options.displayInModal===!0?self.redraw(response,patternOptions):($action.trigger("destroy.plone-modal.patterns"),options.reloadWindowOnClose&&self.reloadWindow()),void self.emit("formActionSuccess",[response,state,xhr,form]))}}))},handleLinkAction:function($action,options,patternOptions){var url,self=this;return url=options.ajaxUrl?"function"==typeof options.ajaxUrl?options.ajaxUrl.apply(self,[$action,options]):options.ajaxUrl:$action.attr("href"),options.displayInModal===!1?void(window.parent.location.href=url):void $.ajax({url:url}).fail(function(xhr,textStatus,errorStatus){"timeout"===textStatus&&options.onTimeout?options.onTimeout(self.$modal,xhr,errorStatus):options.onError?options.onError(xhr,textStatus,errorStatus):window.alert(_t("There was an error loading modal.")),self.emit("linkActionError",[xhr,textStatus,errorStatus])}).done(function(response,state,xhr){self.redraw(response,patternOptions),options.onSuccess&&options.onSuccess(self,response,state,xhr),self.emit("linkActionSuccess",[response,state,xhr])}).always(function(){self.loading.hide()})},render:function(options){var self=this;if(self.emit("before-render"),self.$raw){var $raw=self.$raw.clone();$("input:checked",$raw).each(function(){this.setAttribute&&this.setAttribute("checked","checked")});var tplObject={title:"",prepend:"<div />",content:"",buttons:'<div class="pattern-modal-buttons"></div>',options:options.templateOptions};if(null===options.title){var $title=$(options.titleSelector,$raw);tplObject.title=$title.html(),$(options.titleSelector,$raw).remove()}else tplObject.title=options.title;options.prependContent&&(tplObject.prepend=$("<div />").append($(options.prependContent,$raw).clone()).html(),$(options.prependContent,$raw).remove()),options.content?tplObject.content=$(options.content,$raw).html():tplObject.content=$raw.html(),self.$modal=$(_.template(self.options.templateOptions.template)(tplObject)),self.$modalDialog=$("> ."+self.options.templateOptions.classDialog,self.$modal),self.$modalContent=$("> ."+self.options.templateOptions.classModal,self.$modalDialog),$("form",self.$modal).on("keydown",function(event){13===event.keyCode&&"TEXTAREA"!==event.target.nodeName&&(event.preventDefault(),$("input[type=submit], button[type=submit], button:not(type)",this).eq(0).trigger("click"))}),$(options.buttons,self.$modal).each(function(){var $button=$(this);$button.on("click",function(e){e.stopPropagation(),e.preventDefault()}).clone().appendTo($(".pattern-modal-buttons",self.$modal)).off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$button.trigger("click")}),$button.hide()}),self.emit("before-events-setup"),$(".plone-modal-header > a.plone-modal-close, .plone-modal-footer > a.plone-modal-close",self.$modal).off("click").on("click",function(e){e.stopPropagation(),e.preventDefault(),$(e.target).trigger("destroy.plone-modal.patterns")}),options.form&&options.form.apply(self,[options.actions]),self.$modal.addClass(self.options.templateOptions.className).on("destroy.plone-modal.patterns",function(e){e.stopPropagation(),self.hide()}).on("resize.plone-modal.patterns",function(e){e.stopPropagation(),e.preventDefault(),self.positionModal()}).appendTo(self.$wrapperInner),self.options.loadLinksWithinModal&&self.$modal.on("click",function(e){e.stopPropagation(),$.nodeName(e.target,"a")&&e.preventDefault(),self.$modal.trigger("modal-click")}),self.$modal.data("pattern-"+self.name,self),self.emit("after-render")}}},reloadWindow:function(){window.parent.location.reload()},init:function(){var self=this;self.options.loadLinksWithinModal=$.parseJSON(self.options.loadLinksWithinModal),null!==self.options.routerOptions.id&&Router.addRoute("modal",self.options.routerOptions.id,function(){this.show()},self,self.options.routerOptions.pathExp,self.options.routerOptions.expReplace),self.options.backdropOptions.closeOnEsc===!0&&$(document).on("keydown",function(e,data){self.$el.is("."+self.options.templateOptions.classActiveName)&&27===e.keyCode&&self.hide()}),$(window.parent).resize(function(){self.positionModal()}),self.options.triggers&&$.each(self.options.triggers,function(i,item){var e=item.substring(0,item.indexOf(" ")),selector=item.substring(item.indexOf(" "),item.length);$(selector||self.$el).on(e,function(e){e.stopPropagation(),e.preventDefault(),self.show()})}),self.$el.is("a")&&(self.$el.attr("href")&&!self.options.image&&(self.options.target||"#"!==self.$el.attr("href").substr(0,1)||(self.options.target=self.$el.attr("href"),self.options.content=""),self.options.ajaxUrl||"#"===self.$el.attr("href").substr(0,1)||(self.options.ajaxUrl=self.$el.attr("href"))),self.$el.on("click",function(e){e.stopPropagation(),e.preventDefault(),self.show()})),self.initModal()},createAjaxModal:function(){var self=this;self.emit("before-ajax"),self.loading.show(),self.ajaxXHR=$.ajax({url:self.options.ajaxUrl,type:self.options.ajaxType}).done(function(response,textStatus,xhr){self.ajaxXHR=void 0,self.$raw=$("<div />").append($(utils.parseBodyTag(response))),self.emit("after-ajax",self,textStatus,xhr),self._show()}).fail(function(xhr,textStatus,errorStatus){var options=self.options.actionOptions;"timeout"===textStatus&&options.onTimeout?options.onTimeout(self.$modal,xhr,errorStatus):options.onError?options.onError(xhr,textStatus,errorStatus):(window.alert(_t("There was an error loading modal.")),self.hide()),self.emit("linkActionError",[xhr,textStatus,errorStatus])}).always(function(){self.loading.hide()})},createTargetModal:function(){var self=this;self.$raw=$(self.options.target).clone(),self._show()},createBasicModal:function(){var self=this;self.$raw=$("<div/>").html(self.$el.clone()),self._show()},createHtmlModal:function(){var self=this,$el=$(self.options.html);self.$raw=$el,self._show();
},createImageModal:function(){var self=this;self.$wrapper.addClass("image-modal");var src=self.$el.attr("href");self.$raw=$('<div><h1>Image</h1><div id="content"><div class="modal-image"><img src="'+src+'" /></div></div></div>'),self._show()},initModal:function(){var self=this;self.options.ajaxUrl?self.createModal=self.createAjaxModal:self.options.target?self.createModal=self.createTargetModal:self.options.html?self.createModal=self.createHtmlModal:self.options.image?self.createModal=self.createImageModal:self.createModal=self.createBasicModal},findPosition:function(horpos,vertpos,margin,modalWidth,modalHeight,wrapperInnerWidth,wrapperInnerHeight){var absTop,absBottom,absLeft,absRight,returnpos={};return absRight=absLeft=absTop=absLeft="auto","left"===horpos?(absLeft=margin+"px",modalWidth>wrapperInnerWidth&&(absLeft="0px"),returnpos.left=absLeft):"right"===horpos?(absRight=margin+"px",modalWidth>wrapperInnerWidth&&(absRight="0px"),returnpos.right=absRight,returnpos.left="auto"):(absLeft=wrapperInnerWidth/2-modalWidth/2-margin+"px",modalWidth>wrapperInnerWidth&&(absLeft="0px"),returnpos.left=absLeft),"top"===vertpos?(absTop=margin+"px",modalHeight>wrapperInnerHeight&&(absTop="0px"),returnpos.top=absTop):"bottom"===vertpos?(absBottom=margin+"px",modalHeight>wrapperInnerHeight&&(absBottom="0px"),returnpos.bottom=absBottom,returnpos.top="auto"):(absTop=wrapperInnerHeight/2-modalHeight/2-margin+"px",modalHeight>wrapperInnerHeight&&(absTop="0px"),returnpos.top=absTop),returnpos},modalInitialized:function(){var self=this;return null!==self.$modal&&void 0!==self.$modal},positionModal:function(){var self=this;if(self.modalInitialized()){self.$modal.removeAttr("style"),self.$wrapper.parent().is("body")&&self.$wrapper.height($(window.parent).height());var margin="function"==typeof self.options.margin?self.options.margin():self.options.margin;self.$modal.css({position:"absolute",padding:margin}),self.$modalDialog.css({margin:"0",padding:"0",width:self.options.width,height:self.options.height}),self.$modalContent.css({width:self.options.width});var posopt=self.options.position.split(" "),horpos=posopt[0],vertpos=posopt[1],modalWidth=self.$modalDialog.outerWidth(!0),modalHeight=self.$modalDialog.outerHeight(!0),wrapperInnerWidth=self.$wrapperInner.width(),wrapperInnerHeight=self.$wrapperInner.height(),pos=self.findPosition(horpos,vertpos,margin,modalWidth,modalHeight,wrapperInnerWidth,wrapperInnerHeight);for(var key in pos)self.$modalDialog.css(key,pos[key])}},render:function(options){var self=this;self.emit("render"),self.options.render.apply(self,[options]),self.emit("rendered")},show:function(){var self=this;self.backdrop=self.createBackdrop(),self.createModal()},createBackdrop:function(){var self=this,backdrop=new Backdrop(self.$el.parents(self.options.backdrop),self.options.backdropOptions),zIndex=1041;return $(self.options.zIndexSelector).each(function(){zIndex=Math.max(zIndex,parseInt($(this).css("zIndex"))+1||1041)}),self.$wrapper=$("<div/>").hide().css({"z-index":zIndex,"overflow-y":"auto",position:"fixed",height:"100%",width:"100%",bottom:"0",left:"0",right:"0",top:"0"}).addClass(self.options.templateOptions.classWrapperName).insertBefore(backdrop.$backdrop).on("click",function(e){self.options.backdropOptions.closeOnClick&&(e.stopPropagation(),e.preventDefault(),backdrop.hide())}),backdrop.on("hidden",function(e){void 0!==self.$modal&&self.$modal.hasClass(self.options.templateOptions.classActiveName)&&self.hide()}),self.loading=new utils.Loading({backdrop:backdrop}),self.$wrapperInner=$("<div/>").addClass(self.options.classWrapperInnerName).css({position:"absolute",bottom:"0",left:"0",right:"0",top:"0"}).appendTo(self.$wrapper),backdrop},_show:function(){var self=this;self.render.apply(self,[self.options]),self.emit("show"),self.backdrop.show(),self.$wrapper.show(),self.loading.hide(),self.$el.addClass(self.options.templateOptions.classActiveName),self.$modal.addClass(self.options.templateOptions.classActiveName),registry.scan(self.$modal),self.positionModal(),$("img",self.$modal).load(function(){self.positionModal()}),$(window.parent).on("resize.plone-modal.patterns",function(){self.positionModal()}),$("body").addClass("plone-modal-open"),self.emit("shown")},hide:function(){var self=this;self.ajaxXHR&&self.ajaxXHR.abort(),self.emit("hide"),self._suppressHide&&!window.confirm(self._suppressHide)||(self.loading.hide(),self.$el.removeClass(self.options.templateOptions.classActiveName),void 0!==self.$modal&&(self.$modal.remove(),self.initModal()),self.$wrapper.remove(),$(".plone-modal",$("body")).size()<1&&(self.backdrop.hide(),$("body").removeClass("plone-modal-open"),$(window.parent).off("resize.plone-modal.patterns")),self.emit("hidden"))},redraw:function(response,options){var self=this;self.emit("beforeDraw"),self.$modal.remove(),self.$raw=$("<div />").append($(utils.parseBodyTag(response))),self.render.apply(self,[options||self.options]),self.$modal.addClass(self.options.templateOptions.classActiveName),self.positionModal(),registry.scan(self.$modal),self.emit("afterDraw")}});return Modal}),function(factory){"function"==typeof define&&define.amd?define("dropzone",["jquery"],factory):factory(jQuery)}(function(jQuery){var module={exports:{}};return function(){var Dropzone,Emitter,camelize,contentLoaded,detectVerticalSquash,drawImageIOSFix,noop,without,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};noop=function(){},Emitter=function(){function Emitter(){}return Emitter.prototype.addEventListener=Emitter.prototype.on,Emitter.prototype.on=function(event,fn){return this._callbacks=this._callbacks||{},this._callbacks[event]||(this._callbacks[event]=[]),this._callbacks[event].push(fn),this},Emitter.prototype.emit=function(){var args,callback,callbacks,event,_i,_len;if(event=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],this._callbacks=this._callbacks||{},callbacks=this._callbacks[event])for(_i=0,_len=callbacks.length;_i<_len;_i++)callback=callbacks[_i],callback.apply(this,args);return this},Emitter.prototype.removeListener=Emitter.prototype.off,Emitter.prototype.removeAllListeners=Emitter.prototype.off,Emitter.prototype.removeEventListener=Emitter.prototype.off,Emitter.prototype.off=function(event,fn){var callback,callbacks,i,_i,_len;if(!this._callbacks||0===arguments.length)return this._callbacks={},this;if(callbacks=this._callbacks[event],!callbacks)return this;if(1===arguments.length)return delete this._callbacks[event],this;for(i=_i=0,_len=callbacks.length;_i<_len;i=++_i)if(callback=callbacks[i],callback===fn){callbacks.splice(i,1);break}return this},Emitter}(),Dropzone=function(_super){function Dropzone(element,options){var elementOptions,fallback,_ref;if(this.element=element,this.version=Dropzone.version,this.defaultOptions.previewTemplate=this.defaultOptions.previewTemplate.replace(/\n*/g,""),this.clickableElements=[],this.listeners=[],this.files=[],"string"==typeof this.element&&(this.element=document.querySelector(this.element)),!this.element||null==this.element.nodeType)throw new Error("Invalid dropzone element.");if(this.element.dropzone)throw new Error("Dropzone already attached.");if(Dropzone.instances.push(this),this.element.dropzone=this,elementOptions=null!=(_ref=Dropzone.optionsForElement(this.element))?_ref:{},this.options=extend({},this.defaultOptions,elementOptions,null!=options?options:{}),this.options.forceFallback||!Dropzone.isBrowserSupported())return this.options.fallback.call(this);if(null==this.options.url&&(this.options.url=this.element.getAttribute("action")),!this.options.url)throw new Error("No URL provided.");if(this.options.acceptedFiles&&this.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");this.options.acceptedMimeTypes&&(this.options.acceptedFiles=this.options.acceptedMimeTypes,delete this.options.acceptedMimeTypes),this.options.method=this.options.method.toUpperCase(),(fallback=this.getExistingFallback())&&fallback.parentNode&&fallback.parentNode.removeChild(fallback),this.options.previewsContainer!==!1&&(this.options.previewsContainer?this.previewsContainer=Dropzone.getElement(this.options.previewsContainer,"previewsContainer"):this.previewsContainer=this.element),this.options.clickable&&(this.options.clickable===!0?this.clickableElements=[this.element]:this.clickableElements=Dropzone.getElements(this.options.clickable,"clickable")),this.init()}var extend,resolveOption;return __extends(Dropzone,_super),Dropzone.prototype.Emitter=Emitter,Dropzone.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],Dropzone.prototype.defaultOptions={url:null,method:"post",withCredentials:!1,parallelUploads:2,uploadMultiple:!1,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,filesizeBase:1e3,maxFiles:null,params:{},clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,hiddenInputContainer:"body",capture:null,renameFilename:null,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",accept:function(file,done){return done()},init:function(){return noop},forceFallback:!1,fallback:function(){var child,messageElement,span,_i,_len,_ref;for(this.element.className=""+this.element.className+" dz-browser-not-supported",_ref=this.element.getElementsByTagName("div"),_i=0,_len=_ref.length;_i<_len;_i++)child=_ref[_i],/(^| )dz-message($| )/.test(child.className)&&(messageElement=child,child.className="dz-message");return messageElement||(messageElement=Dropzone.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(messageElement)),span=messageElement.getElementsByTagName("span")[0],span&&(null!=span.textContent?span.textContent=this.options.dictFallbackMessage:null!=span.innerText&&(span.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(file){var info,srcRatio,trgRatio;return info={srcX:0,srcY:0,srcWidth:file.width,srcHeight:file.height},srcRatio=file.width/file.height,info.optWidth=this.options.thumbnailWidth,info.optHeight=this.options.thumbnailHeight,null==info.optWidth&&null==info.optHeight?(info.optWidth=info.srcWidth,info.optHeight=info.srcHeight):null==info.optWidth?info.optWidth=srcRatio*info.optHeight:null==info.optHeight&&(info.optHeight=1/srcRatio*info.optWidth),trgRatio=info.optWidth/info.optHeight,file.height<info.optHeight||file.width<info.optWidth?(info.trgHeight=info.srcHeight,info.trgWidth=info.srcWidth):srcRatio>trgRatio?(info.srcHeight=file.height,info.srcWidth=info.srcHeight*trgRatio):(info.srcWidth=file.width,info.srcHeight=info.srcWidth/trgRatio),info.srcX=(file.width-info.srcWidth)/2,info.srcY=(file.height-info.srcHeight)/2,info},drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:noop,dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:noop,reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(file){var node,removeFileEvent,removeLink,_i,_j,_k,_len,_len1,_len2,_ref,_ref1,_ref2,_results;if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer){for(file.previewElement=Dropzone.createElement(this.options.previewTemplate.trim()),file.previewTemplate=file.previewElement,this.previewsContainer.appendChild(file.previewElement),_ref=file.previewElement.querySelectorAll("[data-dz-name]"),_i=0,_len=_ref.length;_i<_len;_i++)node=_ref[_i],node.textContent=this._renameFilename(file.name);for(_ref1=file.previewElement.querySelectorAll("[data-dz-size]"),_j=0,_len1=_ref1.length;_j<_len1;_j++)node=_ref1[_j],node.innerHTML=this.filesize(file.size);for(this.options.addRemoveLinks&&(file._removeLink=Dropzone.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'+this.options.dictRemoveFile+"</a>"),file.previewElement.appendChild(file._removeLink)),removeFileEvent=function(_this){return function(e){return e.preventDefault(),e.stopPropagation(),file.status===Dropzone.UPLOADING?Dropzone.confirm(_this.options.dictCancelUploadConfirmation,function(){return _this.removeFile(file)}):_this.options.dictRemoveFileConfirmation?Dropzone.confirm(_this.options.dictRemoveFileConfirmation,function(){return _this.removeFile(file)}):_this.removeFile(file)}}(this),_ref2=file.previewElement.querySelectorAll("[data-dz-remove]"),_results=[],_k=0,_len2=_ref2.length;_k<_len2;_k++)removeLink=_ref2[_k],_results.push(removeLink.addEventListener("click",removeFileEvent));return _results}},removedfile:function(file){var _ref;return file.previewElement&&null!=(_ref=file.previewElement)&&_ref.parentNode.removeChild(file.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(file,dataUrl){var thumbnailElement,_i,_len,_ref;if(file.previewElement){for(file.previewElement.classList.remove("dz-file-preview"),_ref=file.previewElement.querySelectorAll("[data-dz-thumbnail]"),_i=0,_len=_ref.length;_i<_len;_i++)thumbnailElement=_ref[_i],thumbnailElement.alt=file.name,thumbnailElement.src=dataUrl;return setTimeout(function(_this){return function(){return file.previewElement.classList.add("dz-image-preview")}}(this),1)}},error:function(file,message){var node,_i,_len,_ref,_results;if(file.previewElement){for(file.previewElement.classList.add("dz-error"),"String"!=typeof message&&message.error&&(message=message.error),_ref=file.previewElement.querySelectorAll("[data-dz-errormessage]"),_results=[],_i=0,_len=_ref.length;_i<_len;_i++)node=_ref[_i],_results.push(node.textContent=message);return _results}},errormultiple:noop,processing:function(file){if(file.previewElement&&(file.previewElement.classList.add("dz-processing"),file._removeLink))return file._removeLink.textContent=this.options.dictCancelUpload},processingmultiple:noop,uploadprogress:function(file,progress,bytesSent){var node,_i,_len,_ref,_results;if(file.previewElement){for(_ref=file.previewElement.querySelectorAll("[data-dz-uploadprogress]"),_results=[],_i=0,_len=_ref.length;_i<_len;_i++)node=_ref[_i],"PROGRESS"===node.nodeName?_results.push(node.value=progress):_results.push(node.style.width=""+progress+"%");return _results}},totaluploadprogress:noop,sending:noop,sendingmultiple:noop,success:function(file){if(file.previewElement)return file.previewElement.classList.add("dz-success")},successmultiple:noop,canceled:function(file){return this.emit("error",file,"Upload canceled.")},canceledmultiple:noop,complete:function(file){if(file._removeLink&&(file._removeLink.textContent=this.options.dictRemoveFile),file.previewElement)return file.previewElement.classList.add("dz-complete")},completemultiple:noop,maxfilesexceeded:noop,maxfilesreached:noop,queuecomplete:noop,addedfiles:noop,previewTemplate:'<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail /></div>\n  <div class="dz-details">\n    <div class="dz-size"><span data-dz-size></span></div>\n    <div class="dz-filename"><span data-dz-name></span></div>\n  </div>\n  <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>\n  <div class="dz-error-message"><span data-dz-errormessage></span></div>\n  <div class="dz-success-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Check</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <path d="M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" stroke-opacity="0.198794158" stroke="#747474" fill-opacity="0.816519475" fill="#FFFFFF" sketch:type="MSShapeGroup"></path>\n      </g>\n    </svg>\n  </div>\n  <div class="dz-error-mark">\n    <svg width="54px" height="54px" viewBox="0 0 54 54" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">\n      <title>Error</title>\n      <defs></defs>\n      <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">\n        <g id="Check-+-Oval-2" sketch:type="MSLayerGroup" stroke="#747474" stroke-opacity="0.198794158" fill="#FFFFFF" fill-opacity="0.816519475">\n          <path d="M32.6568542,29 L38.3106978,23.3461564 C39.8771021,21.7797521 39.8758057,19.2483887 38.3137085,17.6862915 C36.7547899,16.1273729 34.2176035,16.1255422 32.6538436,17.6893022 L27,23.3431458 L21.3461564,17.6893022 C19.7823965,16.1255422 17.2452101,16.1273729 15.6862915,17.6862915 C14.1241943,19.2483887 14.1228979,21.7797521 15.6893022,23.3461564 L21.3431458,29 L15.6893022,34.6538436 C14.1228979,36.2202479 14.1241943,38.7516113 15.6862915,40.3137085 C17.2452101,41.8726271 19.7823965,41.8744578 21.3461564,40.3106978 L27,34.6568542 L32.6538436,40.3106978 C34.2176035,41.8744578 36.7547899,41.8726271 38.3137085,40.3137085 C39.8758057,38.7516113 39.8771021,36.2202479 38.3106978,34.6538436 L32.6568542,29 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z" id="Oval-2" sketch:type="MSShapeGroup"></path>\n        </g>\n      </g>\n    </svg>\n  </div>\n</div>'},extend=function(){var key,object,objects,target,val,_i,_len;for(target=arguments[0],objects=2<=arguments.length?__slice.call(arguments,1):[],_i=0,_len=objects.length;_i<_len;_i++){object=objects[_i];for(key in object)val=object[key],target[key]=val}return target},Dropzone.prototype.getAcceptedFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)file=_ref[_i],file.accepted&&_results.push(file);return _results},Dropzone.prototype.getRejectedFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)file=_ref[_i],file.accepted||_results.push(file);return _results},Dropzone.prototype.getFilesWithStatus=function(status){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)file=_ref[_i],file.status===status&&_results.push(file);return _results},Dropzone.prototype.getQueuedFiles=function(){return this.getFilesWithStatus(Dropzone.QUEUED)},Dropzone.prototype.getUploadingFiles=function(){return this.getFilesWithStatus(Dropzone.UPLOADING)},Dropzone.prototype.getAddedFiles=function(){return this.getFilesWithStatus(Dropzone.ADDED)},Dropzone.prototype.getActiveFiles=function(){var file,_i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)file=_ref[_i],file.status!==Dropzone.UPLOADING&&file.status!==Dropzone.QUEUED||_results.push(file);return _results},Dropzone.prototype.init=function(){var eventName,noPropagation,setupHiddenFileInput,_i,_len,_ref,_ref1;for("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(Dropzone.createElement('<div class="dz-default dz-message"><span>'+this.options.dictDefaultMessage+"</span></div>")),this.clickableElements.length&&(setupHiddenFileInput=function(_this){return function(){return _this.hiddenFileInput&&_this.hiddenFileInput.parentNode.removeChild(_this.hiddenFileInput),_this.hiddenFileInput=document.createElement("input"),_this.hiddenFileInput.setAttribute("type","file"),(null==_this.options.maxFiles||_this.options.maxFiles>1)&&_this.hiddenFileInput.setAttribute("multiple","multiple"),_this.hiddenFileInput.className="dz-hidden-input",null!=_this.options.acceptedFiles&&_this.hiddenFileInput.setAttribute("accept",_this.options.acceptedFiles),null!=_this.options.capture&&_this.hiddenFileInput.setAttribute("capture",_this.options.capture),_this.hiddenFileInput.style.visibility="hidden",_this.hiddenFileInput.style.position="absolute",_this.hiddenFileInput.style.top="0",_this.hiddenFileInput.style.left="0",_this.hiddenFileInput.style.height="0",_this.hiddenFileInput.style.width="0",document.querySelector(_this.options.hiddenInputContainer).appendChild(_this.hiddenFileInput),_this.hiddenFileInput.addEventListener("change",function(){var file,files,_i,_len;if(files=_this.hiddenFileInput.files,files.length)for(_i=0,_len=files.length;_i<_len;_i++)file=files[_i],_this.addFile(file);return _this.emit("addedfiles",files),setupHiddenFileInput()})}}(this))(),this.URL=null!=(_ref=window.URL)?_ref:window.webkitURL,_ref1=this.events,_i=0,_len=_ref1.length;_i<_len;_i++)eventName=_ref1[_i],this.on(eventName,this.options[eventName]);return this.on("uploadprogress",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this)),this.on("removedfile",function(_this){return function(){return _this.updateTotalUploadProgress()}}(this)),this.on("canceled",function(_this){return function(file){return _this.emit("complete",file)}}(this)),this.on("complete",function(_this){return function(file){if(0===_this.getAddedFiles().length&&0===_this.getUploadingFiles().length&&0===_this.getQueuedFiles().length)return setTimeout(function(){return _this.emit("queuecomplete")},0)}}(this)),noPropagation=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1},this.listeners=[{element:this.element,events:{dragstart:function(_this){return function(e){return _this.emit("dragstart",e)}}(this),dragenter:function(_this){return function(e){return noPropagation(e),_this.emit("dragenter",e)}}(this),dragover:function(_this){return function(e){var efct;try{efct=e.dataTransfer.effectAllowed}catch(_error){}return e.dataTransfer.dropEffect="move"===efct||"linkMove"===efct?"move":"copy",noPropagation(e),_this.emit("dragover",e)}}(this),dragleave:function(_this){return function(e){return _this.emit("dragleave",e)}}(this),drop:function(_this){return function(e){return noPropagation(e),_this.drop(e)}}(this),dragend:function(_this){return function(e){return _this.emit("dragend",e)}}(this)}}],this.clickableElements.forEach(function(_this){return function(clickableElement){return _this.listeners.push({element:clickableElement,events:{click:function(evt){return(clickableElement!==_this.element||evt.target===_this.element||Dropzone.elementInside(evt.target,_this.element.querySelector(".dz-message")))&&_this.hiddenFileInput.click(),!0}}})}}(this)),this.enable(),this.options.init.call(this)},Dropzone.prototype.destroy=function(){var _ref;return this.disable(),this.removeAllFiles(!0),(null!=(_ref=this.hiddenFileInput)?_ref.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,Dropzone.instances.splice(Dropzone.instances.indexOf(this),1)},Dropzone.prototype.updateTotalUploadProgress=function(){var activeFiles,file,totalBytes,totalBytesSent,totalUploadProgress,_i,_len,_ref;if(totalBytesSent=0,totalBytes=0,activeFiles=this.getActiveFiles(),activeFiles.length){for(_ref=this.getActiveFiles(),_i=0,_len=_ref.length;_i<_len;_i++)file=_ref[_i],totalBytesSent+=file.upload.bytesSent,totalBytes+=file.upload.total;totalUploadProgress=100*totalBytesSent/totalBytes}else totalUploadProgress=100;return this.emit("totaluploadprogress",totalUploadProgress,totalBytes,totalBytesSent)},Dropzone.prototype._getParamName=function(n){return"function"==typeof this.options.paramName?this.options.paramName(n):""+this.options.paramName+(this.options.uploadMultiple?"["+n+"]":"")},Dropzone.prototype._renameFilename=function(name){return"function"!=typeof this.options.renameFilename?name:this.options.renameFilename(name)},Dropzone.prototype.getFallbackForm=function(){var existingFallback,fields,fieldsString,form;return(existingFallback=this.getExistingFallback())?existingFallback:(fieldsString='<div class="dz-fallback">',this.options.dictFallbackText&&(fieldsString+="<p>"+this.options.dictFallbackText+"</p>"),fieldsString+='<input type="file" name="'+this._getParamName(0)+'" '+(this.options.uploadMultiple?'multiple="multiple"':void 0)+' /><input type="submit" value="Upload!"></div>',fields=Dropzone.createElement(fieldsString),"FORM"!==this.element.tagName?(form=Dropzone.createElement('<form action="'+this.options.url+'" enctype="multipart/form-data" method="'+this.options.method+'"></form>'),form.appendChild(fields)):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=form?form:fields)},Dropzone.prototype.getExistingFallback=function(){var fallback,getFallback,tagName,_i,_len,_ref;for(getFallback=function(elements){var el,_i,_len;for(_i=0,_len=elements.length;_i<_len;_i++)if(el=elements[_i],/(^| )fallback($| )/.test(el.className))return el},_ref=["div","form"],_i=0,_len=_ref.length;_i<_len;_i++)if(tagName=_ref[_i],fallback=getFallback(this.element.getElementsByTagName(tagName)))return fallback},Dropzone.prototype.setupEventListeners=function(){var elementListeners,event,listener,_i,_len,_ref,_results;for(_ref=this.listeners,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)elementListeners=_ref[_i],_results.push(function(){var _ref1,_results1;_ref1=elementListeners.events,_results1=[];for(event in _ref1)listener=_ref1[event],_results1.push(elementListeners.element.addEventListener(event,listener,!1));return _results1}());return _results},Dropzone.prototype.removeEventListeners=function(){var elementListeners,event,listener,_i,_len,_ref,_results;for(_ref=this.listeners,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)elementListeners=_ref[_i],_results.push(function(){var _ref1,_results1;_ref1=elementListeners.events,_results1=[];for(event in _ref1)listener=_ref1[event],_results1.push(elementListeners.element.removeEventListener(event,listener,!1));return _results1}());return _results},Dropzone.prototype.disable=function(){var file,_i,_len,_ref,_results;for(this.clickableElements.forEach(function(element){return element.classList.remove("dz-clickable")}),this.removeEventListeners(),_ref=this.files,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)file=_ref[_i],_results.push(this.cancelUpload(file));return _results},Dropzone.prototype.enable=function(){return this.clickableElements.forEach(function(element){return element.classList.add("dz-clickable")}),this.setupEventListeners()},Dropzone.prototype.filesize=function(size){var cutoff,i,selectedSize,selectedUnit,unit,units,_i,_len;if(selectedSize=0,selectedUnit="b",size>0){for(units=["TB","GB","MB","KB","b"],i=_i=0,_len=units.length;_i<_len;i=++_i)if(unit=units[i],cutoff=Math.pow(this.options.filesizeBase,4-i)/10,size>=cutoff){selectedSize=size/Math.pow(this.options.filesizeBase,4-i),selectedUnit=unit;break}selectedSize=Math.round(10*selectedSize)/10}return"<strong>"+selectedSize+"</strong> "+selectedUnit},Dropzone.prototype._updateMaxFilesReachedClass=function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")},Dropzone.prototype.drop=function(e){var files,items;e.dataTransfer&&(this.emit("drop",e),files=e.dataTransfer.files,this.emit("addedfiles",files),files.length&&(items=e.dataTransfer.items,items&&items.length&&null!=items[0].webkitGetAsEntry?this._addFilesFromItems(items):this.handleFiles(files)))},Dropzone.prototype.paste=function(e){var items,_ref;if(null!=(null!=e&&null!=(_ref=e.clipboardData)?_ref.items:void 0))return this.emit("paste",e),items=e.clipboardData.items,items.length?this._addFilesFromItems(items):void 0},Dropzone.prototype.handleFiles=function(files){var file,_i,_len,_results;for(_results=[],_i=0,_len=files.length;_i<_len;_i++)file=files[_i],_results.push(this.addFile(file));return _results},Dropzone.prototype._addFilesFromItems=function(items){var entry,item,_i,_len,_results;for(_results=[],_i=0,_len=items.length;_i<_len;_i++)item=items[_i],null!=item.webkitGetAsEntry&&(entry=item.webkitGetAsEntry())?entry.isFile?_results.push(this.addFile(item.getAsFile())):entry.isDirectory?_results.push(this._addFilesFromDirectory(entry,entry.name)):_results.push(void 0):null!=item.getAsFile&&(null==item.kind||"file"===item.kind)?_results.push(this.addFile(item.getAsFile())):_results.push(void 0);return _results},Dropzone.prototype._addFilesFromDirectory=function(directory,path){var dirReader,errorHandler,readEntries;return dirReader=directory.createReader(),errorHandler=function(error){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(error):void 0},(readEntries=function(_this){return function(){return dirReader.readEntries(function(entries){var entry,_i,_len;if(entries.length>0){for(_i=0,_len=entries.length;_i<_len;_i++)entry=entries[_i],entry.isFile?entry.file(function(file){if(!_this.options.ignoreHiddenFiles||"."!==file.name.substring(0,1))return file.fullPath=""+path+"/"+file.name,_this.addFile(file)}):entry.isDirectory&&_this._addFilesFromDirectory(entry,""+path+"/"+entry.name);readEntries()}return null},errorHandler)}}(this))()},Dropzone.prototype.accept=function(file,done){return file.size>1024*this.options.maxFilesize*1024?done(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(file.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):Dropzone.isValidFile(file,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(done(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",file)):this.options.accept.call(this,file,done):done(this.options.dictInvalidFileType)},Dropzone.prototype.addFile=function(file){return file.upload={progress:0,total:file.size,bytesSent:0
},this.files.push(file),file.status=Dropzone.ADDED,this.emit("addedfile",file),this._enqueueThumbnail(file),this.accept(file,function(_this){return function(error){return error?(file.accepted=!1,_this._errorProcessing([file],error)):(file.accepted=!0,_this.options.autoQueue&&_this.enqueueFile(file)),_this._updateMaxFilesReachedClass()}}(this))},Dropzone.prototype.enqueueFiles=function(files){var file,_i,_len;for(_i=0,_len=files.length;_i<_len;_i++)file=files[_i],this.enqueueFile(file);return null},Dropzone.prototype.enqueueFile=function(file){if(file.status!==Dropzone.ADDED||file.accepted!==!0)throw new Error("This file can't be queued because it has already been processed or was rejected.");if(file.status=Dropzone.QUEUED,this.options.autoProcessQueue)return setTimeout(function(_this){return function(){return _this.processQueue()}}(this),0)},Dropzone.prototype._thumbnailQueue=[],Dropzone.prototype._processingThumbnail=!1,Dropzone.prototype._enqueueThumbnail=function(file){if(this.options.createImageThumbnails&&file.type.match(/image.*/)&&file.size<=1024*this.options.maxThumbnailFilesize*1024)return this._thumbnailQueue.push(file),setTimeout(function(_this){return function(){return _this._processThumbnailQueue()}}(this),0)},Dropzone.prototype._processThumbnailQueue=function(){if(!this._processingThumbnail&&0!==this._thumbnailQueue.length)return this._processingThumbnail=!0,this.createThumbnail(this._thumbnailQueue.shift(),function(_this){return function(){return _this._processingThumbnail=!1,_this._processThumbnailQueue()}}(this))},Dropzone.prototype.removeFile=function(file){if(file.status===Dropzone.UPLOADING&&this.cancelUpload(file),this.files=without(this.files,file),this.emit("removedfile",file),0===this.files.length)return this.emit("reset")},Dropzone.prototype.removeAllFiles=function(cancelIfNecessary){var file,_i,_len,_ref;for(null==cancelIfNecessary&&(cancelIfNecessary=!1),_ref=this.files.slice(),_i=0,_len=_ref.length;_i<_len;_i++)file=_ref[_i],(file.status!==Dropzone.UPLOADING||cancelIfNecessary)&&this.removeFile(file);return null},Dropzone.prototype.createThumbnail=function(file,callback){var fileReader;return fileReader=new FileReader,fileReader.onload=function(_this){return function(){return"image/svg+xml"===file.type?(_this.emit("thumbnail",file,fileReader.result),void(null!=callback&&callback())):_this.createThumbnailFromUrl(file,fileReader.result,callback)}}(this),fileReader.readAsDataURL(file)},Dropzone.prototype.createThumbnailFromUrl=function(file,imageUrl,callback,crossOrigin){var img;return img=document.createElement("img"),crossOrigin&&(img.crossOrigin=crossOrigin),img.onload=function(_this){return function(){var canvas,ctx,resizeInfo,thumbnail,_ref,_ref1,_ref2,_ref3;if(file.width=img.width,file.height=img.height,resizeInfo=_this.options.resize.call(_this,file),null==resizeInfo.trgWidth&&(resizeInfo.trgWidth=resizeInfo.optWidth),null==resizeInfo.trgHeight&&(resizeInfo.trgHeight=resizeInfo.optHeight),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),canvas.width=resizeInfo.trgWidth,canvas.height=resizeInfo.trgHeight,drawImageIOSFix(ctx,img,null!=(_ref=resizeInfo.srcX)?_ref:0,null!=(_ref1=resizeInfo.srcY)?_ref1:0,resizeInfo.srcWidth,resizeInfo.srcHeight,null!=(_ref2=resizeInfo.trgX)?_ref2:0,null!=(_ref3=resizeInfo.trgY)?_ref3:0,resizeInfo.trgWidth,resizeInfo.trgHeight),thumbnail=canvas.toDataURL("image/png"),_this.emit("thumbnail",file,thumbnail),null!=callback)return callback()}}(this),null!=callback&&(img.onerror=callback),img.src=imageUrl},Dropzone.prototype.processQueue=function(){var i,parallelUploads,processingLength,queuedFiles;if(parallelUploads=this.options.parallelUploads,processingLength=this.getUploadingFiles().length,i=processingLength,!(processingLength>=parallelUploads)&&(queuedFiles=this.getQueuedFiles(),queuedFiles.length>0)){if(this.options.uploadMultiple)return this.processFiles(queuedFiles.slice(0,parallelUploads-processingLength));for(;i<parallelUploads;){if(!queuedFiles.length)return;this.processFile(queuedFiles.shift()),i++}}},Dropzone.prototype.processFile=function(file){return this.processFiles([file])},Dropzone.prototype.processFiles=function(files){var file,_i,_len;for(_i=0,_len=files.length;_i<_len;_i++)file=files[_i],file.processing=!0,file.status=Dropzone.UPLOADING,this.emit("processing",file);return this.options.uploadMultiple&&this.emit("processingmultiple",files),this.uploadFiles(files)},Dropzone.prototype._getFilesWithXhr=function(xhr){var file,files;return files=function(){var _i,_len,_ref,_results;for(_ref=this.files,_results=[],_i=0,_len=_ref.length;_i<_len;_i++)file=_ref[_i],file.xhr===xhr&&_results.push(file);return _results}.call(this)},Dropzone.prototype.cancelUpload=function(file){var groupedFile,groupedFiles,_i,_j,_len,_len1,_ref;if(file.status===Dropzone.UPLOADING){for(groupedFiles=this._getFilesWithXhr(file.xhr),_i=0,_len=groupedFiles.length;_i<_len;_i++)groupedFile=groupedFiles[_i],groupedFile.status=Dropzone.CANCELED;for(file.xhr.abort(),_j=0,_len1=groupedFiles.length;_j<_len1;_j++)groupedFile=groupedFiles[_j],this.emit("canceled",groupedFile);this.options.uploadMultiple&&this.emit("canceledmultiple",groupedFiles)}else(_ref=file.status)!==Dropzone.ADDED&&_ref!==Dropzone.QUEUED||(file.status=Dropzone.CANCELED,this.emit("canceled",file),this.options.uploadMultiple&&this.emit("canceledmultiple",[file]));if(this.options.autoProcessQueue)return this.processQueue()},resolveOption=function(){var args,option;return option=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],"function"==typeof option?option.apply(this,args):option},Dropzone.prototype.uploadFile=function(file){return this.uploadFiles([file])},Dropzone.prototype.uploadFiles=function(files){var file,formData,handleError,headerName,headerValue,headers,i,input,inputName,inputType,key,method,option,progressObj,response,updateProgress,url,value,xhr,_i,_j,_k,_l,_len,_len1,_len2,_len3,_m,_ref,_ref1,_ref2,_ref3,_ref4,_ref5;for(xhr=new XMLHttpRequest,_i=0,_len=files.length;_i<_len;_i++)file=files[_i],file.xhr=xhr;method=resolveOption(this.options.method,files),url=resolveOption(this.options.url,files),xhr.open(method,url,!0),xhr.withCredentials=!!this.options.withCredentials,response=null,handleError=function(_this){return function(){var _j,_len1,_results;for(_results=[],_j=0,_len1=files.length;_j<_len1;_j++)file=files[_j],_results.push(_this._errorProcessing(files,response||_this.options.dictResponseError.replace("{{statusCode}}",xhr.status),xhr));return _results}}(this),updateProgress=function(_this){return function(e){var allFilesFinished,progress,_j,_k,_l,_len1,_len2,_len3,_results;if(null!=e)for(progress=100*e.loaded/e.total,_j=0,_len1=files.length;_j<_len1;_j++)file=files[_j],file.upload={progress:progress,total:e.total,bytesSent:e.loaded};else{for(allFilesFinished=!0,progress=100,_k=0,_len2=files.length;_k<_len2;_k++)file=files[_k],100===file.upload.progress&&file.upload.bytesSent===file.upload.total||(allFilesFinished=!1),file.upload.progress=progress,file.upload.bytesSent=file.upload.total;if(allFilesFinished)return}for(_results=[],_l=0,_len3=files.length;_l<_len3;_l++)file=files[_l],_results.push(_this.emit("uploadprogress",file,progress,file.upload.bytesSent));return _results}}(this),xhr.onload=function(_this){return function(e){var _ref;if(files[0].status!==Dropzone.CANCELED&&4===xhr.readyState){if(response=xhr.responseText,xhr.getResponseHeader("content-type")&&~xhr.getResponseHeader("content-type").indexOf("application/json"))try{response=JSON.parse(response)}catch(_error){e=_error,response="Invalid JSON response from server."}return updateProgress(),200<=(_ref=xhr.status)&&_ref<300?_this._finished(files,response,e):handleError()}}}(this),xhr.onerror=function(_this){return function(){if(files[0].status!==Dropzone.CANCELED)return handleError()}}(this),progressObj=null!=(_ref=xhr.upload)?_ref:xhr,progressObj.onprogress=updateProgress,headers={Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"},this.options.headers&&extend(headers,this.options.headers);for(headerName in headers)headerValue=headers[headerName],headerValue&&xhr.setRequestHeader(headerName,headerValue);if(formData=new FormData,this.options.params){_ref1=this.options.params;for(key in _ref1)value=_ref1[key],formData.append(key,value)}for(_j=0,_len1=files.length;_j<_len1;_j++)file=files[_j],this.emit("sending",file,xhr,formData);if(this.options.uploadMultiple&&this.emit("sendingmultiple",files,xhr,formData),"FORM"===this.element.tagName)for(_ref2=this.element.querySelectorAll("input, textarea, select, button"),_k=0,_len2=_ref2.length;_k<_len2;_k++)if(input=_ref2[_k],inputName=input.getAttribute("name"),inputType=input.getAttribute("type"),"SELECT"===input.tagName&&input.hasAttribute("multiple"))for(_ref3=input.options,_l=0,_len3=_ref3.length;_l<_len3;_l++)option=_ref3[_l],option.selected&&formData.append(inputName,option.value);else(!inputType||"checkbox"!==(_ref4=inputType.toLowerCase())&&"radio"!==_ref4||input.checked)&&formData.append(inputName,input.value);for(i=_m=0,_ref5=files.length-1;0<=_ref5?_m<=_ref5:_m>=_ref5;i=0<=_ref5?++_m:--_m)formData.append(this._getParamName(i),files[i],this._renameFilename(files[i].name));return this.submitRequest(xhr,formData,files)},Dropzone.prototype.submitRequest=function(xhr,formData,files){return xhr.send(formData)},Dropzone.prototype._finished=function(files,responseText,e){var file,_i,_len;for(_i=0,_len=files.length;_i<_len;_i++)file=files[_i],file.status=Dropzone.SUCCESS,this.emit("success",file,responseText,e),this.emit("complete",file);if(this.options.uploadMultiple&&(this.emit("successmultiple",files,responseText,e),this.emit("completemultiple",files)),this.options.autoProcessQueue)return this.processQueue()},Dropzone.prototype._errorProcessing=function(files,message,xhr){var file,_i,_len;for(_i=0,_len=files.length;_i<_len;_i++)file=files[_i],file.status=Dropzone.ERROR,this.emit("error",file,message,xhr),this.emit("complete",file);if(this.options.uploadMultiple&&(this.emit("errormultiple",files,message,xhr),this.emit("completemultiple",files)),this.options.autoProcessQueue)return this.processQueue()},Dropzone}(Emitter),Dropzone.version="4.3.0",Dropzone.options={},Dropzone.optionsForElement=function(element){return element.getAttribute("id")?Dropzone.options[camelize(element.getAttribute("id"))]:void 0},Dropzone.instances=[],Dropzone.forElement=function(element){if("string"==typeof element&&(element=document.querySelector(element)),null==(null!=element?element.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return element.dropzone},Dropzone.autoDiscover=!0,Dropzone.discover=function(){var checkElements,dropzone,dropzones,_i,_len,_results;for(document.querySelectorAll?dropzones=document.querySelectorAll(".dropzone"):(dropzones=[],checkElements=function(elements){var el,_i,_len,_results;for(_results=[],_i=0,_len=elements.length;_i<_len;_i++)el=elements[_i],/(^| )dropzone($| )/.test(el.className)?_results.push(dropzones.push(el)):_results.push(void 0);return _results},checkElements(document.getElementsByTagName("div")),checkElements(document.getElementsByTagName("form"))),_results=[],_i=0,_len=dropzones.length;_i<_len;_i++)dropzone=dropzones[_i],Dropzone.optionsForElement(dropzone)!==!1?_results.push(new Dropzone(dropzone)):_results.push(void 0);return _results},Dropzone.blacklistedBrowsers=[/opera.*Macintosh.*version\/12/i],Dropzone.isBrowserSupported=function(){var capableBrowser,regex,_i,_len,_ref;if(capableBrowser=!0,window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a"))for(_ref=Dropzone.blacklistedBrowsers,_i=0,_len=_ref.length;_i<_len;_i++)regex=_ref[_i],regex.test(navigator.userAgent)&&(capableBrowser=!1);else capableBrowser=!1;else capableBrowser=!1;return capableBrowser},without=function(list,rejectedItem){var item,_i,_len,_results;for(_results=[],_i=0,_len=list.length;_i<_len;_i++)item=list[_i],item!==rejectedItem&&_results.push(item);return _results},camelize=function(str){return str.replace(/[\-_](\w)/g,function(match){return match.charAt(1).toUpperCase()})},Dropzone.createElement=function(string){var div;return div=document.createElement("div"),div.innerHTML=string,div.childNodes[0]},Dropzone.elementInside=function(element,container){if(element===container)return!0;for(;element=element.parentNode;)if(element===container)return!0;return!1},Dropzone.getElement=function(el,name){var element;if("string"==typeof el?element=document.querySelector(el):null!=el.nodeType&&(element=el),null==element)throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector or a plain HTML element.");return element},Dropzone.getElements=function(els,name){var e,el,elements,_i,_j,_len,_len1,_ref;if(els instanceof Array){elements=[];try{for(_i=0,_len=els.length;_i<_len;_i++)el=els[_i],elements.push(this.getElement(el,name))}catch(_error){e=_error,elements=null}}else if("string"==typeof els)for(elements=[],_ref=document.querySelectorAll(els),_j=0,_len1=_ref.length;_j<_len1;_j++)el=_ref[_j],elements.push(el);else null!=els.nodeType&&(elements=[els]);if(null==elements||!elements.length)throw new Error("Invalid `"+name+"` option provided. Please provide a CSS selector, a plain HTML element or a list of those.");return elements},Dropzone.confirm=function(question,accepted,rejected){return window.confirm(question)?accepted():null!=rejected?rejected():void 0},Dropzone.isValidFile=function(file,acceptedFiles){var baseMimeType,mimeType,validType,_i,_len;if(!acceptedFiles)return!0;for(acceptedFiles=acceptedFiles.split(","),mimeType=file.type,baseMimeType=mimeType.replace(/\/.*$/,""),_i=0,_len=acceptedFiles.length;_i<_len;_i++)if(validType=acceptedFiles[_i],validType=validType.trim(),"."===validType.charAt(0)){if(file.name.toLowerCase().indexOf(validType.toLowerCase(),file.name.length-validType.length)!==-1)return!0}else if(/\/\*$/.test(validType)){if(baseMimeType===validType.replace(/\/.*$/,""))return!0}else if(mimeType===validType)return!0;return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(options){return this.each(function(){return new Dropzone(this,options)})}),"undefined"!=typeof module&&null!==module?module.exports=Dropzone:window.Dropzone=Dropzone,Dropzone.ADDED="added",Dropzone.QUEUED="queued",Dropzone.ACCEPTED=Dropzone.QUEUED,Dropzone.UPLOADING="uploading",Dropzone.PROCESSING=Dropzone.UPLOADING,Dropzone.CANCELED="canceled",Dropzone.ERROR="error",Dropzone.SUCCESS="success",detectVerticalSquash=function(img){var alpha,canvas,ctx,data,ey,ih,iw,py,ratio,sy;for(iw=img.naturalWidth,ih=img.naturalHeight,canvas=document.createElement("canvas"),canvas.width=1,canvas.height=ih,ctx=canvas.getContext("2d"),ctx.drawImage(img,0,0),data=ctx.getImageData(0,0,1,ih).data,sy=0,ey=ih,py=ih;py>sy;)alpha=data[4*(py-1)+3],0===alpha?ey=py:sy=py,py=ey+sy>>1;return ratio=py/ih,0===ratio?1:ratio},drawImageIOSFix=function(ctx,img,sx,sy,sw,sh,dx,dy,dw,dh){var vertSquashRatio;return vertSquashRatio=detectVerticalSquash(img),ctx.drawImage(img,sx,sy,sw,sh,dx,dy,dw,dh/vertSquashRatio)},contentLoaded=function(win,fn){var add,doc,done,init,poll,pre,rem,root,top;if(done=!1,top=!0,doc=win.document,root=doc.documentElement,add=doc.addEventListener?"addEventListener":"attachEvent",rem=doc.addEventListener?"removeEventListener":"detachEvent",pre=doc.addEventListener?"":"on",init=function(e){if("readystatechange"!==e.type||"complete"===doc.readyState)return("load"===e.type?win:doc)[rem](pre+e.type,init,!1),!done&&(done=!0)?fn.call(win,e.type||e):void 0},poll=function(){var e;try{root.doScroll("left")}catch(_error){return e=_error,void setTimeout(poll,50)}return init("poll")},"complete"!==doc.readyState){if(doc.createEventObject&&root.doScroll){try{top=!win.frameElement}catch(_error){}top&&poll()}return doc[add](pre+"DOMContentLoaded",init,!1),doc[add](pre+"readystatechange",init,!1),win[add](pre+"load",init,!1)}},Dropzone._autoDiscoverFunction=function(){if(Dropzone.autoDiscover)return Dropzone.discover()},contentLoaded(window,Dropzone._autoDiscoverFunction)}.call(this),module.exports}),define("text!mockup-patterns-upload-url/templates/upload.xml",[],function(){return'<div class="upload-container upload-multiple">\n    <h2 class="title"><%- _t("Upload here") %></h2>\n    <p class="help">\n        <%- _t(\'Drag and drop files from your computer onto the area below or click the "Browse" button.\') %>\n    </p>\n    <div class="upload-area">\n        <div class="fallback">\n            <input name="file" type="file" multiple />\n        </div>\n        <div class="dz-message"><p><%-_t("Drop files here...")%></p></div>\n        <div class="row browse-select">\n            <div class="col-md-9">\n                <input\n                    id="fakeUploadFile"\n                    placeholder="<%- _t("Choose File") %>"\n                    disabled="disabled"\n                    />\n            </div>\n            <div class="col-md-3">\n                <button\n                    type="button"\n                    class="btn btn-primary browse">\n                    Browse\n                </button>\n            </div>\n        </div>\n        <div class="upload-queue">\n            <div class="previews">\n            </div>\n            <div class="controls">\n                <div class="path">\n                    <label><%- _t("Upload to...") %></label>\n                    <p class="form-help">\n                        <%- _t("Select another destination folder or leave blank to add files to the current location.") %>\n                    </p>\n                    <input\n                        type="text"\n                        name="location"\n                        />\n                </div>\n                <div class="actions row">\n                    <div class="col-md-9">\n                        <div class="progress progress-striped active">\n                            <div class="progress-bar progress-bar-success"\n                                 role="progressbar"\n                                 aria-valuenow="0"\n                                 aria-valuemin="0"\n                                 aria-valuemax="100"\n                                 style="width: 0%">\n                                <span class="sr-only">40% Complete (success)</span>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="col-md-3 align-right">\n                        <button\n                            type="button"\n                            class="btn btn-primary upload-all">\n                            <%- _t("Upload") %>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n'}),define("text!mockup-patterns-upload-url/templates/preview.xml",[],function(){return'<div class="row item form-inline">\n    <div class="col-md-1 action">\n        <button\n            type="button"\n            class="btn btn-danger btn-xs remove-item"\n            data-dz-remove=""\n            href="javascript:undefined;">\n            <span class="glyphicon glyphicon-remove"></span>\n        </button>\n    </div>\n    <div class="col-md-8 title">\n        <div class="dz-preview">\n          <div class="dz-details">\n            <div class="dz-filename"><span data-dz-name></span></div>\n          </div>\n          <div class="dz-error-message"><span data-dz-errormessage></span></div>\n        </div>\n        <div class="dz-progress">\n            <span class="dz-upload" data-dz-uploadprogress></span>\n        </div>\n    </div>\n    <div class="col-md-3 info">\n        <div class="dz-size" data-dz-size></div>\n        <img data-dz-thumbnail />\n    </div>\n</div>\n'}),define("mockup-patterns-upload",["jquery","underscore","pat-base","mockup-patterns-relateditems","dropzone","text!mockup-patterns-upload-url/templates/upload.xml","text!mockup-patterns-upload-url/templates/preview.xml","translate"],function($,_,Base,RelatedItems,Dropzone,UploadTemplate,PreviewTemplate,_t){"use strict";Dropzone.autoDiscover=!1;var UploadPattern=Base.extend({name:"upload",trigger:".pat-upload",parser:"mockup",defaults:{showTitle:!0,url:null,className:"upload",wrap:!1,wrapperTemplate:'<div class="upload-wrapper"/>',fileaddedClassName:"dropping",useTus:!1,container:"",ajaxUpload:!0,paramName:"file",addRemoveLinks:!1,autoCleanResults:!0,previewsContainer:".previews",previewTemplate:null,maxFiles:null,maxFilesize:99999999,relatedItems:{attributes:["UID","Title","Description","getURL","portal_type","path","ModificationDate"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,selectableTypes:["Folder"]}},init:function(){var self=this,template=UploadTemplate;$(document).bind("paste",function(e){var oe=e.originalEvent,items=oe.clipboardData.items;if(items)for(var i=0;i<items.length;i++)if(items[i].type.indexOf("image")!==-1){var blob=items[i].getAsFile();self.dropzone.addFile(blob)}}),self.currentPath=self.options.currentPath,self.currentFile=0,template=_.template(template)({_t:_t}),self.$el.addClass(self.options.className),self.$el.append(template),self.$progress=$(".progress-bar-success",self.$el),self.options.showTitle||self.$el.find("h2.title").hide(),self.options.ajaxUpload||($(".fallback",this.$el).remove(),this.$el.hasClass(".upload-container")?this.$el.addClass("no-ajax-upload"):this.$el.closest(".upload-container").addClass("no-ajax-upload")),self.options.wrap&&(self.$el.wrap(self.options.wrapperTemplate),self.$el=self.$el.parent()),self.options.baseUrl&&self.options.relativePath?(self.$pathInput=$('input[name="location"]',self.$el),self.relatedItems=self.setupRelatedItems(self.$pathInput)):($('input[name="location"]',self.$el).parent().remove(),self.relatedItems=null),self.$dropzone=$(".upload-area",self.$el),$("button.browse",self.$el).click(function(e){e.preventDefault(),e.stopPropagation(),(!self.options.maxFiles||self.dropzone.files.length<self.options.maxFiles)&&self.dropzone.hiddenFileInput.click()});var dzoneOptions=this.getDzoneOptions();try{self.dropzone=new Dropzone(self.$dropzone[0],dzoneOptions)}catch(e){throw window.DEBUG&&console.log(e),e}self.dropzone.on("maxfilesreached",function(){self.showHideControls()}),self.dropzone.on("addedfile",function(){self.showHideControls()}),self.dropzone.on("removedfile",function(){self.showHideControls()}),self.dropzone.on("success",function(e,response){var data;try{data=$.parseJSON(response)}catch(ex){data=response}self.$el.trigger("uploadAllCompleted",{data:data,path_uid:self.$pathInput?self.$pathInput.val():null})}),self.options.autoCleanResults&&self.dropzone.on("complete",function(file){file.status===Dropzone.SUCCESS&&setTimeout(function(){$(file.previewElement).fadeOut()},3e3)}),self.dropzone.on("complete",function(file){file.status===Dropzone.SUCCESS&&1===self.dropzone.files.length&&self.showHideControls()}),self.dropzone.on("error",function(file,response,xmlhr){"undefined"!=typeof xmlhr&&403!==xmlhr.status&&$(".dz-error-message span",file.previewElement).html(_t("The file transfer failed"))}),self.dropzone.on("totaluploadprogress",function(pct){pct=(100*(self.currentFile-1)+pct)/(100*self.dropzone.files.length)*100,self.$progress.attr("aria-valuenow",pct).css("width",pct+"%")}),$(".upload-all",self.$el).click(function(e){e.preventDefault(),e.stopPropagation(),self.processUpload({finished:function(){self.$progress.attr("aria-valuenow",0).css("width","0%")}})}),self.options.clipboardfile&&self.dropzone.addFile(self.options.clipboardfile)},showHideControls:function(){var self=this;self._showHideTimeout&&clearTimeout(self._showHideTimeout),self._showHideTimeout=setTimeout(function(){self._showHideControls()},50)},_showHideControls:function(){var self=this,$controls=$(".controls",self.$el),$browse=$(".browse-select",self.$el),$input=$(".dz-hidden-input");if(self.options.maxFiles&&(self.dropzone.files.length<self.options.maxFiles?($browse.show(),$input.prop("disabled",!1)):($browse.hide(),$input.prop("disabled",!0))),self.dropzone.files.length>0){$controls.fadeIn("slow");var file=self.dropzone.files[0];$(".dz-error-message span",file.previewElement).html("")}else $controls.fadeOut("slow")},pathJoin:function(){var parts=[];return _.each(arguments,function(part){part&&("/"===part[0]&&(part=part.substring(1)),"/"===part[part.length-1]&&(part=part.substring(0,part.length-1)),parts.push(part))}),parts.join("/")},getUrl:function(){var self=this,url=self.options.url;if(!url)if(self.options.baseUrl&&self.options.relativePath)url=self.options.baseUrl,"/"!==url[url.length-1]&&(url+="/"),url+=self.pathJoin(self.currentPath,self.options.relativePath);else{var $form=self.$el.parents("form");url=$form.length>0?$form.attr("action"):window.location.href}return url},getDzoneOptions:function(){var self=this;self.options.clickable=!0;var options=$.extend({},self.options);if(options.url=self.getUrl(),options.uploadMultiple=!1,delete options.wrap,delete options.wrapperTemplate,delete options.resultTemplate,delete options.autoCleanResults,delete options.fileaddedClassName,delete options.useTus,self.options.previewsContainer){var $preview=self.$el.find(self.options.previewsContainer);$preview.length>0&&(options.previewsContainer=$preview[0])}return options.autoProcessQueue=!1,options.previewTemplate=PreviewTemplate,options},processUpload:function(options){function process(){processing=!0,0===self.dropzone.files.length&&(processing=!1);var file=self.dropzone.files[0];return processing&&file.status===Dropzone.ERROR&&(file.status=Dropzone.QUEUED,processing=!1),processing?void([Dropzone.SUCCESS,Dropzone.CANCELED].indexOf(file.status)!==-1?(self.dropzone.removeFile(file),process()):file.status!==Dropzone.UPLOADING?(useTus&&window.tus?self.handleTusUpload(file):(self.currentFile+=1,self.dropzone.processFile(file)),setTimeout(process,100)):setTimeout(process,100)):(self.$el.removeClass(fileaddedClassName),void(void 0!==finished&&"function"==typeof finished&&finished()))}options||(options={});var self=this,processing=!1,useTus=self.options.useTus,fileaddedClassName=self.options.fileaddedClassName,finished=options.finished;self.currentFile=0,process()},handleTusUpload:function(file){var self=this,chunkSize=($(file.previewElement),5242880);file.status=Dropzone.UPLOADING,window.tus.upload(file,{endpoint:self.dropzone.options.url,headers:{FILENAME:file.name},chunkSize:chunkSize}).fail(function(){window.DEBUG&&console.alert(_t("Error uploading with TUS resumable uploads")),file.status=Dropzone.ERROR}).progress(function(e,bytesUploaded,bytesTotal){var percentage=bytesUploaded/bytesTotal*100;self.$progress.attr("aria-valuenow",percentage).css("width",percentage+"%"),self.$progress.html(_t("uploading...")+"<br />"+self.formatBytes(bytesUploaded)+" / "+self.formatBytes(bytesTotal))}).done(function(url,file){file.status=Dropzone.SUCCESS,self.dropzone.emit("success",file),self.dropzone.emit("complete",file)})},formatBytes:function(bytes){var kb=Math.round(bytes/1024);if(kb<1024)return kb+" KiB";var mb=Math.round(kb/1024);return mb<1024?mb+" MB":Math.round(mb/1024)+" GB"},setPath:function(path){var self=this;self.currentPath=path,self.options.url=null,self.options.url=self.dropzone.options.url=self.getUrl()},setupRelatedItems:function($input){var self=this,options=self.options.relatedItems;self.options.initialFolder&&$input.attr("value",self.options.initialFolder);var ri=new RelatedItems($input,options);return ri.$el.on("change",function(){var result=$(this).select2("data"),path=null;result.length>0&&(path=result[0].path),self.setPath(path)}),ri}});return UploadPattern}),define("mockup-patterns-tinymce-url/js/links",["jquery","underscore","pat-registry","pat-base","tinymce","text!mockup-patterns-tinymce-url/templates/link.xml","text!mockup-patterns-tinymce-url/templates/image.xml","mockup-patterns-relateditems","mockup-patterns-autotoc","mockup-patterns-modal","mockup-patterns-upload"],function($,_,registry,Base,tinymce,LinkTemplate,ImageTemplate,RelatedItems){"use strict";var LinkType=Base.extend({defaults:{linkModal:null},init:function(){this.linkModal=this.options.linkModal,this.tinypattern=this.options.tinypattern,this.tiny=this.tinypattern.tiny,this.dom=this.tiny.dom},getEl:function(){return this.$el.find("input")},value:function(){return $.trim(this.getEl().val())},toUrl:function(){return this.value()},load:function(element){this.getEl().attr("value",this.tiny.dom.getAttrib(element,"data-val"))},set:function(val){var $el=this.getEl();$el.attr("value",val),$el.val(val)},attributes:function(){return{"data-val":this.value()}}}),ExternalLink=LinkType.extend({init:function(){LinkType.prototype.init.call(this),this.getEl().on("change",function(){var val=$(this).val();if(!new RegExp("https?://").test(val)){var domain=$(this).val().split("/")[0];domain.indexOf(".")!==-1&&$(this).val("http://"+val)}})}}),InternalLink=LinkType.extend({init:function(){LinkType.prototype.init.call(this),this.getEl().addClass("pat-relateditems"),this.createRelatedItems()},getEl:function(){return this.$el.find("input:not(.select2-input)")},createRelatedItems:function(){this.relatedItems=new RelatedItems(this.getEl(),this.linkModal.options.relatedItems)},value:function(){var val=this.getEl().select2("data");return val&&"object"==typeof val&&(val=val[0]),val},toUrl:function(){var value=this.value();return value?this.tinypattern.generateUrl(value):null},load:function(element){var val=this.tiny.dom.getAttrib(element,"data-val");val&&this.set(val)},set:function(val){var $el=this.getEl();$el.select2("destroy"),$el.removeData("pattern-relateditems"),$el.parent().replaceWith($el),$el.attr("value",val),$el.val(val),this.createRelatedItems()},attributes:function(){var val=this.value();return val?{"data-val":val.UID}:{}}}),UploadLink=LinkType.extend({getDelegatedLinkType:function(){return"uploadImage"===this.linkModal.linkType?this.linkModal.linkTypes.image:this.linkModal.linkTypes.internal},toUrl:function(){return this.getDelegatedLinkType().toUrl()},attributes:function(){return this.getDelegatedLinkType().attributes()},set:function(val){return this.getDelegatedLinkType().set(val)},load:function(element){return this.getDelegatedLinkType().load(element)},value:function(){return this.getDelegatedLinkType().value()}}),ImageLink=InternalLink.extend({toUrl:function(){var value=this.value();return this.tinypattern.generateImageUrl(value,this.linkModal.$scale.val())}}),EmailLink=LinkType.extend({toUrl:function(){var self=this,val=self.value();if(val){var subject=self.getSubject(),href="mailto:"+val;return subject&&(href+="?subject="+subject),href}return null},load:function(element){LinkType.prototype.load.apply(this,[element]),this.linkModal.$subject.val(this.tiny.dom.getAttrib(element,"data-subject"))},getSubject:function(){return this.linkModal.$subject.val()},attributes:function(){var attribs=LinkType.prototype.attributes.call(this);return attribs["data-subject"]=this.getSubject(),attribs}}),AnchorLink=LinkType.extend({init:function(){LinkType.prototype.init.call(this),this.$select=this.$el.find("select"),this.anchorNodes=[],this.anchorData=[],this.populate()},value:function(){var val=this.$select.select2("data");return val&&"object"==typeof val&&(val=val.id),val},populate:function(){var self=this;self.$select.find("option").remove(),self.anchorNodes=[],self.anchorData=[];var node,i,j,name,title,nodes=self.tiny.dom.select("a.mceItemAnchor,img.mceItemAnchor,a.mce-item-anchor,img.mce-item-anchor");for(i=0;i<nodes.length;i+=1)node=nodes[i],name=self.tiny.dom.getAttrib(node,"name"),name||(name=self.tiny.dom.getAttrib(node,"id")),""!==name&&(self.anchorNodes.push(node),self.anchorData.push({
name:name,title:name}));if(nodes=self.tiny.dom.select(self.linkModal.options.anchorSelector),nodes.length>0)for(i=0;i<nodes.length;i+=1)if(node=nodes[i],title=$(node).text().replace(/^\s+|\s+$/g,""),""!==title){name=title.toLowerCase().substring(0,1024),name=name.replace(/[^a-z0-9]/g,"-");var found=!1;for(j=0;j<self.anchorNodes.length;j+=1){var anode=self.anchorData[j];if(anode.name===name){found=!0,anode.title=title;break}}found||(self.anchorData.push({name:name,title:title,newAnchor:!0}),self.anchorNodes.push(node))}if(self.anchorNodes.length>0)for(i=0;i<self.anchorData.length;i+=1){var data=self.anchorData[i];self.$select.append('<option value="'+i+'">'+data.title+"</option>")}else self.$select.append("<option>No anchors found..</option>")},getIndex:function(name){for(var i=0;i<this.anchorData.length;i+=1){var data=this.anchorData[i];if(data.name===name)return i}return 0},toUrl:function(){var val=this.value();if(val){var index=parseInt(val,10),node=this.anchorNodes[index],data=this.anchorData[index];return data.newAnchor&&(node.innerHTML='<a name="'+data.name+'" class="mce-item-anchor"></a>'+node.innerHTML),"#"+data.name}return null},set:function(val){var anchor=this.getIndex(val);this.$select.select2("data",""+anchor)}});tinymce.PluginManager.add("ploneimage",function(editor){editor.addButton("ploneimage",{icon:"image",tooltip:"Insert/edit image",onclick:editor.settings.addImageClicked,stateSelector:"img:not([data-mce-object])"}),editor.addMenuItem("ploneimage",{icon:"image",text:"Insert image",onclick:editor.settings.addImageClicked,context:"insert",prependToContext:!0})}),tinymce.PluginManager.add("plonelink",function(editor){editor.addButton("plonelink",{icon:"link",tooltip:"Insert/edit link",shortcut:"Ctrl+K",onclick:editor.settings.addLinkClicked,stateSelector:"a[href]"}),editor.addButton("unlink",{icon:"unlink",tooltip:"Remove link(s)",cmd:"unlink",stateSelector:"a[href]"}),editor.addShortcut("Ctrl+K","",editor.settings.addLinkClicked),editor.addMenuItem("plonelink",{icon:"link",text:"Insert link",shortcut:"Ctrl+K",onclick:editor.settings.addLinkClicked,stateSelector:"a[href]",context:"insert",prependToContext:!0})});var LinkModal=Base.extend({name:"linkmodal",trigger:".pat-linkmodal",defaults:{anchorSelector:"h1,h2,h3",linkTypes:[],initialLinkType:"internal",text:{insertHeading:"Insert Link"},linkTypeClassMapping:{internal:InternalLink,upload:UploadLink,external:ExternalLink,email:EmailLink,anchor:AnchorLink,image:ImageLink,uploadImage:UploadLink,externalImage:LinkType}},linkTypeTemplateMapping:{internal:LinkTemplate,upload:LinkTemplate,external:LinkTemplate,email:LinkTemplate,anchor:LinkTemplate,image:ImageTemplate,uploadImage:ImageTemplate,externalImage:ImageTemplate},template:function(data){return _.template(this.linkTypeTemplateMapping[this.linkType])(data)},init:function(){var self=this;self.tinypattern=self.options.tinypattern,self.tinypattern.options.anchorSelector&&(self.options.anchorSelector=self.tinypattern.options.anchorSelector),self.tiny=self.tinypattern.tiny,self.dom=self.tiny.dom,self.linkType=self.options.initialLinkType,self.linkTypes={},self.modal=registry.patterns["plone-modal"].init(self.$el,{html:self.generateModalHtml(),content:null,buttons:".plone-btn"}),self.modal.on("shown",function(e){self.modalShown.apply(self,[e])})},isOnlyTextSelected:function(){var html=this.tiny.selection.getContent();if(/</.test(html)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(html)||html.indexOf("href=")===-1))return!1;if(this.anchorElm){var nodes=this.anchorElm.childNodes;if(0===nodes.length)return!1;for(var ii=nodes.length-1;ii>=0;ii--)if(3!==nodes[ii].nodeType)return!1}return!0},generateModalHtml:function(){return this.template({options:this.options,upload:this.options.upload,text:this.options.text,insertHeading:this.options.text.insertHeading,linkTypes:this.options.linkTypes,externalText:this.options.text.external,emailText:this.options.text.email,subjectText:this.options.text.subject,targetList:this.options.targetList,titleText:this.options.text.title,externalImageText:this.options.text.externalImage,altText:this.options.text.alt,imageAlignText:this.options.text.imageAlign,scaleText:this.options.text.scale,scales:this.options.scales,cancelBtn:this.options.text.cancelBtn,insertBtn:this.options.text.insertBtn})},isImageMode:function(){return["image","uploadImage","externalImage"].indexOf(this.linkType)!==-1},initElements:function(){var self=this;self.$target=$('select[name="target"]',self.modal.$modal),self.$button=$('.plone-modal-footer input[name="insert"]',self.modal.$modal),self.$title=$('input[name="title"]',self.modal.$modal),self.$subject=$('input[name="subject"]',self.modal.$modal),self.$alt=$('input[name="alt"]',self.modal.$modal),self.$align=$('select[name="align"]',self.modal.$modal),self.$scale=$('select[name="scale"]',self.modal.$modal),_.each(self.options.linkTypes,function(type){var $container=$(".linkType."+type+" .main",self.modal.$modal);self.linkTypes[type]=new self.options.linkTypeClassMapping[type]($container,{linkModal:self,tinypattern:self.tinypattern})}),$(".autotoc-nav a",self.modal.$modal).click(function(){var $fieldset=$("fieldset.linkType",self.modal.$modal).eq($(this).index()),classes=$fieldset[0].className.split(/\s+/);_.each(classes,function(val){_.indexOf(self.options.linkTypes,val)!==-1&&(self.linkType=val)})})},getLinkUrl:function(){return this.linkTypes[this.linkType].toUrl()},getValue:function(){return this.linkTypes[this.linkType].value()},updateAnchor:function(href){var self=this;self.tiny.focus(),self.tiny.selection.setRng(self.rng);var target=self.$target.val(),title=self.$title.val(),linkAttrs=$.extend(!0,self.data,{title:title?title:null,target:target?target:null,"data-linkType":self.linkType,href:href},self.linkTypes[self.linkType].attributes());self.anchorElm?(self.onlyText&&linkAttrs.text!==self.initialText&&("innerText"in self.anchorElm?self.anchorElm.innerText=self.data.text:self.anchorElm.textContent=self.data.text),self.tiny.dom.setAttribs(self.anchorElm,linkAttrs),self.tiny.selection.select(self.anchorElm),self.tiny.undoManager.add()):self.onlyText?self.tiny.insertContent(self.tiny.dom.createHTML("a",linkAttrs,self.tiny.dom.encode(self.data.text))):self.tiny.execCommand("mceInsertLink",!1,linkAttrs)},focusElement:function(elm){this.tiny.focus(),this.tiny.selection.select(elm),this.tiny.nodeChanged()},updateImage:function(src){function waitLoad(imgElm){imgElm.onload=imgElm.onerror=function(){imgElm.onload=imgElm.onerror=null,self.focusElement(imgElm)}}var self=this,title=self.$title.val();self.tiny.focus(),self.tiny.selection.setRng(self.rng);var data=$.extend(!0,{},{src:src,title:title?title:null,alt:self.$alt.val(),"class":"image-"+self.$align.val(),"data-linkType":self.linkType,"data-scale":self.$scale.val()},self.linkTypes[self.linkType].attributes());self.imgElm&&!self.imgElm.getAttribute("data-mce-object")?(data.width=self.dom.getAttrib(self.imgElm,"width"),data.height=self.dom.getAttrib(self.imgElm,"height")):self.imgElm=null,self.imgElm?self.dom.setAttribs(self.imgElm,data):(data.id="__mcenew",self.tiny.insertContent(self.dom.createHTML("img",data)),self.imgElm=self.dom.get("__mcenew"),self.dom.setAttrib(self.imgElm,"id",null)),waitLoad(self.imgElm),self.imgElm.complete&&self.focusElement(self.imgElm)},modalShown:function(e){var self=this;self.initElements(),self.initData(),self.options.upload&&(self.$upload=$(".uploadify-me",self.modal.$modal),self.options.upload.relatedItems=$.extend(!0,{},self.options.relatedItems),self.options.upload.relatedItems.selectableTypes=self.options.folderTypes,self.$upload.addClass("pat-upload").patternUpload(self.options.upload),self.$upload.on("uploadAllCompleted",function(evt,data){self.linkTypes.image?(self.linkTypes.image.set(data.data.UID),$("#"+$("#tinylink-image",self.modal.$modal).data("navref")).trigger("click")):(self.linkTypes.internal.set(data.data.UID),$("#"+$("#tinylink-internal",self.modal.$modal).data("navref")).trigger("click"))})),self.$button.off("click").on("click",function(e){if(e.preventDefault(),e.stopPropagation(),self.linkType=self.modal.$modal.find("fieldset.active").data("linktype"),"uploadImage"===self.linkType||"upload"===self.linkType){var patUpload=self.$upload.data().patternUpload;patUpload.dropzone.files.length>0&&(patUpload.processUpload(),self.$upload.on("uploadAllCompleted",function(evt,data){var counter=0,checkUpload=function(){if(counter<5&&!self.linkTypes[self.linkType].value())return counter+=1,void setTimeout(checkUpload,100);var href=self.getLinkUrl();self.updateImage(href),self.hide()};checkUpload()}))}var href;try{href=self.getLinkUrl()}catch(error){return}href&&(self.isImageMode()?self.updateImage(href):self.updateAnchor(href),self.hide())}),$('.plone-modal-footer input[name="cancel"]',self.modal.$modal).click(function(e){e.preventDefault(),self.hide()})},show:function(){this.modal.show()},hide:function(){this.modal.hide()},initData:function(){var self=this;self.data={},self.initialText=null;var value;self.rng=self.tiny.selection.getRng(),self.selectedElm=self.tiny.selection.getNode(),self.anchorElm=self.tiny.dom.getParent(self.selectedElm,"a[href]"),self.onlyText=self.isOnlyTextSelected(),self.data.text=self.initialText=self.anchorElm?self.anchorElm.innerText||self.anchorElm.textContent:self.tiny.selection.getContent({format:"text"}),self.data.href=self.anchorElm?self.tiny.dom.getAttrib(self.anchorElm,"href"):"",self.anchorElm?self.data.target=self.tiny.dom.getAttrib(self.anchorElm,"target"):self.tiny.settings.default_link_target&&(self.data.target=self.tiny.settings.default_link_target),(value=self.tiny.dom.getAttrib(self.anchorElm,"rel"))&&(self.data.rel=value),(value=self.tiny.dom.getAttrib(self.anchorElm,"class"))&&(self.data["class"]=value),(value=self.tiny.dom.getAttrib(self.anchorElm,"title"))&&(self.data.title=value),self.selection=self.tiny.selection,self.tiny.focus();var selectedElm=self.imgElm=self.selection.getNode();self.anchorElm=self.dom.getParent(selectedElm,"a[href]");var linkType;if(self.isImageMode()){if("IMG"!==self.imgElm.nodeName&&self.anchorElm){var imgs=self.anchorElm.getElementsByTagName("img");imgs.length>0&&(self.imgElm=imgs[0],self.focusElement(self.imgElm))}if("IMG"!==self.imgElm.nodeName&&(self.imgElm=null),self.imgElm){var src=self.dom.getAttrib(self.imgElm,"src");if(self.$title.val(self.dom.getAttrib(self.imgElm,"title")),self.$alt.val(self.dom.getAttrib(self.imgElm,"alt")),linkType=self.dom.getAttrib(self.imgElm,"data-linktype")){self.linkType=linkType,self.linkTypes[self.linkType].load(self.imgElm);var scale=self.dom.getAttrib(self.imgElm,"data-scale");scale&&self.$scale.val(scale),$("#tinylink-"+self.linkType,self.modal.$modal).trigger("click")}else src&&self.guessImageLink(src);for(var className=self.dom.getAttrib(self.imgElm,"class"),klasses=className.split(" "),i=0;i<klasses.length;i+=1){var klass=klasses[i];klass.indexOf("image-")!==-1&&self.$align.val(klass.replace("image-",""))}}}else if(self.anchorElm){self.focusElement(self.anchorElm);var href="";href=self.dom.getAttrib(self.anchorElm,"href"),self.$target.val(self.dom.getAttrib(self.anchorElm,"target")),self.$title.val(self.dom.getAttrib(self.anchorElm,"title")),linkType=self.dom.getAttrib(self.anchorElm,"data-linktype"),linkType?(self.linkType=linkType,self.linkTypes[self.linkType].load(self.anchorElm),$("#tinylink-"+self.linkType,self.modal.$modal).trigger("click")):href&&self.guessAnchorLink(href)}},guessImageLink:function(src){src.indexOf(this.options.prependToScalePart)!==-1?(this.linkType="image",this.$scale.val(this.tinypattern.getScaleFromUrl(src)),this.linkTypes.image.set(this.tinypattern.stripGeneratedUrl(src))):(this.linkType="externalImage",this.linkTypes.externalImage.set(src))},guessAnchorLink:function(href){if(this.options.prependToUrl&&href.indexOf(this.options.prependToUrl)!==-1)this.linkType="internal",this.linkTypes.internal.set(this.tinypattern.stripGeneratedUrl(href));else if(href.indexOf("mailto:")!==-1){this.linkType="email";var email=href.substring("mailto:".length,href.length),split=email.split("?subject=");this.linkTypes.email.set(split[0]),split.length>1&&this.$subject.val(decodeURIComponent(split[1]))}else"#"===href[0]?(this.linkType="anchor",this.linkTypes.anchor.set(href.substring(1))):(this.linkType="external",this.linkTypes.external.set(href))},setSelectElement:function($el,val){$el.find("option:selected").prop("selected",!1),val&&$el.find('option[value="'+val+'"]').prop("selected",!0)},reinitialize:function(){this.modal.options.html=this.generateModalHtml()}});return LinkModal}),function(root){define("tinymce-modern-theme",["tinymce"],function(){return function(){tinymce.ThemeManager.add("modern",function(editor){function createToolbar(items,size){var buttonGroup,toolbarItems=[];if(items)return each(items.split(/[ ,]/),function(item){function bindSelectorChanged(){function setActiveItem(name){return function(state,args){for(var nodeName,i=args.parents.length;i--&&(nodeName=args.parents[i].nodeName,"OL"!=nodeName&&"UL"!=nodeName););item.active(state&&nodeName==name)}}var selection=editor.selection;"bullist"==itemName&&selection.selectorChanged("ul > li",setActiveItem("UL")),"numlist"==itemName&&selection.selectorChanged("ol > li",setActiveItem("OL")),item.settings.stateSelector&&selection.selectorChanged(item.settings.stateSelector,function(state){item.active(state)},!0),item.settings.disabledStateSelector&&selection.selectorChanged(item.settings.disabledStateSelector,function(state){item.disabled(state)})}var itemName;"|"==item?buttonGroup=null:Factory.has(item)?(item={type:item,size:size},toolbarItems.push(item),buttonGroup=null):(buttonGroup||(buttonGroup={type:"buttongroup",items:[]},toolbarItems.push(buttonGroup)),editor.buttons[item]&&(itemName=item,item=editor.buttons[itemName],"function"==typeof item&&(item=item()),item.type=item.type||"button",item.size=size,item=Factory.create(item),buttonGroup.items.push(item),editor.initialized?bindSelectorChanged():editor.on("init",bindSelectorChanged)))}),{type:"toolbar",layout:"flow",items:toolbarItems}}function createToolbars(size){function addToolbar(items){if(items)return toolbars.push(createToolbar(items,size)),!0}var toolbars=[];if(tinymce.isArray(settings.toolbar)){if(0===settings.toolbar.length)return;tinymce.each(settings.toolbar,function(toolbar,i){settings["toolbar"+(i+1)]=toolbar}),delete settings.toolbar}for(var i=1;i<10&&addToolbar(settings["toolbar"+i]);i++);if(toolbars.length||settings.toolbar===!1||addToolbar(settings.toolbar||defaultToolbar),toolbars.length)return{type:"panel",layout:"stack",classes:"toolbar-grp",ariaRoot:!0,ariaRemember:!0,items:toolbars}}function createMenuButtons(){function createMenuItem(name){var menuItem;return"|"==name?{text:"|"}:menuItem=editor.menuItems[name]}function createMenu(context){var menuButton,menu,menuItems,isUserDefined,removedMenuItems;if(removedMenuItems=tinymce.makeMap((settings.removed_menuitems||"").split(/[ ,]/)),settings.menu?(menu=settings.menu[context],isUserDefined=!0):menu=defaultMenus[context],menu){menuButton={text:menu.title},menuItems=[],each((menu.items||"").split(/[ ,]/),function(item){var menuItem=createMenuItem(item);menuItem&&!removedMenuItems[item]&&menuItems.push(createMenuItem(item))}),isUserDefined||each(editor.menuItems,function(menuItem){menuItem.context==context&&("before"==menuItem.separator&&menuItems.push({text:"|"}),menuItem.prependToContext?menuItems.unshift(menuItem):menuItems.push(menuItem),"after"==menuItem.separator&&menuItems.push({text:"|"}))});for(var i=0;i<menuItems.length;i++)"|"==menuItems[i].text&&(0!==i&&i!=menuItems.length-1||menuItems.splice(i,1));if(menuButton.menu=menuItems,!menuButton.menu.length)return null}return menuButton}var name,menuButtons=[],defaultMenuBar=[];if(settings.menu)for(name in settings.menu)defaultMenuBar.push(name);else for(name in defaultMenus)defaultMenuBar.push(name);for(var enabledMenuNames="string"==typeof settings.menubar?settings.menubar.split(/[ ,]/):defaultMenuBar,i=0;i<enabledMenuNames.length;i++){var menu=enabledMenuNames[i];menu=createMenu(menu),menu&&menuButtons.push(menu)}return menuButtons}function addAccessibilityKeys(panel){function focus(type){var item=panel.find(type)[0];item&&item.focus(!0)}editor.shortcuts.add("Alt+F9","",function(){focus("menubar")}),editor.shortcuts.add("Alt+F10","",function(){focus("toolbar")}),editor.shortcuts.add("Alt+F11","",function(){focus("elementpath")}),panel.on("cancel",function(){editor.focus()})}function resizeTo(width,height){function getSize(elm){return{width:elm.clientWidth,height:elm.clientHeight}}var containerElm,iframeElm,containerSize,iframeSize;containerElm=editor.getContainer(),iframeElm=editor.getContentAreaContainer().firstChild,containerSize=getSize(containerElm),iframeSize=getSize(iframeElm),null!==width&&(width=Math.max(settings.min_width||100,width),width=Math.min(settings.max_width||65535,width),DOM.setStyle(containerElm,"width",width+(containerSize.width-iframeSize.width)),DOM.setStyle(iframeElm,"width",width)),height=Math.max(settings.min_height||100,height),height=Math.min(settings.max_height||65535,height),DOM.setStyle(iframeElm,"height",height),editor.fire("ResizeEditor")}function resizeBy(dw,dh){var elm=editor.getContentAreaContainer();self.resizeTo(elm.clientWidth+dw,elm.clientHeight+dh)}function addContextualToolbars(){function getContextToolbars(){return editor.contextToolbars||[]}function getElementRect(elm){var pos,targetRect,root;return pos=tinymce.DOM.getPos(editor.getContentAreaContainer()),targetRect=editor.dom.getRect(elm),root=editor.dom.getRoot(),"BODY"==root.nodeName&&(targetRect.x-=root.ownerDocument.documentElement.scrollLeft||root.scrollLeft,targetRect.y-=root.ownerDocument.documentElement.scrollTop||root.scrollTop),targetRect.x+=pos.x,targetRect.y+=pos.y,targetRect}function hideAllFloatingPanels(){each(editor.contextToolbars,function(toolbar){toolbar.panel&&toolbar.panel.hide()})}function togglePositionClass(panel,relPos,predicate){relPos=relPos?relPos.substr(0,2):"",each({t:"down",b:"up"},function(cls,pos){panel.classes.toggle("arrow-"+cls,predicate(pos,relPos.substr(0,1)))}),each({l:"left",r:"right"},function(cls,pos){panel.classes.toggle("arrow-"+cls,predicate(pos,relPos.substr(1,1)))})}function toClientRect(geomRect){return{left:geomRect.x,top:geomRect.y,width:geomRect.w,height:geomRect.h,right:geomRect.x+geomRect.w,bottom:geomRect.y+geomRect.h}}function userConstrain(x,y,elementRect,contentAreaRect,panelRect){return panelRect=toClientRect({x:x,y:y,w:panelRect.w,h:panelRect.h}),settings.inline_toolbar_position_handler&&(panelRect=settings.inline_toolbar_position_handler({elementRect:toClientRect(elementRect),contentAreaRect:toClientRect(contentAreaRect),panelRect:panelRect})),panelRect}function movePanelTo(panel,pos){panel.moveTo(pos.left,pos.top)}function reposition(match){var relPos,panelRect,elementRect,contentAreaRect,panel,relRect,testPositions;if(!editor.removed){if(!match||!match.toolbar.panel)return void hideAllFloatingPanels();testPositions=["bc-tc","tc-bc","tl-bl","bl-tl","tr-br","br-tr"],panel=match.toolbar.panel,panel.show(),elementRect=getElementRect(match.element),panelRect=tinymce.DOM.getRect(panel.getEl()),contentAreaRect=tinymce.DOM.getRect(editor.getContentAreaContainer()||editor.getBody()),elementRect.w=match.element.clientWidth,elementRect.h=match.element.clientHeight,editor.inline||(contentAreaRect.w=editor.getDoc().documentElement.offsetWidth),editor.selection.controlSelection.isResizable(match.element)&&(elementRect=Rect.inflate(elementRect,0,8)),relPos=Rect.findBestRelativePosition(panelRect,elementRect,contentAreaRect,testPositions),elementRect=Rect.clamp(elementRect,contentAreaRect),relPos?(relRect=Rect.relativePosition(panelRect,elementRect,relPos),movePanelTo(panel,userConstrain(relRect.x,relRect.y,elementRect,contentAreaRect,panelRect))):(contentAreaRect.h+=40,elementRect=Rect.intersect(contentAreaRect,elementRect),elementRect?(relPos=Rect.findBestRelativePosition(panelRect,elementRect,contentAreaRect,["bc-tc","bl-tl","br-tr"]),relPos?(relRect=Rect.relativePosition(panelRect,elementRect,relPos),movePanelTo(panel,userConstrain(relRect.x,relRect.y,elementRect,contentAreaRect,panelRect))):movePanelTo(panel,userConstrain(elementRect.x,elementRect.y,elementRect,contentAreaRect,panelRect))):panel.hide()),togglePositionClass(panel,relPos,function(pos1,pos2){return(!elementRect||elementRect.w>40)&&pos1===pos2})}}function repositionHandler(){function execute(){editor.selection&&reposition(findFrontMostMatch(editor.selection.getNode()))}tinymce.util.Delay.requestAnimationFrame(execute)}function bindScrollEvent(){scrollContainer||(scrollContainer=editor.selection.getScrollContainer()||editor.getWin(),tinymce.$(scrollContainer).on("scroll",repositionHandler),editor.on("remove",function(){tinymce.$(scrollContainer).off("scroll")}))}function showContextToolbar(match){var panel;return match.toolbar.panel?(match.toolbar.panel.show(),void reposition(match)):(bindScrollEvent(),panel=Factory.create({type:"floatpanel",role:"dialog",classes:"tinymce tinymce-inline arrow",ariaLabel:"Inline toolbar",layout:"flex",direction:"column",align:"stretch",autohide:!1,autofix:!0,fixed:!0,border:1,items:createToolbar(match.toolbar.items),oncancel:function(){editor.focus()}}),match.toolbar.panel=panel,panel.renderTo(document.body).reflow(),void reposition(match))}function hideAllContextToolbars(){tinymce.each(getContextToolbars(),function(toolbar){toolbar.panel&&toolbar.panel.hide()})}function findFrontMostMatch(targetElm){var i,y,parentsAndSelf,toolbars=getContextToolbars();for(parentsAndSelf=editor.$(targetElm).parents().add(targetElm),i=parentsAndSelf.length-1;i>=0;i--)for(y=toolbars.length-1;y>=0;y--)if(toolbars[y].predicate(parentsAndSelf[i]))return{toolbar:toolbars[y],element:parentsAndSelf[i]};return null}var scrollContainer;editor.on("click keyup setContent",function(e){("setcontent"!=e.type||e.selection)&&tinymce.util.Delay.setEditorTimeout(editor,function(){var match;match=findFrontMostMatch(editor.selection.getNode()),match?(hideAllContextToolbars(),showContextToolbar(match)):hideAllContextToolbars()})}),editor.on("blur hide",hideAllContextToolbars),editor.on("ObjectResizeStart",function(){var match=findFrontMostMatch(editor.selection.getNode());match&&match.toolbar.panel&&match.toolbar.panel.hide()}),editor.on("nodeChange ResizeEditor ResizeWindow",repositionHandler),editor.on("remove",function(){tinymce.each(getContextToolbars(),function(toolbar){toolbar.panel&&toolbar.panel.remove()}),editor.contextToolbars={}}),editor.shortcuts.add("ctrl+shift+e > ctrl+shift+p","",function(){var match=findFrontMostMatch(editor.selection.getNode());match&&match.toolbar.panel&&match.toolbar.panel.items()[0].focus()})}function fireSkinLoaded(editor){return function(){editor.initialized?editor.fire("SkinLoaded"):editor.on("init",function(){editor.fire("SkinLoaded")})}}function renderInlineUI(args){function reposition(){if(panel&&panel.moveRel&&panel.visible()&&!panel._fixed){var scrollContainer=editor.selection.getScrollContainer(),body=editor.getBody(),deltaX=0,deltaY=0;if(scrollContainer){var bodyPos=DOM.getPos(body),scrollContainerPos=DOM.getPos(scrollContainer);deltaX=Math.max(0,scrollContainerPos.x-bodyPos.x),deltaY=Math.max(0,scrollContainerPos.y-bodyPos.y)}panel.fixed(!1).moveRel(body,editor.rtl?["tr-br","br-tr"]:["tl-bl","bl-tl","tr-br"]).moveBy(deltaX,deltaY)}}function show(){panel&&(panel.show(),reposition(),DOM.addClass(editor.getBody(),"mce-edit-focus"))}function hide(){panel&&(panel.hide(),FloatPanel.hideAll(),DOM.removeClass(editor.getBody(),"mce-edit-focus"))}function render(){return panel?void(panel.visible()||show()):(panel=self.panel=Factory.create({type:inlineToolbarContainer?"panel":"floatpanel",role:"application",classes:"tinymce tinymce-inline",layout:"flex",direction:"column",align:"stretch",autohide:!1,autofix:!0,fixed:!!inlineToolbarContainer,border:1,items:[settings.menubar===!1?null:{type:"menubar",border:"0 0 1 0",items:createMenuButtons()},createToolbars(settings.toolbar_items_size)]}),editor.fire("BeforeRenderUI"),panel.renderTo(inlineToolbarContainer||document.body).reflow(),addAccessibilityKeys(panel),show(),addContextualToolbars(),editor.on("nodeChange",reposition),editor.on("activate",show),editor.on("deactivate",hide),void editor.nodeChanged())}var panel,inlineToolbarContainer;return settings.fixed_toolbar_container&&(inlineToolbarContainer=DOM.select(settings.fixed_toolbar_container)[0]),settings.content_editable=!0,editor.on("focus",function(){args.skinUiCss?tinymce.DOM.styleSheetLoader.load(args.skinUiCss,render,render):render()}),editor.on("blur hide",hide),editor.on("remove",function(){panel&&(panel.remove(),panel=null)}),args.skinUiCss&&tinymce.DOM.styleSheetLoader.load(args.skinUiCss,fireSkinLoaded(editor)),{}}function renderIframeUI(args){function switchMode(){return function(e){"readonly"==e.mode?panel.find("*").disabled(!0):panel.find("*").disabled(!1)}}var panel,resizeHandleCtrl,startSize;return args.skinUiCss&&tinymce.DOM.styleSheetLoader.load(args.skinUiCss,fireSkinLoaded(editor)),panel=self.panel=Factory.create({type:"panel",role:"application",classes:"tinymce",style:"visibility: hidden",layout:"stack",border:1,items:[settings.menubar===!1?null:{type:"menubar",border:"0 0 1 0",items:createMenuButtons()},createToolbars(settings.toolbar_items_size),{type:"panel",name:"iframe",layout:"stack",classes:"edit-area",html:"",border:"1 0 0 0"}]}),settings.resize!==!1&&(resizeHandleCtrl={type:"resizehandle",direction:settings.resize,onResizeStart:function(){var elm=editor.getContentAreaContainer().firstChild;startSize={width:elm.clientWidth,height:elm.clientHeight}},onResize:function(e){"both"==settings.resize?resizeTo(startSize.width+e.deltaX,startSize.height+e.deltaY):resizeTo(null,startSize.height+e.deltaY)}}),settings.statusbar!==!1&&panel.add({type:"panel",name:"statusbar",classes:"statusbar",layout:"flow",border:"1 0 0 0",ariaRoot:!0,items:[{type:"elementpath"},resizeHandleCtrl]}),editor.fire("BeforeRenderUI"),editor.on("SwitchMode",switchMode()),panel.renderBefore(args.targetNode).reflow(),settings.readonly&&editor.setMode("readonly"),settings.width&&tinymce.DOM.setStyle(panel.getEl(),"width",settings.width),editor.on("remove",function(){panel.remove(),panel=null}),addAccessibilityKeys(panel),addContextualToolbars(),{iframeContainer:panel.find("#iframe")[0].getEl(),editorContainer:panel.getEl()}}var self=this,settings=editor.settings,Factory=tinymce.ui.Factory,each=tinymce.each,DOM=tinymce.DOM,Rect=tinymce.geom.Rect,FloatPanel=tinymce.ui.FloatPanel,defaultMenus={file:{title:"File",items:"newdocument"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall"},insert:{title:"Insert",items:"|"},view:{title:"View",items:"visualaid |"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript | formats | removeformat"},table:{title:"Table"},tools:{title:"Tools"}},defaultToolbar="undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image";self.renderUI=function(args){var skin=settings.skin!==!1&&(settings.skin||"lightgray");if(skin){var skinUrl=settings.skin_url;skinUrl=skinUrl?editor.documentBaseURI.toAbsolute(skinUrl):tinymce.baseURL+"/skins/"+skin,tinymce.Env.documentMode<=7?args.skinUiCss=skinUrl+"/skin.ie7.min.css":args.skinUiCss=skinUrl+"/skin.min.css",editor.contentCSS.push(skinUrl+"/content"+(editor.inline?".inline":"")+".min.css")}return editor.on("ProgressState",function(e){self.throbber=self.throbber||new tinymce.ui.Throbber(self.panel.getEl("body")),e.state?self.throbber.show(e.time):self.throbber.hide()}),settings.inline?renderInlineUI(args):renderIframeUI(args)},self.resizeTo=resizeTo,self.resizeBy=resizeBy})}.apply(root,arguments)})}(this),function(root){define("tinymce-advlist",["tinymce"],function(){return function(){tinymce.PluginManager.add("advlist",function(editor){function buildMenuItems(listName,styleValues){var items=[];return tinymce.each(styleValues.split(/[ ,]/),function(styleValue){items.push({text:styleValue.replace(/\-/g," ").replace(/\b\w/g,function(chr){return chr.toUpperCase()}),data:"default"==styleValue?"":styleValue})}),items}function applyListFormat(listName,styleValue){editor.undoManager.transact(function(){var list,dom=editor.dom,sel=editor.selection;list=dom.getParent(sel.getNode(),"ol,ul"),list&&list.nodeName==listName&&styleValue!==!1||editor.execCommand("UL"==listName?"InsertUnorderedList":"InsertOrderedList"),styleValue=styleValue===!1?lastStyles[listName]:styleValue,lastStyles[listName]=styleValue,list=dom.getParent(sel.getNode(),"ol,ul"),list&&(dom.setStyle(list,"listStyleType",styleValue?styleValue:null),list.removeAttribute("data-mce-style")),editor.focus()})}function updateSelection(e){var listStyleType=editor.dom.getStyle(editor.dom.getParent(editor.selection.getNode(),"ol,ul"),"listStyleType")||"";e.control.items().each(function(ctrl){ctrl.active(ctrl.settings.data===listStyleType)})}var olMenuItems,ulMenuItems,lastStyles={};olMenuItems=buildMenuItems("OL",editor.getParam("advlist_number_styles","default,lower-alpha,lower-greek,lower-roman,upper-alpha,upper-roman")),ulMenuItems=buildMenuItems("UL",editor.getParam("advlist_bullet_styles","default,circle,disc,square")),editor.addButton("numlist",{type:"splitbutton",tooltip:"Numbered list",menu:olMenuItems,onshow:updateSelection,onselect:function(e){applyListFormat("OL",e.control.settings.data)},onclick:function(){applyListFormat("OL",!1)}}),editor.addButton("bullist",{type:"splitbutton",tooltip:"Bullet list",menu:ulMenuItems,onshow:updateSelection,onselect:function(e){applyListFormat("UL",e.control.settings.data)},onclick:function(){applyListFormat("UL",!1)}})})}.apply(root,arguments)})}(this),function(root){define("tinymce-anchor",["tinymce"],function(){return function(){tinymce.PluginManager.add("anchor",function(editor){function showDialog(){var selectedNode=editor.selection.getNode(),name="",isAnchor="A"==selectedNode.tagName&&""===editor.dom.getAttrib(selectedNode,"href");isAnchor&&(name=selectedNode.name||selectedNode.id||""),editor.windowManager.open({title:"Anchor",body:{type:"textbox",name:"name",size:40,label:"Name",value:name},onsubmit:function(e){var id=e.data.name;isAnchor?selectedNode.id=id:(editor.selection.collapse(!0),editor.execCommand("mceInsertContent",!1,editor.dom.createHTML("a",{id:id})))}})}editor.addCommand("mceAnchor",showDialog),editor.addButton("anchor",{icon:"anchor",tooltip:"Anchor",onclick:showDialog,stateSelector:"a:not([href])"}),editor.addMenuItem("anchor",{icon:"anchor",text:"Anchor",context:"insert",onclick:showDialog})})}.apply(root,arguments)})}(this),function(root){define("tinymce-autolink",["tinymce"],function(){return function(){tinymce.PluginManager.add("autolink",function(editor){function handleEclipse(editor){parseCurrentLine(editor,-1,"(",!0)}function handleSpacebar(editor){parseCurrentLine(editor,0,"",!0)}function handleEnter(editor){parseCurrentLine(editor,-1,"",!1)}function parseCurrentLine(editor,end_offset,delimiter){function scopeIndex(container,index){if(index<0&&(index=0),3==container.nodeType){var len=container.data.length;index>len&&(index=len)}return index}function setStart(container,offset){1!=container.nodeType||container.hasChildNodes()?rng.setStart(container,scopeIndex(container,offset)):rng.setStartBefore(container)}function setEnd(container,offset){1!=container.nodeType||container.hasChildNodes()?rng.setEnd(container,scopeIndex(container,offset)):rng.setEndAfter(container)}var rng,end,start,endContainer,bookmark,text,matches,prev,len,rngText;if("A"!=editor.selection.getNode().tagName){if(rng=editor.selection.getRng(!0).cloneRange(),rng.startOffset<5){if(prev=rng.endContainer.previousSibling,!prev){if(!rng.endContainer.firstChild||!rng.endContainer.firstChild.nextSibling)return;prev=rng.endContainer.firstChild.nextSibling}if(len=prev.length,setStart(prev,len),
setEnd(prev,len),rng.endOffset<5)return;end=rng.endOffset,endContainer=prev}else{if(endContainer=rng.endContainer,3!=endContainer.nodeType&&endContainer.firstChild){for(;3!=endContainer.nodeType&&endContainer.firstChild;)endContainer=endContainer.firstChild;3==endContainer.nodeType&&(setStart(endContainer,0),setEnd(endContainer,endContainer.nodeValue.length))}end=1==rng.endOffset?2:rng.endOffset-1-end_offset}start=end;do setStart(endContainer,end>=2?end-2:0),setEnd(endContainer,end>=1?end-1:0),end-=1,rngText=rng.toString();while(" "!=rngText&&""!==rngText&&160!=rngText.charCodeAt(0)&&end-2>=0&&rngText!=delimiter);rng.toString()==delimiter||160==rng.toString().charCodeAt(0)?(setStart(endContainer,end),setEnd(endContainer,start),end+=1):0===rng.startOffset?(setStart(endContainer,0),setEnd(endContainer,start)):(setStart(endContainer,end),setEnd(endContainer,start)),text=rng.toString(),"."==text.charAt(text.length-1)&&setEnd(endContainer,start-1),text=rng.toString(),matches=text.match(AutoLinkPattern),matches&&("www."==matches[1]?matches[1]="http://www.":/@$/.test(matches[1])&&!/^mailto:/.test(matches[1])&&(matches[1]="mailto:"+matches[1]),bookmark=editor.selection.getBookmark(),editor.selection.setRng(rng),editor.execCommand("createlink",!1,matches[1]+matches[2]),editor.selection.moveToBookmark(bookmark),editor.nodeChanged())}}var AutoUrlDetectState,AutoLinkPattern=/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+\-]+@)(.+)$/i;return editor.settings.autolink_pattern&&(AutoLinkPattern=editor.settings.autolink_pattern),editor.on("keydown",function(e){if(13==e.keyCode)return handleEnter(editor)}),tinymce.Env.ie?void editor.on("focus",function(){if(!AutoUrlDetectState){AutoUrlDetectState=!0;try{editor.execCommand("AutoUrlDetect",!1,!0)}catch(ex){}}}):(editor.on("keypress",function(e){if(41==e.keyCode)return handleEclipse(editor)}),void editor.on("keyup",function(e){if(32==e.keyCode)return handleSpacebar(editor)}))})}.apply(root,arguments)})}(this),function(root){define("tinymce-autoresize",["tinymce"],function(){return function(){tinymce.PluginManager.add("autoresize",function(editor){function isFullscreen(){return editor.plugins.fullscreen&&editor.plugins.fullscreen.isFullscreen()}function resize(e){var deltaSize,doc,body,docElm,resizeHeight,myHeight,marginTop,marginBottom,paddingTop,paddingBottom,borderTop,borderBottom,DOM=tinymce.DOM;if(doc=editor.getDoc()){if(body=doc.body,docElm=doc.documentElement,resizeHeight=settings.autoresize_min_height,!body||e&&"setcontent"===e.type&&e.initial||isFullscreen())return void(body&&docElm&&(body.style.overflowY="auto",docElm.style.overflowY="auto"));marginTop=editor.dom.getStyle(body,"margin-top",!0),marginBottom=editor.dom.getStyle(body,"margin-bottom",!0),paddingTop=editor.dom.getStyle(body,"padding-top",!0),paddingBottom=editor.dom.getStyle(body,"padding-bottom",!0),borderTop=editor.dom.getStyle(body,"border-top-width",!0),borderBottom=editor.dom.getStyle(body,"border-bottom-width",!0),myHeight=body.offsetHeight+parseInt(marginTop,10)+parseInt(marginBottom,10)+parseInt(paddingTop,10)+parseInt(paddingBottom,10)+parseInt(borderTop,10)+parseInt(borderBottom,10),(isNaN(myHeight)||myHeight<=0)&&(myHeight=tinymce.Env.ie?body.scrollHeight:tinymce.Env.webkit&&0===body.clientHeight?0:body.offsetHeight),myHeight>settings.autoresize_min_height&&(resizeHeight=myHeight),settings.autoresize_max_height&&myHeight>settings.autoresize_max_height?(resizeHeight=settings.autoresize_max_height,body.style.overflowY="auto",docElm.style.overflowY="auto"):(body.style.overflowY="hidden",docElm.style.overflowY="hidden",body.scrollTop=0),resizeHeight!==oldSize&&(deltaSize=resizeHeight-oldSize,DOM.setStyle(editor.iframeElement,"height",resizeHeight+"px"),oldSize=resizeHeight,tinymce.isWebKit&&deltaSize<0&&resize(e))}}function wait(times,interval,callback){tinymce.util.Delay.setEditorTimeout(editor,function(){resize({}),times--?wait(times,interval,callback):callback&&callback()},interval)}var settings=editor.settings,oldSize=0;editor.settings.inline||(settings.autoresize_min_height=parseInt(editor.getParam("autoresize_min_height",editor.getElement().offsetHeight),10),settings.autoresize_max_height=parseInt(editor.getParam("autoresize_max_height",0),10),editor.on("init",function(){var overflowPadding,bottomMargin;overflowPadding=editor.getParam("autoresize_overflow_padding",1),bottomMargin=editor.getParam("autoresize_bottom_margin",50),overflowPadding!==!1&&editor.dom.setStyles(editor.getBody(),{paddingLeft:overflowPadding,paddingRight:overflowPadding}),bottomMargin!==!1&&editor.dom.setStyles(editor.getBody(),{paddingBottom:bottomMargin})}),editor.on("nodechange setcontent keyup FullscreenStateChanged",resize),editor.getParam("autoresize_on_init",!0)&&editor.on("init",function(){wait(20,100,function(){wait(5,1e3)})}),editor.addCommand("mceAutoResize",resize))})}.apply(root,arguments)})}(this),function(root){define("tinymce-autosave",["tinymce"],function(){return function(){tinymce._beforeUnloadHandler=function(){var msg;return tinymce.each(tinymce.editors,function(editor){editor.plugins.autosave&&editor.plugins.autosave.storeDraft(),!msg&&editor.isDirty()&&editor.getParam("autosave_ask_before_unload",!0)&&(msg=editor.translate("You have unsaved changes are you sure you want to navigate away?"))}),msg},tinymce.PluginManager.add("autosave",function(editor){function parseTime(time,defaultTime){var multipels={s:1e3,m:6e4};return time=/^(\d+)([ms]?)$/.exec(""+(time||defaultTime)),(time[2]?multipels[time[2]]:1)*parseInt(time,10)}function hasDraft(){var time=parseInt(LocalStorage.getItem(prefix+"time"),10)||0;return!((new Date).getTime()-time>settings.autosave_retention)||(removeDraft(!1),!1)}function removeDraft(fire){LocalStorage.removeItem(prefix+"draft"),LocalStorage.removeItem(prefix+"time"),fire!==!1&&editor.fire("RemoveDraft")}function storeDraft(){!isEmpty()&&editor.isDirty()&&(LocalStorage.setItem(prefix+"draft",editor.getContent({format:"raw",no_events:!0})),LocalStorage.setItem(prefix+"time",(new Date).getTime()),editor.fire("StoreDraft"))}function restoreDraft(){hasDraft()&&(editor.setContent(LocalStorage.getItem(prefix+"draft"),{format:"raw"}),editor.fire("RestoreDraft"))}function startStoreDraft(){started||(setInterval(function(){editor.removed||storeDraft()},settings.autosave_interval),started=!0)}function postRender(){var self=this;self.disabled(!hasDraft()),editor.on("StoreDraft RestoreDraft RemoveDraft",function(){self.disabled(!hasDraft())}),startStoreDraft()}function restoreLastDraft(){editor.undoManager.beforeChange(),restoreDraft(),removeDraft(),editor.undoManager.add()}function isEmpty(html){var forcedRootBlockName=editor.settings.forced_root_block;return html=tinymce.trim("undefined"==typeof html?editor.getBody().innerHTML:html),""===html||new RegExp("^<"+forcedRootBlockName+"[^>]*>((|&nbsp;|[ \t]|<br[^>]*>)+?|)</"+forcedRootBlockName+">|<br>$","i").test(html)}var prefix,started,settings=editor.settings,LocalStorage=tinymce.util.LocalStorage;prefix=settings.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-",prefix=prefix.replace(/\{path\}/g,document.location.pathname),prefix=prefix.replace(/\{query\}/g,document.location.search),prefix=prefix.replace(/\{id\}/g,editor.id),settings.autosave_interval=parseTime(settings.autosave_interval,"30s"),settings.autosave_retention=parseTime(settings.autosave_retention,"20m"),editor.addButton("restoredraft",{title:"Restore last draft",onclick:restoreLastDraft,onPostRender:postRender}),editor.addMenuItem("restoredraft",{text:"Restore last draft",onclick:restoreLastDraft,onPostRender:postRender,context:"file"}),editor.settings.autosave_restore_when_empty!==!1&&(editor.on("init",function(){hasDraft()&&isEmpty()&&restoreDraft()}),editor.on("saveContent",function(){removeDraft()})),window.onbeforeunload=tinymce._beforeUnloadHandler,this.hasDraft=hasDraft,this.storeDraft=storeDraft,this.restoreDraft=restoreDraft,this.removeDraft=removeDraft,this.isEmpty=isEmpty})}.apply(root,arguments)})}(this),function(root){define("tinymce-bbcode",["tinymce"],function(){return function(){!function(){tinymce.create("tinymce.plugins.BBCodePlugin",{init:function(ed){var self=this,dialect=ed.getParam("bbcode_dialect","punbb").toLowerCase();ed.on("beforeSetContent",function(e){e.content=self["_"+dialect+"_bbcode2html"](e.content)}),ed.on("postProcess",function(e){e.set&&(e.content=self["_"+dialect+"_bbcode2html"](e.content)),e.get&&(e.content=self["_"+dialect+"_html2bbcode"](e.content))})},getInfo:function(){return{longname:"BBCode Plugin",author:"Ephox Corp",authorurl:"http://www.tinymce.com",infourl:"http://www.tinymce.com/wiki.php/Plugin:bbcode"}},_punbb_html2bbcode:function(s){function rep(re,str){s=s.replace(re,str)}return s=tinymce.trim(s),rep(/<a.*?href=\"(.*?)\".*?>(.*?)<\/a>/gi,"[url=$1]$2[/url]"),rep(/<font.*?color=\"(.*?)\".*?class=\"codeStyle\".*?>(.*?)<\/font>/gi,"[code][color=$1]$2[/color][/code]"),rep(/<font.*?color=\"(.*?)\".*?class=\"quoteStyle\".*?>(.*?)<\/font>/gi,"[quote][color=$1]$2[/color][/quote]"),rep(/<font.*?class=\"codeStyle\".*?color=\"(.*?)\".*?>(.*?)<\/font>/gi,"[code][color=$1]$2[/color][/code]"),rep(/<font.*?class=\"quoteStyle\".*?color=\"(.*?)\".*?>(.*?)<\/font>/gi,"[quote][color=$1]$2[/color][/quote]"),rep(/<span style=\"color: ?(.*?);\">(.*?)<\/span>/gi,"[color=$1]$2[/color]"),rep(/<font.*?color=\"(.*?)\".*?>(.*?)<\/font>/gi,"[color=$1]$2[/color]"),rep(/<span style=\"font-size:(.*?);\">(.*?)<\/span>/gi,"[size=$1]$2[/size]"),rep(/<font>(.*?)<\/font>/gi,"$1"),rep(/<img.*?src=\"(.*?)\".*?\/>/gi,"[img]$1[/img]"),rep(/<span class=\"codeStyle\">(.*?)<\/span>/gi,"[code]$1[/code]"),rep(/<span class=\"quoteStyle\">(.*?)<\/span>/gi,"[quote]$1[/quote]"),rep(/<strong class=\"codeStyle\">(.*?)<\/strong>/gi,"[code][b]$1[/b][/code]"),rep(/<strong class=\"quoteStyle\">(.*?)<\/strong>/gi,"[quote][b]$1[/b][/quote]"),rep(/<em class=\"codeStyle\">(.*?)<\/em>/gi,"[code][i]$1[/i][/code]"),rep(/<em class=\"quoteStyle\">(.*?)<\/em>/gi,"[quote][i]$1[/i][/quote]"),rep(/<u class=\"codeStyle\">(.*?)<\/u>/gi,"[code][u]$1[/u][/code]"),rep(/<u class=\"quoteStyle\">(.*?)<\/u>/gi,"[quote][u]$1[/u][/quote]"),rep(/<\/(strong|b)>/gi,"[/b]"),rep(/<(strong|b)>/gi,"[b]"),rep(/<\/(em|i)>/gi,"[/i]"),rep(/<(em|i)>/gi,"[i]"),rep(/<\/u>/gi,"[/u]"),rep(/<span style=\"text-decoration: ?underline;\">(.*?)<\/span>/gi,"[u]$1[/u]"),rep(/<u>/gi,"[u]"),rep(/<blockquote[^>]*>/gi,"[quote]"),rep(/<\/blockquote>/gi,"[/quote]"),rep(/<br \/>/gi,"\n"),rep(/<br\/>/gi,"\n"),rep(/<br>/gi,"\n"),rep(/<p>/gi,""),rep(/<\/p>/gi,"\n"),rep(/&nbsp;|\u00a0/gi," "),rep(/&quot;/gi,'"'),rep(/&lt;/gi,"<"),rep(/&gt;/gi,">"),rep(/&amp;/gi,"&"),s},_punbb_bbcode2html:function(s){function rep(re,str){s=s.replace(re,str)}return s=tinymce.trim(s),rep(/\n/gi,"<br />"),rep(/\[b\]/gi,"<strong>"),rep(/\[\/b\]/gi,"</strong>"),rep(/\[i\]/gi,"<em>"),rep(/\[\/i\]/gi,"</em>"),rep(/\[u\]/gi,"<u>"),rep(/\[\/u\]/gi,"</u>"),rep(/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'),rep(/\[url\](.*?)\[\/url\]/gi,'<a href="$1">$1</a>'),rep(/\[img\](.*?)\[\/img\]/gi,'<img src="$1" />'),rep(/\[color=(.*?)\](.*?)\[\/color\]/gi,'<font color="$1">$2</font>'),rep(/\[code\](.*?)\[\/code\]/gi,'<span class="codeStyle">$1</span>&nbsp;'),rep(/\[quote.*?\](.*?)\[\/quote\]/gi,'<span class="quoteStyle">$1</span>&nbsp;'),s}}),tinymce.PluginManager.add("bbcode",tinymce.plugins.BBCodePlugin)}()}.apply(root,arguments)})}(this),function(root){define("tinymce-charmap",["tinymce"],function(){return function(){tinymce.PluginManager.add("charmap",function(editor){function getDefaultCharMap(){return[["160","no-break space"],["173","soft hyphen"],["34","quotation mark"],["162","cent sign"],["8364","euro sign"],["163","pound sign"],["165","yen sign"],["169","copyright sign"],["174","registered sign"],["8482","trade mark sign"],["8240","per mille sign"],["181","micro sign"],["183","middle dot"],["8226","bullet"],["8230","three dot leader"],["8242","minutes / feet"],["8243","seconds / inches"],["167","section sign"],["182","paragraph sign"],["223","sharp s / ess-zed"],["8249","single left-pointing angle quotation mark"],["8250","single right-pointing angle quotation mark"],["171","left pointing guillemet"],["187","right pointing guillemet"],["8216","left single quotation mark"],["8217","right single quotation mark"],["8220","left double quotation mark"],["8221","right double quotation mark"],["8218","single low-9 quotation mark"],["8222","double low-9 quotation mark"],["60","less-than sign"],["62","greater-than sign"],["8804","less-than or equal to"],["8805","greater-than or equal to"],["8211","en dash"],["8212","em dash"],["175","macron"],["8254","overline"],["164","currency sign"],["166","broken bar"],["168","diaeresis"],["161","inverted exclamation mark"],["191","turned question mark"],["710","circumflex accent"],["732","small tilde"],["176","degree sign"],["8722","minus sign"],["177","plus-minus sign"],["247","division sign"],["8260","fraction slash"],["215","multiplication sign"],["185","superscript one"],["178","superscript two"],["179","superscript three"],["188","fraction one quarter"],["189","fraction one half"],["190","fraction three quarters"],["402","function / florin"],["8747","integral"],["8721","n-ary sumation"],["8734","infinity"],["8730","square root"],["8764","similar to"],["8773","approximately equal to"],["8776","almost equal to"],["8800","not equal to"],["8801","identical to"],["8712","element of"],["8713","not an element of"],["8715","contains as member"],["8719","n-ary product"],["8743","logical and"],["8744","logical or"],["172","not sign"],["8745","intersection"],["8746","union"],["8706","partial differential"],["8704","for all"],["8707","there exists"],["8709","diameter"],["8711","backward difference"],["8727","asterisk operator"],["8733","proportional to"],["8736","angle"],["180","acute accent"],["184","cedilla"],["170","feminine ordinal indicator"],["186","masculine ordinal indicator"],["8224","dagger"],["8225","double dagger"],["192","A - grave"],["193","A - acute"],["194","A - circumflex"],["195","A - tilde"],["196","A - diaeresis"],["197","A - ring above"],["198","ligature AE"],["199","C - cedilla"],["200","E - grave"],["201","E - acute"],["202","E - circumflex"],["203","E - diaeresis"],["204","I - grave"],["205","I - acute"],["206","I - circumflex"],["207","I - diaeresis"],["208","ETH"],["209","N - tilde"],["210","O - grave"],["211","O - acute"],["212","O - circumflex"],["213","O - tilde"],["214","O - diaeresis"],["216","O - slash"],["338","ligature OE"],["352","S - caron"],["217","U - grave"],["218","U - acute"],["219","U - circumflex"],["220","U - diaeresis"],["221","Y - acute"],["376","Y - diaeresis"],["222","THORN"],["224","a - grave"],["225","a - acute"],["226","a - circumflex"],["227","a - tilde"],["228","a - diaeresis"],["229","a - ring above"],["230","ligature ae"],["231","c - cedilla"],["232","e - grave"],["233","e - acute"],["234","e - circumflex"],["235","e - diaeresis"],["236","i - grave"],["237","i - acute"],["238","i - circumflex"],["239","i - diaeresis"],["240","eth"],["241","n - tilde"],["242","o - grave"],["243","o - acute"],["244","o - circumflex"],["245","o - tilde"],["246","o - diaeresis"],["248","o slash"],["339","ligature oe"],["353","s - caron"],["249","u - grave"],["250","u - acute"],["251","u - circumflex"],["252","u - diaeresis"],["253","y - acute"],["254","thorn"],["255","y - diaeresis"],["913","Alpha"],["914","Beta"],["915","Gamma"],["916","Delta"],["917","Epsilon"],["918","Zeta"],["919","Eta"],["920","Theta"],["921","Iota"],["922","Kappa"],["923","Lambda"],["924","Mu"],["925","Nu"],["926","Xi"],["927","Omicron"],["928","Pi"],["929","Rho"],["931","Sigma"],["932","Tau"],["933","Upsilon"],["934","Phi"],["935","Chi"],["936","Psi"],["937","Omega"],["945","alpha"],["946","beta"],["947","gamma"],["948","delta"],["949","epsilon"],["950","zeta"],["951","eta"],["952","theta"],["953","iota"],["954","kappa"],["955","lambda"],["956","mu"],["957","nu"],["958","xi"],["959","omicron"],["960","pi"],["961","rho"],["962","final sigma"],["963","sigma"],["964","tau"],["965","upsilon"],["966","phi"],["967","chi"],["968","psi"],["969","omega"],["8501","alef symbol"],["982","pi symbol"],["8476","real part symbol"],["978","upsilon - hook symbol"],["8472","Weierstrass p"],["8465","imaginary part"],["8592","leftwards arrow"],["8593","upwards arrow"],["8594","rightwards arrow"],["8595","downwards arrow"],["8596","left right arrow"],["8629","carriage return"],["8656","leftwards double arrow"],["8657","upwards double arrow"],["8658","rightwards double arrow"],["8659","downwards double arrow"],["8660","left right double arrow"],["8756","therefore"],["8834","subset of"],["8835","superset of"],["8836","not a subset of"],["8838","subset of or equal to"],["8839","superset of or equal to"],["8853","circled plus"],["8855","circled times"],["8869","perpendicular"],["8901","dot operator"],["8968","left ceiling"],["8969","right ceiling"],["8970","left floor"],["8971","right floor"],["9001","left-pointing angle bracket"],["9002","right-pointing angle bracket"],["9674","lozenge"],["9824","black spade suit"],["9827","black club suit"],["9829","black heart suit"],["9830","black diamond suit"],["8194","en space"],["8195","em space"],["8201","thin space"],["8204","zero width non-joiner"],["8205","zero width joiner"],["8206","left-to-right mark"],["8207","right-to-left mark"]]}function charmapFilter(charmap){return tinymce.util.Tools.grep(charmap,function(item){return isArray(item)&&2==item.length})}function getCharsFromSetting(settingValue){return isArray(settingValue)?[].concat(charmapFilter(settingValue)):"function"==typeof settingValue?settingValue():[]}function extendCharMap(charmap){var settings=editor.settings;return settings.charmap&&(charmap=getCharsFromSetting(settings.charmap)),settings.charmap_append?[].concat(charmap).concat(getCharsFromSetting(settings.charmap_append)):charmap}function getCharMap(){return extendCharMap(getDefaultCharMap())}function insertChar(chr){editor.fire("insertCustomChar",{chr:chr}).chr,editor.execCommand("mceInsertContent",!1,chr)}function showDialog(){function getParentTd(elm){for(;elm;){if("TD"==elm.nodeName)return elm;elm=elm.parentNode}}var gridHtml,x,y,win;gridHtml='<table role="presentation" cellspacing="0" class="mce-charmap"><tbody>';var charmap=getCharMap(),width=Math.min(charmap.length,25),height=Math.ceil(charmap.length/width);for(y=0;y<height;y++){for(gridHtml+="<tr>",x=0;x<width;x++){var index=y*width+x;if(index<charmap.length){var chr=charmap[index];gridHtml+='<td title="'+chr[1]+'"><div tabindex="-1" title="'+chr[1]+'" role="button">'+(chr?String.fromCharCode(parseInt(chr[0],10)):"&nbsp;")+"</div></td>"}else gridHtml+="<td />"}gridHtml+="</tr>"}gridHtml+="</tbody></table>";var charMapPanel={type:"container",html:gridHtml,onclick:function(e){var target=e.target;/^(TD|DIV)$/.test(target.nodeName)&&getParentTd(target).firstChild&&(insertChar(tinymce.trim(target.innerText||target.textContent)),e.ctrlKey||win.close())},onmouseover:function(e){var td=getParentTd(e.target);td&&td.firstChild?(win.find("#preview").text(td.firstChild.firstChild.data),win.find("#previewTitle").text(td.title)):(win.find("#preview").text(" "),win.find("#previewTitle").text(" "))}};win=editor.windowManager.open({title:"Special character",spacing:10,padding:10,items:[charMapPanel,{type:"container",layout:"flex",direction:"column",align:"center",spacing:5,minWidth:160,minHeight:160,items:[{type:"label",name:"preview",text:" ",style:"font-size: 40px; text-align: center",border:1,minWidth:140,minHeight:80},{type:"label",name:"previewTitle",text:" ",style:"text-align: center",border:1,minWidth:140,minHeight:80}]}],buttons:[{text:"Close",onclick:function(){win.close()}}]})}var isArray=tinymce.util.Tools.isArray;return editor.addCommand("mceShowCharmap",showDialog),editor.addButton("charmap",{icon:"charmap",tooltip:"Special character",cmd:"mceShowCharmap"}),editor.addMenuItem("charmap",{icon:"charmap",text:"Special character",cmd:"mceShowCharmap",context:"insert"}),{getCharMap:getCharMap,insertChar:insertChar}})}.apply(root,arguments)})}(this),function(root){define("tinymce-code",["tinymce"],function(){return function(){tinymce.PluginManager.add("code",function(editor){function showDialog(){var win=editor.windowManager.open({title:"Source code",body:{type:"textbox",name:"code",multiline:!0,minWidth:editor.getParam("code_dialog_width",600),minHeight:editor.getParam("code_dialog_height",Math.min(tinymce.DOM.getViewPort().h-200,500)),spellcheck:!1,style:"direction: ltr; text-align: left"},onSubmit:function(e){editor.focus(),editor.undoManager.transact(function(){editor.setContent(e.data.code)}),editor.selection.setCursorLocation(),editor.nodeChanged()}});win.find("#code").value(editor.getContent({source_view:!0}))}editor.addCommand("mceCodeEditor",showDialog),editor.addButton("code",{icon:"code",tooltip:"Source code",onclick:showDialog}),editor.addMenuItem("code",{icon:"code",text:"Source code",context:"tools",onclick:showDialog})})}.apply(root,arguments)})}(this),function(root){define("tinymce-colorpicker",["tinymce"],function(){return function(){tinymce.PluginManager.add("colorpicker",function(editor){function colorPickerCallback(callback,value){function setColor(value){var color=new tinymce.util.Color(value),rgb=color.toRgb();win.fromJSON({r:rgb.r,g:rgb.g,b:rgb.b,hex:color.toHex().substr(1)}),showPreview(color.toHex())}function showPreview(hexColor){win.find("#preview")[0].getEl().style.background=hexColor}var win=editor.windowManager.open({title:"Color",items:{type:"container",layout:"flex",direction:"row",align:"stretch",padding:5,spacing:10,items:[{type:"colorpicker",value:value,onchange:function(){var rgb=this.rgb();win&&(win.find("#r").value(rgb.r),win.find("#g").value(rgb.g),win.find("#b").value(rgb.b),win.find("#hex").value(this.value().substr(1)),showPreview(this.value()))}},{type:"form",padding:0,labelGap:5,defaults:{type:"textbox",size:7,value:"0",flex:1,spellcheck:!1,onchange:function(){var name,value,colorPickerCtrl=win.find("colorpicker")[0];return name=this.name(),value=this.value(),"hex"==name?(value="#"+value,setColor(value),void colorPickerCtrl.value(value)):(value={r:win.find("#r").value(),g:win.find("#g").value(),b:win.find("#b").value()},colorPickerCtrl.value(value),void setColor(value))}},items:[{name:"r",label:"R",autofocus:1},{name:"g",label:"G"},{name:"b",label:"B"},{name:"hex",label:"#",value:"000000"},{name:"preview",type:"container",border:1}]}]},onSubmit:function(){callback("#"+this.toJSON().hex)}});setColor(value)}editor.settings.color_picker_callback||(editor.settings.color_picker_callback=colorPickerCallback)})}.apply(root,arguments)})}(this),function(root){define("tinymce-contextmenu",["tinymce"],function(){return function(){tinymce.PluginManager.add("contextmenu",function(editor){var menu,contextmenuNeverUseNative=editor.settings.contextmenu_never_use_native;editor.on("contextmenu",function(e){var contextmenu,doc=editor.getDoc();if(!e.ctrlKey||contextmenuNeverUseNative){if(e.preventDefault(),tinymce.Env.mac&&tinymce.Env.webkit&&2==e.button&&doc.caretRangeFromPoint&&editor.selection.setRng(doc.caretRangeFromPoint(e.x,e.y)),contextmenu=editor.settings.contextmenu||"link image inserttable | cell row column deletetable",menu)menu.show();else{var items=[];tinymce.each(contextmenu.split(/[ ,]/),function(name){var item=editor.menuItems[name];"|"==name&&(item={text:name}),item&&(item.shortcut="",items.push(item))});for(var i=0;i<items.length;i++)"|"==items[i].text&&(0!==i&&i!=items.length-1||items.splice(i,1));menu=new tinymce.ui.Menu({items:items,context:"contextmenu",classes:"contextmenu"}).renderTo(),editor.on("remove",function(){menu.remove(),menu=null})}var pos={x:e.pageX,y:e.pageY};editor.inline||(pos=tinymce.DOM.getPos(editor.getContentAreaContainer()),pos.x+=e.clientX,pos.y+=e.clientY),menu.moveTo(pos.x,pos.y)}})})}.apply(root,arguments)})}(this),function(root){define("tinymce-directionality",["tinymce"],function(){return function(){tinymce.PluginManager.add("directionality",function(editor){function setDir(dir){var curDir,dom=editor.dom,blocks=editor.selection.getSelectedBlocks();blocks.length&&(curDir=dom.getAttrib(blocks[0],"dir"),tinymce.each(blocks,function(block){dom.getParent(block.parentNode,"*[dir='"+dir+"']",dom.getRoot())||(curDir!=dir?dom.setAttrib(block,"dir",dir):dom.setAttrib(block,"dir",null))}),editor.nodeChanged())}function generateSelector(dir){var selector=[];return tinymce.each("h1 h2 h3 h4 h5 h6 div p".split(" "),function(name){selector.push(name+"[dir="+dir+"]")}),selector.join(",")}editor.addCommand("mceDirectionLTR",function(){setDir("ltr")}),editor.addCommand("mceDirectionRTL",function(){setDir("rtl")}),editor.addButton("ltr",{title:"Left to right",cmd:"mceDirectionLTR",stateSelector:generateSelector("ltr")}),editor.addButton("rtl",{title:"Right to left",cmd:"mceDirectionRTL",stateSelector:generateSelector("rtl")})})}.apply(root,arguments)})}(this),function(root){define("tinymce-emoticons",["tinymce"],function(){return function(){tinymce.PluginManager.add("emoticons",function(editor,url){function getHtml(){var emoticonsHtml;return emoticonsHtml='<table role="list" class="mce-grid">',tinymce.each(emoticons,function(row){emoticonsHtml+="<tr>",tinymce.each(row,function(icon){var emoticonUrl=url+"/img/smiley-"+icon+".gif";emoticonsHtml+='<td><a href="#" data-mce-url="'+emoticonUrl+'" data-mce-alt="'+icon+'" tabindex="-1" role="option" aria-label="'+icon+'"><img src="'+emoticonUrl+'" style="width: 18px; height: 18px" role="presentation" /></a></td>'}),emoticonsHtml+="</tr>"}),emoticonsHtml+="</table>"}var emoticons=[["cool","cry","embarassed","foot-in-mouth"],["frown","innocent","kiss","laughing"],["money-mouth","sealed","smile","surprised"],["tongue-out","undecided","wink","yell"]];editor.addButton("emoticons",{type:"panelbutton",panel:{role:"application",autohide:!0,html:getHtml,onclick:function(e){var linkElm=editor.dom.getParent(e.target,"a");linkElm&&(editor.insertContent('<img src="'+linkElm.getAttribute("data-mce-url")+'" alt="'+linkElm.getAttribute("data-mce-alt")+'" />'),this.hide())}},tooltip:"Emoticons"})})}.apply(root,arguments)})}(this),function(root){define("tinymce-fullpage",["tinymce"],function(){return function(){tinymce.PluginManager.add("fullpage",function(editor){function showDialog(){var data=htmlToData();editor.windowManager.open({title:"Document properties",data:data,defaults:{type:"textbox",size:40},body:[{name:"title",label:"Title"},{name:"keywords",label:"Keywords"},{name:"description",label:"Description"},{name:"robots",label:"Robots"},{name:"author",label:"Author"},{name:"docencoding",label:"Encoding"}],onSubmit:function(e){dataToHtml(tinymce.extend(data,e.data))}})}function htmlToData(){function getAttr(elm,name){var value=elm.attr(name);return value||""}var elm,matches,headerFragment=parseHeader(),data={};return data.fontface=editor.getParam("fullpage_default_fontface",""),data.fontsize=editor.getParam("fullpage_default_fontsize",""),elm=headerFragment.firstChild,7==elm.type&&(data.xml_pi=!0,matches=/encoding="([^"]+)"/.exec(elm.value),matches&&(data.docencoding=matches[1])),elm=headerFragment.getAll("#doctype")[0],elm&&(data.doctype="<!DOCTYPE"+elm.value+">"),elm=headerFragment.getAll("title")[0],elm&&elm.firstChild&&(data.title=elm.firstChild.value),each(headerFragment.getAll("meta"),function(meta){var matches,name=meta.attr("name"),httpEquiv=meta.attr("http-equiv");name?data[name.toLowerCase()]=meta.attr("content"):"Content-Type"==httpEquiv&&(matches=/charset\s*=\s*(.*)\s*/gi.exec(meta.attr("content")),matches&&(data.docencoding=matches[1]))}),elm=headerFragment.getAll("html")[0],elm&&(data.langcode=getAttr(elm,"lang")||getAttr(elm,"xml:lang")),data.stylesheets=[],tinymce.each(headerFragment.getAll("link"),function(link){"stylesheet"==link.attr("rel")&&data.stylesheets.push(link.attr("href"))}),elm=headerFragment.getAll("body")[0],elm&&(data.langdir=getAttr(elm,"dir"),data.style=getAttr(elm,"style"),data.visited_color=getAttr(elm,"vlink"),data.link_color=getAttr(elm,"link"),data.active_color=getAttr(elm,"alink")),data}function dataToHtml(data){function setAttr(elm,name,value){elm.attr(name,value?value:void 0)}function addHeadNode(node){headElement.firstChild?headElement.insert(node,headElement.firstChild):headElement.append(node)}var headerFragment,headElement,html,elm,value,dom=editor.dom;headerFragment=parseHeader(),headElement=headerFragment.getAll("head")[0],headElement||(elm=headerFragment.getAll("html")[0],headElement=new Node("head",1),elm.firstChild?elm.insert(headElement,elm.firstChild,!0):elm.append(headElement)),elm=headerFragment.firstChild,data.xml_pi?(value='version="1.0"',data.docencoding&&(value+=' encoding="'+data.docencoding+'"'),7!=elm.type&&(elm=new Node("xml",7),headerFragment.insert(elm,headerFragment.firstChild,!0)),elm.value=value):elm&&7==elm.type&&elm.remove(),elm=headerFragment.getAll("#doctype")[0],data.doctype?(elm||(elm=new Node("#doctype",10),data.xml_pi?headerFragment.insert(elm,headerFragment.firstChild):addHeadNode(elm)),elm.value=data.doctype.substring(9,data.doctype.length-1)):elm&&elm.remove(),elm=null,each(headerFragment.getAll("meta"),function(meta){"Content-Type"==meta.attr("http-equiv")&&(elm=meta)}),data.docencoding?(elm||(elm=new Node("meta",1),elm.attr("http-equiv","Content-Type"),elm.shortEnded=!0,addHeadNode(elm)),elm.attr("content","text/html; charset="+data.docencoding)):elm&&elm.remove(),elm=headerFragment.getAll("title")[0],data.title?(elm?elm.empty():(elm=new Node("title",1),addHeadNode(elm)),elm.append(new Node("#text",3)).value=data.title):elm&&elm.remove(),each("keywords,description,author,copyright,robots".split(","),function(name){var i,meta,nodes=headerFragment.getAll("meta"),value=data[name];for(i=0;i<nodes.length;i++)if(meta=nodes[i],meta.attr("name")==name)return void(value?meta.attr("content",value):meta.remove());value&&(elm=new Node("meta",1),elm.attr("name",name),elm.attr("content",value),elm.shortEnded=!0,addHeadNode(elm))});var currentStyleSheetsMap={};tinymce.each(headerFragment.getAll("link"),function(stylesheet){"stylesheet"==stylesheet.attr("rel")&&(currentStyleSheetsMap[stylesheet.attr("href")]=stylesheet)}),tinymce.each(data.stylesheets,function(stylesheet){currentStyleSheetsMap[stylesheet]||(elm=new Node("link",1),elm.attr({rel:"stylesheet",text:"text/css",href:stylesheet}),elm.shortEnded=!0,addHeadNode(elm)),delete currentStyleSheetsMap[stylesheet]}),tinymce.each(currentStyleSheetsMap,function(stylesheet){stylesheet.remove()}),elm=headerFragment.getAll("body")[0],elm&&(setAttr(elm,"dir",data.langdir),setAttr(elm,"style",data.style),setAttr(elm,"vlink",data.visited_color),setAttr(elm,"link",data.link_color),setAttr(elm,"alink",data.active_color),dom.setAttribs(editor.getBody(),{style:data.style,dir:data.dir,vLink:data.visited_color,link:data.link_color,aLink:data.active_color})),elm=headerFragment.getAll("html")[0],elm&&(setAttr(elm,"lang",data.langcode),setAttr(elm,"xml:lang",data.langcode)),headElement.firstChild||headElement.remove(),html=new tinymce.html.Serializer({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(headerFragment),head=html.substring(0,html.indexOf("</body>"))}function parseHeader(){return new tinymce.html.DomParser({validate:!1,root_name:"#document"}).parse(head)}function setContent(evt){function low(s){return s.replace(/<\/?[A-Z]+/g,function(a){return a.toLowerCase()})}var startPos,endPos,headerFragment,elm,content=evt.content,styles="",dom=editor.dom;if(!evt.selection&&!("raw"==evt.format&&head||evt.source_view&&editor.getParam("fullpage_hide_in_source_view"))){0!==content.length||evt.source_view||(content=tinymce.trim(head)+"\n"+tinymce.trim(content)+"\n"+tinymce.trim(foot)),content=content.replace(/<(\/?)BODY/gi,"<$1body"),startPos=content.indexOf("<body"),startPos!=-1?(startPos=content.indexOf(">",startPos),
head=low(content.substring(0,startPos+1)),endPos=content.indexOf("</body",startPos),endPos==-1&&(endPos=content.length),evt.content=content.substring(startPos+1,endPos),foot=low(content.substring(endPos))):(head=getDefaultHeader(),foot="\n</body>\n</html>"),headerFragment=parseHeader(),each(headerFragment.getAll("style"),function(node){node.firstChild&&(styles+=node.firstChild.value)}),elm=headerFragment.getAll("body")[0],elm&&dom.setAttribs(editor.getBody(),{style:elm.attr("style")||"",dir:elm.attr("dir")||"",vLink:elm.attr("vlink")||"",link:elm.attr("link")||"",aLink:elm.attr("alink")||""}),dom.remove("fullpage_styles");var headElm=editor.getDoc().getElementsByTagName("head")[0];styles&&(dom.add(headElm,"style",{id:"fullpage_styles"},styles),elm=dom.get("fullpage_styles"),elm.styleSheet&&(elm.styleSheet.cssText=styles));var currentStyleSheetsMap={};tinymce.each(headElm.getElementsByTagName("link"),function(stylesheet){"stylesheet"==stylesheet.rel&&stylesheet.getAttribute("data-mce-fullpage")&&(currentStyleSheetsMap[stylesheet.href]=stylesheet)}),tinymce.each(headerFragment.getAll("link"),function(stylesheet){var href=stylesheet.attr("href");currentStyleSheetsMap[href]||"stylesheet"!=stylesheet.attr("rel")||dom.add(headElm,"link",{rel:"stylesheet",text:"text/css",href:href,"data-mce-fullpage":"1"}),delete currentStyleSheetsMap[href]}),tinymce.each(currentStyleSheetsMap,function(stylesheet){stylesheet.parentNode.removeChild(stylesheet)})}}function getDefaultHeader(){var value,header="",styles="";return editor.getParam("fullpage_default_xml_pi")&&(header+='<?xml version="1.0" encoding="'+editor.getParam("fullpage_default_encoding","ISO-8859-1")+'" ?>\n'),header+=editor.getParam("fullpage_default_doctype","<!DOCTYPE html>"),header+="\n<html>\n<head>\n",(value=editor.getParam("fullpage_default_title"))&&(header+="<title>"+value+"</title>\n"),(value=editor.getParam("fullpage_default_encoding"))&&(header+='<meta http-equiv="Content-Type" content="text/html; charset='+value+'" />\n'),(value=editor.getParam("fullpage_default_font_family"))&&(styles+="font-family: "+value+";"),(value=editor.getParam("fullpage_default_font_size"))&&(styles+="font-size: "+value+";"),(value=editor.getParam("fullpage_default_text_color"))&&(styles+="color: "+value+";"),header+="</head>\n<body"+(styles?' style="'+styles+'"':"")+">\n"}function getContent(evt){evt.selection||evt.source_view&&editor.getParam("fullpage_hide_in_source_view")||(evt.content=tinymce.trim(head)+"\n"+tinymce.trim(evt.content)+"\n"+tinymce.trim(foot))}var head,foot,each=tinymce.each,Node=tinymce.html.Node;editor.addCommand("mceFullPageProperties",showDialog),editor.addButton("fullpage",{title:"Document properties",cmd:"mceFullPageProperties"}),editor.addMenuItem("fullpage",{text:"Document properties",cmd:"mceFullPageProperties",context:"file"}),editor.on("BeforeSetContent",setContent),editor.on("GetContent",getContent)})}.apply(root,arguments)})}(this),function(root){define("tinymce-fullscreen",["tinymce"],function(){return function(){tinymce.PluginManager.add("fullscreen",function(editor){function getWindowSize(){var w,h,win=window,doc=document,body=doc.body;return body.offsetWidth&&(w=body.offsetWidth,h=body.offsetHeight),win.innerWidth&&win.innerHeight&&(w=win.innerWidth,h=win.innerHeight),{w:w,h:h}}function getScrollPos(){var vp=tinymce.DOM.getViewPort();return{x:vp.x,y:vp.y}}function setScrollPos(pos){scrollTo(pos.x,pos.y)}function toggleFullscreen(){function resize(){DOM.setStyle(iframe,"height",getWindowSize().h-(editorContainer.clientHeight-iframe.clientHeight))}var editorContainerStyle,editorContainer,iframe,iframeStyle,body=document.body,documentElement=document.documentElement;fullscreenState=!fullscreenState,editorContainer=editor.getContainer(),editorContainerStyle=editorContainer.style,iframe=editor.getContentAreaContainer().firstChild,iframeStyle=iframe.style,fullscreenState?(scrollPos=getScrollPos(),iframeWidth=iframeStyle.width,iframeHeight=iframeStyle.height,iframeStyle.width=iframeStyle.height="100%",containerWidth=editorContainerStyle.width,containerHeight=editorContainerStyle.height,editorContainerStyle.width=editorContainerStyle.height="",DOM.addClass(body,"mce-fullscreen"),DOM.addClass(documentElement,"mce-fullscreen"),DOM.addClass(editorContainer,"mce-fullscreen"),DOM.bind(window,"resize",resize),resize(),resizeHandler=resize):(iframeStyle.width=iframeWidth,iframeStyle.height=iframeHeight,containerWidth&&(editorContainerStyle.width=containerWidth),containerHeight&&(editorContainerStyle.height=containerHeight),DOM.removeClass(body,"mce-fullscreen"),DOM.removeClass(documentElement,"mce-fullscreen"),DOM.removeClass(editorContainer,"mce-fullscreen"),DOM.unbind(window,"resize",resizeHandler),setScrollPos(scrollPos)),editor.fire("FullscreenStateChanged",{state:fullscreenState})}var iframeWidth,iframeHeight,resizeHandler,containerWidth,containerHeight,scrollPos,fullscreenState=!1,DOM=tinymce.DOM;if(!editor.settings.inline)return editor.on("init",function(){editor.addShortcut("Ctrl+Shift+F","",toggleFullscreen)}),editor.on("remove",function(){resizeHandler&&DOM.unbind(window,"resize",resizeHandler)}),editor.addCommand("mceFullScreen",toggleFullscreen),editor.addMenuItem("fullscreen",{text:"Fullscreen",shortcut:"Meta+Alt+F",selectable:!0,onClick:function(){toggleFullscreen(),editor.focus()},onPostRender:function(){var self=this;editor.on("FullscreenStateChanged",function(e){self.active(e.state)})},context:"view"}),editor.addButton("fullscreen",{tooltip:"Fullscreen",shortcut:"Meta+Alt+F",onClick:toggleFullscreen,onPostRender:function(){var self=this;editor.on("FullscreenStateChanged",function(e){self.active(e.state)})}}),{isFullscreen:function(){return fullscreenState}}})}.apply(root,arguments)})}(this),function(root){define("tinymce-hr",["tinymce"],function(){return function(){tinymce.PluginManager.add("hr",function(editor){editor.addCommand("InsertHorizontalRule",function(){editor.execCommand("mceInsertContent",!1,"<hr />")}),editor.addButton("hr",{icon:"hr",tooltip:"Horizontal line",cmd:"InsertHorizontalRule"}),editor.addMenuItem("hr",{icon:"hr",text:"Horizontal line",cmd:"InsertHorizontalRule",context:"insert"})})}.apply(root,arguments)})}(this),function(root){define("tinymce-image",["tinymce"],function(){return function(){tinymce.PluginManager.add("image",function(editor){function getImageSize(url,callback){function done(width,height){img.parentNode&&img.parentNode.removeChild(img),callback({width:width,height:height})}var img=document.createElement("img");img.onload=function(){done(Math.max(img.width,img.clientWidth),Math.max(img.height,img.clientHeight))},img.onerror=function(){done()};var style=img.style;style.visibility="hidden",style.position="fixed",style.bottom=style.left=0,style.width=style.height="auto",document.body.appendChild(img),img.src=url}function buildListItems(inputList,itemCallback,startItems){function appendItems(values,output){return output=output||[],tinymce.each(values,function(item){var menuItem={text:item.text||item.title};item.menu?menuItem.menu=appendItems(item.menu):(menuItem.value=item.value,itemCallback(menuItem)),output.push(menuItem)}),output}return appendItems(inputList,startItems||[])}function createImageList(callback){return function(){var imageList=editor.settings.image_list;"string"==typeof imageList?tinymce.util.XHR.send({url:imageList,success:function(text){callback(tinymce.util.JSON.parse(text))}}):"function"==typeof imageList?imageList(callback):callback(imageList)}}function showDialog(imageList){function recalcSize(){var widthCtrl,heightCtrl,newWidth,newHeight;widthCtrl=win.find("#width")[0],heightCtrl=win.find("#height")[0],widthCtrl&&heightCtrl&&(newWidth=widthCtrl.value(),newHeight=heightCtrl.value(),win.find("#constrain")[0].checked()&&width&&height&&newWidth&&newHeight&&(width!=newWidth?(newHeight=Math.round(newWidth/width*newHeight),isNaN(newHeight)||heightCtrl.value(newHeight)):(newWidth=Math.round(newHeight/height*newWidth),isNaN(newWidth)||widthCtrl.value(newWidth))),width=newWidth,height=newHeight)}function onSubmitForm(){function waitLoad(imgElm){function selectImage(){imgElm.onload=imgElm.onerror=null,editor.selection&&(editor.selection.select(imgElm),editor.nodeChanged())}imgElm.onload=function(){data.width||data.height||!imageDimensions||dom.setAttribs(imgElm,{width:imgElm.clientWidth,height:imgElm.clientHeight}),selectImage()},imgElm.onerror=selectImage}var figureElm,oldImg;updateStyle(),recalcSize(),data=tinymce.extend(data,win.toJSON()),data.alt||(data.alt=""),data.title||(data.title=""),""===data.width&&(data.width=null),""===data.height&&(data.height=null),data.style||(data.style=null),data={src:data.src,alt:data.alt,title:data.title,width:data.width,height:data.height,style:data.style,caption:data.caption,"class":data["class"]},editor.undoManager.transact(function(){function isTextBlock(node){return editor.schema.getTextBlockElements()[node.nodeName]}if(!data.src)return void(imgElm&&(dom.remove(imgElm),editor.focus(),editor.nodeChanged()));if(""===data.title&&(data.title=null),imgElm?dom.setAttribs(imgElm,data):(data.id="__mcenew",editor.focus(),editor.selection.setContent(dom.createHTML("img",data)),imgElm=dom.get("__mcenew"),dom.setAttrib(imgElm,"id",null)),editor.editorUpload.uploadImagesAuto(),data.caption===!1&&dom.is(imgElm.parentNode,"figure.image")&&(figureElm=imgElm.parentNode,dom.insertAfter(imgElm,figureElm),dom.remove(figureElm)),data.caption!==!0)waitLoad(imgElm);else if(!dom.is(imgElm.parentNode,"figure.image")){oldImg=imgElm,imgElm=imgElm.cloneNode(!0),figureElm=dom.create("figure",{"class":"image"}),figureElm.appendChild(imgElm),figureElm.appendChild(dom.create("figcaption",{contentEditable:!0},"Caption")),figureElm.contentEditable=!1;var textBlock=dom.getParent(oldImg,isTextBlock);textBlock?dom.split(textBlock,oldImg,figureElm):dom.replace(figureElm,oldImg),editor.selection.select(figureElm)}})}function removePixelSuffix(value){return value&&(value=value.replace(/px$/,"")),value}function srcChange(e){var srcURL,prependURL,absoluteURLPattern,meta=e.meta||{};imageListCtrl&&imageListCtrl.value(editor.convertURL(this.value(),"src")),tinymce.each(meta,function(value,key){win.find("#"+key).value(value)}),meta.width||meta.height||(srcURL=editor.convertURL(this.value(),"src"),prependURL=editor.settings.image_prepend_url,absoluteURLPattern=new RegExp("^(?:[a-z]+:)?//","i"),prependURL&&!absoluteURLPattern.test(srcURL)&&srcURL.substring(0,prependURL.length)!==prependURL&&(srcURL=prependURL+srcURL),this.value(srcURL),getImageSize(editor.documentBaseURI.toAbsolute(this.value()),function(data){data.width&&data.height&&imageDimensions&&(width=data.width,height=data.height,win.find("#width").value(width),win.find("#height").value(height))}))}function mergeMargins(css){if(css.margin){var splitMargin=css.margin.split(" ");switch(splitMargin.length){case 1:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[0],css["margin-bottom"]=css["margin-bottom"]||splitMargin[0],css["margin-left"]=css["margin-left"]||splitMargin[0];break;case 2:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[0],css["margin-left"]=css["margin-left"]||splitMargin[1];break;case 3:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[2],css["margin-left"]=css["margin-left"]||splitMargin[1];break;case 4:css["margin-top"]=css["margin-top"]||splitMargin[0],css["margin-right"]=css["margin-right"]||splitMargin[1],css["margin-bottom"]=css["margin-bottom"]||splitMargin[2],css["margin-left"]=css["margin-left"]||splitMargin[3]}delete css.margin}return css}function updateStyle(){function addPixelSuffix(value){return value.length>0&&/^[0-9]+$/.test(value)&&(value+="px"),value}if(editor.settings.image_advtab){var data=win.toJSON(),css=dom.parseStyle(data.style);css=mergeMargins(css),data.vspace&&(css["margin-top"]=css["margin-bottom"]=addPixelSuffix(data.vspace)),data.hspace&&(css["margin-left"]=css["margin-right"]=addPixelSuffix(data.hspace)),data.border&&(css["border-width"]=addPixelSuffix(data.border)),win.find("#style").value(dom.serializeStyle(dom.parseStyle(dom.serializeStyle(css))))}}function updateVSpaceHSpaceBorder(){if(editor.settings.image_advtab){var data=win.toJSON(),css=dom.parseStyle(data.style);win.find("#vspace").value(""),win.find("#hspace").value(""),css=mergeMargins(css),(css["margin-top"]&&css["margin-bottom"]||css["margin-right"]&&css["margin-left"])&&(css["margin-top"]===css["margin-bottom"]?win.find("#vspace").value(removePixelSuffix(css["margin-top"])):win.find("#vspace").value(""),css["margin-right"]===css["margin-left"]?win.find("#hspace").value(removePixelSuffix(css["margin-right"])):win.find("#hspace").value("")),css["border-width"]&&win.find("#border").value(removePixelSuffix(css["border-width"])),win.find("#style").value(dom.serializeStyle(dom.parseStyle(dom.serializeStyle(css))))}}var win,imgElm,figureElm,width,height,imageListCtrl,classListCtrl,data={},dom=editor.dom,imageDimensions=editor.settings.image_dimensions!==!1;imgElm=editor.selection.getNode(),figureElm=dom.getParent(imgElm,"figure.image"),figureElm&&(imgElm=dom.select("img",figureElm)[0]),imgElm&&("IMG"!=imgElm.nodeName||imgElm.getAttribute("data-mce-object")||imgElm.getAttribute("data-mce-placeholder"))&&(imgElm=null),imgElm&&(width=dom.getAttrib(imgElm,"width"),height=dom.getAttrib(imgElm,"height"),data={src:dom.getAttrib(imgElm,"src"),alt:dom.getAttrib(imgElm,"alt"),title:dom.getAttrib(imgElm,"title"),"class":dom.getAttrib(imgElm,"class"),width:width,height:height,caption:!!figureElm}),imageList&&(imageListCtrl={type:"listbox",label:"Image list",values:buildListItems(imageList,function(item){item.value=editor.convertURL(item.value||item.url,"src")},[{text:"None",value:""}]),value:data.src&&editor.convertURL(data.src,"src"),onselect:function(e){var altCtrl=win.find("#alt");(!altCtrl.value()||e.lastControl&&altCtrl.value()==e.lastControl.text())&&altCtrl.value(e.control.text()),win.find("#src").value(e.control.value()).fire("change")},onPostRender:function(){imageListCtrl=this}}),editor.settings.image_class_list&&(classListCtrl={name:"class",type:"listbox",label:"Class",values:buildListItems(editor.settings.image_class_list,function(item){item.value&&(item.textStyle=function(){return editor.formatter.getCssText({inline:"img",classes:[item.value]})})})});var generalFormItems=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:srcChange},imageListCtrl];editor.settings.image_description!==!1&&generalFormItems.push({name:"alt",type:"textbox",label:"Image description"}),editor.settings.image_title&&generalFormItems.push({name:"title",type:"textbox",label:"Image Title"}),imageDimensions&&generalFormItems.push({type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:recalcSize,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:recalcSize,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),generalFormItems.push(classListCtrl),editor.settings.image_caption&&tinymce.Env.ceFalse&&generalFormItems.push({name:"caption",type:"checkbox",label:"Caption"}),editor.settings.image_advtab?(imgElm&&(imgElm.style.marginLeft&&imgElm.style.marginRight&&imgElm.style.marginLeft===imgElm.style.marginRight&&(data.hspace=removePixelSuffix(imgElm.style.marginLeft)),imgElm.style.marginTop&&imgElm.style.marginBottom&&imgElm.style.marginTop===imgElm.style.marginBottom&&(data.vspace=removePixelSuffix(imgElm.style.marginTop)),imgElm.style.borderWidth&&(data.border=removePixelSuffix(imgElm.style.borderWidth)),data.style=editor.dom.serializeStyle(editor.dom.parseStyle(editor.dom.getAttrib(imgElm,"style")))),win=editor.windowManager.open({title:"Insert/edit image",data:data,bodyType:"tabpanel",body:[{title:"General",type:"form",items:generalFormItems},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox",onchange:updateVSpaceHSpaceBorder},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:updateStyle},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:onSubmitForm})):win=editor.windowManager.open({title:"Insert/edit image",data:data,body:generalFormItems,onSubmit:onSubmitForm})}editor.on("preInit",function(){function hasImageClass(node){var className=node.attr("class");return className&&/\bimage\b/.test(className)}function toggleContentEditableState(state){return function(nodes){function toggleContentEditable(node){node.attr("contenteditable",state?"true":null)}for(var node,i=nodes.length;i--;)node=nodes[i],hasImageClass(node)&&(node.attr("contenteditable",state?"false":null),tinymce.each(node.getAll("figcaption"),toggleContentEditable))}}editor.parser.addNodeFilter("figure",toggleContentEditableState(!0)),editor.serializer.addNodeFilter("figure",toggleContentEditableState(!1))}),editor.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:createImageList(showDialog),stateSelector:"img:not([data-mce-object],[data-mce-placeholder]),figure.image"}),editor.addMenuItem("image",{icon:"image",text:"Insert/edit image",onclick:createImageList(showDialog),context:"insert",prependToContext:!0}),editor.addCommand("mceImage",createImageList(showDialog))})}.apply(root,arguments)})}(this),function(root){define("tinymce-importcss",["tinymce"],function(){return function(){tinymce.PluginManager.add("importcss",function(editor){function removeCacheSuffix(url){var cacheSuffix=tinymce.Env.cacheSuffix;return"string"==typeof url&&(url=url.replace("?"+cacheSuffix,"").replace("&"+cacheSuffix,"")),url}function isSkinContentCss(href){var settings=editor.settings,skin=settings.skin!==!1&&(settings.skin||"lightgray");if(skin){var skinUrl=settings.skin_url;return skinUrl=skinUrl?editor.documentBaseURI.toAbsolute(skinUrl):tinymce.baseURL+"/skins/"+skin,href===skinUrl+"/content"+(editor.inline?".inline":"")+".min.css"}return!1}function compileFilter(filter){return"string"==typeof filter?function(value){return value.indexOf(filter)!==-1}:filter instanceof RegExp?function(value){return filter.test(value)}:filter}function getSelectors(doc,fileFilter){function append(styleSheet,imported){var rules,href=styleSheet.href;if(href=removeCacheSuffix(href),href&&fileFilter(href,imported)&&!isSkinContentCss(href)){each(styleSheet.imports,function(styleSheet){append(styleSheet,!0)});try{rules=styleSheet.cssRules||styleSheet.rules}catch(e){}each(rules,function(cssRule){cssRule.styleSheet?append(cssRule.styleSheet,!0):cssRule.selectorText&&each(cssRule.selectorText.split(","),function(selector){selectors.push(tinymce.trim(selector))})})}}var selectors=[],contentCSSUrls={};each(editor.contentCSS,function(url){contentCSSUrls[url]=!0}),fileFilter||(fileFilter=function(href,imported){return imported||contentCSSUrls[href]});try{each(doc.styleSheets,function(styleSheet){append(styleSheet)})}catch(e){}return selectors}function convertSelectorToFormat(selectorText){var format,selector=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(selectorText);if(selector){var elementName=selector[1],classes=selector[2].substr(1).split(".").join(" "),inlineSelectorElements=tinymce.makeMap("a,img");return selector[1]?(format={title:selectorText},editor.schema.getTextBlockElements()[elementName]?format.block=elementName:editor.schema.getBlockElements()[elementName]||inlineSelectorElements[elementName.toLowerCase()]?format.selector=elementName:format.inline=elementName):selector[2]&&(format={inline:"span",title:selectorText.substr(1),classes:classes}),editor.settings.importcss_merge_classes!==!1?format.classes=classes:format.attributes={"class":classes},format}}var self=this,each=tinymce.each;editor.on("renderFormatsMenu",function(e){var settings=editor.settings,selectors={},selectorConverter=settings.importcss_selector_converter||convertSelectorToFormat,selectorFilter=compileFilter(settings.importcss_selector_filter),ctrl=e.control;editor.settings.importcss_append||ctrl.items().remove();var groups=[];tinymce.each(settings.importcss_groups,function(group){group=tinymce.extend({},group),group.filter=compileFilter(group.filter),groups.push(group)}),each(getSelectors(e.doc||editor.getDoc(),compileFilter(settings.importcss_file_filter)),function(selector){if(selector.indexOf(".mce-")===-1&&!selectors[selector]&&(!selectorFilter||selectorFilter(selector))){var menu,format=selectorConverter.call(self,selector);if(format){var formatName=format.name||tinymce.DOM.uniqueId();if(groups)for(var i=0;i<groups.length;i++)if(!groups[i].filter||groups[i].filter(selector)){groups[i].item||(groups[i].item={text:groups[i].title,menu:[]}),menu=groups[i].item.menu;break}editor.formatter.register(formatName,format);var menuItem=tinymce.extend({},ctrl.settings.itemDefaults,{text:format.title,format:formatName});menu?menu.push(menuItem):ctrl.add(menuItem)}selectors[selector]=!0}}),each(groups,function(group){ctrl.add(group.item)}),e.control.renderNew()}),self.convertSelectorToFormat=convertSelectorToFormat})}.apply(root,arguments)})}(this),function(root){define("tinymce-insertdatetime",["tinymce"],function(){return function(){tinymce.PluginManager.add("insertdatetime",function(editor){function getDateTime(fmt,date){function addZeros(value,len){if(value=""+value,value.length<len)for(var i=0;i<len-value.length;i++)value="0"+value;return value}return date=date||new Date,fmt=fmt.replace("%D","%m/%d/%Y"),fmt=fmt.replace("%r","%I:%M:%S %p"),fmt=fmt.replace("%Y",""+date.getFullYear()),fmt=fmt.replace("%y",""+date.getYear()),fmt=fmt.replace("%m",addZeros(date.getMonth()+1,2)),fmt=fmt.replace("%d",addZeros(date.getDate(),2)),fmt=fmt.replace("%H",""+addZeros(date.getHours(),2)),fmt=fmt.replace("%M",""+addZeros(date.getMinutes(),2)),fmt=fmt.replace("%S",""+addZeros(date.getSeconds(),2)),fmt=fmt.replace("%I",""+((date.getHours()+11)%12+1)),fmt=fmt.replace("%p",""+(date.getHours()<12?"AM":"PM")),fmt=fmt.replace("%B",""+editor.translate(monthsLong[date.getMonth()])),fmt=fmt.replace("%b",""+editor.translate(monthsShort[date.getMonth()])),fmt=fmt.replace("%A",""+editor.translate(daysLong[date.getDay()])),fmt=fmt.replace("%a",""+editor.translate(daysShort[date.getDay()])),fmt=fmt.replace("%%","%")}function insertDateTime(format){var html=getDateTime(format);if(editor.settings.insertdatetime_element){var computerTime;computerTime=getDateTime(/%[HMSIp]/.test(format)?"%Y-%m-%dT%H:%M":"%Y-%m-%d"),html='<time datetime="'+computerTime+'">'+html+"</time>";var timeElm=editor.dom.getParent(editor.selection.getStart(),"time");if(timeElm)return void editor.dom.setOuterHTML(timeElm,html)}editor.insertContent(html)}var lastFormat,defaultButtonTimeFormat,daysShort="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),daysLong="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),monthsShort="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthsLong="January February March April May June July August September October November December".split(" "),menuItems=[];editor.addCommand("mceInsertDate",function(){insertDateTime(editor.getParam("insertdatetime_dateformat",editor.translate("%Y-%m-%d")))}),editor.addCommand("mceInsertTime",function(){insertDateTime(editor.getParam("insertdatetime_timeformat",editor.translate("%H:%M:%S")))}),editor.addButton("insertdatetime",{type:"splitbutton",title:"Insert date/time",onclick:function(){insertDateTime(lastFormat||defaultButtonTimeFormat)},menu:menuItems}),tinymce.each(editor.settings.insertdatetime_formats||["%H:%M:%S","%Y-%m-%d","%I:%M:%S %p","%D"],function(fmt){defaultButtonTimeFormat||(defaultButtonTimeFormat=fmt),menuItems.push({text:getDateTime(fmt),onclick:function(){lastFormat=fmt,insertDateTime(fmt)}})}),editor.addMenuItem("insertdatetime",{icon:"date",text:"Insert date/time",menu:menuItems,context:"insert"})})}.apply(root,arguments)})}(this),function(root){define("tinymce-layer",["tinymce"],function(){return function(){tinymce.PluginManager.add("layer",function(editor){function getParentLayer(node){do if(node.className&&node.className.indexOf("mceItemLayer")!=-1)return node;while(node=node.parentNode)}function visualAid(e){var dom=editor.dom;tinymce.each(dom.select("div,p",e),function(e){/^(absolute|relative|fixed)$/i.test(e.style.position)&&(e.hasVisual?dom.addClass(e,"mceItemVisualAid"):dom.removeClass(e,"mceItemVisualAid"),dom.addClass(e,"mceItemLayer"))})}function move(d){var i,nl,z=[],le=getParentLayer(editor.selection.getNode()),ci=-1,fi=-1;for(nl=[],tinymce.walk(editor.getBody(),function(n){1==n.nodeType&&/^(absolute|relative|static)$/i.test(n.style.position)&&nl.push(n)},"childNodes"),i=0;i<nl.length;i++)z[i]=nl[i].style.zIndex?parseInt(nl[i].style.zIndex,10):0,ci<0&&nl[i]==le&&(ci=i);if(d<0){for(i=0;i<z.length;i++)if(z[i]<z[ci]){fi=i;break}fi>-1?(nl[ci].style.zIndex=z[fi],nl[fi].style.zIndex=z[ci]):z[ci]>0&&(nl[ci].style.zIndex=z[ci]-1)}else{for(i=0;i<z.length;i++)if(z[i]>z[ci]){fi=i;break}fi>-1?(nl[ci].style.zIndex=z[fi],nl[fi].style.zIndex=z[ci]):nl[ci].style.zIndex=z[ci]+1}editor.execCommand("mceRepaint")}function insertLayer(){var dom=editor.dom,p=dom.getPos(dom.getParent(editor.selection.getNode(),"*")),body=editor.getBody();editor.dom.add(body,"div",{style:{position:"absolute",left:p.x,top:p.y>20?p.y:20,width:100,height:100},"class":"mceItemVisualAid mceItemLayer"},editor.selection.getContent()||editor.getLang("layer.content")),tinymce.Env.ie&&dom.setHTML(body,body.innerHTML)}function toggleAbsolute(){var le=getParentLayer(editor.selection.getNode());le||(le=editor.dom.getParent(editor.selection.getNode(),"DIV,P,IMG")),le&&("absolute"==le.style.position.toLowerCase()?(editor.dom.setStyles(le,{position:"",left:"",top:"",width:"",height:""}),editor.dom.removeClass(le,"mceItemVisualAid"),editor.dom.removeClass(le,"mceItemLayer")):(le.style.left||(le.style.left="20px"),le.style.top||(le.style.top="20px"),le.style.width||(le.style.width=le.width?le.width+"px":"100px"),le.style.height||(le.style.height=le.height?le.height+"px":"100px"),le.style.position="absolute",editor.dom.setAttrib(le,"data-mce-style",""),editor.addVisual(editor.getBody())),editor.execCommand("mceRepaint"),editor.nodeChanged())}editor.addCommand("mceInsertLayer",insertLayer),editor.addCommand("mceMoveForward",function(){move(1)}),editor.addCommand("mceMoveBackward",function(){move(-1)}),editor.addCommand("mceMakeAbsolute",function(){toggleAbsolute()}),editor.addButton("moveforward",{title:"layer.forward_desc",cmd:"mceMoveForward"}),editor.addButton("movebackward",{title:"layer.backward_desc",cmd:"mceMoveBackward"}),editor.addButton("absolute",{title:"layer.absolute_desc",cmd:"mceMakeAbsolute"}),editor.addButton("insertlayer",{title:"layer.insertlayer_desc",cmd:"mceInsertLayer"}),editor.on("init",function(){tinymce.Env.ie&&editor.getDoc().execCommand("2D-Position",!1,!0)}),editor.on("mouseup",function(e){var layer=getParentLayer(e.target);layer&&editor.dom.setAttrib(layer,"data-mce-style","")}),editor.on("mousedown",function(e){var parent,node=e.target,doc=editor.getDoc();tinymce.Env.gecko&&(getParentLayer(node)?"on"!==doc.designMode&&(doc.designMode="on",node=doc.body,parent=node.parentNode,parent.removeChild(node),parent.appendChild(node)):"on"==doc.designMode&&(doc.designMode="off"))}),editor.on("NodeChange",visualAid)})}.apply(root,arguments)})}(this),function(root){define("tinymce-legacyoutput",["tinymce"],function(){return function(){!function(tinymce){tinymce.on("AddEditor",function(e){e.editor.settings.inline_styles=!1}),tinymce.PluginManager.add("legacyoutput",function(editor,url,$){editor.on("init",function(){var alignElements="p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",fontSizes=tinymce.explode(editor.settings.font_size_style_values),schema=editor.schema;editor.formatter.register({alignleft:{selector:alignElements,attributes:{align:"left"}},aligncenter:{selector:alignElements,attributes:{align:"center"}},alignright:{selector:alignElements,attributes:{align:"right"}},alignjustify:{selector:alignElements,attributes:{align:"justify"}},bold:[{inline:"b",remove:"all"},{inline:"strong",remove:"all"},{inline:"span",styles:{fontWeight:"bold"}}],italic:[{inline:"i",remove:"all"},{inline:"em",remove:"all"},{inline:"span",styles:{fontStyle:"italic"}}],underline:[{inline:"u",remove:"all"},{inline:"span",styles:{textDecoration:"underline"},exact:!0}],strikethrough:[{inline:"strike",remove:"all"},{inline:"span",styles:{textDecoration:"line-through"},exact:!0}],fontname:{inline:"font",attributes:{face:"%value"}},fontsize:{inline:"font",attributes:{size:function(vars){return tinymce.inArray(fontSizes,vars.value)+1}}},forecolor:{inline:"font",attributes:{color:"%value"}},hilitecolor:{inline:"font",styles:{backgroundColor:"%value"}}}),tinymce.each("b,i,u,strike".split(","),function(name){schema.addValidElements(name+"[*]")}),schema.getElementRule("font")||schema.addValidElements("font[face|size|color|style]"),tinymce.each(alignElements.split(","),function(name){var rule=schema.getElementRule(name);rule&&(rule.attributes.align||(rule.attributes.align={},rule.attributesOrder.push("align")))})}),editor.addButton("fontsizeselect",function(){var items=[],defaultFontsizeFormats="8pt=1 10pt=2 12pt=3 14pt=4 18pt=5 24pt=6 36pt=7",fontsize_formats=editor.settings.fontsize_formats||defaultFontsizeFormats;return editor.$.each(fontsize_formats.split(" "),function(i,item){var text=item,value=item,values=item.split("=");values.length>1&&(text=values[0],value=values[1]),items.push({text:text,value:value})}),{type:"listbox",text:"Font Sizes",tooltip:"Font Sizes",values:items,fixedWidth:!0,onPostRender:function(){var self=this;editor.on("NodeChange",function(){var fontElm;fontElm=editor.dom.getParent(editor.selection.getNode(),"font"),fontElm?self.value(fontElm.size):self.value("")})},onclick:function(e){e.control.settings.value&&editor.execCommand("FontSize",!1,e.control.settings.value)}}}),editor.addButton("fontselect",function(){function createFormats(formats){formats=formats.replace(/;$/,"").split(";");for(var i=formats.length;i--;)formats[i]=formats[i].split("=");return formats}var defaultFontsFormats="Andale Mono=andale mono,monospace;Arial=arial,helvetica,sans-serif;Arial Black=arial black,sans-serif;Book Antiqua=book antiqua,palatino,serif;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier,monospace;Georgia=georgia,palatino,serif;Helvetica=helvetica,arial,sans-serif;Impact=impact,sans-serif;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco,monospace;Times New Roman=times new roman,times,serif;Trebuchet MS=trebuchet ms,geneva,sans-serif;Verdana=verdana,geneva,sans-serif;Webdings=webdings;Wingdings=wingdings,zapf dingbats",items=[],fonts=createFormats(editor.settings.font_formats||defaultFontsFormats);return $.each(fonts,function(i,font){items.push({text:{raw:font[0]},value:font[1],textStyle:font[1].indexOf("dings")==-1?"font-family:"+font[1]:""})}),{type:"listbox",text:"Font Family",tooltip:"Font Family",values:items,fixedWidth:!0,onPostRender:function(){var self=this;editor.on("NodeChange",function(){var fontElm;fontElm=editor.dom.getParent(editor.selection.getNode(),"font"),fontElm?self.value(fontElm.face):self.value("")})},onselect:function(e){e.control.settings.value&&editor.execCommand("FontName",!1,e.control.settings.value)}}})})}(tinymce)}.apply(root,arguments)})}(this),function(root){define("tinymce-link",["tinymce"],function(){return function(){tinymce.PluginManager.add("link",function(editor){function createLinkList(callback){return function(){var linkList=editor.settings.link_list;
"string"==typeof linkList?tinymce.util.XHR.send({url:linkList,success:function(text){callback(tinymce.util.JSON.parse(text))}}):"function"==typeof linkList?linkList(callback):callback(linkList)}}function buildListItems(inputList,itemCallback,startItems){function appendItems(values,output){return output=output||[],tinymce.each(values,function(item){var menuItem={text:item.text||item.title};item.menu?menuItem.menu=appendItems(item.menu):(menuItem.value=item.value,itemCallback&&itemCallback(menuItem)),output.push(menuItem)}),output}return appendItems(inputList,startItems||[])}function showDialog(linkList){function linkListChangeHandler(e){var textCtrl=win.find("#text");(!textCtrl.value()||e.lastControl&&textCtrl.value()==e.lastControl.text())&&textCtrl.value(e.control.text()),win.find("#href").value(e.control.value())}function buildAnchorListControl(url){var anchorList=[];if(tinymce.each(editor.dom.select("a:not([href])"),function(anchor){var id=anchor.name||anchor.id;id&&anchorList.push({text:id,value:"#"+id,selected:url.indexOf("#"+id)!=-1})}),anchorList.length)return anchorList.unshift({text:"None",value:""}),{name:"anchor",type:"listbox",label:"Anchors",values:anchorList,onselect:linkListChangeHandler}}function updateText(){!initialText&&0===data.text.length&&onlyText&&this.parent().parent().find("#text")[0].value(this.value())}function urlChange(e){var meta=e.meta||{};linkListCtrl&&linkListCtrl.value(editor.convertURL(this.value(),"href")),tinymce.each(e.meta,function(value,key){win.find("#"+key).value(value)}),meta.text||updateText.call(this)}function isOnlyTextSelected(anchorElm){var html=selection.getContent();if(/</.test(html)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(html)||html.indexOf("href=")==-1))return!1;if(anchorElm){var i,nodes=anchorElm.childNodes;if(0===nodes.length)return!1;for(i=nodes.length-1;i>=0;i--)if(3!=nodes[i].nodeType)return!1}return!0}var selectedElm,anchorElm,initialText,win,onlyText,textListCtrl,linkListCtrl,relListCtrl,targetListCtrl,classListCtrl,linkTitleCtrl,value,data={},selection=editor.selection,dom=editor.dom;selectedElm=selection.getNode(),anchorElm=dom.getParent(selectedElm,"a[href]"),onlyText=isOnlyTextSelected(),data.text=initialText=anchorElm?anchorElm.innerText||anchorElm.textContent:selection.getContent({format:"text"}),data.href=anchorElm?dom.getAttrib(anchorElm,"href"):"",anchorElm?data.target=dom.getAttrib(anchorElm,"target"):editor.settings.default_link_target&&(data.target=editor.settings.default_link_target),(value=dom.getAttrib(anchorElm,"rel"))&&(data.rel=value),(value=dom.getAttrib(anchorElm,"class"))&&(data["class"]=value),(value=dom.getAttrib(anchorElm,"title"))&&(data.title=value),onlyText&&(textListCtrl={name:"text",type:"textbox",size:40,label:"Text to display",onchange:function(){data.text=this.value()}}),linkList&&(linkListCtrl={type:"listbox",label:"Link list",values:buildListItems(linkList,function(item){item.value=editor.convertURL(item.value||item.url,"href")},[{text:"None",value:""}]),onselect:linkListChangeHandler,value:editor.convertURL(data.href,"href"),onPostRender:function(){linkListCtrl=this}}),editor.settings.target_list!==!1&&(editor.settings.target_list||(editor.settings.target_list=[{text:"None",value:""},{text:"New window",value:"_blank"}]),targetListCtrl={name:"target",type:"listbox",label:"Target",values:buildListItems(editor.settings.target_list)}),editor.settings.rel_list&&(relListCtrl={name:"rel",type:"listbox",label:"Rel",values:buildListItems(editor.settings.rel_list)}),editor.settings.link_class_list&&(classListCtrl={name:"class",type:"listbox",label:"Class",values:buildListItems(editor.settings.link_class_list,function(item){item.value&&(item.textStyle=function(){return editor.formatter.getCssText({inline:"a",classes:[item.value]})})})}),editor.settings.link_title!==!1&&(linkTitleCtrl={name:"title",type:"textbox",label:"Title",value:data.title}),win=editor.windowManager.open({title:"Insert link",data:data,body:[{name:"href",type:"filepicker",filetype:"file",size:40,autofocus:!0,label:"Url",onchange:urlChange,onkeyup:updateText},textListCtrl,linkTitleCtrl,buildAnchorListControl(data.href),linkListCtrl,relListCtrl,targetListCtrl,classListCtrl],onSubmit:function(e){function delayedConfirm(message,callback){var rng=editor.selection.getRng();tinymce.util.Delay.setEditorTimeout(editor,function(){editor.windowManager.confirm(message,function(state){editor.selection.setRng(rng),callback(state)})})}function insertLink(){var linkAttrs={href:href,target:data.target?data.target:null,rel:data.rel?data.rel:null,"class":data["class"]?data["class"]:null,title:data.title?data.title:null};anchorElm?(editor.focus(),onlyText&&data.text!=initialText&&("innerText"in anchorElm?anchorElm.innerText=data.text:anchorElm.textContent=data.text),dom.setAttribs(anchorElm,linkAttrs),selection.select(anchorElm),editor.undoManager.add()):onlyText?editor.insertContent(dom.createHTML("a",linkAttrs,dom.encode(data.text))):editor.execCommand("mceInsertLink",!1,linkAttrs)}var href;return data=tinymce.extend(data,e.data),(href=data.href)?href.indexOf("@")>0&&href.indexOf("//")==-1&&href.indexOf("mailto:")==-1?void delayedConfirm("The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",function(state){state&&(href="mailto:"+href),insertLink()}):editor.settings.link_assume_external_targets&&!/^\w+:/i.test(href)||!editor.settings.link_assume_external_targets&&/^\s*www[\.|\d\.]/i.test(href)?void delayedConfirm("The URL you entered seems to be an external link. Do you want to add the required http:// prefix?",function(state){state&&(href="http://"+href),insertLink()}):void insertLink():void editor.execCommand("unlink")}})}editor.addButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Meta+K",onclick:createLinkList(showDialog),stateSelector:"a[href]"}),editor.addButton("unlink",{icon:"unlink",tooltip:"Remove link",cmd:"unlink",stateSelector:"a[href]"}),editor.addShortcut("Meta+K","",createLinkList(showDialog)),editor.addCommand("mceLink",createLinkList(showDialog)),this.showDialog=showDialog,editor.addMenuItem("link",{icon:"link",text:"Insert/edit link",shortcut:"Meta+K",onclick:createLinkList(showDialog),stateSelector:"a[href]",context:"insert",prependToContext:!0})})}.apply(root,arguments)})}(this),function(root){define("tinymce-lists",["tinymce"],function(){return function(){tinymce.PluginManager.add("lists",function(editor){function isChildOfBody(elm){return editor.$.contains(editor.getBody(),elm)}function isBr(node){return node&&"BR"==node.nodeName}function isListNode(node){return node&&/^(OL|UL|DL)$/.test(node.nodeName)&&isChildOfBody(node)}function isFirstChild(node){return node.parentNode.firstChild==node}function isLastChild(node){return node.parentNode.lastChild==node}function isTextBlock(node){return node&&!!editor.schema.getTextBlockElements()[node.nodeName]}function isEditorBody(elm){return elm===editor.getBody()}var self=this;editor.on("init",function(){function isEmpty(elm,keepBookmarks){var empty=dom.isEmpty(elm);return!(keepBookmarks&&dom.select("span[data-mce-type=bookmark]").length>0)&&empty}function createBookmark(rng){function setupEndPoint(start){var offsetNode,container,offset;container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],1==container.nodeType&&(offsetNode=dom.create("span",{"data-mce-type":"bookmark"}),container.hasChildNodes()?(offset=Math.min(offset,container.childNodes.length-1),start?container.insertBefore(offsetNode,container.childNodes[offset]):dom.insertAfter(offsetNode,container.childNodes[offset])):container.appendChild(offsetNode),container=offsetNode,offset=0),bookmark[start?"startContainer":"endContainer"]=container,bookmark[start?"startOffset":"endOffset"]=offset}var bookmark={};return setupEndPoint(!0),rng.collapsed||setupEndPoint(),bookmark}function moveToBookmark(bookmark){function restoreEndPoint(start){function nodeIndex(container){for(var node=container.parentNode.firstChild,idx=0;node;){if(node==container)return idx;1==node.nodeType&&"bookmark"==node.getAttribute("data-mce-type")||idx++,node=node.nextSibling}return-1}var container,offset,node;container=node=bookmark[start?"startContainer":"endContainer"],offset=bookmark[start?"startOffset":"endOffset"],container&&(1==container.nodeType&&(offset=nodeIndex(container),container=container.parentNode,dom.remove(node)),bookmark[start?"startContainer":"endContainer"]=container,bookmark[start?"startOffset":"endOffset"]=offset)}restoreEndPoint(!0),restoreEndPoint();var rng=dom.createRng();rng.setStart(bookmark.startContainer,bookmark.startOffset),bookmark.endContainer&&rng.setEnd(bookmark.endContainer,bookmark.endOffset),selection.setRng(rng)}function createNewTextBlock(contentNode,blockName){var node,textBlock,hasContentNode,fragment=dom.createFragment(),blockElements=editor.schema.getBlockElements();if(editor.settings.forced_root_block&&(blockName=blockName||editor.settings.forced_root_block),blockName&&(textBlock=dom.create(blockName),textBlock.tagName===editor.settings.forced_root_block&&dom.setAttribs(textBlock,editor.settings.forced_root_block_attrs),fragment.appendChild(textBlock)),contentNode)for(;node=contentNode.firstChild;){var nodeName=node.nodeName;hasContentNode||"SPAN"==nodeName&&"bookmark"==node.getAttribute("data-mce-type")||(hasContentNode=!0),blockElements[nodeName]?(fragment.appendChild(node),textBlock=null):blockName?(textBlock||(textBlock=dom.create(blockName),fragment.appendChild(textBlock)),textBlock.appendChild(node)):fragment.appendChild(node)}return editor.settings.forced_root_block?hasContentNode||tinymce.Env.ie&&!(tinymce.Env.ie>10)||textBlock.appendChild(dom.create("br",{"data-mce-bogus":"1"})):fragment.appendChild(dom.create("br")),fragment}function getSelectedListItems(){return tinymce.grep(selection.getSelectedBlocks(),function(block){return/^(LI|DT|DD)$/.test(block.nodeName)})}function splitList(ul,li,newBlock){function removeAndKeepBookmarks(targetNode){tinymce.each(bookmarks,function(node){targetNode.parentNode.insertBefore(node,li.parentNode)}),dom.remove(targetNode)}var tmpRng,fragment,bookmarks,node;for(bookmarks=dom.select('span[data-mce-type="bookmark"]',ul),newBlock=newBlock||createNewTextBlock(li),tmpRng=dom.createRng(),tmpRng.setStartAfter(li),tmpRng.setEndAfter(ul),fragment=tmpRng.extractContents(),node=fragment.firstChild;node;node=node.firstChild)if("LI"==node.nodeName&&dom.isEmpty(node)){dom.remove(node);break}dom.isEmpty(fragment)||dom.insertAfter(fragment,ul),dom.insertAfter(newBlock,ul),isEmpty(li.parentNode)&&removeAndKeepBookmarks(li.parentNode),dom.remove(li),isEmpty(ul)&&dom.remove(ul)}function mergeWithAdjacentLists(listBlock){var sibling,node;if(sibling=listBlock.nextSibling,sibling&&isListNode(sibling)&&sibling.nodeName==listBlock.nodeName){for(;node=sibling.firstChild;)listBlock.appendChild(node);dom.remove(sibling)}if(sibling=listBlock.previousSibling,sibling&&isListNode(sibling)&&sibling.nodeName==listBlock.nodeName){for(;node=sibling.firstChild;)listBlock.insertBefore(node,listBlock.firstChild);dom.remove(sibling)}}function normalizeList(element){tinymce.each(tinymce.grep(dom.select("ol,ul",element)),function(ul){var sibling,parentNode=ul.parentNode;"LI"==parentNode.nodeName&&parentNode.firstChild==ul&&(sibling=parentNode.previousSibling,sibling&&"LI"==sibling.nodeName&&(sibling.appendChild(ul),isEmpty(parentNode)&&dom.remove(parentNode))),isListNode(parentNode)&&(sibling=parentNode.previousSibling,sibling&&"LI"==sibling.nodeName&&sibling.appendChild(ul))})}function outdent(li){function removeEmptyLi(li){isEmpty(li)&&dom.remove(li)}var newBlock,ul=li.parentNode,ulParent=ul.parentNode;return!!isEditorBody(ul)||("DD"==li.nodeName?(dom.rename(li,"DT"),!0):isFirstChild(li)&&isLastChild(li)?("LI"==ulParent.nodeName?(dom.insertAfter(li,ulParent),removeEmptyLi(ulParent),dom.remove(ul)):isListNode(ulParent)?dom.remove(ul,!0):(ulParent.insertBefore(createNewTextBlock(li),ul),dom.remove(ul)),!0):isFirstChild(li)?("LI"==ulParent.nodeName?(dom.insertAfter(li,ulParent),li.appendChild(ul),removeEmptyLi(ulParent)):isListNode(ulParent)?ulParent.insertBefore(li,ul):(ulParent.insertBefore(createNewTextBlock(li),ul),dom.remove(li)),!0):isLastChild(li)?("LI"==ulParent.nodeName?dom.insertAfter(li,ulParent):isListNode(ulParent)?dom.insertAfter(li,ul):(dom.insertAfter(createNewTextBlock(li),ul),dom.remove(li)),!0):("LI"==ulParent.nodeName?(ul=ulParent,newBlock=createNewTextBlock(li,"LI")):newBlock=isListNode(ulParent)?createNewTextBlock(li,"LI"):createNewTextBlock(li),splitList(ul,li,newBlock),normalizeList(ul.parentNode),!0))}function indent(li){function mergeLists(from,to){var node;if(isListNode(from)){for(;node=li.lastChild.firstChild;)to.appendChild(node);dom.remove(from)}}var sibling,newList;return"DT"==li.nodeName?(dom.rename(li,"DD"),!0):(sibling=li.previousSibling,sibling&&isListNode(sibling)?(sibling.appendChild(li),!0):sibling&&"LI"==sibling.nodeName&&isListNode(sibling.lastChild)?(sibling.lastChild.appendChild(li),mergeLists(li.lastChild,sibling.lastChild),!0):(sibling=li.nextSibling,sibling&&isListNode(sibling)?(sibling.insertBefore(li,sibling.firstChild),!0):(sibling=li.previousSibling,!(!sibling||"LI"!=sibling.nodeName)&&(newList=dom.create(li.parentNode.nodeName),sibling.appendChild(newList),newList.appendChild(li),mergeLists(li.lastChild,newList),!0))))}function indentSelection(){var listElements=getSelectedListItems();if(listElements.length){for(var bookmark=createBookmark(selection.getRng(!0)),i=0;i<listElements.length&&(indent(listElements[i])||0!==i);i++);return moveToBookmark(bookmark),editor.nodeChanged(),!0}}function outdentSelection(){var listElements=getSelectedListItems();if(listElements.length){var i,y,bookmark=createBookmark(selection.getRng(!0)),root=editor.getBody();for(i=listElements.length;i--;)for(var node=listElements[i].parentNode;node&&node!=root;){for(y=listElements.length;y--;)if(listElements[y]===node){listElements.splice(i,1);break}node=node.parentNode}for(i=0;i<listElements.length&&(outdent(listElements[i])||0!==i);i++);return moveToBookmark(bookmark),editor.nodeChanged(),!0}}function applyList(listName){function getSelectedTextBlocks(){function getEndPointNode(start){var container,offset;for(container=rng[start?"startContainer":"endContainer"],offset=rng[start?"startOffset":"endOffset"],1==container.nodeType&&(container=container.childNodes[Math.min(offset,container.childNodes.length-1)]||container);container.parentNode!=root;){if(isTextBlock(container))return container;if(/^(TD|TH)$/.test(container.parentNode.nodeName))return container;container=container.parentNode}return container}for(var block,textBlocks=[],root=editor.getBody(),startNode=getEndPointNode(!0),endNode=getEndPointNode(),siblings=[],node=startNode;node&&(siblings.push(node),node!=endNode);node=node.nextSibling);return tinymce.each(siblings,function(node){if(isTextBlock(node))return textBlocks.push(node),void(block=null);if(dom.isBlock(node)||isBr(node))return isBr(node)&&dom.remove(node),void(block=null);var nextSibling=node.nextSibling;return tinymce.dom.BookmarkManager.isBookmarkNode(node)&&(isTextBlock(nextSibling)||!nextSibling&&node.parentNode==root)?void(block=null):(block||(block=dom.create("p"),node.parentNode.insertBefore(block,node),textBlocks.push(block)),void block.appendChild(node))}),textBlocks}var bookmark,rng=selection.getRng(!0),listItemName="LI";"false"!==dom.getContentEditable(selection.getNode())&&(listName=listName.toUpperCase(),"DL"==listName&&(listItemName="DT"),bookmark=createBookmark(rng),tinymce.each(getSelectedTextBlocks(),function(block){var listBlock,sibling;sibling=block.previousSibling,sibling&&isListNode(sibling)&&sibling.nodeName==listName?(listBlock=sibling,block=dom.rename(block,listItemName),sibling.appendChild(block)):(listBlock=dom.create(listName),block.parentNode.insertBefore(listBlock,block),listBlock.appendChild(block),block=dom.rename(block,listItemName)),mergeWithAdjacentLists(listBlock)}),moveToBookmark(bookmark))}function removeList(){var bookmark=createBookmark(selection.getRng(!0)),root=editor.getBody();tinymce.each(getSelectedListItems(),function(li){var node,rootList;if(!isEditorBody(li.parentNode)){if(isEmpty(li))return void outdent(li);for(node=li;node&&node!=root;node=node.parentNode)isListNode(node)&&(rootList=node);splitList(rootList,li)}}),moveToBookmark(bookmark)}function toggleList(listName){var parentList=dom.getParent(selection.getStart(),"OL,UL,DL");if(!isEditorBody(parentList))if(parentList)if(parentList.nodeName==listName)removeList(listName);else{var bookmark=createBookmark(selection.getRng(!0));mergeWithAdjacentLists(dom.rename(parentList,listName)),moveToBookmark(bookmark)}else applyList(listName)}function queryListCommandState(listName){return function(){var parentList=dom.getParent(editor.selection.getStart(),"UL,OL,DL");return parentList&&parentList.nodeName==listName}}function isBogusBr(node){return!!isBr(node)&&!(!dom.isBlock(node.nextSibling)||isBr(node.previousSibling))}var dom=editor.dom,selection=editor.selection;self.backspaceDelete=function(isForward){function findNextCaretContainer(rng,isForward){var nonEmptyBlocks,walker,node=rng.startContainer,offset=rng.startOffset;if(3==node.nodeType&&(isForward?offset<node.data.length:offset>0))return node;for(nonEmptyBlocks=editor.schema.getNonEmptyElements(),1==node.nodeType&&(node=tinymce.dom.RangeUtils.getNode(node,offset)),walker=new tinymce.dom.TreeWalker(node,editor.getBody()),isForward&&isBogusBr(node)&&walker.next();node=walker[isForward?"next":"prev2"]();){if("LI"==node.nodeName&&!node.hasChildNodes())return node;if(nonEmptyBlocks[node.nodeName])return node;if(3==node.nodeType&&node.data.length>0)return node}}function mergeLiElements(fromElm,toElm){var node,listNode,ul=fromElm.parentNode;if(isChildOfBody(fromElm)&&isChildOfBody(toElm)){if(isListNode(toElm.lastChild)&&(listNode=toElm.lastChild),ul==toElm.lastChild&&isBr(ul.previousSibling)&&dom.remove(ul.previousSibling),node=toElm.lastChild,node&&isBr(node)&&fromElm.hasChildNodes()&&dom.remove(node),isEmpty(toElm,!0)&&dom.$(toElm).empty(),!isEmpty(fromElm,!0))for(;node=fromElm.firstChild;)toElm.appendChild(node);listNode&&toElm.appendChild(listNode),dom.remove(fromElm),isEmpty(ul)&&!isEditorBody(ul)&&dom.remove(ul)}}if(selection.isCollapsed()){var ul,rng,otherLi,li=dom.getParent(selection.getStart(),"LI");if(li){if(ul=li.parentNode,isEditorBody(ul)&&dom.isEmpty(ul))return!0;if(rng=selection.getRng(!0),otherLi=dom.getParent(findNextCaretContainer(rng,isForward),"LI"),otherLi&&otherLi!=li){var bookmark=createBookmark(rng);return isForward?mergeLiElements(otherLi,li):mergeLiElements(li,otherLi),moveToBookmark(bookmark),!0}if(!otherLi&&!isForward&&removeList(ul.nodeName))return!0}}},editor.on("BeforeExecCommand",function(e){var isHandled,cmd=e.command.toLowerCase();if("indent"==cmd?indentSelection()&&(isHandled=!0):"outdent"==cmd&&outdentSelection()&&(isHandled=!0),isHandled)return editor.fire("ExecCommand",{command:e.command}),e.preventDefault(),!0}),editor.addCommand("InsertUnorderedList",function(){toggleList("UL")}),editor.addCommand("InsertOrderedList",function(){toggleList("OL")}),editor.addCommand("InsertDefinitionList",function(){toggleList("DL")}),editor.addQueryStateHandler("InsertUnorderedList",queryListCommandState("UL")),editor.addQueryStateHandler("InsertOrderedList",queryListCommandState("OL")),editor.addQueryStateHandler("InsertDefinitionList",queryListCommandState("DL")),editor.on("keydown",function(e){9!=e.keyCode||tinymce.util.VK.metaKeyPressed(e)||editor.dom.getParent(editor.selection.getStart(),"LI,DT,DD")&&(e.preventDefault(),e.shiftKey?outdentSelection():indentSelection())})}),editor.addButton("indent",{icon:"indent",title:"Increase indent",cmd:"Indent",onPostRender:function(){var ctrl=this;editor.on("nodechange",function(){for(var blocks=editor.selection.getSelectedBlocks(),disable=!1,i=0,l=blocks.length;!disable&&i<l;i++){var tag=blocks[i].nodeName;disable="LI"==tag&&isFirstChild(blocks[i])||"UL"==tag||"OL"==tag||"DD"==tag}ctrl.disabled(disable)})}}),editor.on("keydown",function(e){e.keyCode==tinymce.util.VK.BACKSPACE?self.backspaceDelete()&&e.preventDefault():e.keyCode==tinymce.util.VK.DELETE&&self.backspaceDelete(!0)&&e.preventDefault()})})}.apply(root,arguments)})}(this),function(root){define("tinymce-media",["tinymce"],function(){return function(){tinymce.PluginManager.add("media",function(editor,url){function guessMime(url){return url=url.toLowerCase(),url.indexOf(".mp3")!=-1?"audio/mpeg":url.indexOf(".wav")!=-1?"audio/wav":url.indexOf(".mp4")!=-1?"video/mp4":url.indexOf(".webm")!=-1?"video/webm":url.indexOf(".ogg")!=-1?"video/ogg":url.indexOf(".swf")!=-1?"application/x-shockwave-flash":""}function getVideoScriptMatch(src){var prefixes=editor.settings.media_scripts;if(prefixes)for(var i=0;i<prefixes.length;i++)if(src.indexOf(prefixes[i].filter)!==-1)return prefixes[i]}function showDialog(){function recalcSize(e){var widthCtrl,heightCtrl,newWidth,newHeight;widthCtrl=win.find("#width")[0],heightCtrl=win.find("#height")[0],newWidth=widthCtrl.value(),newHeight=heightCtrl.value(),win.find("#constrain")[0].checked()&&width&&height&&newWidth&&newHeight&&(e.control==widthCtrl?(newHeight=Math.round(newWidth/width*newHeight),isNaN(newHeight)||heightCtrl.value(newHeight)):(newWidth=Math.round(newHeight/height*newWidth),isNaN(newWidth)||widthCtrl.value(newWidth))),width=newWidth,height=newHeight}function updateValueOnChange(){data=htmlToData(this.value()),this.parent().parent().fromJSON(data)}var win,width,height,data,generalFormItems=[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:!0,label:"Source",onchange:function(e){tinymce.each(e.meta,function(value,key){win.find("#"+key).value(value)})}}];editor.settings.media_alt_source!==!1&&generalFormItems.push({name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"}),editor.settings.media_poster!==!1&&generalFormItems.push({name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"}),editor.settings.media_dimensions!==!1&&generalFormItems.push({type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:5,size:3,onchange:recalcSize,ariaLabel:"Width"},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:5,size:3,onchange:recalcSize,ariaLabel:"Height"},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}),data=getData(editor.selection.getNode()),width=data.width,height=data.height;var embedTextBox={id:"mcemediasource",type:"textbox",flex:1,name:"embed",value:getSource(),multiline:!0,label:"Source"};embedTextBox[embedChange]=updateValueOnChange,win=editor.windowManager.open({title:"Insert/edit video",data:data,bodyType:"tabpanel",body:[{title:"General",type:"form",onShowTab:function(){data=htmlToData(this.next().find("#embed").value()),this.fromJSON(data)},items:generalFormItems},{title:"Embed",type:"container",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,onShowTab:function(){this.find("#embed").value(dataToHtml(this.parent().toJSON()))},items:[{type:"label",text:"Paste your embed code below:",forId:"mcemediasource"},embedTextBox]}],onSubmit:function(){var beforeObjects,afterObjects,i,y;for(beforeObjects=editor.dom.select("img[data-mce-object]"),editor.insertContent(dataToHtml(this.toJSON())),afterObjects=editor.dom.select("img[data-mce-object]"),i=0;i<beforeObjects.length;i++)for(y=afterObjects.length-1;y>=0;y--)beforeObjects[i]==afterObjects[y]&&afterObjects.splice(y,1);editor.selection.select(afterObjects[0]),editor.nodeChanged()}})}function getSource(){var elm=editor.selection.getNode();if(elm.getAttribute("data-mce-object"))return editor.selection.getContent()}function dataToHtml(data){var html="";if(!data.source1&&(tinymce.extend(data,htmlToData(data.embed)),!data.source1))return"";if(data.source2||(data.source2=""),data.poster||(data.poster=""),data.source1=editor.convertURL(data.source1,"source"),data.source2=editor.convertURL(data.source2,"source"),data.source1mime=guessMime(data.source1),data.source2mime=guessMime(data.source2),data.poster=editor.convertURL(data.poster,"poster"),data.flashPlayerUrl=editor.convertURL(url+"/moxieplayer.swf","movie"),tinymce.each(urlPatterns,function(pattern){var match,i,url;if(match=pattern.regex.exec(data.source1)){for(url=pattern.url,i=0;match[i];i++)url=url.replace("$"+i,function(){return match[i]});data.source1=url,data.type=pattern.type,data.allowFullscreen=pattern.allowFullscreen,data.width=data.width||pattern.w,data.height=data.height||pattern.h}}),data.embed)html=updateHtml(data.embed,data,!0);else{var videoScript=getVideoScriptMatch(data.source1);if(videoScript&&(data.type="script",data.width=videoScript.width,data.height=videoScript.height),data.width=data.width||300,data.height=data.height||150,tinymce.each(data,function(value,key){data[key]=editor.dom.encode(value)}),"iframe"==data.type){var allowFullscreen=data.allowFullscreen?' allowFullscreen="1"':"";html+='<iframe src="'+data.source1+'" width="'+data.width+'" height="'+data.height+'"'+allowFullscreen+"></iframe>"}else"application/x-shockwave-flash"==data.source1mime?(html+='<object data="'+data.source1+'" width="'+data.width+'" height="'+data.height+'" type="application/x-shockwave-flash">',data.poster&&(html+='<img src="'+data.poster+'" width="'+data.width+'" height="'+data.height+'" />'),html+="</object>"):data.source1mime.indexOf("audio")!=-1?editor.settings.audio_template_callback?html=editor.settings.audio_template_callback(data):html+='<audio controls="controls" src="'+data.source1+'">'+(data.source2?'\n<source src="'+data.source2+'"'+(data.source2mime?' type="'+data.source2mime+'"':"")+" />\n":"")+"</audio>":"script"==data.type?html+='<script src="'+data.source1+'"></script>':html=editor.settings.video_template_callback?editor.settings.video_template_callback(data):'<video width="'+data.width+'" height="'+data.height+'"'+(data.poster?' poster="'+data.poster+'"':"")+' controls="controls">\n<source src="'+data.source1+'"'+(data.source1mime?' type="'+data.source1mime+'"':"")+" />\n"+(data.source2?'<source src="'+data.source2+'"'+(data.source2mime?' type="'+data.source2mime+'"':"")+" />\n":"")+"</video>"}return html}function htmlToData(html){var data={};return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!0,special:"script,noscript",start:function(name,attrs){if(data.source1||"param"!=name||(data.source1=attrs.map.movie),"iframe"!=name&&"object"!=name&&"embed"!=name&&"video"!=name&&"audio"!=name||(data.type||(data.type=name),data=tinymce.extend(attrs.map,data)),"script"==name){var videoScript=getVideoScriptMatch(attrs.map.src);if(!videoScript)return;data={type:"script",source1:attrs.map.src,width:videoScript.width,height:videoScript.height}}"source"==name&&(data.source1?data.source2||(data.source2=attrs.map.src):data.source1=attrs.map.src),"img"!=name||data.poster||(data.poster=attrs.map.src)}}).parse(html),data.source1=data.source1||data.src||data.data,data.source2=data.source2||"",data.poster=data.poster||"",data}function getData(element){return element.getAttribute("data-mce-object")?htmlToData(editor.serializer.serialize(element,{selection:!0})):{}}function sanitize(html){if(editor.settings.media_filter_html===!1)return html;var blocked,writer=new tinymce.html.Writer;return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!1,special:"script,noscript",comment:function(text){writer.comment(text)},cdata:function(text){writer.cdata(text)},text:function(text,raw){writer.text(text,raw)},start:function(name,attrs,empty){if(blocked=!0,"script"!=name&&"noscript"!=name){for(var i=0;i<attrs.length;i++){if(0===attrs[i].name.indexOf("on"))return;"style"==attrs[i].name&&(attrs[i].value=editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value),name))}writer.start(name,attrs,empty),blocked=!1}},end:function(name){blocked||writer.end(name)}},new tinymce.html.Schema({})).parse(html),writer.getContent()}function updateHtml(html,data,updateAll){function setAttributes(attrs,updatedAttrs){var name,i,value,attr;for(name in updatedAttrs)if(value=""+updatedAttrs[name],attrs.map[name])for(i=attrs.length;i--;)attr=attrs[i],attr.name==name&&(value?(attrs.map[name]=value,attr.value=value):(delete attrs.map[name],attrs.splice(i,1)));else value&&(attrs.push({name:name,value:value}),attrs.map[name]=value)}var hasImage,writer=new tinymce.html.Writer,sourceCount=0;return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!0,special:"script,noscript",comment:function(text){writer.comment(text)},cdata:function(text){writer.cdata(text)},text:function(text,raw){writer.text(text,raw)},start:function(name,attrs,empty){switch(name){case"video":case"object":case"embed":case"img":case"iframe":setAttributes(attrs,{width:data.width,height:data.height})}if(updateAll)switch(name){case"video":setAttributes(attrs,{poster:data.poster,src:""}),data.source2&&setAttributes(attrs,{src:""});break;case"iframe":setAttributes(attrs,{src:data.source1});break;case"source":if(sourceCount++,sourceCount<=2&&(setAttributes(attrs,{src:data["source"+sourceCount],type:data["source"+sourceCount+"mime"]}),!data["source"+sourceCount]))return;break;case"img":if(!data.poster)return;hasImage=!0}writer.start(name,attrs,empty)},end:function(name){if("video"==name&&updateAll)for(var index=1;index<=2;index++)if(data["source"+index]){var attrs=[];attrs.map={},sourceCount<index&&(setAttributes(attrs,{src:data["source"+index],type:data["source"+index+"mime"]}),writer.start("source",attrs,!0))}if(data.poster&&"object"==name&&updateAll&&!hasImage){var imgAttrs=[];imgAttrs.map={},setAttributes(imgAttrs,{src:data.poster,width:data.width,height:data.height}),writer.start("img",imgAttrs,!0)}writer.end(name)}},new tinymce.html.Schema({})).parse(html),writer.getContent()}function retainAttributesAndInnerHtml(sourceNode,targetNode){var attrName,attrValue,attribs,ai,innerHtml;for(attribs=sourceNode.attributes,ai=attribs.length;ai--;)attrName=attribs[ai].name,attrValue=attribs[ai].value,"width"!==attrName&&"height"!==attrName&&"style"!==attrName&&("data"!=attrName&&"src"!=attrName||(attrValue=editor.convertURL(attrValue,attrName)),targetNode.attr("data-mce-p-"+attrName,attrValue));innerHtml=sourceNode.firstChild&&sourceNode.firstChild.value,innerHtml&&(targetNode.attr("data-mce-html",escape(innerHtml)),targetNode.firstChild=null)}function createPlaceholderNode(node){var placeHolder,name=node.name;return placeHolder=new tinymce.html.Node("img",1),placeHolder.shortEnded=!0,retainAttributesAndInnerHtml(node,placeHolder),placeHolder.attr({width:node.attr("width")||"300",height:node.attr("height")||("audio"==name?"30":"150"),style:node.attr("style"),src:tinymce.Env.transparentSrc,"data-mce-object":name,"class":"mce-object mce-object-"+name}),placeHolder}function createPreviewNode(node){var previewWrapper,previewNode,shimNode,name=node.name;return previewWrapper=new tinymce.html.Node("span",1),previewWrapper.attr({contentEditable:"false",style:node.attr("style"),"data-mce-object":name,"class":"mce-preview-object mce-object-"+name}),retainAttributesAndInnerHtml(node,previewWrapper),previewNode=new tinymce.html.Node(name,1),previewNode.attr({src:node.attr("src"),allowfullscreen:node.attr("allowfullscreen"),width:node.attr("width")||"300",height:node.attr("height")||("audio"==name?"30":"150"),frameborder:"0"}),shimNode=new tinymce.html.Node("span",1),shimNode.attr("class","mce-shim"),previewWrapper.append(previewNode),previewWrapper.append(shimNode),previewWrapper}var urlPatterns=[{regex:/youtu\.be\/([\w\-.]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$2",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\-_]+)/i,type:"iframe",w:560,h:314,url:"//www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,
type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowfullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"//player.vimeo.com/video/$2?title=0&amp;byline=0",allowfullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'//maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"//www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],embedChange=tinymce.Env.ie&&tinymce.Env.ie<=8?"onChange":"onInput";editor.on("ResolveName",function(e){var name;1==e.target.nodeType&&(name=e.target.getAttribute("data-mce-object"))&&(e.name=name)}),editor.on("preInit",function(){var specialElements=editor.schema.getSpecialElements();tinymce.each("video audio iframe object".split(" "),function(name){specialElements[name]=new RegExp("</"+name+"[^>]*>","gi")});var boolAttrs=editor.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(name){boolAttrs[name]={}}),editor.parser.addNodeFilter("iframe,video,audio,object,embed,script",function(nodes){for(var node,placeHolder,videoScript,i=nodes.length;i--;)node=nodes[i],node.parent&&(node.parent.attr("data-mce-object")||("script"!=node.name||(videoScript=getVideoScriptMatch(node.attr("src"))))&&(videoScript&&(videoScript.width&&node.attr("width",videoScript.width.toString()),videoScript.height&&node.attr("height",videoScript.height.toString())),placeHolder="iframe"==node.name&&editor.settings.media_live_embeds!==!1&&tinymce.Env.ceFalse?createPreviewNode(node):createPlaceholderNode(node),node.replace(placeHolder)))}),editor.serializer.addAttributeFilter("data-mce-object",function(nodes,name){for(var node,realElm,ai,attribs,innerHtml,innerNode,realElmName,className,i=nodes.length;i--;)if(node=nodes[i],node.parent){for(realElmName=node.attr(name),realElm=new tinymce.html.Node(realElmName,1),"audio"!=realElmName&&"script"!=realElmName&&(className=node.attr("class"),className&&className.indexOf("mce-preview-object")!==-1?realElm.attr({width:node.firstChild.attr("width"),height:node.firstChild.attr("height")}):realElm.attr({width:node.attr("width"),height:node.attr("height")})),realElm.attr({style:node.attr("style")}),attribs=node.attributes,ai=attribs.length;ai--;){var attrName=attribs[ai].name;0===attrName.indexOf("data-mce-p-")&&realElm.attr(attrName.substr(11),attribs[ai].value)}"script"==realElmName&&realElm.attr("type","text/javascript"),innerHtml=node.attr("data-mce-html"),innerHtml&&(innerNode=new tinymce.html.Node("#text",3),innerNode.raw=!0,innerNode.value=sanitize(unescape(innerHtml)),realElm.append(innerNode)),node.replace(realElm)}})}),editor.on("click keyup",function(){var selectedNode=editor.selection.getNode();selectedNode&&editor.dom.hasClass(selectedNode,"mce-preview-object")&&editor.dom.getAttrib(selectedNode,"data-mce-selected")&&selectedNode.setAttribute("data-mce-selected","2")}),editor.on("ObjectSelected",function(e){var objectType=e.target.getAttribute("data-mce-object");"audio"!=objectType&&"script"!=objectType||e.preventDefault()}),editor.on("objectResized",function(e){var html,target=e.target;target.getAttribute("data-mce-object")&&(html=target.getAttribute("data-mce-html"),html&&(html=unescape(html),target.setAttribute("data-mce-html",escape(updateHtml(html,{width:e.width,height:e.height})))))}),editor.addButton("media",{tooltip:"Insert/edit video",onclick:showDialog,stateSelector:["img[data-mce-object]","span[data-mce-object]"]}),editor.addMenuItem("media",{icon:"media",text:"Insert/edit video",onclick:showDialog,context:"insert",prependToContext:!0}),editor.on("setContent",function(){editor.$("span.mce-preview-object").each(function(index,elm){var $elm=editor.$(elm);0===$elm.find("span.mce-shim",elm).length&&$elm.append('<span class="mce-shim"></span>')})}),editor.addCommand("mceMedia",showDialog),this.showDialog=showDialog})}.apply(root,arguments)})}(this),function(root){define("tinymce-nonbreaking",["tinymce"],function(){return function(){tinymce.PluginManager.add("nonbreaking",function(editor){var setting=editor.getParam("nonbreaking_force_tab");if(editor.addCommand("mceNonBreaking",function(){editor.insertContent(editor.plugins.visualchars&&editor.plugins.visualchars.state?'<span class="mce-nbsp">&nbsp;</span>':"&nbsp;"),editor.dom.setAttrib(editor.dom.select("span.mce-nbsp"),"data-mce-bogus","1")}),editor.addButton("nonbreaking",{title:"Nonbreaking space",cmd:"mceNonBreaking"}),editor.addMenuItem("nonbreaking",{text:"Nonbreaking space",cmd:"mceNonBreaking",context:"insert"}),setting){var spaces=+setting>1?+setting:3;editor.on("keydown",function(e){if(9==e.keyCode){if(e.shiftKey)return;e.preventDefault();for(var i=0;i<spaces;i++)editor.execCommand("mceNonBreaking")}})}})}.apply(root,arguments)})}(this),function(root){define("tinymce-noneditable",["tinymce"],function(){return function(){tinymce.PluginManager.add("noneditable",function(editor){function hasClass(checkClassName){return function(node){return(" "+node.attr("class")+" ").indexOf(checkClassName)!==-1}}function convertRegExpsToNonEditable(e){function replaceMatchWithSpan(match){var args=arguments,index=args[args.length-2];return index>0&&'"'==content.charAt(index-1)?match:'<span class="'+cls+'" data-mce-content="'+editor.dom.encode(args[0])+'">'+editor.dom.encode("string"==typeof args[1]?args[1]:args[0])+"</span>"}var i=nonEditableRegExps.length,content=e.content,cls=tinymce.trim(nonEditClass);if("raw"!=e.format){for(;i--;)content=content.replace(nonEditableRegExps[i],replaceMatchWithSpan);e.content=content}}var editClass,nonEditClass,nonEditableRegExps,contentEditableAttrName="contenteditable";editClass=" "+tinymce.trim(editor.getParam("noneditable_editable_class","mceEditable"))+" ",nonEditClass=" "+tinymce.trim(editor.getParam("noneditable_noneditable_class","mceNonEditable"))+" ";var hasEditClass=hasClass(editClass),hasNonEditClass=hasClass(nonEditClass);nonEditableRegExps=editor.getParam("noneditable_regexp"),nonEditableRegExps&&!nonEditableRegExps.length&&(nonEditableRegExps=[nonEditableRegExps]),editor.on("PreInit",function(){nonEditableRegExps&&editor.on("BeforeSetContent",convertRegExpsToNonEditable),editor.parser.addAttributeFilter("class",function(nodes){for(var node,i=nodes.length;i--;)node=nodes[i],hasEditClass(node)?node.attr(contentEditableAttrName,"true"):hasNonEditClass(node)&&node.attr(contentEditableAttrName,"false")}),editor.serializer.addAttributeFilter(contentEditableAttrName,function(nodes){for(var node,i=nodes.length;i--;)node=nodes[i],(hasEditClass(node)||hasNonEditClass(node))&&(nonEditableRegExps&&node.attr("data-mce-content")?(node.name="#text",node.type=3,node.raw=!0,node.value=node.attr("data-mce-content")):node.attr(contentEditableAttrName,null))})})})}.apply(root,arguments)})}(this),function(root){define("tinymce-pagebreak",["tinymce"],function(){return function(){tinymce.PluginManager.add("pagebreak",function(editor){var pageBreakClass="mce-pagebreak",separatorHtml=editor.getParam("pagebreak_separator","<!-- pagebreak -->"),pageBreakSeparatorRegExp=new RegExp(separatorHtml.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(a){return"\\"+a}),"gi"),pageBreakPlaceHolderHtml='<img src="'+tinymce.Env.transparentSrc+'" class="'+pageBreakClass+'" data-mce-resize="false" data-mce-placeholder />';editor.addCommand("mcePageBreak",function(){editor.settings.pagebreak_split_block?editor.insertContent("<p>"+pageBreakPlaceHolderHtml+"</p>"):editor.insertContent(pageBreakPlaceHolderHtml)}),editor.addButton("pagebreak",{title:"Page break",cmd:"mcePageBreak"}),editor.addMenuItem("pagebreak",{text:"Page break",icon:"pagebreak",cmd:"mcePageBreak",context:"insert"}),editor.on("ResolveName",function(e){"IMG"==e.target.nodeName&&editor.dom.hasClass(e.target,pageBreakClass)&&(e.name="pagebreak")}),editor.on("click",function(e){e=e.target,"IMG"===e.nodeName&&editor.dom.hasClass(e,pageBreakClass)&&editor.selection.select(e)}),editor.on("BeforeSetContent",function(e){e.content=e.content.replace(pageBreakSeparatorRegExp,pageBreakPlaceHolderHtml)}),editor.on("PreInit",function(){editor.serializer.addNodeFilter("img",function(nodes){for(var node,className,i=nodes.length;i--;)if(node=nodes[i],className=node.attr("class"),className&&className.indexOf("mce-pagebreak")!==-1){var parentNode=node.parent;if(editor.schema.getBlockElements()[parentNode.name]&&editor.settings.pagebreak_split_block){parentNode.type=3,parentNode.value=separatorHtml,parentNode.raw=!0,node.remove();continue}node.type=3,node.value=separatorHtml,node.raw=!0}})})})}.apply(root,arguments)})}(this),function(root){define("tinymce-paste",["tinymce"],function(){return function(){!function(exports,undefined){"use strict";function require(ids,callback){for(var module,defs=[],i=0;i<ids.length;++i){if(module=modules[ids[i]]||resolve(ids[i]),!module)throw"module definition dependecy not found: "+ids[i];defs.push(module)}callback.apply(null,defs)}function define(id,dependencies,definition){if("string"!=typeof id)throw"invalid module definition, module id must be defined and be a string";if(dependencies===undefined)throw"invalid module definition, dependencies must be specified";if(definition===undefined)throw"invalid module definition, definition function must be specified";require(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function resolve(id){for(var target=exports,fragments=id.split(/[.\/]/),fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]])return;target=target[fragments[fi]]}return target}function expose(ids){var i,target,id,fragments,privateModules;for(i=0;i<ids.length;i++){target=exports,id=ids[i],fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length-1;++fi)target[fragments[fi]]===undefined&&(target[fragments[fi]]={}),target=target[fragments[fi]];target[fragments[fragments.length-1]]=modules[id]}if(exports.AMDLC_TESTS){privateModules=exports.privateModules||{};for(id in modules)privateModules[id]=modules[id];for(i=0;i<ids.length;i++)delete privateModules[ids[i]];exports.privateModules=privateModules}}var modules={};define("tinymce/pasteplugin/Utils",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema"],function(Tools,DomParser,Schema){function filter(content,items){return Tools.each(items,function(v){content=v.constructor==RegExp?content.replace(v,""):content.replace(v[0],v[1])}),content}function innerText(html){function walk(node){var name=node.name,currentNode=node;if("br"===name)return void(text+="\n");if(shortEndedElements[name]&&(text+=" "),ignoreElements[name])return void(text+=" ");if(3==node.type&&(text+=node.value),!node.shortEnded&&(node=node.firstChild))do walk(node);while(node=node.next);blockElements[name]&&currentNode.next&&(text+="\n","p"==name&&(text+="\n"))}var schema=new Schema,domParser=new DomParser({},schema),text="",shortEndedElements=schema.getShortEndedElements(),ignoreElements=Tools.makeMap("script noscript style textarea video audio iframe object"," "),blockElements=schema.getBlockElements();return html=filter(html,[/<!\[[^\]]+\]>/g]),walk(domParser.parse(html)),text}function trimHtml(html){function trimSpaces(all,s1,s2){return s1||s2?"":" "}return html=filter(html,[/^[\s\S]*<body[^>]*>\s*|\s*<\/body[^>]*>[\s\S]*$/g,/<!--StartFragment-->|<!--EndFragment-->/g,[/( ?)<span class="Apple-converted-space">\u00a0<\/span>( ?)/g,trimSpaces],/<br class="Apple-interchange-newline">/g,/<br>$/i])}function createIdGenerator(prefix){var count=0;return function(){return prefix+count++}}return{filter:filter,innerText:innerText,trimHtml:trimHtml,createIdGenerator:createIdGenerator}}),define("tinymce/pasteplugin/Clipboard",["tinymce/Env","tinymce/dom/RangeUtils","tinymce/util/VK","tinymce/pasteplugin/Utils","tinymce/util/Delay"],function(Env,RangeUtils,VK,Utils,Delay){return function(editor){function pasteHtml(html){var args,dom=editor.dom;if(args=editor.fire("BeforePastePreProcess",{content:html}),args=editor.fire("PastePreProcess",args),html=args.content,!args.isDefaultPrevented()){if(editor.hasEventListeners("PastePostProcess")&&!args.isDefaultPrevented()){var tempBody=dom.add(editor.getBody(),"div",{style:"display:none"},html);args=editor.fire("PastePostProcess",{node:tempBody}),dom.remove(tempBody),html=args.node.innerHTML}args.isDefaultPrevented()||editor.insertContent(html,{merge:editor.settings.paste_merge_formats!==!1,data:{paste:!0}})}}function pasteText(text){text=editor.dom.encode(text).replace(/\r\n/g,"\n");var forcedRootBlockStartHtml,startBlock=editor.dom.getParent(editor.selection.getStart(),editor.dom.isBlock),forcedRootBlockName=editor.settings.forced_root_block;forcedRootBlockName&&(forcedRootBlockStartHtml=editor.dom.createHTML(forcedRootBlockName,editor.settings.forced_root_block_attrs),forcedRootBlockStartHtml=forcedRootBlockStartHtml.substr(0,forcedRootBlockStartHtml.length-3)+">"),startBlock&&/^(PRE|DIV)$/.test(startBlock.nodeName)||!forcedRootBlockName?text=Utils.filter(text,[[/\n/g,"<br>"]]):(text=Utils.filter(text,[[/\n\n/g,"</p>"+forcedRootBlockStartHtml],[/^(.*<\/p>)(<p>)$/,forcedRootBlockStartHtml+"$1"],[/\n/g,"<br />"]]),text.indexOf("<p>")!=-1&&(text=forcedRootBlockStartHtml+text)),pasteHtml(text)}function createPasteBin(){function getCaretRect(rng){var rects,textNode,node,container=rng.startContainer;if(rects=rng.getClientRects(),rects.length)return rects[0];if(rng.collapsed&&1==container.nodeType){for(node=container.childNodes[lastRng.startOffset];node&&3==node.nodeType&&!node.data.length;)node=node.nextSibling;if(node)return"BR"==node.tagName&&(textNode=dom.doc.createTextNode("\ufeff"),node.parentNode.insertBefore(textNode,node),rng=dom.createRng(),rng.setStartBefore(textNode),rng.setEndAfter(textNode),rects=rng.getClientRects(),dom.remove(textNode)),rects.length?rects[0]:void 0}}var scrollContainer,dom=editor.dom,body=editor.getBody(),viewport=editor.dom.getViewPort(editor.getWin()),scrollTop=viewport.y,top=20;if(lastRng=editor.selection.getRng(),editor.inline&&(scrollContainer=editor.selection.getScrollContainer(),scrollContainer&&scrollContainer.scrollTop>0&&(scrollTop=scrollContainer.scrollTop)),lastRng.getClientRects){var rect=getCaretRect(lastRng);if(rect)top=scrollTop+(rect.top-dom.getPos(body).y);else{top=scrollTop;var container=lastRng.startContainer;container&&(3==container.nodeType&&container.parentNode!=body&&(container=container.parentNode),1==container.nodeType&&(top=dom.getPos(container,scrollContainer||body).y))}}pasteBinElm=dom.add(editor.getBody(),"div",{id:"mcepastebin",contentEditable:!0,"data-mce-bogus":"all",style:"position: absolute; top: "+top+"px;width: 10px; height: 10px; overflow: hidden; opacity: 0"},pasteBinDefaultContent),(Env.ie||Env.gecko)&&dom.setStyle(pasteBinElm,"left","rtl"==dom.getStyle(body,"direction",!0)?65535:-65535),dom.bind(pasteBinElm,"beforedeactivate focusin focusout",function(e){e.stopPropagation()}),pasteBinElm.focus(),editor.selection.select(pasteBinElm,!0)}function removePasteBin(){if(pasteBinElm){for(var pasteBinClone;pasteBinClone=editor.dom.get("mcepastebin");)editor.dom.remove(pasteBinClone),editor.dom.unbind(pasteBinClone);lastRng&&editor.selection.setRng(lastRng)}pasteBinElm=lastRng=null}function getPasteBinHtml(){var pasteBinClones,i,clone,cloneHtml,html="";for(pasteBinClones=editor.dom.select("div[id=mcepastebin]"),i=0;i<pasteBinClones.length;i++)clone=pasteBinClones[i],clone.firstChild&&"mcepastebin"==clone.firstChild.id&&(clone=clone.firstChild),cloneHtml=clone.innerHTML,html!=pasteBinDefaultContent&&(html+=cloneHtml);return html}function getDataTransferItems(dataTransfer){var items={};if(dataTransfer){if(dataTransfer.getData){var legacyText=dataTransfer.getData("Text");legacyText&&legacyText.length>0&&legacyText.indexOf(mceInternalUrlPrefix)==-1&&(items["text/plain"]=legacyText)}if(dataTransfer.types)for(var i=0;i<dataTransfer.types.length;i++){var contentType=dataTransfer.types[i];items[contentType]=dataTransfer.getData(contentType)}}return items}function getClipboardContent(clipboardEvent){return getDataTransferItems(clipboardEvent.clipboardData||editor.getDoc().dataTransfer)}function hasHtmlOrText(content){return hasContentType(content,"text/html")||hasContentType(content,"text/plain")}function pasteImageData(e,rng){function getBase64FromUri(uri){var idx;return idx=uri.indexOf(","),idx!==-1?uri.substr(idx+1):null}function processItems(items){function pasteImage(reader,blob){rng&&(editor.selection.setRng(rng),rng=null);var blobCache=editor.editorUpload.blobCache,blobInfo=blobCache.create(uniqueId(),blob,getBase64FromUri(reader.result));blobCache.add(blobInfo),pasteHtml('<img src="'+blobInfo.blobUri()+'">')}var i,item,reader,hadImage=!1;if(items)for(i=0;i<items.length;i++)if(item=items[i],/^image\/(jpeg|png|gif|bmp)$/.test(item.type)){var blob=item.getAsFile?item.getAsFile():item;reader=new FileReader,reader.onload=pasteImage.bind(null,reader,blob),reader.readAsDataURL(blob),e.preventDefault(),hadImage=!0}return hadImage}var dataTransfer=e.clipboardData||e.dataTransfer;if(editor.settings.paste_data_images&&dataTransfer)return processItems(dataTransfer.items)||processItems(dataTransfer.files)}function isBrokenAndroidClipboardEvent(e){var clipboardData=e.clipboardData;return navigator.userAgent.indexOf("Android")!=-1&&clipboardData&&clipboardData.items&&0===clipboardData.items.length}function getCaretRangeFromEvent(e){return RangeUtils.getCaretRangeFromPoint(e.clientX,e.clientY,editor.getDoc())}function hasContentType(clipboardContent,mimeType){return mimeType in clipboardContent&&clipboardContent[mimeType].length>0}function isKeyboardPasteEvent(e){return VK.metaKeyPressed(e)&&86==e.keyCode||e.shiftKey&&45==e.keyCode}function registerEventHandlers(){function insertClipboardContent(clipboardContent,isKeyBoardPaste,plainTextMode){var content;return hasContentType(clipboardContent,"text/html")?content=clipboardContent["text/html"]:(content=getPasteBinHtml(),content==pasteBinDefaultContent&&(plainTextMode=!0)),content=Utils.trimHtml(content),pasteBinElm&&pasteBinElm.firstChild&&"mcepastebin"===pasteBinElm.firstChild.id&&(plainTextMode=!0),removePasteBin(),content.length||(plainTextMode=!0),plainTextMode&&(content=hasContentType(clipboardContent,"text/plain")&&content.indexOf("</p>")==-1?clipboardContent["text/plain"]:Utils.innerText(content)),content==pasteBinDefaultContent?void(isKeyBoardPaste||editor.windowManager.alert("Please use Ctrl+V/Cmd+V keyboard shortcuts to paste contents.")):void(plainTextMode?pasteText(content):pasteHtml(content))}function isPlainTextFileUrl(content){return 0===content["text/plain"].indexOf("file://")}editor.on("keydown",function(e){function removePasteBinOnKeyUp(e){isKeyboardPasteEvent(e)&&!e.isDefaultPrevented()&&removePasteBin()}if(isKeyboardPasteEvent(e)&&!e.isDefaultPrevented()){if(keyboardPastePlainTextState=e.shiftKey&&86==e.keyCode,keyboardPastePlainTextState&&Env.webkit&&navigator.userAgent.indexOf("Version/")!=-1)return;if(e.stopImmediatePropagation(),keyboardPasteTimeStamp=(new Date).getTime(),Env.ie&&keyboardPastePlainTextState)return e.preventDefault(),void editor.fire("paste",{ieFake:!0});removePasteBin(),createPasteBin(),editor.once("keyup",removePasteBinOnKeyUp),editor.once("paste",function(){editor.off("keyup",removePasteBinOnKeyUp)})}});var getLastRng=function(){return lastRng||editor.selection.getRng()};editor.on("paste",function(e){var clipboardTimer=(new Date).getTime(),clipboardContent=getClipboardContent(e),clipboardDelay=(new Date).getTime()-clipboardTimer,isKeyBoardPaste=(new Date).getTime()-keyboardPasteTimeStamp-clipboardDelay<1e3,plainTextMode="text"==self.pasteFormat||keyboardPastePlainTextState;return keyboardPastePlainTextState=!1,e.isDefaultPrevented()||isBrokenAndroidClipboardEvent(e)?void removePasteBin():!hasHtmlOrText(clipboardContent)&&pasteImageData(e,getLastRng())?void removePasteBin():(isKeyBoardPaste||e.preventDefault(),!Env.ie||isKeyBoardPaste&&!e.ieFake||(createPasteBin(),editor.dom.bind(pasteBinElm,"paste",function(e){e.stopPropagation()}),editor.getDoc().execCommand("Paste",!1,null),clipboardContent["text/html"]=getPasteBinHtml()),void(hasContentType(clipboardContent,"text/html")?(e.preventDefault(),insertClipboardContent(clipboardContent,isKeyBoardPaste,plainTextMode)):Delay.setEditorTimeout(editor,function(){insertClipboardContent(clipboardContent,isKeyBoardPaste,plainTextMode)},0)))}),editor.on("dragstart dragend",function(e){draggingInternally="dragstart"==e.type}),editor.on("drop",function(e){var dropContent,rng;if(rng=getCaretRangeFromEvent(e),!e.isDefaultPrevented()&&!draggingInternally&&(dropContent=getDataTransferItems(e.dataTransfer),(hasHtmlOrText(dropContent)&&!isPlainTextFileUrl(dropContent)||!pasteImageData(e,rng))&&rng&&editor.settings.paste_filter_drop!==!1)){var content=dropContent["mce-internal"]||dropContent["text/html"]||dropContent["text/plain"];content&&(e.preventDefault(),Delay.setEditorTimeout(editor,function(){editor.undoManager.transact(function(){dropContent["mce-internal"]&&editor.execCommand("Delete"),editor.selection.setRng(rng),content=Utils.trimHtml(content),dropContent["text/html"]?pasteHtml(content):pasteText(content)})}))}}),editor.on("dragover dragend",function(e){editor.settings.paste_data_images&&e.preventDefault()})}var pasteBinElm,lastRng,keyboardPastePlainTextState,self=this,keyboardPasteTimeStamp=0,draggingInternally=!1,pasteBinDefaultContent="%MCEPASTEBIN%",mceInternalUrlPrefix="data:text/mce-internal,",uniqueId=Utils.createIdGenerator("mceclip");self.pasteHtml=pasteHtml,self.pasteText=pasteText,editor.on("preInit",function(){registerEventHandlers(),editor.parser.addNodeFilter("img",function(nodes,name,args){function isPasteInsert(args){return args.data&&args.data.paste===!0}function remove(node){node.attr("data-mce-object")||src===Env.transparentSrc||node.remove()}function isWebKitFakeUrl(src){return 0===src.indexOf("webkit-fake-url")}function isDataUri(src){return 0===src.indexOf("data:")}if(!editor.settings.paste_data_images&&isPasteInsert(args))for(var i=nodes.length;i--;){var src=nodes[i].attributes.map.src;src&&(isWebKitFakeUrl(src)?remove(nodes[i]):!editor.settings.allow_html_data_urls&&isDataUri(src)&&remove(nodes[i]))}})})}}),define("tinymce/pasteplugin/WordFilter",["tinymce/util/Tools","tinymce/html/DomParser","tinymce/html/Schema","tinymce/html/Serializer","tinymce/html/Node","tinymce/pasteplugin/Utils"],function(Tools,DomParser,Schema,Serializer,Node,Utils){function isWordContent(content){return/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(content)||/class="OutlineElement/.test(content)||/id="?docs\-internal\-guid\-/.test(content)}function isNumericList(text){var found,patterns;return patterns=[/^[IVXLMCD]{1,2}\.[ \u00a0]/,/^[ivxlmcd]{1,2}\.[ \u00a0]/,/^[a-z]{1,2}[\.\)][ \u00a0]/,/^[A-Z]{1,2}[\.\)][ \u00a0]/,/^[0-9]+\.[ \u00a0]/,/^[\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d]+\.[ \u00a0]/,/^[\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe]+\.[ \u00a0]/],text=text.replace(/^[\u00a0 ]+/,""),Tools.each(patterns,function(pattern){if(pattern.test(text))return found=!0,!1}),found}function isBulletList(text){return/^[\s\u00a0]*[\u2022\u00b7\u00a7\u25CF]\s*/.test(text)}function WordFilter(editor){var settings=editor.settings;editor.on("BeforePastePreProcess",function(e){function convertFakeListsToProperLists(node){function getText(node){var txt="";if(3===node.type)return node.value;if(node=node.firstChild)do txt+=getText(node);while(node=node.next);return txt}function trimListStart(node,regExp){if(3===node.type&&regExp.test(node.value))return node.value=node.value.replace(regExp,""),!1;if(node=node.firstChild)do if(!trimListStart(node,regExp))return!1;while(node=node.next);return!0}function removeIgnoredNodes(node){if(node._listIgnore)return void node.remove();if(node=node.firstChild)do removeIgnoredNodes(node);while(node=node.next)}function convertParagraphToLi(paragraphNode,listName,start){var level=paragraphNode._listLevel||lastLevel;level!=lastLevel&&(level<lastLevel?currentListNode&&(currentListNode=currentListNode.parent.parent):(prevListNode=currentListNode,currentListNode=null)),currentListNode&&currentListNode.name==listName?currentListNode.append(paragraphNode):(prevListNode=prevListNode||currentListNode,currentListNode=new Node(listName,1),start>1&&currentListNode.attr("start",""+start),paragraphNode.wrap(currentListNode)),paragraphNode.name="li",level>lastLevel&&prevListNode&&prevListNode.lastChild.append(currentListNode),lastLevel=level,removeIgnoredNodes(paragraphNode),trimListStart(paragraphNode,/^\u00a0+/),trimListStart(paragraphNode,/^\s*([\u2022\u00b7\u00a7\u25CF]|\w+\.)/),trimListStart(paragraphNode,/^\u00a0+/)}for(var currentListNode,prevListNode,lastLevel=1,elements=[],child=node.firstChild;"undefined"!=typeof child&&null!==child;)if(elements.push(child),child=child.walk(),null!==child)for(;"undefined"!=typeof child&&child.parent!==node;)child=child.walk();for(var i=0;i<elements.length;i++)if(node=elements[i],"p"==node.name&&node.firstChild){var nodeText=getText(node);if(isBulletList(nodeText)){convertParagraphToLi(node,"ul");continue}if(isNumericList(nodeText)){var matches=/([0-9]+)\./.exec(nodeText),start=1;matches&&(start=parseInt(matches[1],10)),convertParagraphToLi(node,"ol",start);continue}if(node._listLevel){convertParagraphToLi(node,"ul",1);continue}currentListNode=null}else prevListNode=currentListNode,currentListNode=null}function filterStyles(node,styleValue){var matches,outputStyles={},styles=editor.dom.parseStyle(styleValue);return Tools.each(styles,function(value,name){switch(name){case"mso-list":matches=/\w+ \w+([0-9]+)/i.exec(styleValue),matches&&(node._listLevel=parseInt(matches[1],10)),/Ignore/i.test(value)&&node.firstChild&&(node._listIgnore=!0,node.firstChild._listIgnore=!0);break;case"horiz-align":name="text-align";break;case"vert-align":name="vertical-align";break;case"font-color":case"mso-foreground":name="color";break;case"mso-background":case"mso-highlight":name="background";break;case"font-weight":case"font-style":return void("normal"!=value&&(outputStyles[name]=value));case"mso-element":if(/^(comment|comment-list)$/i.test(value))return void node.remove()}return 0===name.indexOf("mso-comment")?void node.remove():void(0!==name.indexOf("mso-")&&("all"==retainStyleProperties||validStyles&&validStyles[name])&&(outputStyles[name]=value))}),/(bold)/i.test(outputStyles["font-weight"])&&(delete outputStyles["font-weight"],node.wrap(new Node("b",1))),/(italic)/i.test(outputStyles["font-style"])&&(delete outputStyles["font-style"],node.wrap(new Node("i",1))),outputStyles=editor.dom.serializeStyle(outputStyles,node.name),outputStyles?outputStyles:null}var retainStyleProperties,validStyles,content=e.content;if(content=content.replace(/<b[^>]+id="?docs-internal-[^>]*>/gi,""),content=content.replace(/<br class="?Apple-interchange-newline"?>/gi,""),retainStyleProperties=settings.paste_retain_style_properties,retainStyleProperties&&(validStyles=Tools.makeMap(retainStyleProperties.split(/[, ]/))),settings.paste_enable_default_filters!==!1&&isWordContent(e.content)){e.wordContent=!0,content=Utils.filter(content,[/<!--[\s\S]+?-->/gi,/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,[/<(\/?)s>/gi,"<$1strike>"],[/&nbsp;/gi,""],[/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(str,spaces){return spaces.length>0?spaces.replace(/./," ").slice(Math.floor(spaces.length/2)).split("").join(""):""}]]);var validElements=settings.paste_word_valid_elements;validElements||(validElements="-strong/b,-em/i,-u,-span,-p,-ol,-ul,-li,-h1,-h2,-h3,-h4,-h5,-h6,-p/div,-a[href|name],sub,sup,strike,br,del,table[width],tr,td[colspan|rowspan|width],th[colspan|rowspan|width],thead,tfoot,tbody");var schema=new Schema({valid_elements:validElements,valid_children:"-li[p]"});Tools.each(schema.elements,function(rule){rule.attributes["class"]||(rule.attributes["class"]={},rule.attributesOrder.push("class")),rule.attributes.style||(rule.attributes.style={},rule.attributesOrder.push("style"))});var domParser=new DomParser({},schema);domParser.addAttributeFilter("style",function(nodes){for(var node,i=nodes.length;i--;)node=nodes[i],node.attr("style",filterStyles(node,node.attr("style"))),"span"==node.name&&node.parent&&!node.attributes.length&&node.unwrap()}),domParser.addAttributeFilter("class",function(nodes){for(var node,className,i=nodes.length;i--;)node=nodes[i],className=node.attr("class"),/^(MsoCommentReference|MsoCommentText|msoDel)$/i.test(className)&&node.remove(),node.attr("class",null)}),domParser.addNodeFilter("del",function(nodes){for(var i=nodes.length;i--;)nodes[i].remove()}),domParser.addNodeFilter("a",function(nodes){for(var node,href,name,i=nodes.length;i--;)if(node=nodes[i],href=node.attr("href"),name=node.attr("name"),href&&href.indexOf("#_msocom_")!=-1)node.remove();else if(href&&0===href.indexOf("file://")&&(href=href.split("#")[1],href&&(href="#"+href)),href||name){if(name&&!/^_?(?:toc|edn|ftn)/i.test(name)){node.unwrap();continue}node.attr({href:href,name:name})}else node.unwrap()});var rootNode=domParser.parse(content);settings.paste_convert_word_fake_lists!==!1&&convertFakeListsToProperLists(rootNode),e.content=new Serializer({validate:settings.validate},schema).serialize(rootNode)}})}return WordFilter.isWordContent=isWordContent,WordFilter}),define("tinymce/pasteplugin/Quirks",["tinymce/Env","tinymce/util/Tools","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Utils"],function(Env,Tools,WordFilter,Utils){return function(editor){function addPreProcessFilter(filterFunc){editor.on("BeforePastePreProcess",function(e){e.content=filterFunc(e.content)})}function removeExplorerBrElementsAfterBlocks(html){if(!WordFilter.isWordContent(html))return html;var blockElements=[];Tools.each(editor.schema.getBlockElements(),function(block,blockName){blockElements.push(blockName)});var explorerBlocksRegExp=new RegExp("(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*(<\\/?("+blockElements.join("|")+")[^>]*>)(?:<br>&nbsp;[\\s\\r\\n]+|<br>)*","g");return html=Utils.filter(html,[[explorerBlocksRegExp,"$1"]]),html=Utils.filter(html,[[/<br><br>/g,"<BR><BR>"],[/<br>/g," "],[/<BR><BR>/g,"<br>"]])}function removeWebKitStyles(content){if(WordFilter.isWordContent(content))return content;var webKitStyles=editor.settings.paste_webkit_styles;if(editor.settings.paste_remove_styles_if_webkit===!1||"all"==webKitStyles)return content;if(webKitStyles&&(webKitStyles=webKitStyles.split(/[, ]/)),webKitStyles){var dom=editor.dom,node=editor.selection.getNode();content=content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,function(all,before,value,after){var inputStyles=dom.parseStyle(value,"span"),outputStyles={};if("none"===webKitStyles)return before+after;for(var i=0;i<webKitStyles.length;i++){var inputValue=inputStyles[webKitStyles[i]],currentValue=dom.getStyle(node,webKitStyles[i],!0);/color/.test(webKitStyles[i])&&(inputValue=dom.toHex(inputValue),currentValue=dom.toHex(currentValue)),currentValue!=inputValue&&(outputStyles[webKitStyles[i]]=inputValue)}return outputStyles=dom.serializeStyle(outputStyles,"span"),outputStyles?before+' style="'+outputStyles+'"'+after:before+after})}else content=content.replace(/(<[^>]+) style="([^"]*)"([^>]*>)/gi,"$1$3");return content=content.replace(/(<[^>]+) data-mce-style="([^"]+)"([^>]*>)/gi,function(all,before,value,after){return before+' style="'+value+'"'+after})}Env.webkit&&addPreProcessFilter(removeWebKitStyles),Env.ie&&addPreProcessFilter(removeExplorerBrElementsAfterBlocks)}}),define("tinymce/pasteplugin/Plugin",["tinymce/PluginManager","tinymce/pasteplugin/Clipboard","tinymce/pasteplugin/WordFilter","tinymce/pasteplugin/Quirks"],function(PluginManager,Clipboard,WordFilter,Quirks){var userIsInformed;PluginManager.add("paste",function(editor){function isUserInformedAboutPlainText(){
return userIsInformed||editor.settings.paste_plaintext_inform===!1}function togglePlainTextPaste(){if("text"==clipboard.pasteFormat)this.active(!1),clipboard.pasteFormat="html",editor.fire("PastePlainTextToggle",{state:!1});else if(clipboard.pasteFormat="text",this.active(!0),!isUserInformedAboutPlainText()){var message=editor.translate("Paste is now in plain text mode. Contents will now be pasted as plain text until you toggle this option off.");editor.notificationManager.open({text:message,type:"info"}),userIsInformed=!0,editor.fire("PastePlainTextToggle",{state:!0})}editor.focus()}var clipboard,self=this,settings=editor.settings;self.clipboard=clipboard=new Clipboard(editor),self.quirks=new Quirks(editor),self.wordFilter=new WordFilter(editor),editor.settings.paste_as_text&&(self.clipboard.pasteFormat="text"),settings.paste_preprocess&&editor.on("PastePreProcess",function(e){settings.paste_preprocess.call(self,self,e)}),settings.paste_postprocess&&editor.on("PastePostProcess",function(e){settings.paste_postprocess.call(self,self,e)}),editor.addCommand("mceInsertClipboardContent",function(ui,value){value.content&&self.clipboard.pasteHtml(value.content),value.text&&self.clipboard.pasteText(value.text)}),editor.settings.paste_block_drop&&editor.on("dragend dragover draggesture dragdrop drop drag",function(e){e.preventDefault(),e.stopPropagation()}),editor.settings.paste_data_images||editor.on("drop",function(e){var dataTransfer=e.dataTransfer;dataTransfer&&dataTransfer.files&&dataTransfer.files.length>0&&e.preventDefault()}),editor.addButton("pastetext",{icon:"pastetext",tooltip:"Paste as text",onclick:togglePlainTextPaste,active:"text"==self.clipboard.pasteFormat}),editor.addMenuItem("pastetext",{text:"Paste as text",selectable:!0,active:clipboard.pasteFormat,onclick:togglePlainTextPaste})})}),expose(["tinymce/pasteplugin/Utils"])}(this)}.apply(root,arguments)})}(this),function(root){define("tinymce-preview",["tinymce"],function(){return function(){tinymce.PluginManager.add("preview",function(editor){var settings=editor.settings,sandbox=!tinymce.Env.ie;editor.addCommand("mcePreview",function(){editor.windowManager.open({title:"Preview",width:parseInt(editor.getParam("plugin_preview_width","650"),10),height:parseInt(editor.getParam("plugin_preview_height","500"),10),html:'<iframe src="javascript:\'\'" frameborder="0"'+(sandbox?' sandbox="allow-scripts"':"")+"></iframe>",buttons:{text:"Close",onclick:function(){this.parent().parent().close()}},onPostRender:function(){var previewHtml,headHtml="";headHtml+='<base href="'+editor.documentBaseURI.getURI()+'">',tinymce.each(editor.contentCSS,function(url){headHtml+='<link type="text/css" rel="stylesheet" href="'+editor.documentBaseURI.toAbsolute(url)+'">'});var bodyId=settings.body_id||"tinymce";bodyId.indexOf("=")!=-1&&(bodyId=editor.getParam("body_id","","hash"),bodyId=bodyId[editor.id]||bodyId);var bodyClass=settings.body_class||"";bodyClass.indexOf("=")!=-1&&(bodyClass=editor.getParam("body_class","","hash"),bodyClass=bodyClass[editor.id]||"");var preventClicksOnLinksScript='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A") {e.preventDefault();}}}, false);</script> ',dirAttr=editor.settings.directionality?' dir="'+editor.settings.directionality+'"':"";if(previewHtml="<!DOCTYPE html><html><head>"+headHtml+'</head><body id="'+bodyId+'" class="mce-content-body '+bodyClass+'"'+dirAttr+">"+editor.getContent()+preventClicksOnLinksScript+"</body></html>",sandbox)this.getEl("body").firstChild.src="data:text/html;charset=utf-8,"+encodeURIComponent(previewHtml);else{var doc=this.getEl("body").firstChild.contentWindow.document;doc.open(),doc.write(previewHtml),doc.close()}}})}),editor.addButton("preview",{title:"Preview",cmd:"mcePreview"}),editor.addMenuItem("preview",{text:"Preview",cmd:"mcePreview",context:"view"})})}.apply(root,arguments)})}(this),function(root){define("tinymce-print",["tinymce"],function(){return function(){tinymce.PluginManager.add("print",function(editor){editor.addCommand("mcePrint",function(){editor.getWin().print()}),editor.addButton("print",{title:"Print",cmd:"mcePrint"}),editor.addShortcut("Meta+P","","mcePrint"),editor.addMenuItem("print",{text:"Print",cmd:"mcePrint",icon:"print",shortcut:"Meta+P",context:"file"})})}.apply(root,arguments)})}(this),function(root){define("tinymce-save",["tinymce"],function(){return function(){tinymce.PluginManager.add("save",function(editor){function save(){var formObj;if(formObj=tinymce.DOM.getParent(editor.id,"form"),!editor.getParam("save_enablewhendirty",!0)||editor.isDirty())return tinymce.triggerSave(),editor.getParam("save_onsavecallback")?(editor.execCallback("save_onsavecallback",editor),void editor.nodeChanged()):void(formObj?(editor.setDirty(!1),formObj.onsubmit&&!formObj.onsubmit()||("function"==typeof formObj.submit?formObj.submit():displayErrorMessage(editor.translate("Error: Form submit field collision."))),editor.nodeChanged()):displayErrorMessage(editor.translate("Error: No form element found.")))}function displayErrorMessage(message){editor.notificationManager.open({text:message,type:"error"})}function cancel(){var h=tinymce.trim(editor.startContent);return editor.getParam("save_oncancelcallback")?void editor.execCallback("save_oncancelcallback",editor):(editor.setContent(h),editor.undoManager.clear(),void editor.nodeChanged())}function stateToggle(){var self=this;editor.on("nodeChange dirty",function(){self.disabled(editor.getParam("save_enablewhendirty",!0)&&!editor.isDirty())})}editor.addCommand("mceSave",save),editor.addCommand("mceCancel",cancel),editor.addButton("save",{icon:"save",text:"Save",cmd:"mceSave",disabled:!0,onPostRender:stateToggle}),editor.addButton("cancel",{text:"Cancel",icon:!1,cmd:"mceCancel",disabled:!0,onPostRender:stateToggle}),editor.addShortcut("Meta+S","","mceSave")})}.apply(root,arguments)})}(this),function(root){define("tinymce-searchreplace",["tinymce"],function(){return function(){!function(){function isContentEditableFalse(node){return node&&1==node.nodeType&&"false"===node.contentEditable}function findAndReplaceDOMText(regex,node,replacementNode,captureGroup,schema){function getMatchIndexes(m,captureGroup){if(captureGroup=captureGroup||0,!m[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var index=m.index;if(captureGroup>0){var cg=m[captureGroup];if(!cg)throw"Invalid capture group";index+=m[0].indexOf(cg),m[0]=cg}return[index,index+m[0].length,[m[0]]]}function getText(node){var txt;if(3===node.nodeType)return node.data;if(hiddenTextElementsMap[node.nodeName]&&!blockElementsMap[node.nodeName])return"";if(txt="",isContentEditableFalse(node))return"\n";if((blockElementsMap[node.nodeName]||shortEndedElementsMap[node.nodeName])&&(txt+="\n"),node=node.firstChild)do txt+=getText(node);while(node=node.nextSibling);return txt}function stepThroughMatches(node,matches,replaceFn){var startNode,endNode,startNodeIndex,endNodeIndex,innerNodes=[],atIndex=0,curNode=node,matchLocation=matches.shift(),matchIndex=0;out:for(;;){if((blockElementsMap[curNode.nodeName]||shortEndedElementsMap[curNode.nodeName]||isContentEditableFalse(curNode))&&atIndex++,3===curNode.nodeType&&(!endNode&&curNode.length+atIndex>=matchLocation[1]?(endNode=curNode,endNodeIndex=matchLocation[1]-atIndex):startNode&&innerNodes.push(curNode),!startNode&&curNode.length+atIndex>matchLocation[0]&&(startNode=curNode,startNodeIndex=matchLocation[0]-atIndex),atIndex+=curNode.length),startNode&&endNode){if(curNode=replaceFn({startNode:startNode,startNodeIndex:startNodeIndex,endNode:endNode,endNodeIndex:endNodeIndex,innerNodes:innerNodes,match:matchLocation[2],matchIndex:matchIndex}),atIndex-=endNode.length-endNodeIndex,startNode=null,endNode=null,innerNodes=[],matchLocation=matches.shift(),matchIndex++,!matchLocation)break}else if(hiddenTextElementsMap[curNode.nodeName]&&!blockElementsMap[curNode.nodeName]||!curNode.firstChild){if(curNode.nextSibling){curNode=curNode.nextSibling;continue}}else if(!isContentEditableFalse(curNode)){curNode=curNode.firstChild;continue}for(;;){if(curNode.nextSibling){curNode=curNode.nextSibling;break}if(curNode.parentNode===node)break out;curNode=curNode.parentNode}}}function genReplacer(nodeName){var makeReplacementNode;if("function"!=typeof nodeName){var stencilNode=nodeName.nodeType?nodeName:doc.createElement(nodeName);makeReplacementNode=function(fill,matchIndex){var clone=stencilNode.cloneNode(!1);return clone.setAttribute("data-mce-index",matchIndex),fill&&clone.appendChild(doc.createTextNode(fill)),clone}}else makeReplacementNode=nodeName;return function(range){var before,after,parentNode,startNode=range.startNode,endNode=range.endNode,matchIndex=range.matchIndex;if(startNode===endNode){var node=startNode;parentNode=node.parentNode,range.startNodeIndex>0&&(before=doc.createTextNode(node.data.substring(0,range.startNodeIndex)),parentNode.insertBefore(before,node));var el=makeReplacementNode(range.match[0],matchIndex);return parentNode.insertBefore(el,node),range.endNodeIndex<node.length&&(after=doc.createTextNode(node.data.substring(range.endNodeIndex)),parentNode.insertBefore(after,node)),node.parentNode.removeChild(node),el}before=doc.createTextNode(startNode.data.substring(0,range.startNodeIndex)),after=doc.createTextNode(endNode.data.substring(range.endNodeIndex));for(var elA=makeReplacementNode(startNode.data.substring(range.startNodeIndex),matchIndex),innerEls=[],i=0,l=range.innerNodes.length;i<l;++i){var innerNode=range.innerNodes[i],innerEl=makeReplacementNode(innerNode.data,matchIndex);innerNode.parentNode.replaceChild(innerEl,innerNode),innerEls.push(innerEl)}var elB=makeReplacementNode(endNode.data.substring(0,range.endNodeIndex),matchIndex);return parentNode=startNode.parentNode,parentNode.insertBefore(before,startNode),parentNode.insertBefore(elA,startNode),parentNode.removeChild(startNode),parentNode=endNode.parentNode,parentNode.insertBefore(elB,endNode),parentNode.insertBefore(after,endNode),parentNode.removeChild(endNode),elB}}var m,text,doc,blockElementsMap,hiddenTextElementsMap,shortEndedElementsMap,matches=[],count=0;if(doc=node.ownerDocument,blockElementsMap=schema.getBlockElements(),hiddenTextElementsMap=schema.getWhiteSpaceElements(),shortEndedElementsMap=schema.getShortEndedElements(),text=getText(node)){if(regex.global)for(;m=regex.exec(text);)matches.push(getMatchIndexes(m,captureGroup));else m=text.match(regex),matches.push(getMatchIndexes(m,captureGroup));return matches.length&&(count=matches.length,stepThroughMatches(node,matches,genReplacer(replacementNode))),count}}function Plugin(editor){function showDialog(){function updateButtonStates(){win.statusbar.find("#next").disabled(!findSpansByIndex(currentIndex+1).length),win.statusbar.find("#prev").disabled(!findSpansByIndex(currentIndex-1).length)}function notFoundAlert(){editor.windowManager.alert("Could not find the specified string.",function(){win.find("#find")[0].focus()})}var selectedText,last={};selectedText=tinymce.trim(editor.selection.getContent({format:"text"}));var win=editor.windowManager.open({layout:"flex",pack:"center",align:"center",onClose:function(){editor.focus(),self.done()},onSubmit:function(e){var count,caseState,text,wholeWord;return e.preventDefault(),caseState=win.find("#case").checked(),wholeWord=win.find("#words").checked(),text=win.find("#find").value(),text.length?last.text==text&&last.caseState==caseState&&last.wholeWord==wholeWord?0===findSpansByIndex(currentIndex+1).length?void notFoundAlert():(self.next(),void updateButtonStates()):(count=self.find(text,caseState,wholeWord),count||notFoundAlert(),win.statusbar.items().slice(1).disabled(0===count),updateButtonStates(),void(last={text:text,caseState:caseState,wholeWord:wholeWord})):(self.done(!1),void win.statusbar.items().slice(1).disabled(!0))},buttons:[{text:"Find",subtype:"primary",onclick:function(){win.submit()}},{text:"Replace",disabled:!0,onclick:function(){self.replace(win.find("#replace").value())||(win.statusbar.items().slice(1).disabled(!0),currentIndex=-1,last={})}},{text:"Replace all",disabled:!0,onclick:function(){self.replace(win.find("#replace").value(),!0,!0),win.statusbar.items().slice(1).disabled(!0),last={}}},{type:"spacer",flex:1},{text:"Prev",name:"prev",disabled:!0,onclick:function(){self.prev(),updateButtonStates()}},{text:"Next",name:"next",disabled:!0,onclick:function(){self.next(),updateButtonStates()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,items:[{type:"textbox",name:"find",size:40,label:"Find",value:selectedText},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}})}function getElmIndex(elm){var value=elm.getAttribute("data-mce-index");return"number"==typeof value?""+value:value}function markAllMatches(regex){var node,marker;return marker=editor.dom.create("span",{"data-mce-bogus":1}),marker.className="mce-match-marker",node=editor.getBody(),self.done(!1),findAndReplaceDOMText(regex,node,marker,!1,editor.schema)}function unwrap(node){var parentNode=node.parentNode;node.firstChild&&parentNode.insertBefore(node.firstChild,node),node.parentNode.removeChild(node)}function findSpansByIndex(index){var nodes,spans=[];if(nodes=tinymce.toArray(editor.getBody().getElementsByTagName("span")),nodes.length)for(var i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]);null!==nodeIndex&&nodeIndex.length&&nodeIndex===index.toString()&&spans.push(nodes[i])}return spans}function moveSelection(forward){var testIndex=currentIndex,dom=editor.dom;forward=forward!==!1,forward?testIndex++:testIndex--,dom.removeClass(findSpansByIndex(currentIndex),"mce-match-marker-selected");var spans=findSpansByIndex(testIndex);return spans.length?(dom.addClass(findSpansByIndex(testIndex),"mce-match-marker-selected"),editor.selection.scrollIntoView(spans[0]),testIndex):-1}function removeNode(node){var dom=editor.dom,parent=node.parentNode;dom.remove(node),dom.isEmpty(parent)&&dom.remove(parent)}function isMatchSpan(node){var matchIndex=getElmIndex(node);return null!==matchIndex&&matchIndex.length>0}var self=this,currentIndex=-1;self.init=function(ed){ed.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Meta+F",onclick:showDialog,separator:"before",context:"edit"}),ed.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Meta+F",onclick:showDialog}),ed.addCommand("SearchReplace",showDialog),ed.shortcuts.add("Meta+F","",showDialog)},self.find=function(text,matchCase,wholeWord){text=text.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),text=wholeWord?"\\b"+text+"\\b":text;var count=markAllMatches(new RegExp(text,matchCase?"g":"gi"));return count&&(currentIndex=-1,currentIndex=moveSelection(!0)),count},self.next=function(){var index=moveSelection(!0);index!==-1&&(currentIndex=index)},self.prev=function(){var index=moveSelection(!1);index!==-1&&(currentIndex=index)},self.replace=function(text,forward,all){var i,nodes,node,matchIndex,currentMatchIndex,hasMore,nextIndex=currentIndex;for(forward=forward!==!1,node=editor.getBody(),nodes=tinymce.grep(tinymce.toArray(node.getElementsByTagName("span")),isMatchSpan),i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]);if(matchIndex=currentMatchIndex=parseInt(nodeIndex,10),all||matchIndex===currentIndex){for(text.length?(nodes[i].firstChild.nodeValue=text,unwrap(nodes[i])):removeNode(nodes[i]);nodes[++i];){if(matchIndex=parseInt(getElmIndex(nodes[i]),10),matchIndex!==currentMatchIndex){i--;break}removeNode(nodes[i])}forward&&nextIndex--}else currentMatchIndex>currentIndex&&nodes[i].setAttribute("data-mce-index",currentMatchIndex-1)}return editor.undoManager.add(),currentIndex=nextIndex,forward?(hasMore=findSpansByIndex(nextIndex+1).length>0,self.next()):(hasMore=findSpansByIndex(nextIndex-1).length>0,self.prev()),!all&&hasMore},self.done=function(keepEditorSelection){var i,nodes,startContainer,endContainer;for(nodes=tinymce.toArray(editor.getBody().getElementsByTagName("span")),i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]);null!==nodeIndex&&nodeIndex.length&&(nodeIndex===currentIndex.toString()&&(startContainer||(startContainer=nodes[i].firstChild),endContainer=nodes[i].firstChild),unwrap(nodes[i]))}if(startContainer&&endContainer){var rng=editor.dom.createRng();return rng.setStart(startContainer,0),rng.setEnd(endContainer,endContainer.data.length),keepEditorSelection!==!1&&editor.selection.setRng(rng),rng}}}tinymce.PluginManager.add("searchreplace",Plugin)}()}.apply(root,arguments)})}(this),function(root){define("tinymce-spellchecker",["tinymce"],function(){return function(){!function(exports,undefined){"use strict";function require(ids,callback){for(var module,defs=[],i=0;i<ids.length;++i){if(module=modules[ids[i]]||resolve(ids[i]),!module)throw"module definition dependecy not found: "+ids[i];defs.push(module)}callback.apply(null,defs)}function define(id,dependencies,definition){if("string"!=typeof id)throw"invalid module definition, module id must be defined and be a string";if(dependencies===undefined)throw"invalid module definition, dependencies must be specified";if(definition===undefined)throw"invalid module definition, definition function must be specified";require(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function resolve(id){for(var target=exports,fragments=id.split(/[.\/]/),fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]])return;target=target[fragments[fi]]}return target}function expose(ids){var i,target,id,fragments,privateModules;for(i=0;i<ids.length;i++){target=exports,id=ids[i],fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length-1;++fi)target[fragments[fi]]===undefined&&(target[fragments[fi]]={}),target=target[fragments[fi]];target[fragments[fragments.length-1]]=modules[id]}if(exports.AMDLC_TESTS){privateModules=exports.privateModules||{};for(id in modules)privateModules[id]=modules[id];for(i=0;i<ids.length;i++)delete privateModules[ids[i]];exports.privateModules=privateModules}}var modules={};define("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){function isContentEditableFalse(node){return node&&1==node.nodeType&&"false"===node.contentEditable}return function(node,editor){function createMatch(m,data){if(!m[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:m.index,end:m.index+m[0].length,text:m[0],data:data}}function getText(node){var txt;if(3===node.nodeType)return node.data;if(hiddenTextElementsMap[node.nodeName]&&!blockElementsMap[node.nodeName])return"";if(isContentEditableFalse(node))return"\n";if(txt="",(blockElementsMap[node.nodeName]||shortEndedElementsMap[node.nodeName])&&(txt+="\n"),node=node.firstChild)do txt+=getText(node);while(node=node.nextSibling);return txt}function stepThroughMatches(node,matches,replaceFn){var startNode,endNode,startNodeIndex,endNodeIndex,matchLocation,innerNodes=[],atIndex=0,curNode=node,matchIndex=0;matches=matches.slice(0),matches.sort(function(a,b){return a.start-b.start}),matchLocation=matches.shift();out:for(;;){if((blockElementsMap[curNode.nodeName]||shortEndedElementsMap[curNode.nodeName]||isContentEditableFalse(curNode))&&atIndex++,3===curNode.nodeType&&(!endNode&&curNode.length+atIndex>=matchLocation.end?(endNode=curNode,endNodeIndex=matchLocation.end-atIndex):startNode&&innerNodes.push(curNode),!startNode&&curNode.length+atIndex>matchLocation.start&&(startNode=curNode,startNodeIndex=matchLocation.start-atIndex),atIndex+=curNode.length),startNode&&endNode){if(curNode=replaceFn({startNode:startNode,startNodeIndex:startNodeIndex,endNode:endNode,endNodeIndex:endNodeIndex,innerNodes:innerNodes,match:matchLocation.text,matchIndex:matchIndex}),atIndex-=endNode.length-endNodeIndex,startNode=null,endNode=null,innerNodes=[],matchLocation=matches.shift(),matchIndex++,!matchLocation)break}else if(hiddenTextElementsMap[curNode.nodeName]&&!blockElementsMap[curNode.nodeName]||!curNode.firstChild){if(curNode.nextSibling){curNode=curNode.nextSibling;continue}}else if(!isContentEditableFalse(curNode)){curNode=curNode.firstChild;continue}for(;;){if(curNode.nextSibling){curNode=curNode.nextSibling;break}if(curNode.parentNode===node)break out;curNode=curNode.parentNode}}}function genReplacer(callback){function makeReplacementNode(fill,matchIndex){var match=matches[matchIndex];match.stencil||(match.stencil=callback(match));var clone=match.stencil.cloneNode(!1);return clone.setAttribute("data-mce-index",matchIndex),fill&&clone.appendChild(dom.doc.createTextNode(fill)),clone}return function(range){var before,after,parentNode,startNode=range.startNode,endNode=range.endNode,matchIndex=range.matchIndex,doc=dom.doc;if(startNode===endNode){var node=startNode;parentNode=node.parentNode,range.startNodeIndex>0&&(before=doc.createTextNode(node.data.substring(0,range.startNodeIndex)),parentNode.insertBefore(before,node));var el=makeReplacementNode(range.match,matchIndex);return parentNode.insertBefore(el,node),range.endNodeIndex<node.length&&(after=doc.createTextNode(node.data.substring(range.endNodeIndex)),parentNode.insertBefore(after,node)),node.parentNode.removeChild(node),el}before=doc.createTextNode(startNode.data.substring(0,range.startNodeIndex)),after=doc.createTextNode(endNode.data.substring(range.endNodeIndex));for(var elA=makeReplacementNode(startNode.data.substring(range.startNodeIndex),matchIndex),innerEls=[],i=0,l=range.innerNodes.length;i<l;++i){var innerNode=range.innerNodes[i],innerEl=makeReplacementNode(innerNode.data,matchIndex);innerNode.parentNode.replaceChild(innerEl,innerNode),innerEls.push(innerEl)}var elB=makeReplacementNode(endNode.data.substring(0,range.endNodeIndex),matchIndex);return parentNode=startNode.parentNode,parentNode.insertBefore(before,startNode),parentNode.insertBefore(elA,startNode),parentNode.removeChild(startNode),parentNode=endNode.parentNode,parentNode.insertBefore(elB,endNode),parentNode.insertBefore(after,endNode),parentNode.removeChild(endNode),elB}}function unwrapElement(element){var parentNode=element.parentNode;parentNode.insertBefore(element.firstChild,element),element.parentNode.removeChild(element)}function getWrappersByIndex(index){var elements=node.getElementsByTagName("*"),wrappers=[];index="number"==typeof index?""+index:null;for(var i=0;i<elements.length;i++){var element=elements[i],dataIndex=element.getAttribute("data-mce-index");null!==dataIndex&&dataIndex.length&&(dataIndex!==index&&null!==index||wrappers.push(element))}return wrappers}function indexOf(match){for(var i=matches.length;i--;)if(matches[i]===match)return i;return-1}function filter(callback){var filteredMatches=[];return each(function(match,i){callback(match,i)&&filteredMatches.push(match)}),matches=filteredMatches,this}function each(callback){for(var i=0,l=matches.length;i<l&&callback(matches[i],i)!==!1;i++);return this}function wrap(callback){return matches.length&&stepThroughMatches(node,matches,genReplacer(callback)),this}function find(regex,data){if(text&&regex.global)for(;m=regex.exec(text);)matches.push(createMatch(m,data));return this}function unwrap(match){var i,elements=getWrappersByIndex(match?indexOf(match):null);for(i=elements.length;i--;)unwrapElement(elements[i]);return this}function matchFromElement(element){return matches[element.getAttribute("data-mce-index")]}function elementFromMatch(match){return getWrappersByIndex(indexOf(match))[0]}function add(start,length,data){return matches.push({start:start,end:start+length,text:text.substr(start,length),data:data}),this}function rangeFromMatch(match){var wrappers=getWrappersByIndex(indexOf(match)),rng=editor.dom.createRng();return rng.setStartBefore(wrappers[0]),rng.setEndAfter(wrappers[wrappers.length-1]),rng}function replace(match,text){var rng=rangeFromMatch(match);return rng.deleteContents(),text.length>0&&rng.insertNode(editor.dom.doc.createTextNode(text)),rng}function reset(){return matches.splice(0,matches.length),unwrap(),this}var m,text,blockElementsMap,hiddenTextElementsMap,shortEndedElementsMap,matches=[],dom=editor.dom;return blockElementsMap=editor.schema.getBlockElements(),hiddenTextElementsMap=editor.schema.getWhiteSpaceElements(),shortEndedElementsMap=editor.schema.getShortEndedElements(),text=getText(node),{text:text,matches:matches,each:each,filter:filter,reset:reset,matchFromElement:matchFromElement,elementFromMatch:elementFromMatch,find:find,add:add,wrap:wrap,unwrap:unwrap,replace:replace,rangeFromMatch:rangeFromMatch,indexOf:indexOf}}}),define("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(DomTextMatcher,PluginManager,Tools,Menu,DOMUtils,XHR,URI,JSON){PluginManager.add("spellchecker",function(editor,url){function getTextMatcher(){return self.textMatcher||(self.textMatcher=new DomTextMatcher(editor.getBody(),editor)),self.textMatcher}function buildMenuItems(listName,languageValues){var items=[];return Tools.each(languageValues,function(languageValue){items.push({selectable:!0,text:languageValue.name,data:languageValue.value})}),items}function isEmpty(obj){for(var name in obj)return!1;return!0}function showSuggestions(word,spans){var items=[],suggestions=lastSuggestions[word];Tools.each(suggestions,function(suggestion){items.push({text:suggestion,onclick:function(){editor.insertContent(editor.dom.encode(suggestion)),editor.dom.remove(spans),checkIfFinished()}})}),items.push({text:"-"}),hasDictionarySupport&&items.push({text:"Add to Dictionary",onclick:function(){addToDictionary(word,spans)}}),items.push.apply(items,[{text:"Ignore",onclick:function(){ignoreWord(word,spans)}},{text:"Ignore all",onclick:function(){ignoreWord(word,spans,!0)}}]),suggestionsMenu=new Menu({items:items,context:"contextmenu",onautohide:function(e){e.target.className.indexOf("spellchecker")!=-1&&e.preventDefault()},onhide:function(){suggestionsMenu.remove(),suggestionsMenu=null}}),suggestionsMenu.renderTo(document.body);var pos=DOMUtils.DOM.getPos(editor.getContentAreaContainer()),targetPos=editor.dom.getPos(spans[0]),root=editor.dom.getRoot();"BODY"==root.nodeName?(targetPos.x-=root.ownerDocument.documentElement.scrollLeft||root.scrollLeft,targetPos.y-=root.ownerDocument.documentElement.scrollTop||root.scrollTop):(targetPos.x-=root.scrollLeft,targetPos.y-=root.scrollTop),pos.x+=targetPos.x,pos.y+=targetPos.y,suggestionsMenu.moveTo(pos.x,pos.y+spans[0].offsetHeight)}function getWordCharPattern(){return editor.getParam("spellchecker_wordchar_pattern")||new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`]+',"g")}function defaultSpellcheckCallback(method,text,doneCallback,errorCallback){var data={method:method,lang:settings.spellchecker_language},postData="";data["addToDictionary"==method?"word":"text"]=text,Tools.each(data,function(value,key){postData&&(postData+="&"),postData+=key+"="+encodeURIComponent(value)}),XHR.send({url:new URI(url).toAbsolute(settings.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:postData,success:function(result){if(result=JSON.parse(result))result.error?errorCallback(result.error):doneCallback(result);else{var message=editor.translate("Server response wasn't proper JSON.");errorCallback(message)}},error:function(){var message=editor.translate("The spelling service was not found: (")+settings.spellchecker_rpc_url+editor.translate(")");errorCallback(message)}})}function sendRpcCall(name,data,successCallback,errorCallback){var spellCheckCallback=settings.spellchecker_callback||defaultSpellcheckCallback;spellCheckCallback.call(self,name,data,successCallback,errorCallback)}function spellcheck(){function errorCallback(message){editor.notificationManager.open({text:message,type:"error"}),editor.setProgressState(!1),finish()}finish()||(editor.setProgressState(!0),sendRpcCall("spellcheck",getTextMatcher().text,markErrors,errorCallback),editor.focus())}function checkIfFinished(){editor.dom.select("span.mce-spellchecker-word").length||finish()}function addToDictionary(word,spans){editor.setProgressState(!0),sendRpcCall("addToDictionary",word,function(){editor.setProgressState(!1),editor.dom.remove(spans,!0),checkIfFinished()},function(message){editor.notificationManager.open({text:message,type:"error"}),editor.setProgressState(!1)})}function ignoreWord(word,spans,all){editor.selection.collapse(),all?Tools.each(editor.dom.select("span.mce-spellchecker-word"),function(span){span.getAttribute("data-mce-word")==word&&editor.dom.remove(span,!0)}):editor.dom.remove(spans,!0),checkIfFinished()}function finish(){if(getTextMatcher().reset(),self.textMatcher=null,started)return started=!1,editor.fire("SpellcheckEnd"),!0}function getElmIndex(elm){var value=elm.getAttribute("data-mce-index");return"number"==typeof value?""+value:value}function findSpansByIndex(index){var nodes,spans=[];if(nodes=Tools.toArray(editor.getBody().getElementsByTagName("span")),nodes.length)for(var i=0;i<nodes.length;i++){var nodeIndex=getElmIndex(nodes[i]);null!==nodeIndex&&nodeIndex.length&&nodeIndex===index.toString()&&spans.push(nodes[i])}return spans}function updateSelection(e){var selectedLanguage=settings.spellchecker_language;e.control.items().each(function(ctrl){ctrl.active(ctrl.settings.data===selectedLanguage)})}function markErrors(data){var suggestions;if(data.words?(hasDictionarySupport=!!data.dictionary,suggestions=data.words):suggestions=data,editor.setProgressState(!1),isEmpty(suggestions)){var message=editor.translate("No misspellings found.");return editor.notificationManager.open({text:message,type:"info"}),void(started=!1)}lastSuggestions=suggestions,getTextMatcher().find(getWordCharPattern()).filter(function(match){return!!suggestions[match.text]}).wrap(function(match){return editor.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":match.text})}),started=!0,editor.fire("SpellcheckStart")}var languageMenuItems,lastSuggestions,started,suggestionsMenu,hasDictionarySupport,self=this,settings=editor.settings,languagesString=settings.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv";languageMenuItems=buildMenuItems("Language",Tools.map(languagesString.split(","),function(langPair){return langPair=langPair.split("="),{name:langPair[0],value:langPair[1]}})),editor.on("click",function(e){var target=e.target;if("mce-spellchecker-word"==target.className){e.preventDefault();var spans=findSpansByIndex(getElmIndex(target));if(spans.length>0){var rng=editor.dom.createRng();rng.setStartBefore(spans[0]),rng.setEndAfter(spans[spans.length-1]),editor.selection.setRng(rng),showSuggestions(target.getAttribute("data-mce-word"),spans)}}}),editor.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:spellcheck,selectable:!0,onPostRender:function(){var self=this;self.active(started),editor.on("SpellcheckStart SpellcheckEnd",function(){self.active(started)})}});var buttonArgs={tooltip:"Spellcheck",onclick:spellcheck,onPostRender:function(){var self=this;editor.on("SpellcheckStart SpellcheckEnd",function(){self.active(started)})}};languageMenuItems.length>1&&(buttonArgs.type="splitbutton",buttonArgs.menu=languageMenuItems,buttonArgs.onshow=updateSelection,buttonArgs.onselect=function(e){settings.spellchecker_language=e.control.settings.data}),editor.addButton("spellchecker",buttonArgs),editor.addCommand("mceSpellCheck",spellcheck),editor.on("remove",function(){suggestionsMenu&&(suggestionsMenu.remove(),suggestionsMenu=null)}),editor.on("change",checkIfFinished),this.getTextMatcher=getTextMatcher,this.getWordCharPattern=getWordCharPattern,this.markErrors=markErrors,this.getLanguage=function(){return settings.spellchecker_language},settings.spellchecker_language=settings.spellchecker_language||settings.language||"en";
})}),expose(["tinymce/spellcheckerplugin/DomTextMatcher"])}(this)}.apply(root,arguments)})}(this),function(root){define("tinymce-tabfocus",["tinymce"],function(){return function(){tinymce.PluginManager.add("tabfocus",function(editor){function tabCancel(e){9!==e.keyCode||e.ctrlKey||e.altKey||e.metaKey||e.preventDefault()}function tabHandler(e){function find(direction){function canSelectRecursive(e){return"BODY"===e.nodeName||"hidden"!=e.type&&"none"!=e.style.display&&"hidden"!=e.style.visibility&&canSelectRecursive(e.parentNode)}function canSelect(el){return/INPUT|TEXTAREA|BUTTON/.test(el.tagName)&&tinymce.get(e.id)&&el.tabIndex!=-1&&canSelectRecursive(el)}if(el=DOM.select(":input:enabled,*[tabindex]:not(iframe)"),each(el,function(e,i){if(e.id==editor.id)return x=i,!1}),direction>0){for(i=x+1;i<el.length;i++)if(canSelect(el[i]))return el[i]}else for(i=x-1;i>=0;i--)if(canSelect(el[i]))return el[i];return null}var x,el,v,i;if(!(9!==e.keyCode||e.ctrlKey||e.altKey||e.metaKey||e.isDefaultPrevented())&&(v=explode(editor.getParam("tab_focus",editor.getParam("tabfocus_elements",":prev,:next"))),1==v.length&&(v[1]=v[0],v[0]=":prev"),el=e.shiftKey?":prev"==v[0]?find(-1):DOM.get(v[0]):":next"==v[1]?find(1):DOM.get(v[1]))){var focusEditor=tinymce.get(el.id||el.name);el.id&&focusEditor?focusEditor.focus():tinymce.util.Delay.setTimeout(function(){tinymce.Env.webkit||window.focus(),el.focus()},10),e.preventDefault()}}var DOM=tinymce.DOM,each=tinymce.each,explode=tinymce.explode;editor.on("init",function(){editor.inline&&tinymce.DOM.setAttrib(editor.getBody(),"tabIndex",null),editor.on("keyup",tabCancel),tinymce.Env.gecko?editor.on("keypress keydown",tabHandler):editor.on("keydown",tabHandler)})})}.apply(root,arguments)})}(this),function(root){define("tinymce-table",["tinymce"],function(){return function(){!function(exports,undefined){"use strict";function require(ids,callback){for(var module,defs=[],i=0;i<ids.length;++i){if(module=modules[ids[i]]||resolve(ids[i]),!module)throw"module definition dependecy not found: "+ids[i];defs.push(module)}callback.apply(null,defs)}function define(id,dependencies,definition){if("string"!=typeof id)throw"invalid module definition, module id must be defined and be a string";if(dependencies===undefined)throw"invalid module definition, dependencies must be specified";if(definition===undefined)throw"invalid module definition, definition function must be specified";require(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function resolve(id){for(var target=exports,fragments=id.split(/[.\/]/),fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]])return;target=target[fragments[fi]]}return target}var modules={};define("tinymce/tableplugin/Utils",["tinymce/Env"],function(Env){function getSpanVal(td,name){return parseInt(td.getAttribute(name)||1,10)}function paddCell(cell){(!Env.ie||Env.ie>9)&&(cell.hasChildNodes()||(cell.innerHTML='<br data-mce-bogus="1" />'))}return{getSpanVal:getSpanVal,paddCell:paddCell}}),define("tinymce/tableplugin/TableGrid",["tinymce/util/Tools","tinymce/Env","tinymce/tableplugin/Utils"],function(Tools,Env,Utils){var each=Tools.each,getSpanVal=Utils.getSpanVal;return function(editor,table,selectedCell){function removeCellSelection(){editor.$("td[data-mce-selected],th[data-mce-selected]").removeAttr("data-mce-selected")}function isEditorBody(node){return node===editor.getBody()}function getChildrenByName(node,names){return node?(names=Tools.map(names.split(","),function(name){return name.toLowerCase()}),Tools.grep(node.childNodes,function(node){return Tools.inArray(names,node.nodeName.toLowerCase())!==-1})):[]}function buildGrid(){var startY=0;grid=[],gridWidth=0,each(["thead","tbody","tfoot"],function(part){var partElm=getChildrenByName(table,part)[0],rows=getChildrenByName(partElm,"tr");each(rows,function(tr,y){y+=startY,each(getChildrenByName(tr,"td,th"),function(td,x){var x2,y2,rowspan,colspan;if(grid[y])for(;grid[y][x];)x++;for(rowspan=getSpanVal(td,"rowspan"),colspan=getSpanVal(td,"colspan"),y2=y;y2<y+rowspan;y2++)for(grid[y2]||(grid[y2]=[]),x2=x;x2<x+colspan;x2++)grid[y2][x2]={part:part,real:y2==y&&x2==x,elm:td,rowspan:rowspan,colspan:colspan};gridWidth=Math.max(gridWidth,x+1)})}),startY+=rows.length})}function fireNewRow(node){return editor.fire("newrow",{node:node}),node}function fireNewCell(node){return editor.fire("newcell",{node:node}),node}function cloneNode(node,children){return node=node.cloneNode(children),node.removeAttribute("id"),node}function getCell(x,y){var row;if(row=grid[y])return row[x]}function setSpanVal(td,name,val){td&&(val=parseInt(val,10),1===val?td.removeAttribute(name,1):td.setAttribute(name,val,1))}function isCellSelected(cell){return cell&&(!!dom.getAttrib(cell.elm,"data-mce-selected")||cell==selectedCell)}function getSelectedRows(){var rows=[];return each(table.rows,function(row){each(row.cells,function(cell){if(dom.getAttrib(cell,"data-mce-selected")||selectedCell&&cell==selectedCell.elm)return rows.push(row),!1})}),rows}function deleteTable(){var rng=dom.createRng();isEditorBody(table)||(rng.setStartAfter(table),rng.setEndAfter(table),selection.setRng(rng),dom.remove(table))}function cloneCell(cell){var formatNode,cloneFormats={};return editor.settings.table_clone_elements!==!1&&(cloneFormats=Tools.makeMap((editor.settings.table_clone_elements||"strong em b i span font h1 h2 h3 h4 h5 h6 p div").toUpperCase(),/[ ,]/)),Tools.walk(cell,function(node){var curNode;if(3==node.nodeType)return each(dom.getParents(node.parentNode,null,cell).reverse(),function(node){cloneFormats[node.nodeName]&&(node=cloneNode(node,!1),formatNode?curNode&&curNode.appendChild(node):formatNode=curNode=node,curNode=node)}),curNode&&(curNode.innerHTML=Env.ie&&Env.ie<10?"&nbsp;":'<br data-mce-bogus="1" />'),!1},"childNodes"),cell=cloneNode(cell,!1),fireNewCell(cell),setSpanVal(cell,"rowSpan",1),setSpanVal(cell,"colSpan",1),formatNode?cell.appendChild(formatNode):Utils.paddCell(cell),cell}function cleanup(){var row,rng=dom.createRng();return each(dom.select("tr",table),function(tr){0===tr.cells.length&&dom.remove(tr)}),0===dom.select("tr",table).length?(rng.setStartBefore(table),rng.setEndBefore(table),selection.setRng(rng),void dom.remove(table)):(each(dom.select("thead,tbody,tfoot",table),function(part){0===part.rows.length&&dom.remove(part)}),buildGrid(),void(startPos&&(row=grid[Math.min(grid.length-1,startPos.y)],row&&(selection.select(row[Math.min(row.length-1,startPos.x)].elm,!0),selection.collapse(!0)))))}function fillLeftDown(x,y,rows,cols){var tr,x2,r,c,cell;for(tr=grid[y][x].elm.parentNode,r=1;r<=rows;r++)if(tr=dom.getNext(tr,"tr")){for(x2=x;x2>=0;x2--)if(cell=grid[y+r][x2].elm,cell.parentNode==tr){for(c=1;c<=cols;c++)dom.insertAfter(cloneCell(cell),cell);break}if(x2==-1)for(c=1;c<=cols;c++)tr.insertBefore(cloneCell(tr.cells[0]),tr.cells[0])}}function split(){each(grid,function(row,y){each(row,function(cell,x){var colSpan,rowSpan,i;if(isCellSelected(cell)&&(cell=cell.elm,colSpan=getSpanVal(cell,"colspan"),rowSpan=getSpanVal(cell,"rowspan"),colSpan>1||rowSpan>1)){for(setSpanVal(cell,"rowSpan",1),setSpanVal(cell,"colSpan",1),i=0;i<colSpan-1;i++)dom.insertAfter(cloneCell(cell),cell);fillLeftDown(x,y,rowSpan-1,colSpan)}})})}function merge(cell,cols,rows){var pos,startX,startY,endX,endY,x,y,startCell,endCell,children,count;if(cell?(pos=getPos(cell),startX=pos.x,startY=pos.y,endX=startX+(cols-1),endY=startY+(rows-1)):(startPos=endPos=null,each(grid,function(row,y){each(row,function(cell,x){isCellSelected(cell)&&(startPos||(startPos={x:x,y:y}),endPos={x:x,y:y})})}),startPos&&(startX=startPos.x,startY=startPos.y,endX=endPos.x,endY=endPos.y)),startCell=getCell(startX,startY),endCell=getCell(endX,endY),startCell&&endCell&&startCell.part==endCell.part){for(split(),buildGrid(),startCell=getCell(startX,startY).elm,setSpanVal(startCell,"colSpan",endX-startX+1),setSpanVal(startCell,"rowSpan",endY-startY+1),y=startY;y<=endY;y++)for(x=startX;x<=endX;x++)grid[y]&&grid[y][x]&&(cell=grid[y][x].elm,cell!=startCell&&(children=Tools.grep(cell.childNodes),each(children,function(node){startCell.appendChild(node)}),children.length&&(children=Tools.grep(startCell.childNodes),count=0,each(children,function(node){"BR"==node.nodeName&&count++<children.length-1&&startCell.removeChild(node)})),dom.remove(cell)));cleanup()}}function insertRow(before){var posY,cell,lastCell,x,rowElm,newRow,newCell,otherCell,rowSpan,spanValue;if(each(grid,function(row,y){if(each(row,function(cell){if(isCellSelected(cell)&&(cell=cell.elm,rowElm=cell.parentNode,newRow=fireNewRow(cloneNode(rowElm,!1)),posY=y,before))return!1}),before)return!posY}),posY!==undefined){for(x=0,spanValue=0;x<grid[0].length;x+=spanValue)if(grid[posY][x]&&(cell=grid[posY][x].elm,spanValue=getSpanVal(cell,"colspan"),cell!=lastCell)){if(before){if(posY>0&&grid[posY-1][x]&&(otherCell=grid[posY-1][x].elm,rowSpan=getSpanVal(otherCell,"rowSpan"),rowSpan>1)){setSpanVal(otherCell,"rowSpan",rowSpan+1);continue}}else if(rowSpan=getSpanVal(cell,"rowspan"),rowSpan>1){setSpanVal(cell,"rowSpan",rowSpan+1);continue}newCell=cloneCell(cell),setSpanVal(newCell,"colSpan",cell.colSpan),newRow.appendChild(newCell),lastCell=cell}newRow.hasChildNodes()&&(before?rowElm.parentNode.insertBefore(newRow,rowElm):dom.insertAfter(newRow,rowElm))}}function insertCol(before){var posX,lastCell;each(grid,function(row){if(each(row,function(cell,x){if(isCellSelected(cell)&&(posX=x,before))return!1}),before)return!posX}),each(grid,function(row,y){var cell,rowSpan,colSpan;row[posX]&&(cell=row[posX].elm,cell!=lastCell&&(colSpan=getSpanVal(cell,"colspan"),rowSpan=getSpanVal(cell,"rowspan"),1==colSpan?before?(cell.parentNode.insertBefore(cloneCell(cell),cell),fillLeftDown(posX,y,rowSpan-1,colSpan)):(dom.insertAfter(cloneCell(cell),cell),fillLeftDown(posX,y,rowSpan-1,colSpan)):setSpanVal(cell,"colSpan",cell.colSpan+1),lastCell=cell))})}function getSelectedCells(grid){return Tools.grep(getAllCells(grid),isCellSelected)}function getAllCells(grid){var cells=[];return each(grid,function(row){each(row,function(cell){cells.push(cell)})}),cells}function deleteCols(){var cols=[];if(isEditorBody(table)){if(1==grid[0].length)return;if(getSelectedCells(grid).length==getAllCells(grid).length)return}each(grid,function(row){each(row,function(cell,x){isCellSelected(cell)&&Tools.inArray(cols,x)===-1&&(each(grid,function(row){var colSpan,cell=row[x].elm;colSpan=getSpanVal(cell,"colSpan"),colSpan>1?setSpanVal(cell,"colSpan",colSpan-1):dom.remove(cell)}),cols.push(x))})}),cleanup()}function deleteRows(){function deleteRow(tr){var pos,lastCell;each(tr.cells,function(cell){var rowSpan=getSpanVal(cell,"rowSpan");rowSpan>1&&(setSpanVal(cell,"rowSpan",rowSpan-1),pos=getPos(cell),fillLeftDown(pos.x,pos.y,1,1))}),pos=getPos(tr.cells[0]),each(grid[pos.y],function(cell){var rowSpan;cell=cell.elm,cell!=lastCell&&(rowSpan=getSpanVal(cell,"rowSpan"),rowSpan<=1?dom.remove(cell):setSpanVal(cell,"rowSpan",rowSpan-1),lastCell=cell)})}var rows;rows=getSelectedRows(),isEditorBody(table)&&rows.length==table.rows.length||(each(rows.reverse(),function(tr){deleteRow(tr)}),cleanup())}function cutRows(){var rows=getSelectedRows();if(!isEditorBody(table)||rows.length!=table.rows.length)return dom.remove(rows),cleanup(),rows}function copyRows(){var rows=getSelectedRows();return each(rows,function(row,i){rows[i]=cloneNode(row,!0)}),rows}function pasteRows(rows,before){var selectedRows=getSelectedRows(),targetRow=selectedRows[before?0:selectedRows.length-1],targetCellCount=targetRow.cells.length;rows&&(each(grid,function(row){var match;if(targetCellCount=0,each(row,function(cell){cell.real&&(targetCellCount+=cell.colspan),cell.elm.parentNode==targetRow&&(match=1)}),match)return!1}),before||rows.reverse(),each(rows,function(row){var i,cell,cellCount=row.cells.length;for(fireNewRow(row),i=0;i<cellCount;i++)cell=row.cells[i],fireNewCell(cell),setSpanVal(cell,"colSpan",1),setSpanVal(cell,"rowSpan",1);for(i=cellCount;i<targetCellCount;i++)row.appendChild(fireNewCell(cloneCell(row.cells[cellCount-1])));for(i=targetCellCount;i<cellCount;i++)dom.remove(row.cells[i]);before?targetRow.parentNode.insertBefore(row,targetRow):dom.insertAfter(row,targetRow)}),removeCellSelection())}function getPos(target){var pos;return each(grid,function(row,y){return each(row,function(cell,x){if(cell.elm==target)return pos={x:x,y:y},!1}),!pos}),pos}function setStartCell(cell){startPos=getPos(cell)}function findEndPos(){var maxX,maxY;return maxX=maxY=0,each(grid,function(row,y){each(row,function(cell,x){var colSpan,rowSpan;isCellSelected(cell)&&(cell=grid[y][x],x>maxX&&(maxX=x),y>maxY&&(maxY=y),cell.real&&(colSpan=cell.colspan-1,rowSpan=cell.rowspan-1,colSpan&&x+colSpan>maxX&&(maxX=x+colSpan),rowSpan&&y+rowSpan>maxY&&(maxY=y+rowSpan)))})}),{x:maxX,y:maxY}}function setEndCell(cell){var startX,startY,endX,endY,maxX,maxY,colSpan,rowSpan,x,y;if(endPos=getPos(cell),startPos&&endPos){for(startX=Math.min(startPos.x,endPos.x),startY=Math.min(startPos.y,endPos.y),endX=Math.max(startPos.x,endPos.x),endY=Math.max(startPos.y,endPos.y),maxX=endX,maxY=endY,y=startY;y<=endY;y++)for(x=startX;x<=endX;x++)cell=grid[y][x],cell.real&&(colSpan=cell.colspan-1,rowSpan=cell.rowspan-1,colSpan&&x+colSpan>maxX&&(maxX=x+colSpan),rowSpan&&y+rowSpan>maxY&&(maxY=y+rowSpan));for(removeCellSelection(),y=startY;y<=maxY;y++)for(x=startX;x<=maxX;x++)grid[y][x]&&dom.setAttrib(grid[y][x].elm,"data-mce-selected","1")}}function moveRelIdx(cellElm,delta){var pos,index,cell;pos=getPos(cellElm),index=pos.y*gridWidth+pos.x;do{if(index+=delta,cell=getCell(index%gridWidth,Math.floor(index/gridWidth)),!cell)break;if(cell.elm!=cellElm)return selection.select(cell.elm,!0),dom.isEmpty(cell.elm)&&selection.collapse(!0),!0}while(cell.elm==cellElm);return!1}var grid,gridWidth,startPos,endPos,selection=editor.selection,dom=selection.dom;table=table||dom.getParent(selection.getStart(!0),"table"),buildGrid(),selectedCell=selectedCell||dom.getParent(selection.getStart(!0),"th,td"),selectedCell&&(startPos=getPos(selectedCell),endPos=findEndPos(),selectedCell=getCell(startPos.x,startPos.y)),Tools.extend(this,{deleteTable:deleteTable,split:split,merge:merge,insertRow:insertRow,insertCol:insertCol,deleteCols:deleteCols,deleteRows:deleteRows,cutRows:cutRows,copyRows:copyRows,pasteRows:pasteRows,getPos:getPos,setStartCell:setStartCell,setEndCell:setEndCell,moveRelIdx:moveRelIdx,refresh:buildGrid})}}),define("tinymce/tableplugin/Quirks",["tinymce/util/VK","tinymce/util/Delay","tinymce/Env","tinymce/util/Tools","tinymce/tableplugin/Utils"],function(VK,Delay,Env,Tools,Utils){var each=Tools.each,getSpanVal=Utils.getSpanVal;return function(editor){function moveWebKitSelection(){function eventHandler(e){function handle(upBool,sourceNode){var siblingDirection=upBool?"previousSibling":"nextSibling",currentRow=editor.dom.getParent(sourceNode,"tr"),siblingRow=currentRow[siblingDirection];if(siblingRow)return moveCursorToRow(editor,sourceNode,siblingRow,upBool),e.preventDefault(),!0;var tableNode=editor.dom.getParent(currentRow,"table"),middleNode=currentRow.parentNode,parentNodeName=middleNode.nodeName.toLowerCase();if("tbody"===parentNodeName||parentNodeName===(upBool?"tfoot":"thead")){var targetParent=getTargetParent(upBool,tableNode,middleNode,"tbody");if(null!==targetParent)return moveToRowInTarget(upBool,targetParent,sourceNode)}return escapeTable(upBool,currentRow,siblingDirection,tableNode)}function getTargetParent(upBool,topNode,secondNode,nodeName){var tbodies=editor.dom.select(">"+nodeName,topNode),position=tbodies.indexOf(secondNode);if(upBool&&0===position||!upBool&&position===tbodies.length-1)return getFirstHeadOrFoot(upBool,topNode);if(position===-1){var topOrBottom="thead"===secondNode.tagName.toLowerCase()?0:tbodies.length-1;return tbodies[topOrBottom]}return tbodies[position+(upBool?-1:1)]}function getFirstHeadOrFoot(upBool,parent){var tagName=upBool?"thead":"tfoot",headOrFoot=editor.dom.select(">"+tagName,parent);return 0!==headOrFoot.length?headOrFoot[0]:null}function moveToRowInTarget(upBool,targetParent,sourceNode){var targetRow=getChildForDirection(targetParent,upBool);return targetRow&&moveCursorToRow(editor,sourceNode,targetRow,upBool),e.preventDefault(),!0}function escapeTable(upBool,currentRow,siblingDirection,table){var tableSibling=table[siblingDirection];if(tableSibling)return moveCursorToStartOfElement(tableSibling),!0;var parentCell=editor.dom.getParent(table,"td,th");if(parentCell)return handle(upBool,parentCell,e);var backUpSibling=getChildForDirection(currentRow,!upBool);return moveCursorToStartOfElement(backUpSibling),e.preventDefault(),!1}function getChildForDirection(parent,up){var child=parent&&parent[up?"lastChild":"firstChild"];return child&&"BR"===child.nodeName?editor.dom.getParent(child,"td,th"):child}function moveCursorToStartOfElement(n){editor.selection.setCursorLocation(n,0)}function isVerticalMovement(){return key==VK.UP||key==VK.DOWN}function isInTable(editor){var node=editor.selection.getNode(),currentRow=editor.dom.getParent(node,"tr");return null!==currentRow}function columnIndex(column){for(var colIndex=0,c=column;c.previousSibling;)c=c.previousSibling,colIndex+=getSpanVal(c,"colspan");return colIndex}function findColumn(rowElement,columnIndex){var c=0,r=0;return each(rowElement.children,function(cell,i){if(c+=getSpanVal(cell,"colspan"),r=i,c>columnIndex)return!1}),r}function moveCursorToRow(ed,node,row,upBool){var srcColumnIndex=columnIndex(editor.dom.getParent(node,"td,th")),tgtColumnIndex=findColumn(row,srcColumnIndex),tgtNode=row.childNodes[tgtColumnIndex],rowCellTarget=getChildForDirection(tgtNode,upBool);moveCursorToStartOfElement(rowCellTarget||tgtNode)}function shouldFixCaret(preBrowserNode){var newNode=editor.selection.getNode(),newParent=editor.dom.getParent(newNode,"td,th"),oldParent=editor.dom.getParent(preBrowserNode,"td,th");return newParent&&newParent!==oldParent&&checkSameParentTable(newParent,oldParent)}function checkSameParentTable(nodeOne,NodeTwo){return editor.dom.getParent(nodeOne,"TABLE")===editor.dom.getParent(NodeTwo,"TABLE")}var key=e.keyCode;if(isVerticalMovement()&&isInTable(editor)){var preBrowserNode=editor.selection.getNode();Delay.setEditorTimeout(editor,function(){shouldFixCaret(preBrowserNode)&&handle(!e.shiftKey&&key===VK.UP,preBrowserNode,e)},0)}}editor.on("KeyDown",function(e){eventHandler(e)})}function fixBeforeTableCaretBug(){function isAtStart(rng,par){var elm,doc=par.ownerDocument,rng2=doc.createRange();return rng2.setStartBefore(par),rng2.setEnd(rng.endContainer,rng.endOffset),elm=doc.createElement("body"),elm.appendChild(rng2.cloneContents()),0===elm.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length}editor.on("KeyDown",function(e){var rng,table,dom=editor.dom;37!=e.keyCode&&38!=e.keyCode||(rng=editor.selection.getRng(),table=dom.getParent(rng.startContainer,"table"),table&&editor.getBody().firstChild==table&&isAtStart(rng,table)&&(rng=dom.createRng(),rng.setStartBefore(table),rng.setEndBefore(table),editor.selection.setRng(rng),e.preventDefault()))})}function fixTableCaretPos(){editor.on("KeyDown SetContent VisualAid",function(){var last;for(last=editor.getBody().lastChild;last;last=last.previousSibling)if(3==last.nodeType){if(last.nodeValue.length>0)break}else if(1==last.nodeType&&("BR"==last.tagName||!last.getAttribute("data-mce-bogus")))break;last&&"TABLE"==last.nodeName&&(editor.settings.forced_root_block?editor.dom.add(editor.getBody(),editor.settings.forced_root_block,editor.settings.forced_root_block_attrs,Env.ie&&Env.ie<10?"&nbsp;":'<br data-mce-bogus="1" />'):editor.dom.add(editor.getBody(),"br",{"data-mce-bogus":"1"}))}),editor.on("PreProcess",function(o){var last=o.node.lastChild;last&&("BR"==last.nodeName||1==last.childNodes.length&&("BR"==last.firstChild.nodeName||""==last.firstChild.nodeValue))&&last.previousSibling&&"TABLE"==last.previousSibling.nodeName&&editor.dom.remove(last)})}function fixTableCellSelection(){function tableCellSelected(ed,rng,n,currentCell){var tableParent,allOfCellSelected,tableCellSelection,TEXT_NODE=3,table=ed.dom.getParent(rng.startContainer,"TABLE");return table&&(tableParent=table.parentNode),allOfCellSelected=rng.startContainer.nodeType==TEXT_NODE&&0===rng.startOffset&&0===rng.endOffset&&currentCell&&("TR"==n.nodeName||n==tableParent),tableCellSelection=("TD"==n.nodeName||"TH"==n.nodeName)&&!currentCell,allOfCellSelected||tableCellSelection}function fixSelection(){var rng=editor.selection.getRng(),n=editor.selection.getNode(),currentCell=editor.dom.getParent(rng.startContainer,"TD,TH");if(tableCellSelected(editor,rng,n,currentCell)){currentCell||(currentCell=n);for(var end=currentCell.lastChild;end.lastChild;)end=end.lastChild;3==end.nodeType&&(rng.setEnd(end,end.data.length),editor.selection.setRng(rng))}}editor.on("KeyDown",function(){fixSelection()}),editor.on("MouseDown",function(e){2!=e.button&&fixSelection()})}function deleteTable(){function placeCaretInCell(cell){editor.selection.select(cell,!0),editor.selection.collapse(!0)}function clearCell(cell){editor.$(cell).empty(),Utils.paddCell(cell)}editor.on("keydown",function(e){if((e.keyCode==VK.DELETE||e.keyCode==VK.BACKSPACE)&&!e.isDefaultPrevented()){var table,tableCells,selectedTableCells,cell;if(table=editor.dom.getParent(editor.selection.getStart(),"table")){if(tableCells=editor.dom.select("td,th",table),selectedTableCells=Tools.grep(tableCells,function(cell){return!!editor.dom.getAttrib(cell,"data-mce-selected")}),0===selectedTableCells.length)return cell=editor.dom.getParent(editor.selection.getStart(),"td,th"),void(editor.selection.isCollapsed()&&cell&&editor.dom.isEmpty(cell)&&(e.preventDefault(),clearCell(cell),placeCaretInCell(cell)));e.preventDefault(),editor.undoManager.transact(function(){tableCells.length==selectedTableCells.length?editor.execCommand("mceTableDelete"):(Tools.each(selectedTableCells,clearCell),placeCaretInCell(selectedTableCells[0]))})}}})}deleteTable(),Env.webkit&&(moveWebKitSelection(),fixTableCellSelection()),Env.gecko&&(fixBeforeTableCaretBug(),fixTableCaretPos()),Env.ie>9&&(fixBeforeTableCaretBug(),fixTableCaretPos())}}),define("tinymce/tableplugin/CellSelection",["tinymce/tableplugin/TableGrid","tinymce/dom/TreeWalker","tinymce/util/Tools"],function(TableGrid,TreeWalker,Tools){return function(editor){function clear(force){editor.getBody().style.webkitUserSelect="",(force||hasCellSelection)&&(editor.$("td[data-mce-selected],th[data-mce-selected]").removeAttr("data-mce-selected"),hasCellSelection=!1)}function isCellInTable(table,cell){return!(!table||!cell)&&table===dom.getParent(cell,"table")}function cellSelectionHandler(e){var sel,currentCell,target=e.target;if(!resizing&&target!==lastMouseOverTarget&&(lastMouseOverTarget=target,startTable&&startCell)){if(currentCell=dom.getParent(target,"td,th"),isCellInTable(startTable,currentCell)||(currentCell=dom.getParent(startTable,"td,th")),startCell===currentCell&&!hasCellSelection)return;if(isCellInTable(startTable,currentCell)){e.preventDefault(),tableGrid||(tableGrid=new TableGrid(editor,startTable,startCell),editor.getBody().style.webkitUserSelect="none"),tableGrid.setEndCell(currentCell),hasCellSelection=!0,sel=editor.selection.getSel();try{sel.removeAllRanges?sel.removeAllRanges():sel.empty()}catch(ex){}}}}var tableGrid,startCell,startTable,lastMouseOverTarget,resizing,dom=editor.dom,hasCellSelection=!0;return editor.on("SelectionChange",function(e){hasCellSelection&&e.stopImmediatePropagation()},!0),editor.on("MouseDown",function(e){2==e.button||resizing||(clear(),startCell=dom.getParent(e.target,"td,th"),startTable=dom.getParent(startCell,"table"))}),editor.on("mouseover",cellSelectionHandler),editor.on("remove",function(){dom.unbind(editor.getDoc(),"mouseover",cellSelectionHandler),clear()}),editor.on("MouseUp",function(){function setPoint(node,start){var walker=new TreeWalker(node,node);do{if(3==node.nodeType&&0!==Tools.trim(node.nodeValue).length)return void(start?rng.setStart(node,0):rng.setEnd(node,node.nodeValue.length));if("BR"==node.nodeName)return void(start?rng.setStartBefore(node):rng.setEndBefore(node))}while(node=start?walker.next():walker.prev())}var rng,selectedCells,walker,node,lastNode,sel=editor.selection;if(startCell){if(tableGrid&&(editor.getBody().style.webkitUserSelect=""),selectedCells=dom.select("td[data-mce-selected],th[data-mce-selected]"),selectedCells.length>0){rng=dom.createRng(),node=selectedCells[0],rng.setStartBefore(node),rng.setEndAfter(node),setPoint(node,1),walker=new TreeWalker(node,dom.getParent(selectedCells[0],"table"));do if("TD"==node.nodeName||"TH"==node.nodeName){if(!dom.getAttrib(node,"data-mce-selected"))break;lastNode=node}while(node=walker.next());setPoint(lastNode),sel.setRng(rng)}editor.nodeChanged(),startCell=tableGrid=startTable=lastMouseOverTarget=null}}),editor.on("KeyUp Drop SetContent",function(e){clear("setcontent"==e.type),startCell=tableGrid=startTable=lastMouseOverTarget=null,resizing=!1}),editor.on("ObjectResizeStart ObjectResized",function(e){resizing="objectresized"!=e.type}),{clear:clear}}}),define("tinymce/tableplugin/Dialogs",["tinymce/util/Tools","tinymce/Env"],function(Tools,Env){var each=Tools.each;return function(editor){function createColorPickAction(){var colorPickerCallback=editor.settings.color_picker_callback;if(colorPickerCallback)return function(){var self=this;colorPickerCallback.call(editor,function(value){self.value(value).fire("change")},self.value())}}function createStyleForm(dom){return{title:"Advanced",type:"form",defaults:{onchange:function(){updateStyle(dom,this.parents().reverse()[0],"style"==this.name())}},items:[{label:"Style",name:"style",type:"textbox"},{type:"form",padding:0,formItemDefaults:{layout:"grid",alignH:["start","right"]},defaults:{size:7},items:[{label:"Border color",type:"colorbox",name:"borderColor",onaction:createColorPickAction()},{label:"Background color",type:"colorbox",name:"backgroundColor",onaction:createColorPickAction()}]}]}}function removePxSuffix(size){return size?size.replace(/px$/,""):""}function addSizeSuffix(size){return/^[0-9]+$/.test(size)&&(size+="px"),size}function unApplyAlign(elm){each("left center right".split(" "),function(name){editor.formatter.remove("align"+name,{},elm)})}function unApplyVAlign(elm){each("top middle bottom".split(" "),function(name){editor.formatter.remove("valign"+name,{},elm)})}function buildListItems(inputList,itemCallback,startItems){function appendItems(values,output){return output=output||[],Tools.each(values,function(item){var menuItem={text:item.text||item.title};item.menu?menuItem.menu=appendItems(item.menu):(menuItem.value=item.value,itemCallback&&itemCallback(menuItem)),output.push(menuItem)}),output}return appendItems(inputList,startItems||[])}function updateStyle(dom,win,isStyleCtrl){var data=win.toJSON(),css=dom.parseStyle(data.style);isStyleCtrl?(win.find("#borderColor").value(css["border-color"]||"")[0].fire("change"),win.find("#backgroundColor").value(css["background-color"]||"")[0].fire("change")):(css["border-color"]=data.borderColor,css["background-color"]=data.backgroundColor),win.find("#style").value(dom.serializeStyle(dom.parseStyle(dom.serializeStyle(css))))}function appendStylesToData(dom,data,elm){var css=dom.parseStyle(dom.getAttrib(elm,"style"));css["border-color"]&&(data.borderColor=css["border-color"]),css["background-color"]&&(data.backgroundColor=css["background-color"]),data.style=dom.serializeStyle(css)}function mergeStyles(dom,elm,styles){var css=dom.parseStyle(dom.getAttrib(elm,"style"));each(styles,function(style){css[style.name]=style.value}),dom.setAttrib(elm,"style",dom.serializeStyle(dom.parseStyle(dom.serializeStyle(css))))}var self=this;self.tableProps=function(){self.table(!0)},self.table=function(isProps){function onSubmitTableForm(){function styleTDTH(elm,name,value){if("TD"===elm.tagName||"TH"===elm.tagName)dom.setStyle(elm,name,value);else if(elm.children)for(var i=0;i<elm.children.length;i++)styleTDTH(elm.children[i],name,value)}var captionElm;updateStyle(dom,this),data=Tools.extend(data,this.toJSON()),data["class"]===!1&&delete data["class"],editor.undoManager.transact(function(){if(tableElm||(tableElm=editor.plugins.table.insertTable(data.cols||1,data.rows||1)),editor.dom.setAttribs(tableElm,{style:data.style,"class":data["class"]}),editor.settings.table_style_by_css){if(stylesToMerge=[],stylesToMerge.push({name:"border",value:data.border}),stylesToMerge.push({name:"border-spacing",value:addSizeSuffix(data.cellspacing)}),mergeStyles(dom,tableElm,stylesToMerge),dom.setAttribs(tableElm,{"data-mce-border-color":data.borderColor,"data-mce-cell-padding":data.cellpadding,"data-mce-border":data.border}),tableElm.children)for(var i=0;i<tableElm.children.length;i++)styleTDTH(tableElm.children[i],"border",data.border),styleTDTH(tableElm.children[i],"padding",addSizeSuffix(data.cellpadding))}else editor.dom.setAttribs(tableElm,{border:data.border,cellpadding:data.cellpadding,cellspacing:data.cellspacing});dom.getAttrib(tableElm,"width")&&!editor.settings.table_style_by_css?dom.setAttrib(tableElm,"width",removePxSuffix(data.width)):dom.setStyle(tableElm,"width",addSizeSuffix(data.width)),dom.setStyle(tableElm,"height",addSizeSuffix(data.height)),captionElm=dom.select("caption",tableElm)[0],captionElm&&!data.caption&&dom.remove(captionElm),!captionElm&&data.caption&&(captionElm=dom.create("caption"),captionElm.innerHTML=Env.ie?"":'<br data-mce-bogus="1"/>',tableElm.insertBefore(captionElm,tableElm.firstChild)),unApplyAlign(tableElm),data.align&&editor.formatter.apply("align"+data.align,{},tableElm),editor.focus(),editor.addVisual()})}function getTDTHOverallStyle(elm,name){function checkChildren(firstChildStyle,elms){for(var i=0;i<elms.length;i++){var currentStyle=dom.getStyle(elms[i],name);if("undefined"==typeof firstChildStyle&&(firstChildStyle=currentStyle),firstChildStyle!=currentStyle)return""}return firstChildStyle}var firstChildStyle,cells=editor.dom.select("td,th",elm);return firstChildStyle=checkChildren(firstChildStyle,cells)}var tableElm,colsCtrl,rowsCtrl,classListCtrl,generalTableForm,stylesToMerge,dom=editor.dom,data={};isProps===!0?(tableElm=dom.getParent(editor.selection.getStart(),"table"),tableElm&&(data={width:removePxSuffix(dom.getStyle(tableElm,"width")||dom.getAttrib(tableElm,"width")),height:removePxSuffix(dom.getStyle(tableElm,"height")||dom.getAttrib(tableElm,"height")),cellspacing:removePxSuffix(dom.getStyle(tableElm,"border-spacing")||dom.getAttrib(tableElm,"cellspacing")),cellpadding:dom.getAttrib(tableElm,"data-mce-cell-padding")||dom.getAttrib(tableElm,"cellpadding")||getTDTHOverallStyle(tableElm,"padding"),border:dom.getAttrib(tableElm,"data-mce-border")||dom.getAttrib(tableElm,"border")||getTDTHOverallStyle(tableElm,"border"),borderColor:dom.getAttrib(tableElm,"data-mce-border-color"),caption:!!dom.select("caption",tableElm)[0],"class":dom.getAttrib(tableElm,"class")},each("left center right".split(" "),function(name){editor.formatter.matchNode(tableElm,"align"+name)&&(data.align=name)}))):(colsCtrl={label:"Cols",name:"cols"},rowsCtrl={label:"Rows",name:"rows"}),editor.settings.table_class_list&&(data["class"]&&(data["class"]=data["class"].replace(/\s*mce\-item\-table\s*/g,"")),classListCtrl={name:"class",type:"listbox",label:"Class",values:buildListItems(editor.settings.table_class_list,function(item){item.value&&(item.textStyle=function(){return editor.formatter.getCssText({block:"table",classes:[item.value]})})})}),generalTableForm={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",labelGapCalc:!1,padding:0,layout:"grid",columns:2,defaults:{type:"textbox",maxWidth:50},items:editor.settings.table_appearance_options!==!1?[colsCtrl,rowsCtrl,{label:"Width",name:"width"},{label:"Height",name:"height"},{label:"Cell spacing",name:"cellspacing"},{label:"Cell padding",name:"cellpadding"},{label:"Border",name:"border"},{label:"Caption",name:"caption",type:"checkbox"}]:[colsCtrl,rowsCtrl,{label:"Width",
name:"width"},{label:"Height",name:"height"}]},{label:"Alignment",name:"align",type:"listbox",text:"None",values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},classListCtrl]},editor.settings.table_advtab!==!1?(appendStylesToData(dom,data,tableElm),editor.windowManager.open({title:"Table properties",data:data,bodyType:"tabpanel",body:[{title:"General",type:"form",items:generalTableForm},createStyleForm(dom)],onsubmit:onSubmitTableForm})):editor.windowManager.open({title:"Table properties",data:data,body:generalTableForm,onsubmit:onSubmitTableForm})},self.merge=function(grid,cell){editor.windowManager.open({title:"Merge cells",body:[{label:"Cols",name:"cols",type:"textbox",value:"1",size:10},{label:"Rows",name:"rows",type:"textbox",value:"1",size:10}],onsubmit:function(){var data=this.toJSON();editor.undoManager.transact(function(){grid.merge(cell,data.cols,data.rows)})}})},self.cell=function(){function onSubmitCellForm(){updateStyle(dom,this),data=Tools.extend(data,this.toJSON()),editor.undoManager.transact(function(){each(cells,function(cellElm){editor.dom.setAttribs(cellElm,{scope:data.scope,style:data.style,"class":data["class"]}),editor.dom.setStyles(cellElm,{width:addSizeSuffix(data.width),height:addSizeSuffix(data.height)}),data.type&&cellElm.nodeName.toLowerCase()!=data.type&&(cellElm=dom.rename(cellElm,data.type)),unApplyAlign(cellElm),data.align&&editor.formatter.apply("align"+data.align,{},cellElm),unApplyVAlign(cellElm),data.valign&&editor.formatter.apply("valign"+data.valign,{},cellElm)}),editor.focus()})}var cellElm,data,classListCtrl,dom=editor.dom,cells=[];if(cells=editor.dom.select("td[data-mce-selected],th[data-mce-selected]"),cellElm=editor.dom.getParent(editor.selection.getStart(),"td,th"),!cells.length&&cellElm&&cells.push(cellElm),cellElm=cellElm||cells[0]){data={width:removePxSuffix(dom.getStyle(cellElm,"width")||dom.getAttrib(cellElm,"width")),height:removePxSuffix(dom.getStyle(cellElm,"height")||dom.getAttrib(cellElm,"height")),scope:dom.getAttrib(cellElm,"scope"),"class":dom.getAttrib(cellElm,"class")},data.type=cellElm.nodeName.toLowerCase(),each("left center right".split(" "),function(name){editor.formatter.matchNode(cellElm,"align"+name)&&(data.align=name)}),each("top middle bottom".split(" "),function(name){editor.formatter.matchNode(cellElm,"valign"+name)&&(data.valign=name)}),editor.settings.table_cell_class_list&&(classListCtrl={name:"class",type:"listbox",label:"Class",values:buildListItems(editor.settings.table_cell_class_list,function(item){item.value&&(item.textStyle=function(){return editor.formatter.getCssText({block:"td",classes:[item.value]})})})});var generalCellForm={type:"form",layout:"flex",direction:"column",labelGapCalc:"children",padding:0,items:[{type:"form",layout:"grid",columns:2,labelGapCalc:!1,padding:0,defaults:{type:"textbox",maxWidth:50},items:[{label:"Width",name:"width"},{label:"Height",name:"height"},{label:"Cell type",name:"type",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{label:"Scope",name:"scope",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{label:"H Align",name:"align",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"V Align",name:"valign",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Top",value:"top"},{text:"Middle",value:"middle"},{text:"Bottom",value:"bottom"}]}]},classListCtrl]};editor.settings.table_cell_advtab!==!1?(appendStylesToData(dom,data,cellElm),editor.windowManager.open({title:"Cell properties",bodyType:"tabpanel",data:data,body:[{title:"General",type:"form",items:generalCellForm},createStyleForm(dom)],onsubmit:onSubmitCellForm})):editor.windowManager.open({title:"Cell properties",data:data,body:generalCellForm,onsubmit:onSubmitCellForm})}},self.row=function(){function onSubmitRowForm(){var tableElm,oldParentElm,parentElm;updateStyle(dom,this),data=Tools.extend(data,this.toJSON()),editor.undoManager.transact(function(){var toType=data.type;each(rows,function(rowElm){editor.dom.setAttribs(rowElm,{scope:data.scope,style:data.style,"class":data["class"]}),editor.dom.setStyles(rowElm,{height:addSizeSuffix(data.height)}),toType!=rowElm.parentNode.nodeName.toLowerCase()&&(tableElm=dom.getParent(rowElm,"table"),oldParentElm=rowElm.parentNode,parentElm=dom.select(toType,tableElm)[0],parentElm||(parentElm=dom.create(toType),tableElm.firstChild?tableElm.insertBefore(parentElm,tableElm.firstChild):tableElm.appendChild(parentElm)),parentElm.appendChild(rowElm),oldParentElm.hasChildNodes()||dom.remove(oldParentElm)),unApplyAlign(rowElm),data.align&&editor.formatter.apply("align"+data.align,{},rowElm)}),editor.focus()})}var tableElm,cellElm,rowElm,classListCtrl,data,generalRowForm,dom=editor.dom,rows=[];tableElm=editor.dom.getParent(editor.selection.getStart(),"table"),cellElm=editor.dom.getParent(editor.selection.getStart(),"td,th"),each(tableElm.rows,function(row){each(row.cells,function(cell){if(dom.getAttrib(cell,"data-mce-selected")||cell==cellElm)return rows.push(row),!1})}),rowElm=rows[0],rowElm&&(data={height:removePxSuffix(dom.getStyle(rowElm,"height")||dom.getAttrib(rowElm,"height")),scope:dom.getAttrib(rowElm,"scope"),"class":dom.getAttrib(rowElm,"class")},data.type=rowElm.parentNode.nodeName.toLowerCase(),each("left center right".split(" "),function(name){editor.formatter.matchNode(rowElm,"align"+name)&&(data.align=name)}),editor.settings.table_row_class_list&&(classListCtrl={name:"class",type:"listbox",label:"Class",values:buildListItems(editor.settings.table_row_class_list,function(item){item.value&&(item.textStyle=function(){return editor.formatter.getCssText({block:"tr",classes:[item.value]})})})}),generalRowForm={type:"form",columns:2,padding:0,defaults:{type:"textbox"},items:[{type:"listbox",name:"type",label:"Row type",text:"None",maxWidth:null,values:[{text:"Header",value:"thead"},{text:"Body",value:"tbody"},{text:"Footer",value:"tfoot"}]},{type:"listbox",name:"align",label:"Alignment",text:"None",maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height"},classListCtrl]},editor.settings.table_row_advtab!==!1?(appendStylesToData(dom,data,rowElm),editor.windowManager.open({title:"Row properties",data:data,bodyType:"tabpanel",body:[{title:"General",type:"form",items:generalRowForm},createStyleForm(dom)],onsubmit:onSubmitRowForm})):editor.windowManager.open({title:"Row properties",data:data,body:generalRowForm,onsubmit:onSubmitRowForm}))}}}),define("tinymce/tableplugin/ResizeBars",["tinymce/util/Tools","tinymce/util/VK"],function(Tools,VK){var hoverTable;return function(editor){function getTopEdge(index,row){return{index:index,y:editor.dom.getPos(row).y}}function getBottomEdge(index,row){return{index:index,y:editor.dom.getPos(row).y+row.offsetHeight}}function getLeftEdge(index,cell){return{index:index,x:editor.dom.getPos(cell).x}}function getRightEdge(index,cell){return{index:index,x:editor.dom.getPos(cell).x+cell.offsetWidth}}function isRtl(){var dir=editor.getBody().dir;return"rtl"===dir}function isInline(){return editor.inline}function getBody(){return isInline?editor.getBody().ownerDocument.body:editor.getBody()}function getInnerEdge(index,cell){return isRtl()?getRightEdge(index,cell):getLeftEdge(index,cell)}function getOuterEdge(index,cell){return isRtl()?getLeftEdge(index,cell):getRightEdge(index,cell)}function getPercentageWidthFallback(element,table){return getComputedStyleSize(element,"width")/getComputedStyleSize(table,"width")*100}function getComputedStyleSize(element,property){var widthString=editor.dom.getStyle(element,property,!0),width=parseInt(widthString,10);return width}function getCurrentTablePercentWidth(table){var tableWidth=getComputedStyleSize(table,"width"),tableParentWidth=getComputedStyleSize(table.parentElement,"width");return tableWidth/tableParentWidth*100}function getCellPercentDelta(table,delta){var tableWidth=getComputedStyleSize(table,"width");return delta/tableWidth*100}function getTablePercentDelta(table,delta){var tableParentWidth=getComputedStyleSize(table.parentElement,"width");return delta/tableParentWidth*100}function findPositions(getInner,getOuter,thingsToMeasure){for(var tablePositions=[],i=1;i<thingsToMeasure.length;i++){var item=thingsToMeasure[i].element;tablePositions.push(getInner(i-1,item))}var lastTableLineToMake=thingsToMeasure[thingsToMeasure.length-1];return tablePositions.push(getOuter(thingsToMeasure.length-1,lastTableLineToMake.element)),tablePositions}function clearBars(){var bars=editor.dom.select("."+RESIZE_BAR_CLASS,getBody());Tools.each(bars,function(bar){editor.dom.remove(bar)})}function refreshBars(tableElement){clearBars(),drawBars(tableElement)}function generateBar(classToAdd,cursor,left,top,height,width,indexAttr,index){var bar={"data-mce-bogus":"all","class":RESIZE_BAR_CLASS+" "+classToAdd,unselectable:"on","data-mce-resize":!1,style:"cursor: "+cursor+"; margin: 0; padding: 0; position: absolute; left: "+left+"px; top: "+top+"px; height: "+height+"px; width: "+width+"px; "};return bar[indexAttr]=index,bar}function drawRows(rowPositions,tableWidth,tablePosition){Tools.each(rowPositions,function(rowPosition){var left=tablePosition.x,top=rowPosition.y-RESIZE_BAR_THICKNESS/2,height=RESIZE_BAR_THICKNESS,width=tableWidth;editor.dom.add(getBody(),"div",generateBar(RESIZE_BAR_ROW_CLASS,RESIZE_BAR_ROW_CURSOR_STYLE,left,top,height,width,RESIZE_BAR_ROW_DATA_ATTRIBUTE,rowPosition.index))})}function drawCols(cellPositions,tableHeight,tablePosition){Tools.each(cellPositions,function(cellPosition){var left=cellPosition.x-RESIZE_BAR_THICKNESS/2,top=tablePosition.y,height=tableHeight,width=RESIZE_BAR_THICKNESS;editor.dom.add(getBody(),"div",generateBar(RESIZE_BAR_COL_CLASS,RESIZE_BAR_COL_CURSOR_STYLE,left,top,height,width,RESIZE_BAR_COL_DATA_ATTRIBUTE,cellPosition.index))})}function getTableDetails(table){return Tools.map(table.rows,function(row){var cells=Tools.map(row.cells,function(cell){var rowspan=cell.hasAttribute("rowspan")?parseInt(cell.getAttribute("rowspan"),10):1,colspan=cell.hasAttribute("colspan")?parseInt(cell.getAttribute("colspan"),10):1;return{element:cell,rowspan:rowspan,colspan:colspan}});return{element:row,cells:cells}})}function getTableGrid(tableDetails){function key(rowIndex,colIndex){return rowIndex+","+colIndex}function getAt(rowIndex,colIndex){return access[key(rowIndex,colIndex)]}function getAllCells(){var allCells=[];return Tools.each(rows,function(row){allCells=allCells.concat(row.cells)}),allCells}function getAllRows(){return rows}var access={},rows=[],maxRows=0,maxCols=0;return Tools.each(tableDetails,function(row,rowIndex){var currentRow=[];Tools.each(row.cells,function(cell){for(var start=0;access[key(rowIndex,start)]!==undefined;)start++;for(var current={element:cell.element,colspan:cell.colspan,rowspan:cell.rowspan,rowIndex:rowIndex,colIndex:start},i=0;i<cell.colspan;i++)for(var j=0;j<cell.rowspan;j++){var cr=rowIndex+j,cc=start+i;access[key(cr,cc)]=current,maxRows=Math.max(maxRows,cr+1),maxCols=Math.max(maxCols,cc+1)}currentRow.push(current)}),rows.push({element:row.element,cells:currentRow})}),{grid:{maxRows:maxRows,maxCols:maxCols},getAt:getAt,getAllCells:getAllCells,getAllRows:getAllRows}}function range(start,end){for(var r=[],i=start;i<end;i++)r.push(i);return r}function decide(getBlock,isSingle,getFallback){for(var singleInBlock,inBlock=getBlock(),i=0;i<inBlock.length;i++)isSingle(inBlock[i])&&(singleInBlock=inBlock[i]);return singleInBlock?singleInBlock:getFallback()}function getColumnBlocks(tableGrid){var cols=range(0,tableGrid.grid.maxCols),rows=range(0,tableGrid.grid.maxRows);return Tools.map(cols,function(col){function getBlock(){for(var details=[],i=0;i<rows.length;i++){var detail=tableGrid.getAt(i,col);detail&&detail.colIndex===col&&details.push(detail)}return details}function isSingle(detail){return 1===detail.colspan}function getFallback(){for(var item,i=0;i<rows.length;i++)if(item=tableGrid.getAt(i,col))return item;return null}return decide(getBlock,isSingle,getFallback)})}function getRowBlocks(tableGrid){var cols=range(0,tableGrid.grid.maxCols),rows=range(0,tableGrid.grid.maxRows);return Tools.map(rows,function(row){function getBlock(){for(var details=[],i=0;i<cols.length;i++){var detail=tableGrid.getAt(row,i);detail&&detail.rowIndex===row&&details.push(detail)}return details}function isSingle(detail){return 1===detail.rowspan}function getFallback(){return tableGrid.getAt(row,0)}return decide(getBlock,isSingle,getFallback)})}function drawBars(table){var tableDetails=getTableDetails(table),tableGrid=getTableGrid(tableDetails),rows=getRowBlocks(tableGrid),cols=getColumnBlocks(tableGrid),tablePosition=editor.dom.getPos(table),rowPositions=rows.length>0?findPositions(getTopEdge,getBottomEdge,rows):[],colPositions=cols.length>0?findPositions(getInnerEdge,getOuterEdge,cols):[];drawRows(rowPositions,table.offsetWidth,tablePosition),drawCols(colPositions,table.offsetHeight,tablePosition)}function deduceSize(deducables,index,isPercentageBased,table){if(index<0||index>=deducables.length-1)return"";var current=deducables[index];if(current)current={value:current,delta:0};else for(var reversedUpToIndex=deducables.slice(0,index).reverse(),i=0;i<reversedUpToIndex.length;i++)reversedUpToIndex[i]&&(current={value:reversedUpToIndex[i],delta:i+1});var next=deducables[index+1];if(next)next={value:next,delta:1};else for(var rest=deducables.slice(index+1),j=0;j<rest.length;j++)rest[j]&&(next={value:rest[j],delta:j+1});var extras=next.delta-current.delta,pixelWidth=Math.abs(next.value-current.value)/extras;return isPercentageBased?pixelWidth/getComputedStyleSize(table,"width")*100:pixelWidth}function getStyleOrAttrib(element,property){var sizeString=editor.dom.getStyle(element,property);return sizeString||(sizeString=editor.dom.getAttrib(element,property)),sizeString||(sizeString=editor.dom.getStyle(element,property,!0)),sizeString}function getWidth(element,isPercentageBased,table){var widthString=getStyleOrAttrib(element,"width"),widthNumber=parseInt(widthString,10),getWidthFallback=isPercentageBased?getPercentageWidthFallback(element,table):getComputedStyleSize(element,"width");return(isPercentageBased&&!isPercentageBasedSize(widthString)||!isPercentageBased&&!isPixelBasedSize(widthString))&&(widthNumber=0),!isNaN(widthNumber)&&widthNumber>0?widthNumber:getWidthFallback}function getWidths(tableGrid,isPercentageBased,table){for(var cols=getColumnBlocks(tableGrid),backups=Tools.map(cols,function(col){return getInnerEdge(col.colIndex,col.element).x}),widths=[],i=0;i<cols.length;i++){var span=cols[i].element.hasAttribute("colspan")?parseInt(cols[i].element.getAttribute("colspan"),10):1,width=span>1?deduceSize(backups,i):getWidth(cols[i].element,isPercentageBased,table);width=width?width:RESIZE_MINIMUM_WIDTH,widths.push(width)}return widths}function getPixelHeight(element){var heightString=getStyleOrAttrib(element,"height"),heightNumber=parseInt(heightString,10);return isPercentageBasedSize(heightString)&&(heightNumber=0),!isNaN(heightNumber)&&heightNumber>0?heightNumber:getComputedStyleSize(element,"height")}function getPixelHeights(tableGrid){for(var rows=getRowBlocks(tableGrid),backups=Tools.map(rows,function(row){return getTopEdge(row.rowIndex,row.element).y}),heights=[],i=0;i<rows.length;i++){var span=rows[i].element.hasAttribute("rowspan")?parseInt(rows[i].element.getAttribute("rowspan"),10):1,height=span>1?deduceSize(backups,i):getPixelHeight(rows[i].element);height=height?height:RESIZE_MINIMUM_HEIGHT,heights.push(height)}return heights}function determineDeltas(sizes,column,step,min,isPercentageBased){function generateZeros(array){return Tools.map(array,function(){return 0})}function onOneColumn(){var deltas;if(isPercentageBased)deltas=[100-result[0]];else{var newNext=Math.max(min,result[0]+step);deltas=[newNext-result[0]]}return deltas}function onLeftOrMiddle(index,next){var deltas,startZeros=generateZeros(result.slice(0,index)),endZeros=generateZeros(result.slice(next+1));if(step>=0){var newNext=Math.max(min,result[next]-step);deltas=startZeros.concat([step,newNext-result[next]]).concat(endZeros)}else{var newThis=Math.max(min,result[index]+step),diffx=result[index]-newThis;deltas=startZeros.concat([newThis-result[index],diffx]).concat(endZeros)}return deltas}function onRight(previous,index){var deltas,startZeros=generateZeros(result.slice(0,index));if(step>=0)deltas=startZeros.concat([step]);else{var size=Math.max(min,result[index]+step);deltas=startZeros.concat([size-result[index]])}return deltas}var deltas,result=sizes.slice(0);return deltas=0===sizes.length?[]:1===sizes.length?onOneColumn():0===column?onLeftOrMiddle(0,1):column>0&&column<sizes.length-1?onLeftOrMiddle(column,column+1):column===sizes.length-1?onRight(column-1,column):[]}function total(start,end,measures){for(var r=0,i=start;i<end;i++)r+=measures[i];return r}function recalculateWidths(tableGrid,widths){var allCells=tableGrid.getAllCells();return Tools.map(allCells,function(cell){var width=total(cell.colIndex,cell.colIndex+cell.colspan,widths);return{element:cell.element,width:width,colspan:cell.colspan}})}function recalculateCellHeights(tableGrid,heights){var allCells=tableGrid.getAllCells();return Tools.map(allCells,function(cell){var height=total(cell.rowIndex,cell.rowIndex+cell.rowspan,heights);return{element:cell.element,height:height,rowspan:cell.rowspan}})}function recalculateRowHeights(tableGrid,heights){var allRows=tableGrid.getAllRows();return Tools.map(allRows,function(row,i){return{element:row.element,height:heights[i]}})}function isPercentageBasedSize(size){return percentageBasedSizeRegex.test(size)}function isPixelBasedSize(size){return pixelBasedSizeRegex.test(size)}function adjustWidth(table,delta,index){function setSizes(newSizes,styleExtension){Tools.each(newSizes,function(cell){editor.dom.setStyle(cell.element,"width",cell.width+styleExtension),editor.dom.setAttrib(cell.element,"width",null)})}function getNewTablePercentWidth(){return index<tableGrid.grid.maxCols-1?getCurrentTablePercentWidth(table):getCurrentTablePercentWidth(table)+getTablePercentDelta(table,delta)}function getNewTablePixelWidth(){return index<tableGrid.grid.maxCols-1?getComputedStyleSize(table,"width"):getComputedStyleSize(table,"width")+delta}function setTableSize(newTableWidth,styleExtension,isPercentBased){index!=tableGrid.grid.maxCols-1&&isPercentBased||(editor.dom.setStyle(table,"width",newTableWidth+styleExtension),editor.dom.setAttrib(table,"width",null))}for(var tableDetails=getTableDetails(table),tableGrid=getTableGrid(tableDetails),percentageBased=isPercentageBasedSize(table.width)||isPercentageBasedSize(table.style.width),widths=getWidths(tableGrid,percentageBased,table),step=percentageBased?getCellPercentDelta(table,delta):delta,deltas=determineDeltas(widths,index,step,RESIZE_MINIMUM_WIDTH,percentageBased,table),newWidths=[],i=0;i<deltas.length;i++)newWidths.push(deltas[i]+widths[i]);var newSizes=recalculateWidths(tableGrid,newWidths),styleExtension=percentageBased?"%":"px",newTableWidth=percentageBased?getNewTablePercentWidth():getNewTablePixelWidth();editor.undoManager.transact(function(){setSizes(newSizes,styleExtension),setTableSize(newTableWidth,styleExtension,percentageBased)})}function adjustHeight(table,delta,index){for(var tableDetails=getTableDetails(table),tableGrid=getTableGrid(tableDetails),heights=getPixelHeights(tableGrid),newHeights=[],newTotalHeight=0,i=0;i<heights.length;i++)newHeights.push(i===index?delta+heights[i]:heights[i]),newTotalHeight+=newTotalHeight[i];var newCellSizes=recalculateCellHeights(tableGrid,newHeights),newRowSizes=recalculateRowHeights(tableGrid,newHeights);editor.undoManager.transact(function(){Tools.each(newRowSizes,function(row){editor.dom.setStyle(row.element,"height",row.height+"px"),editor.dom.setAttrib(row.element,"height",null)}),Tools.each(newCellSizes,function(cell){editor.dom.setStyle(cell.element,"height",cell.height+"px"),editor.dom.setAttrib(cell.element,"height",null)}),editor.dom.setStyle(table,"height",newTotalHeight+"px"),editor.dom.setAttrib(table,"height",null)})}function scheduleDelayedDropEvent(){delayDrop=setTimeout(function(){drop()},200)}function cancelDelayedDropEvent(){clearTimeout(delayDrop)}function getBlockerElement(){var blocker=document.createElement("div");return blocker.setAttribute("style","margin: 0; padding: 0; position: fixed; left: 0px; top: 0px; height: 100%; width: 100%;"),blocker.setAttribute("data-mce-bogus","all"),blocker}function bindBlockerEvents(blocker,dragHandler){editor.dom.bind(blocker,"mouseup",function(){drop()}),editor.dom.bind(blocker,"mousemove",function(e){cancelDelayedDropEvent(),dragging&&dragHandler(e)}),editor.dom.bind(blocker,"mouseout",function(){scheduleDelayedDropEvent()})}function drop(){if(editor.dom.remove(blockerElement),dragging){editor.dom.removeClass(dragBar,RESIZE_BAR_DRAGGING_CLASS),dragging=!1;var index,delta;if(isCol(dragBar)){var initialLeft=parseInt(editor.dom.getAttrib(dragBar,RESIZE_BAR_COL_DATA_INITIAL_LEFT_ATTRIBUTE),10),newLeft=editor.dom.getPos(dragBar).x;index=parseInt(editor.dom.getAttrib(dragBar,RESIZE_BAR_COL_DATA_ATTRIBUTE),10),delta=isRtl()?initialLeft-newLeft:newLeft-initialLeft,adjustWidth(hoverTable,delta,index)}else if(isRow(dragBar)){var initialTop=parseInt(editor.dom.getAttrib(dragBar,RESIZE_BAR_ROW_DATA_INITIAL_TOP_ATTRIBUTE),10),newTop=editor.dom.getPos(dragBar).y;index=parseInt(editor.dom.getAttrib(dragBar,RESIZE_BAR_ROW_DATA_ATTRIBUTE),10),delta=newTop-initialTop,adjustHeight(hoverTable,delta,index)}refreshBars(hoverTable),editor.nodeChanged()}}function setupBaseDrag(bar,dragHandler){blockerElement=blockerElement?blockerElement:getBlockerElement(),dragging=!0,editor.dom.addClass(bar,RESIZE_BAR_DRAGGING_CLASS),dragBar=bar,bindBlockerEvents(blockerElement,dragHandler),editor.dom.add(getBody(),blockerElement)}function isCol(target){return editor.dom.hasClass(target,RESIZE_BAR_COL_CLASS)}function isRow(target){return editor.dom.hasClass(target,RESIZE_BAR_ROW_CLASS)}function colDragHandler(event){lastX=lastX!==undefined?lastX:event.clientX;var deltaX=event.clientX-lastX;lastX=event.clientX;var oldLeft=editor.dom.getPos(dragBar).x;editor.dom.setStyle(dragBar,"left",oldLeft+deltaX+"px")}function rowDragHandler(event){lastY=lastY!==undefined?lastY:event.clientY;var deltaY=event.clientY-lastY;lastY=event.clientY;var oldTop=editor.dom.getPos(dragBar).y;editor.dom.setStyle(dragBar,"top",oldTop+deltaY+"px")}function setupColDrag(bar){lastX=undefined,setupBaseDrag(bar,colDragHandler)}function setupRowDrag(bar){lastY=undefined,setupBaseDrag(bar,rowDragHandler)}function mouseDownHandler(e){var target=e.target,body=editor.getBody();if(editor.$.contains(body,hoverTable)||hoverTable===body)if(isCol(target)){e.preventDefault();var initialLeft=editor.dom.getPos(target).x;editor.dom.setAttrib(target,RESIZE_BAR_COL_DATA_INITIAL_LEFT_ATTRIBUTE,initialLeft),setupColDrag(target)}else if(isRow(target)){e.preventDefault();var initialTop=editor.dom.getPos(target).y;editor.dom.setAttrib(target,RESIZE_BAR_ROW_DATA_INITIAL_TOP_ATTRIBUTE,initialTop),setupRowDrag(target)}}var delayDrop,dragging,blockerElement,dragBar,lastX,lastY,RESIZE_BAR_CLASS="mce-resize-bar",RESIZE_BAR_ROW_CLASS="mce-resize-bar-row",RESIZE_BAR_ROW_CURSOR_STYLE="row-resize",RESIZE_BAR_ROW_DATA_ATTRIBUTE="data-row",RESIZE_BAR_ROW_DATA_INITIAL_TOP_ATTRIBUTE="data-initial-top",RESIZE_BAR_COL_CLASS="mce-resize-bar-col",RESIZE_BAR_COL_CURSOR_STYLE="col-resize",RESIZE_BAR_COL_DATA_ATTRIBUTE="data-col",RESIZE_BAR_COL_DATA_INITIAL_LEFT_ATTRIBUTE="data-initial-left",RESIZE_BAR_THICKNESS=4,RESIZE_MINIMUM_WIDTH=10,RESIZE_MINIMUM_HEIGHT=10,RESIZE_BAR_DRAGGING_CLASS="mce-resize-bar-dragging",percentageBasedSizeRegex=new RegExp(/(\d+(\.\d+)?%)/),pixelBasedSizeRegex=new RegExp(/px|em/);return editor.on("init",function(){editor.dom.bind(getBody(),"mousedown",mouseDownHandler)}),editor.on("ObjectResized",function(e){var table=e.target;if("TABLE"===table.nodeName){var newCellSizes=[];Tools.each(table.rows,function(row){Tools.each(row.cells,function(cell){var width=editor.dom.getStyle(cell,"width",!0);newCellSizes.push({cell:cell,width:width})})}),Tools.each(newCellSizes,function(newCellSize){editor.dom.setStyle(newCellSize.cell,"width",newCellSize.width),editor.dom.setAttrib(newCellSize.cell,"width",null)})}}),editor.on("mouseover",function(e){if(!dragging){var tableElement=editor.dom.getParent(e.target,"table");("TABLE"===e.target.nodeName||tableElement)&&(hoverTable=tableElement,refreshBars(tableElement))}}),editor.on("keydown",function(e){switch(e.keyCode){case VK.LEFT:case VK.RIGHT:case VK.UP:case VK.DOWN:clearBars()}}),editor.on("remove",function(){clearBars(),editor.dom.unbind(getBody(),"mousedown",mouseDownHandler)}),{adjustWidth:adjustWidth,adjustHeight:adjustHeight,clearBars:clearBars,drawBars:drawBars,determineDeltas:determineDeltas,getTableGrid:getTableGrid,getTableDetails:getTableDetails,getWidths:getWidths,getPixelHeights:getPixelHeights,isPercentageBasedSize:isPercentageBasedSize,isPixelBasedSize:isPixelBasedSize,recalculateWidths:recalculateWidths,recalculateCellHeights:recalculateCellHeights,recalculateRowHeights:recalculateRowHeights}}}),define("tinymce/tableplugin/Plugin",["tinymce/tableplugin/TableGrid","tinymce/tableplugin/Quirks","tinymce/tableplugin/CellSelection","tinymce/tableplugin/Dialogs","tinymce/tableplugin/ResizeBars","tinymce/util/Tools","tinymce/dom/TreeWalker","tinymce/Env","tinymce/PluginManager"],function(TableGrid,Quirks,CellSelection,Dialogs,ResizeBars,Tools,TreeWalker,Env,PluginManager){function Plugin(editor){function cmd(command){return function(){editor.execCommand(command)}}function insertTable(cols,rows){var y,x,html,tableElm;for(html='<table id="__mce"><tbody>',y=0;y<rows;y++){for(html+="<tr>",x=0;x<cols;x++)html+="<td>"+(Env.ie&&Env.ie<10?"&nbsp;":"<br>")+"</td>";html+="</tr>"}return html+="</tbody></table>",editor.undoManager.transact(function(){editor.insertContent(html),tableElm=editor.dom.get("__mce"),editor.dom.setAttrib(tableElm,"id",null),editor.$("tr",tableElm).each(function(index,row){editor.fire("newrow",{node:row}),editor.$("th,td",row).each(function(index,cell){editor.fire("newcell",{node:cell})})}),editor.dom.setAttribs(tableElm,editor.settings.table_default_attributes||{}),editor.dom.setStyles(tableElm,editor.settings.table_default_styles||{})}),tableElm}function handleDisabledState(ctrl,selector,sameParts){function bindStateListener(){var selectedElm,selectedCells,state,parts={},sum=0;selectedCells=editor.dom.select("td[data-mce-selected],th[data-mce-selected]"),selectedElm=selectedCells[0],selectedElm||(selectedElm=editor.selection.getStart()),sameParts&&selectedCells.length>0?(each(selectedCells,function(cell){return parts[cell.parentNode.parentNode.nodeName]=1}),each(parts,function(value){sum+=value}),state=1!==sum):state=!editor.dom.getParent(selectedElm,selector),ctrl.disabled(state),editor.selection.selectorChanged(selector,function(state){ctrl.disabled(!state)})}editor.initialized?bindStateListener():editor.on("init",bindStateListener)}function postRender(){handleDisabledState(this,"table")}function postRenderCell(){handleDisabledState(this,"td,th")}function postRenderMergeCell(){handleDisabledState(this,"td,th",!0)}function generateTableGrid(){var html="";html='<table role="grid" class="mce-grid mce-grid-border" aria-readonly="true">';for(var y=0;y<10;y++){html+="<tr>";for(var x=0;x<10;x++)html+='<td role="gridcell" tabindex="-1"><a id="mcegrid'+(10*y+x)+'" href="#" data-mce-x="'+x+'" data-mce-y="'+y+'"></a></td>';html+="</tr>"}return html+="</table>",html+='<div class="mce-text-center" role="presentation">1 x 1</div>'}function selectGrid(tx,ty,control){var x,y,focusCell,cell,active,table=control.getEl().getElementsByTagName("table")[0],rtl=control.isRtl()||"tl-tr"==control.parent().rel;for(table.nextSibling.innerHTML=tx+1+" x "+(ty+1),rtl&&(tx=9-tx),y=0;y<10;y++)for(x=0;x<10;x++)cell=table.rows[y].childNodes[x].firstChild,active=(rtl?x>=tx:x<=tx)&&y<=ty,editor.dom.toggleClass(cell,"mce-active",active),active&&(focusCell=cell);return focusCell.parentNode}function addButtons(){editor.addButton("tableprops",{title:"Table properties",onclick:dialogs.tableProps,icon:"table"}),editor.addButton("tabledelete",{title:"Delete table",onclick:cmd("mceTableDelete")}),editor.addButton("tablecellprops",{title:"Cell properties",onclick:cmd("mceTableCellProps")}),editor.addButton("tablemergecells",{title:"Merge cells",onclick:cmd("mceTableMergeCells")}),editor.addButton("tablesplitcells",{title:"Split cell",onclick:cmd("mceTableSplitCells")}),editor.addButton("tableinsertrowbefore",{title:"Insert row before",onclick:cmd("mceTableInsertRowBefore")}),editor.addButton("tableinsertrowafter",{title:"Insert row after",onclick:cmd("mceTableInsertRowAfter")}),editor.addButton("tabledeleterow",{title:"Delete row",onclick:cmd("mceTableDeleteRow")}),editor.addButton("tablerowprops",{title:"Row properties",onclick:cmd("mceTableRowProps")}),editor.addButton("tablecutrow",{title:"Cut row",onclick:cmd("mceTableCutRow")}),editor.addButton("tablecopyrow",{title:"Copy row",onclick:cmd("mceTableCopyRow")}),editor.addButton("tablepasterowbefore",{title:"Paste row before",onclick:cmd("mceTablePasteRowBefore")}),editor.addButton("tablepasterowafter",{title:"Paste row after",onclick:cmd("mceTablePasteRowAfter")}),editor.addButton("tableinsertcolbefore",{title:"Insert column before",onclick:cmd("mceTableInsertColBefore")}),editor.addButton("tableinsertcolafter",{title:"Insert column after",onclick:cmd("mceTableInsertColAfter")}),editor.addButton("tabledeletecol",{title:"Delete column",onclick:cmd("mceTableDeleteCol")})}function isTable(table){var selectorMatched=editor.dom.is(table,"table")&&editor.getBody().contains(table);return selectorMatched}function addToolbars(){var toolbarItems=editor.settings.table_toolbar;""!==toolbarItems&&toolbarItems!==!1&&(toolbarItems||(toolbarItems="tableprops tabledelete | tableinsertrowbefore tableinsertrowafter tabledeleterow | tableinsertcolbefore tableinsertcolafter tabledeletecol"),editor.addContextToolbar(isTable,toolbarItems))}var clipboardRows,resizeBars,self=this,dialogs=new Dialogs(editor);!editor.settings.object_resizing||editor.settings.table_resize_bars===!1||editor.settings.object_resizing!==!0&&"table"!==editor.settings.object_resizing||(resizeBars=ResizeBars(editor)),editor.settings.table_grid===!1?editor.addMenuItem("inserttable",{text:"Insert table",icon:"table",context:"table",onclick:dialogs.table}):editor.addMenuItem("inserttable",{text:"Insert table",icon:"table",context:"table",ariaHideMenu:!0,onclick:function(e){e.aria&&(this.parent().hideAll(),e.stopImmediatePropagation(),dialogs.table())},onshow:function(){selectGrid(0,0,this.menu.items()[0])},onhide:function(){var elements=this.menu.items()[0].getEl().getElementsByTagName("a");editor.dom.removeClass(elements,"mce-active"),editor.dom.addClass(elements[0],"mce-active")},menu:[{type:"container",html:generateTableGrid(),onPostRender:function(){this.lastX=this.lastY=0},onmousemove:function(e){var x,y,target=e.target;"A"==target.tagName.toUpperCase()&&(x=parseInt(target.getAttribute("data-mce-x"),10),y=parseInt(target.getAttribute("data-mce-y"),10),(this.isRtl()||"tl-tr"==this.parent().rel)&&(x=9-x),x===this.lastX&&y===this.lastY||(selectGrid(x,y,e.control),this.lastX=x,this.lastY=y))},onclick:function(e){var self=this;"A"==e.target.tagName.toUpperCase()&&(e.preventDefault(),e.stopPropagation(),self.parent().cancel(),editor.undoManager.transact(function(){insertTable(self.lastX+1,self.lastY+1);
}),editor.addVisual())}}]}),editor.addMenuItem("tableprops",{text:"Table properties",context:"table",onPostRender:postRender,onclick:dialogs.tableProps}),editor.addMenuItem("deletetable",{text:"Delete table",context:"table",onPostRender:postRender,cmd:"mceTableDelete"}),editor.addMenuItem("cell",{separator:"before",text:"Cell",context:"table",menu:[{text:"Cell properties",onclick:cmd("mceTableCellProps"),onPostRender:postRenderCell},{text:"Merge cells",onclick:cmd("mceTableMergeCells"),onPostRender:postRenderMergeCell},{text:"Split cell",onclick:cmd("mceTableSplitCells"),onPostRender:postRenderCell}]}),editor.addMenuItem("row",{text:"Row",context:"table",menu:[{text:"Insert row before",onclick:cmd("mceTableInsertRowBefore"),onPostRender:postRenderCell},{text:"Insert row after",onclick:cmd("mceTableInsertRowAfter"),onPostRender:postRenderCell},{text:"Delete row",onclick:cmd("mceTableDeleteRow"),onPostRender:postRenderCell},{text:"Row properties",onclick:cmd("mceTableRowProps"),onPostRender:postRenderCell},{text:"-"},{text:"Cut row",onclick:cmd("mceTableCutRow"),onPostRender:postRenderCell},{text:"Copy row",onclick:cmd("mceTableCopyRow"),onPostRender:postRenderCell},{text:"Paste row before",onclick:cmd("mceTablePasteRowBefore"),onPostRender:postRenderCell},{text:"Paste row after",onclick:cmd("mceTablePasteRowAfter"),onPostRender:postRenderCell}]}),editor.addMenuItem("column",{text:"Column",context:"table",menu:[{text:"Insert column before",onclick:cmd("mceTableInsertColBefore"),onPostRender:postRenderCell},{text:"Insert column after",onclick:cmd("mceTableInsertColAfter"),onPostRender:postRenderCell},{text:"Delete column",onclick:cmd("mceTableDeleteCol"),onPostRender:postRenderCell}]});var menuItems=[];each("inserttable tableprops deletetable | cell row column".split(" "),function(name){"|"==name?menuItems.push({text:"-"}):menuItems.push(editor.menuItems[name])}),editor.addButton("table",{type:"menubutton",title:"Table",menu:menuItems}),Env.isIE||editor.on("click",function(e){e=e.target,"TABLE"===e.nodeName&&(editor.selection.select(e),editor.nodeChanged())}),self.quirks=new Quirks(editor),editor.on("Init",function(){self.cellSelection=new CellSelection(editor),self.resizeBars=resizeBars}),editor.on("PreInit",function(){editor.serializer.addAttributeFilter("data-mce-cell-padding,data-mce-border,data-mce-border-color",function(nodes,name){for(var i=nodes.length;i--;)nodes[i].attr(name,null)})}),each({mceTableSplitCells:function(grid){grid.split()},mceTableMergeCells:function(grid){var cell;cell=editor.dom.getParent(editor.selection.getStart(),"th,td"),editor.dom.select("td[data-mce-selected],th[data-mce-selected]").length?grid.merge():dialogs.merge(grid,cell)},mceTableInsertRowBefore:function(grid){grid.insertRow(!0)},mceTableInsertRowAfter:function(grid){grid.insertRow()},mceTableInsertColBefore:function(grid){grid.insertCol(!0)},mceTableInsertColAfter:function(grid){grid.insertCol()},mceTableDeleteCol:function(grid){grid.deleteCols()},mceTableDeleteRow:function(grid){grid.deleteRows()},mceTableCutRow:function(grid){clipboardRows=grid.cutRows()},mceTableCopyRow:function(grid){clipboardRows=grid.copyRows()},mceTablePasteRowBefore:function(grid){grid.pasteRows(clipboardRows,!0)},mceTablePasteRowAfter:function(grid){grid.pasteRows(clipboardRows)},mceTableDelete:function(grid){resizeBars&&resizeBars.clearBars(),grid.deleteTable()}},function(func,name){editor.addCommand(name,function(){var grid=new TableGrid(editor);grid&&(func(grid),editor.execCommand("mceRepaint"),self.cellSelection.clear())})}),each({mceInsertTable:dialogs.table,mceTableProps:function(){dialogs.table(!0)},mceTableRowProps:dialogs.row,mceTableCellProps:dialogs.cell},function(func,name){editor.addCommand(name,function(ui,val){func(val)})}),addButtons(),addToolbars(),editor.settings.table_tab_navigation!==!1&&editor.on("keydown",function(e){var cellElm,grid,delta;9==e.keyCode&&(cellElm=editor.dom.getParent(editor.selection.getStart(),"th,td"),cellElm&&(e.preventDefault(),grid=new TableGrid(editor),delta=e.shiftKey?-1:1,editor.undoManager.transact(function(){!grid.moveRelIdx(cellElm,delta)&&delta>0&&(grid.insertRow(),grid.refresh(),grid.moveRelIdx(cellElm,delta))})))}),self.insertTable=insertTable}var each=Tools.each;PluginManager.add("table",Plugin)})}(this)}.apply(root,arguments)})}(this),function(root){define("tinymce-template",["tinymce"],function(){return function(){tinymce.PluginManager.add("template",function(editor){function createTemplateList(callback){return function(){var templateList=editor.settings.templates;return"function"==typeof templateList?void templateList(callback):void("string"==typeof templateList?tinymce.util.XHR.send({url:templateList,success:function(text){callback(tinymce.util.JSON.parse(text))}}):callback(templateList))}}function showDialog(templateList){function onSelectTemplate(e){function insertIframeHtml(html){if(html.indexOf("<html>")==-1){var contentCssLinks="";tinymce.each(editor.contentCSS,function(url){contentCssLinks+='<link type="text/css" rel="stylesheet" href="'+editor.documentBaseURI.toAbsolute(url)+'">'});var bodyClass=editor.settings.body_class||"";bodyClass.indexOf("=")!=-1&&(bodyClass=editor.getParam("body_class","","hash"),bodyClass=bodyClass[editor.id]||""),html="<!DOCTYPE html><html><head>"+contentCssLinks+'</head><body class="'+bodyClass+'">'+html+"</body></html>"}html=replaceTemplateValues(html,"template_preview_replace_values");var doc=win.find("iframe")[0].getEl().contentWindow.document;doc.open(),doc.write(html),doc.close()}var value=e.control.value();value.url?tinymce.util.XHR.send({url:value.url,success:function(html){templateHtml=html,insertIframeHtml(templateHtml)}}):(templateHtml=value.content,insertIframeHtml(templateHtml)),win.find("#description")[0].text(e.control.value().description)}var win,templateHtml,values=[];if(!templateList||0===templateList.length){var message=editor.translate("No templates defined.");return void editor.notificationManager.open({text:message,type:"info"})}tinymce.each(templateList,function(template){values.push({selected:!values.length,text:template.title,value:{url:template.url,content:template.content,description:template.description}})}),win=editor.windowManager.open({title:"Insert template",layout:"flex",direction:"column",align:"stretch",padding:15,spacing:10,items:[{type:"form",flex:0,padding:0,items:[{type:"container",label:"Templates",items:{type:"listbox",label:"Templates",name:"template",values:values,onselect:onSelectTemplate}}]},{type:"label",name:"description",label:"Description",text:""},{type:"iframe",flex:1,border:1}],onsubmit:function(){insertTemplate(!1,templateHtml)},width:editor.getParam("template_popup_width",600),height:editor.getParam("template_popup_height",500)}),win.find("listbox")[0].fire("select")}function getDateTime(fmt,date){function addZeros(value,len){if(value=""+value,value.length<len)for(var i=0;i<len-value.length;i++)value="0"+value;return value}var daysShort="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),daysLong="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),monthsShort="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),monthsLong="January February March April May June July August September October November December".split(" ");return date=date||new Date,fmt=fmt.replace("%D","%m/%d/%Y"),fmt=fmt.replace("%r","%I:%M:%S %p"),fmt=fmt.replace("%Y",""+date.getFullYear()),fmt=fmt.replace("%y",""+date.getYear()),fmt=fmt.replace("%m",addZeros(date.getMonth()+1,2)),fmt=fmt.replace("%d",addZeros(date.getDate(),2)),fmt=fmt.replace("%H",""+addZeros(date.getHours(),2)),fmt=fmt.replace("%M",""+addZeros(date.getMinutes(),2)),fmt=fmt.replace("%S",""+addZeros(date.getSeconds(),2)),fmt=fmt.replace("%I",""+((date.getHours()+11)%12+1)),fmt=fmt.replace("%p",""+(date.getHours()<12?"AM":"PM")),fmt=fmt.replace("%B",""+editor.translate(monthsLong[date.getMonth()])),fmt=fmt.replace("%b",""+editor.translate(monthsShort[date.getMonth()])),fmt=fmt.replace("%A",""+editor.translate(daysLong[date.getDay()])),fmt=fmt.replace("%a",""+editor.translate(daysShort[date.getDay()])),fmt=fmt.replace("%%","%")}function replaceVals(e){var dom=editor.dom,vl=editor.getParam("template_replace_values");each(dom.select("*",e),function(e){each(vl,function(v,k){dom.hasClass(e,k)&&"function"==typeof vl[k]&&vl[k](e)})})}function replaceTemplateValues(html,templateValuesOptionName){return each(editor.getParam(templateValuesOptionName),function(v,k){"function"==typeof v&&(v=v(k)),html=html.replace(new RegExp("\\{\\$"+k+"\\}","g"),v)}),html}function insertTemplate(ui,html){function hasClass(n,c){return new RegExp("\\b"+c+"\\b","g").test(n.className)}var el,n,dom=editor.dom,sel=editor.selection.getContent();html=replaceTemplateValues(html,"template_replace_values"),el=dom.create("div",null,html),n=dom.select(".mceTmpl",el),n&&n.length>0&&(el=dom.create("div",null),el.appendChild(n[0].cloneNode(!0))),each(dom.select("*",el),function(n){hasClass(n,editor.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(n.innerHTML=getDateTime(editor.getParam("template_cdate_format",editor.getLang("template.cdate_format")))),hasClass(n,editor.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(n.innerHTML=getDateTime(editor.getParam("template_mdate_format",editor.getLang("template.mdate_format")))),hasClass(n,editor.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(n.innerHTML=sel)}),replaceVals(el),editor.execCommand("mceInsertContent",!1,el.innerHTML),editor.addVisual()}var each=tinymce.each;editor.addCommand("mceInsertTemplate",insertTemplate),editor.addButton("template",{title:"Insert template",onclick:createTemplateList(showDialog)}),editor.addMenuItem("template",{text:"Insert template",onclick:createTemplateList(showDialog),context:"insert"}),editor.on("PreProcess",function(o){var dom=editor.dom;each(dom.select("div",o.node),function(e){dom.hasClass(e,"mceTmpl")&&(each(dom.select("*",e),function(e){dom.hasClass(e,editor.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(e.innerHTML=getDateTime(editor.getParam("template_mdate_format",editor.getLang("template.mdate_format"))))}),replaceVals(e))})})})}.apply(root,arguments)})}(this),function(root){define("tinymce-textcolor",["tinymce"],function(){return function(){tinymce.PluginManager.add("textcolor",function(editor){function getCurrentColor(format){var color;return editor.dom.getParents(editor.selection.getStart(),function(elm){var value;(value=elm.style["forecolor"==format?"color":"background-color"])&&(color=value)}),color}function mapColors(type){var i,colorMap,colors=[];for(colorMap=["000000","Black","993300","Burnt orange","333300","Dark olive","003300","Dark green","003366","Dark azure","000080","Navy Blue","333399","Indigo","333333","Very dark gray","800000","Maroon","FF6600","Orange","808000","Olive","008000","Green","008080","Teal","0000FF","Blue","666699","Grayish blue","808080","Gray","FF0000","Red","FF9900","Amber","99CC00","Yellow green","339966","Sea green","33CCCC","Turquoise","3366FF","Royal blue","800080","Purple","999999","Medium gray","FF00FF","Magenta","FFCC00","Gold","FFFF00","Yellow","00FF00","Lime","00FFFF","Aqua","00CCFF","Sky blue","993366","Red violet","FFFFFF","White","FF99CC","Pink","FFCC99","Peach","FFFF99","Light yellow","CCFFCC","Pale green","CCFFFF","Pale cyan","99CCFF","Light sky blue","CC99FF","Plum"],colorMap=editor.settings.textcolor_map||colorMap,colorMap=editor.settings[type+"_map"]||colorMap,i=0;i<colorMap.length;i+=2)colors.push({text:colorMap[i+1],color:"#"+colorMap[i]});return colors}function renderColorPicker(){function getColorCellHtml(color,title){var isNoColor="transparent"==color;return'<td class="mce-grid-cell'+(isNoColor?" mce-colorbtn-trans":"")+'"><div id="'+id+"-"+count++ +'" data-mce-color="'+(color?color:"")+'" role="option" tabIndex="-1" style="'+(color?"background-color: "+color:"")+'" title="'+tinymce.translate(title)+'">'+(isNoColor?"&#215;":"")+"</div></td>"}var colors,color,html,last,x,y,i,type,ctrl=this,id=ctrl._id,count=0;for(type=ctrl.settings.origin,colors=mapColors(type),colors.push({text:tinymce.translate("No color"),color:"transparent"}),html='<table class="mce-grid mce-grid-border mce-colorbutton-grid" role="list" cellspacing="0"><tbody>',last=colors.length-1,y=0;y<rows[type];y++){for(html+="<tr>",x=0;x<cols[type];x++)i=y*cols[type]+x,i>last?html+="<td></td>":(color=colors[i],html+=getColorCellHtml(color.color,color.text));html+="</tr>"}if(editor.settings.color_picker_callback){for(html+='<tr><td colspan="'+cols[type]+'" class="mce-custom-color-btn"><div id="'+id+'-c" class="mce-widget mce-btn mce-btn-small mce-btn-flat" role="button" tabindex="-1" aria-labelledby="'+id+'-c" style="width: 100%"><button type="button" role="presentation" tabindex="-1">'+tinymce.translate("Custom...")+"</button></div></td></tr>",html+="<tr>",x=0;x<cols[type];x++)html+=getColorCellHtml("","Custom color");html+="</tr>"}return html+="</tbody></table>"}function applyFormat(format,value){editor.undoManager.transact(function(){editor.focus(),editor.formatter.apply(format,{value:value}),editor.nodeChanged()})}function removeFormat(format){editor.undoManager.transact(function(){editor.focus(),editor.formatter.remove(format,{value:null},null,!0),editor.nodeChanged()})}function onPanelClick(e){function selectColor(value){buttonCtrl.hidePanel(),buttonCtrl.color(value),applyFormat(buttonCtrl.settings.format,value)}function resetColor(){buttonCtrl.hidePanel(),buttonCtrl.resetColor(),removeFormat(buttonCtrl.settings.format)}function setDivColor(div,value){div.style.background=value,div.setAttribute("data-mce-color",value)}var value,type,buttonCtrl=this.parent();type=buttonCtrl.settings.origin,tinymce.DOM.getParent(e.target,".mce-custom-color-btn")&&(buttonCtrl.hidePanel(),editor.settings.color_picker_callback.call(editor,function(value){var customColorCells,div,i,tableElm=buttonCtrl.panel.getEl().getElementsByTagName("table")[0];for(customColorCells=tinymce.map(tableElm.rows[tableElm.rows.length-1].childNodes,function(elm){return elm.firstChild}),i=0;i<customColorCells.length&&(div=customColorCells[i],div.getAttribute("data-mce-color"));i++);if(i==cols[type])for(i=0;i<cols[type]-1;i++)setDivColor(customColorCells[i],customColorCells[i+1].getAttribute("data-mce-color"));setDivColor(div,value),selectColor(value)},getCurrentColor(buttonCtrl.settings.format))),value=e.target.getAttribute("data-mce-color"),value?(this.lastId&&document.getElementById(this.lastId).setAttribute("aria-selected",!1),e.target.setAttribute("aria-selected",!0),this.lastId=e.target.id,"transparent"==value?resetColor():selectColor(value)):null!==value&&buttonCtrl.hidePanel()}function onButtonClick(){var self=this;self._color?applyFormat(self.settings.format,self._color):removeFormat(self.settings.format)}var cols,rows;rows={forecolor:editor.settings.forecolor_rows||editor.settings.textcolor_rows||5,backcolor:editor.settings.backcolor_rows||editor.settings.textcolor_rows||5},cols={forecolor:editor.settings.forecolor_cols||editor.settings.textcolor_cols||8,backcolor:editor.settings.backcolor_cols||editor.settings.textcolor_cols||8},editor.addButton("forecolor",{type:"colorbutton",tooltip:"Text color",format:"forecolor",panel:{origin:"forecolor",role:"application",ariaRemember:!0,html:renderColorPicker,onclick:onPanelClick},onclick:onButtonClick}),editor.addButton("backcolor",{type:"colorbutton",tooltip:"Background color",format:"hilitecolor",panel:{origin:"backcolor",role:"application",ariaRemember:!0,html:renderColorPicker,onclick:onPanelClick},onclick:onButtonClick})})}.apply(root,arguments)})}(this),function(root){define("tinymce-textpattern",["tinymce"],function(){return function(){tinymce.PluginManager.add("textpattern",function(editor){function getPatterns(){return isPatternsDirty&&(patterns.sort(function(a,b){return a.start.length>b.start.length?-1:a.start.length<b.start.length?1:0}),isPatternsDirty=!1),patterns}function findPattern(text){for(var patterns=getPatterns(),i=0;i<patterns.length;i++)if(0===text.indexOf(patterns[i].start)&&(!patterns[i].end||text.lastIndexOf(patterns[i].end)==text.length-patterns[i].end.length))return patterns[i]}function findEndPattern(text,offset,delta){var patterns,pattern,i;for(patterns=getPatterns(),i=0;i<patterns.length;i++)if(pattern=patterns[i],pattern.end&&text.substr(offset-pattern.end.length-delta,pattern.end.length)==pattern.end)return pattern}function applyInlineFormat(space){function splitContainer(){container=container.splitText(startOffset),container.splitText(offset-startOffset-delta),container.deleteData(0,pattern.start.length),container.deleteData(container.data.length-pattern.end.length,pattern.end.length)}var selection,dom,rng,container,offset,startOffset,text,patternRng,pattern,delta,format;if(selection=editor.selection,dom=editor.dom,selection.isCollapsed()&&(rng=selection.getRng(!0),container=rng.startContainer,offset=rng.startOffset,text=container.data,delta=space?1:0,3==container.nodeType&&(pattern=findEndPattern(text,offset,delta),pattern&&(startOffset=Math.max(0,offset-delta),startOffset=text.lastIndexOf(pattern.start,startOffset-pattern.end.length-1),startOffset!==-1&&(patternRng=dom.createRng(),patternRng.setStart(container,startOffset),patternRng.setEnd(container,offset-delta),pattern=findPattern(patternRng.toString()),pattern&&pattern.end&&!(container.data.length<=pattern.start.length+pattern.end.length))))))return format=editor.formatter.get(pattern.format),format&&format[0].inline?(splitContainer(),editor.formatter.apply(pattern.format,{},container),container):void 0}function applyBlockFormat(){var selection,dom,container,firstTextNode,node,format,textBlockElm,pattern,walker,rng,offset;if(selection=editor.selection,dom=editor.dom,selection.isCollapsed()&&(textBlockElm=dom.getParent(selection.getStart(),"p"))){for(walker=new tinymce.dom.TreeWalker(textBlockElm,textBlockElm);node=walker.next();)if(3==node.nodeType){firstTextNode=node;break}if(firstTextNode){if(pattern=findPattern(firstTextNode.data),!pattern)return;if(rng=selection.getRng(!0),container=rng.startContainer,offset=rng.startOffset,firstTextNode==container&&(offset=Math.max(0,offset-pattern.start.length)),tinymce.trim(firstTextNode.data).length==pattern.start.length)return;pattern.format&&(format=editor.formatter.get(pattern.format),format&&format[0].block&&(firstTextNode.deleteData(0,pattern.start.length),editor.formatter.apply(pattern.format,{},firstTextNode),rng.setStart(container,offset),rng.collapse(!0),selection.setRng(rng))),pattern.cmd&&editor.undoManager.transact(function(){firstTextNode.deleteData(0,pattern.start.length),editor.execCommand(pattern.cmd)})}}}function handleEnter(){var rng,wrappedTextNode;wrappedTextNode=applyInlineFormat(),wrappedTextNode&&(rng=editor.dom.createRng(),rng.setStart(wrappedTextNode,wrappedTextNode.data.length),rng.setEnd(wrappedTextNode,wrappedTextNode.data.length),editor.selection.setRng(rng)),applyBlockFormat()}function handleSpace(){var wrappedTextNode,lastChar,lastCharNode,rng,dom;wrappedTextNode=applyInlineFormat(!0),wrappedTextNode&&(dom=editor.dom,lastChar=wrappedTextNode.data.slice(-1),/[\u00a0 ]/.test(lastChar)&&(wrappedTextNode.deleteData(wrappedTextNode.data.length-1,1),lastCharNode=dom.doc.createTextNode(lastChar),wrappedTextNode.nextSibling?dom.insertAfter(lastCharNode,wrappedTextNode.nextSibling):wrappedTextNode.parentNode.appendChild(lastCharNode),rng=dom.createRng(),rng.setStart(lastCharNode,1),rng.setEnd(lastCharNode,1),editor.selection.setRng(rng)))}var patterns,isPatternsDirty=!0;patterns=editor.settings.textpattern_patterns||[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],editor.on("keydown",function(e){13!=e.keyCode||tinymce.util.VK.modifierPressed(e)||handleEnter()},!0),editor.on("keyup",function(e){32!=e.keyCode||tinymce.util.VK.modifierPressed(e)||handleSpace()}),this.getPatterns=getPatterns,this.setPatterns=function(newPatterns){patterns=newPatterns,isPatternsDirty=!0}})}.apply(root,arguments)})}(this),function(root){define("tinymce-visualblocks",["tinymce"],function(){return function(){tinymce.PluginManager.add("visualblocks",function(editor,url){function toggleActiveState(){var self=this;self.active(enabled),editor.on("VisualBlocks",function(){self.active(editor.dom.hasClass(editor.getBody(),"mce-visualblocks"))})}var cssId,visualBlocksMenuItem,enabled;window.NodeList&&(editor.addCommand("mceVisualBlocks",function(){var linkElm,dom=editor.dom;cssId||(cssId=dom.uniqueId(),linkElm=dom.create("link",{id:cssId,rel:"stylesheet",href:url+"/css/visualblocks.css"}),editor.getDoc().getElementsByTagName("head")[0].appendChild(linkElm)),editor.on("PreviewFormats AfterPreviewFormats",function(e){enabled&&dom.toggleClass(editor.getBody(),"mce-visualblocks","afterpreviewformats"==e.type)}),dom.toggleClass(editor.getBody(),"mce-visualblocks"),enabled=editor.dom.hasClass(editor.getBody(),"mce-visualblocks"),visualBlocksMenuItem&&visualBlocksMenuItem.active(dom.hasClass(editor.getBody(),"mce-visualblocks")),editor.fire("VisualBlocks")}),editor.addButton("visualblocks",{title:"Show blocks",cmd:"mceVisualBlocks",onPostRender:toggleActiveState}),editor.addMenuItem("visualblocks",{text:"Show blocks",cmd:"mceVisualBlocks",onPostRender:toggleActiveState,selectable:!0,context:"view",prependToContext:!0}),editor.on("init",function(){editor.settings.visualblocks_default_state&&editor.execCommand("mceVisualBlocks",!1,null,{skip_focus:!0})}),editor.on("remove",function(){editor.dom.removeClass(editor.getBody(),"mce-visualblocks")}))})}.apply(root,arguments)})}(this),function(root){define("tinymce-visualchars",["tinymce"],function(){return function(){tinymce.PluginManager.add("visualchars",function(editor){function toggleVisualChars(addBookmark){function wrapCharWithSpan(value){return'<span data-mce-bogus="1" class="mce-'+charMap[value]+'">'+value+"</span>"}function compileCharMapToRegExp(){var key,regExp="";for(key in charMap)regExp+=key;return new RegExp("["+regExp+"]","g")}function compileCharMapToCssSelector(){var key,selector="";for(key in charMap)selector&&(selector+=","),selector+="span.mce-"+charMap[key];return selector}var node,nodeList,i,nodeValue,div,bookmark,charMap,visualCharsRegExp,body=editor.getBody(),selection=editor.selection;if(charMap={"":"nbsp","":"shy"},state=!state,self.state=state,editor.fire("VisualChars",{state:state}),visualCharsRegExp=compileCharMapToRegExp(),addBookmark&&(bookmark=selection.getBookmark()),state)for(nodeList=[],tinymce.walk(body,function(n){3==n.nodeType&&n.nodeValue&&visualCharsRegExp.test(n.nodeValue)&&nodeList.push(n)},"childNodes"),i=0;i<nodeList.length;i++){for(nodeValue=nodeList[i].nodeValue,nodeValue=nodeValue.replace(visualCharsRegExp,wrapCharWithSpan),div=editor.dom.create("div",null,nodeValue);node=div.lastChild;)editor.dom.insertAfter(node,nodeList[i]);editor.dom.remove(nodeList[i])}else for(nodeList=editor.dom.select(compileCharMapToCssSelector(),body),i=nodeList.length-1;i>=0;i--)editor.dom.remove(nodeList[i],1);selection.moveToBookmark(bookmark)}function toggleActiveState(){var self=this;editor.on("VisualChars",function(e){self.active(e.state)})}var state,self=this;editor.addCommand("mceVisualChars",toggleVisualChars),editor.addButton("visualchars",{title:"Show invisible characters",cmd:"mceVisualChars",onPostRender:toggleActiveState}),editor.addMenuItem("visualchars",{text:"Show invisible characters",cmd:"mceVisualChars",onPostRender:toggleActiveState,selectable:!0,context:"view",prependToContext:!0}),editor.on("beforegetcontent",function(e){state&&"raw"!=e.format&&!e.draft&&(state=!0,toggleVisualChars(!1))})})}.apply(root,arguments)})}(this),function(root){define("tinymce-wordcount",["tinymce"],function(){return function(){tinymce.PluginManager.add("wordcount",function(editor){function update(){editor.theme.panel.find("#wordcount").text(["Words: {0}",self.getCount()])}var countre,cleanre,self=this;countre=editor.getParam("wordcount_countregex",/[\w\u2019\x27\-\u00C0-\u1FFF]+/g),cleanre=editor.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\x27\x22_+=\\\/\-]*/g),editor.on("init",function(){var statusbar=editor.theme.panel&&editor.theme.panel.find("#statusbar")[0];statusbar&&tinymce.util.Delay.setEditorTimeout(editor,function(){statusbar.insert({type:"label",name:"wordcount",text:["Words: {0}",self.getCount()],classes:"wordcount",disabled:editor.settings.readonly},0),editor.on("setcontent beforeaddundo",update),editor.on("keyup",function(e){32==e.keyCode&&update()})},0)}),self.getCount=function(){var tx=editor.getContent({format:"raw"}),tc=0;if(tx){tx=tx.replace(/\.\.\./g," "),tx=tx.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," "),tx=tx.replace(/(\w+)(&#?[a-z0-9]+;)+(\w+)/i,"$1$3").replace(/&.+?;/g," "),tx=tx.replace(cleanre,"");var wordArray=tx.match(countre);wordArray&&(tc=wordArray.length)}return tc}})}.apply(root,arguments)})}(this),function(root){define("tinymce-compat3x",["tinymce"],function(){return function(){!function(tinymce){function noop(){}function log(apiCall){!reported&&window&&window.console&&(reported=!0,console.log("Deprecated TinyMCE API call: "+apiCall))}function Dispatcher(target,newEventName,argsMap,defaultScope){return target=target||this,newEventName?(this.add=function(callback,scope,prepend){function patchedEventCallback(e){var callbackArgs=[];if("string"==typeof argsMap&&(argsMap=argsMap.split(" ")),argsMap&&"function"!=typeof argsMap)for(var i=0;i<argsMap.length;i++)callbackArgs.push(e[argsMap[i]]);("function"!=typeof argsMap||(callbackArgs=argsMap(newEventName,e,target)))&&(argsMap||(callbackArgs=[e]),callbackArgs.unshift(defaultScope||target),callback.apply(scope||defaultScope||target,callbackArgs)===!1&&e.stopImmediatePropagation())}return log("<target>.on"+newEventName+".add(..)"),target.on(newEventName,patchedEventCallback,prepend),patchedEventCallback},this.addToTop=function(callback,scope){this.add(callback,scope,!0)},this.remove=function(callback){return target.off(newEventName,callback)},void(this.dispatch=function(){return target.fire(newEventName),!0})):void(this.add=this.addToTop=this.remove=this.dispatch=noop)}function patchEditor(editor){function patchEditorEvents(oldEventNames,argsMap){tinymce.each(oldEventNames.split(" "),function(oldName){editor["on"+oldName]=new Dispatcher(editor,oldName,argsMap)})}function convertUndoEventArgs(type,event,target){return[event.level,target]}function filterSelectionEvents(needsSelection){return function(type,e){if(!e.selection&&!needsSelection||e.selection==needsSelection)return[e]}}function cmNoop(){function _noop(){return cmNoop()}var obj={},methods="add addMenu addSeparator collapse createMenu destroy displayColor expand focus getLength hasMenus hideMenu isActive isCollapsed isDisabled isRendered isSelected mark postRender remove removeAll renderHTML renderMenu renderNode renderTo select selectByIndex setActive setAriaProperty setColor setDisabled setSelected setState showMenu update";return log("editor.controlManager.*"),tinymce.each(methods.split(" "),function(method){obj[method]=_noop}),obj}if(!editor.controlManager){editor.controlManager={buttons:{},setDisabled:function(name,state){log("controlManager.setDisabled(..)"),this.buttons[name]&&this.buttons[name].disabled(state)},setActive:function(name,state){log("controlManager.setActive(..)"),this.buttons[name]&&this.buttons[name].active(state)},onAdd:new Dispatcher,onPostRender:new Dispatcher,add:function(obj){return obj},createButton:cmNoop,createColorSplitButton:cmNoop,createControl:cmNoop,createDropMenu:cmNoop,createListBox:cmNoop,createMenuButton:cmNoop,createSeparator:cmNoop,createSplitButton:cmNoop,createToolbar:cmNoop,createToolbarGroup:cmNoop,destroy:noop,get:noop,setControlType:cmNoop},patchEditorEvents("PreInit BeforeRenderUI PostRender Load Init Remove Activate Deactivate","editor"),patchEditorEvents("Click MouseUp MouseDown DblClick KeyDown KeyUp KeyPress ContextMenu Paste Submit Reset"),patchEditorEvents("BeforeExecCommand ExecCommand","command ui value args"),patchEditorEvents("PreProcess PostProcess LoadContent SaveContent Change"),patchEditorEvents("BeforeSetContent BeforeGetContent SetContent GetContent",filterSelectionEvents(!1)),patchEditorEvents("SetProgressState","state time"),patchEditorEvents("VisualAid","element hasVisual"),patchEditorEvents("Undo Redo",convertUndoEventArgs),patchEditorEvents("NodeChange",function(type,e){return[editor.controlManager,e.element,editor.selection.isCollapsed(),e]});var originalAddButton=editor.addButton;editor.addButton=function(name,settings){function patchedPostRender(){if(editor.controlManager.buttons[name]=this,originalOnPostRender)return originalOnPostRender.call(this)}var originalOnPostRender;for(var key in settings)"onpostrender"===key.toLowerCase()&&(originalOnPostRender=settings[key],settings.onPostRender=patchedPostRender);return originalOnPostRender||(settings.onPostRender=patchedPostRender),settings.title&&(settings.title=tinymce.i18n.translate((editor.settings.language||"en")+"."+settings.title)),originalAddButton.call(this,name,settings)},editor.on("init",function(){var undoManager=editor.undoManager,selection=editor.selection;undoManager.onUndo=new Dispatcher(editor,"Undo",convertUndoEventArgs,null,undoManager),undoManager.onRedo=new Dispatcher(editor,"Redo",convertUndoEventArgs,null,undoManager),undoManager.onBeforeAdd=new Dispatcher(editor,"BeforeAddUndo",null,undoManager),undoManager.onAdd=new Dispatcher(editor,"AddUndo",null,undoManager),selection.onBeforeGetContent=new Dispatcher(editor,"BeforeGetContent",filterSelectionEvents(!0),selection),selection.onGetContent=new Dispatcher(editor,"GetContent",filterSelectionEvents(!0),selection),selection.onBeforeSetContent=new Dispatcher(editor,"BeforeSetContent",filterSelectionEvents(!0),selection),selection.onSetContent=new Dispatcher(editor,"SetContent",filterSelectionEvents(!0),selection)}),editor.on("BeforeRenderUI",function(){var windowManager=editor.windowManager;windowManager.onOpen=new Dispatcher,windowManager.onClose=new Dispatcher,windowManager.createInstance=function(className,a,b,c,d,e){log("windowManager.createInstance(..)");var constr=tinymce.resolve(className);return new constr(a,b,c,d,e)}})}}var reported;tinymce.util.Dispatcher=Dispatcher,tinymce.onBeforeUnload=new Dispatcher(tinymce,"BeforeUnload"),tinymce.onAddEditor=new Dispatcher(tinymce,"AddEditor","editor"),tinymce.onRemoveEditor=new Dispatcher(tinymce,"RemoveEditor","editor"),tinymce.util.Cookie={get:noop,getHash:noop,remove:noop,set:noop,setHash:noop},tinymce.on("SetupEditor",patchEditor),tinymce.PluginManager.add("compat3x",patchEditor),tinymce.addI18n=function(prefix,o){var I18n=tinymce.util.I18n,each=tinymce.each;return"string"==typeof prefix&&prefix.indexOf(".")===-1?void I18n.add(prefix,o):void(tinymce.is(prefix,"string")?each(o,function(o,k){I18n.data[prefix+"."+k]=o}):each(prefix,function(o,lc){each(o,function(o,g){each(o,function(o,k){"common"===g?I18n.data[lc+"."+k]=o:I18n.data[lc+"."+g+"."+k]=o})})}))}}(tinymce)}.apply(root,arguments)})}(this),define("mockup-patterns-tinymce",["jquery","underscore","pat-base","tinymce","text!mockup-patterns-tinymce-url/templates/result.xml","text!mockup-patterns-tinymce-url/templates/selection.xml","mockup-utils","mockup-patterns-tinymce-url/js/links","mockup-i18n","translate","tinymce-modern-theme","tinymce-advlist","tinymce-anchor","tinymce-autolink","tinymce-autoresize","tinymce-autosave","tinymce-bbcode","tinymce-charmap","tinymce-code","tinymce-colorpicker","tinymce-contextmenu","tinymce-directionality","tinymce-emoticons","tinymce-fullpage","tinymce-fullscreen","tinymce-hr","tinymce-image","tinymce-importcss","tinymce-insertdatetime","tinymce-layer","tinymce-legacyoutput","tinymce-link","tinymce-lists","tinymce-media","tinymce-nonbreaking","tinymce-noneditable","tinymce-pagebreak","tinymce-paste","tinymce-preview","tinymce-print","tinymce-save","tinymce-searchreplace","tinymce-spellchecker","tinymce-tabfocus","tinymce-table","tinymce-template","tinymce-textcolor","tinymce-textpattern","tinymce-visualblocks","tinymce-visualchars","tinymce-wordcount","tinymce-compat3x"],function($,_,Base,tinymce,ResultTemplate,SelectionTemplate,utils,LinkModal,I18n,_t){
"use strict";var TinyMCE=Base.extend({name:"tinymce",trigger:".pat-tinymce",parser:"mockup",defaults:{upload:{uploadMultiple:!1,maxFiles:1,showTitle:!1},relatedItems:{attributes:["UID","Title","portal_type","path","getURL","getIcon","is_folderish","review_state"],batchSize:20,basePath:"/",vocabularyUrl:null,width:500,maximumSelectionSize:1,placeholder:_t("Search for item on site...")},text:{insertBtn:_t("Insert"),cancelBtn:_t("Cancel"),insertHeading:_t("Insert link"),title:_t("Title"),internal:_t("Internal"),external:_t("External URL (can be relative within this site or absolute if it starts with http:// or https://)"),email:_t("Email Address"),anchor:_t("Anchor"),subject:_t("Email Subject (optional)"),image:_t("Image"),imageAlign:_t("Align"),scale:_t("Size"),alt:_t("Alternative Text"),externalImage:_t("External Image URL (can be relative within this site or absolute if it starts with http:// or https://)")},loadingBaseUrl:"../../../bower_components/tinymce-builded/js/tinymce/",prependToUrl:"",appendToUrl:"",linkAttribute:"path",prependToScalePart:"/imagescale/",appendToScalePart:"",appendToOriginalScalePart:"",defaultScale:"large",scales:_t("Listing (16x16):listing,Icon (32x32):icon,Tile (64x64):tile,Thumb (128x128):thumb,Mini (200x200):mini,Preview (400x400):preview,Large (768x768):large"),targetList:[{text:_t("Open in this window / frame"),value:""},{text:_t("Open in new window"),value:"_blank"},{text:_t("Open in parent window / frame"),value:"_parent"},{text:_t("Open in top frame (replaces all frames)"),value:"_top"}],imageTypes:["Image"],folderTypes:["Folder","Plone Site"],tiny:{content_css:"++resource++plone.app.widgets-tinymce-content.min.css",theme:"-modern",plugins:["advlist","autolink","lists","charmap","print","preview","anchor","searchreplace","visualblocks","code","fullscreen","insertdatetime","media","table","contextmenu","paste","plonelink","ploneimage"],menubar:"edit table format tools view insert",toolbar:"undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | unlink plonelink ploneimage",height:400},inline:!1},addLinkClicked:function(){var self=this;if(null===self.linkModal){var $el=$("<div/>").insertAfter(self.$el),linkTypes=["internal","upload","external","email","anchor"];self.options.upload||linkTypes.splice(1,1),self.linkModal=new LinkModal($el,$.extend(!0,{},self.options,{tinypattern:self,linkTypes:linkTypes})),self.linkModal.show()}else self.linkModal.reinitialize(),self.linkModal.show()},addImageClicked:function(){var self=this;if(null===self.imageModal){var linkTypes=["image","uploadImage","externalImage"];self.options.upload||linkTypes.splice(1,1);var options=$.extend(!0,{},self.options,{tinypattern:self,linkTypes:linkTypes,initialLinkType:"image",text:{insertHeading:_t("Insert Image")},relatedItems:{baseCriteria:[{i:"portal_type",o:"plone.app.querystring.operation.list.contains",v:self.options.imageTypes.concat(self.options.folderTypes)}],selectableTypes:self.options.imageTypes,resultTemplate:ResultTemplate,selectionTemplate:SelectionTemplate}}),$el=$("<div/>").insertAfter(self.$el);self.imageModal=new LinkModal($el,options),self.imageModal.show()}else self.imageModal.reinitialize(),self.imageModal.show()},generateUrl:function(data){var self=this,part=data[self.options.linkAttribute];return self.options.prependToUrl+part+self.options.appendToUrl},generateImageUrl:function(data,scale_name){var self=this,url=self.generateUrl(data);if(""!==scale_name){for(var part=scale_name,i=0;i<self.options.scales.length;i+=1)self.options.scales[i].name===scale_name&&(part=self.options.scales[i].part);url=url+self.options.prependToScalePart+part+self.options.appendToScalePart}else url+=self.options.appendToOriginalScalePart;return url},stripGeneratedUrl:function(url){var self=this;if(url=url.split(self.options.prependToScalePart,2)[0],self.options.prependToUrl){var parts=url.split(self.options.prependToUrl,2);2===parts.length&&(url=parts[1])}return self.options.appendToUrl&&(url=url.split(self.options.appendToUrl)[0]),url},getScaleFromUrl:function(url){var self=this,split=url.split(self.options.prependToScalePart);return 2!==split.length?null:(url=self.options.appendToScalePart?split[1].split(self.options.appendToScalePart)[0]:split[1],url.indexOf("/image_")!==-1&&(url=url.split("/image_")[1]),url)},initLanguage:function(call_back){var self=this,i18n=new I18n,lang=i18n.currentLanguage;"en-us"!==lang&&"en"!==self.options.tiny.language?(tinymce.baseURL=self.options.loadingBaseUrl,$.ajax({url:tinymce.baseURL+"/langs/"+lang+".js",method:"GET",cache:"true",success:function(){self.options.tiny.language=lang,call_back()},error:function(){lang=lang.split("_")>1?lang.split("_")[0]:lang.split("-")>1?lang.split("-")[0]:lang+"_"+lang.toUpperCase(),$.ajax({url:tinymce.baseURL+"/langs/"+lang+".js",method:"GET",cache:"true",success:function(){self.options.tiny.language=lang,call_back()},error:function(){call_back()}})}})):call_back()},init:function(){var self=this;self.linkModal=self.imageModal=self.uploadModal=self.pasteModal=null;var id=utils.setId(self.$el),tinyOptions=self.options.tiny;self.options.inline===!0&&(self.options.tiny.inline=!0),self.tinyId=self.options.inline?id+"-editable":id,tinyOptions.selector="#"+self.tinyId,tinyOptions.addLinkClicked=function(){self.addLinkClicked.apply(self,[])},tinyOptions.addImageClicked=function(file){self.addImageClicked.apply(self,[file])},tinyOptions.skin=!1,self.options.relatedItems.generateImageUrl=function(data,scale){return self.generateImageUrl.apply(self,[data,scale])},tinyOptions.init_instance_callback=function(editor){void 0!==self.tiny&&null!==self.tiny||(self.tiny=editor)},self.initLanguage(function(){if("string"==typeof self.options.scales&&(self.options.scales=_.map(self.options.scales.split(","),function(scale){return scale=scale.split(":"),{part:scale[1],name:scale[1],label:scale[0]}})),"string"==typeof self.options.folderTypes&&(self.options.folderTypes=self.options.folderTypes.split(",")),"string"==typeof self.options.imageTypes&&(self.options.imageTypes=self.options.imageTypes.split(",")),self.options.inline===!0&&(self.$el.after('<div id="'+self.tinyId+'">'+self.$el.val()+"</div>"),self.$el.hide()),tinyOptions.importcss_file_filter&&tinyOptions.importcss_file_filter.indexOf(",")!==-1){var files=tinyOptions.importcss_file_filter.split(",");tinyOptions.importcss_file_filter=function(value){for(var i=0;i<files.length;i++)if(value.indexOf(files[i])!==-1)return!0;return!1}}tinymce.init(tinyOptions),self.tiny=tinymce.get(self.tinyId);var $form=self.$el.parents("form");$form.on("submit",function(){self.options.inline===!0?self.$el.val(self.tiny.getContent()):self.tiny.save()})})},destroy:function(){this.tiny&&(this.options.inline===!0&&(this.$el.val(this.tiny.getContent()),$("#"+this.tinyId).remove(),this.$el.show()),this.tiny.destroy(),this.tiny=void 0)}});return TinyMCE}),define("mockup-patterns-textareamimetypeselector",["jquery","pat-base","pat-registry","mockup-patterns-tinymce"],function($,Base,registry){"use strict";var TextareaMimetypeSelector=Base.extend({name:"textareamimetypeselector",trigger:".pat-textareamimetypeselector",parser:"mockup",textarea:void 0,currentWidget:void 0,defaults:{textareaName:"",widgets:{"text/html":{pattern:"tinymce",patternOptions:{}}}},init:function(){var self=this,$el=self.$el;self.textarea=$('[name="'+self.options.textareaName+'"]'),$el.change(function(e){self.initTextarea(e.target.value)}),self.initTextarea($el.val())},initTextarea:function(mimetype){var pattern,self=this,patternConfig=self.options.widgets[mimetype];self.currentWidget&&self.currentWidget.destroy(),patternConfig&&(pattern=new registry.patterns[patternConfig.pattern](self.textarea,patternConfig.patternOptions||{}),self.currentWidget=pattern)}});return TextareaMimetypeSelector}),define("mockup-bundles-widgets",["jquery","pat-registry","pat-base","mockup-patterns-select2","mockup-patterns-passwordstrength","mockup-patterns-pickadate","mockup-patterns-recurrence","mockup-patterns-relateditems","mockup-patterns-querystring","mockup-patterns-textareamimetypeselector","mockup-patterns-tinymce"],function($,registry,Base){"use strict";var PloneWidgets=Base.extend({name:"plone-widgets",init:function(){}});return window.parent===window&&$(document).ready(function(){$("body").addClass("pat-plone-widgets"),registry.initialized||registry.init()}),PloneWidgets}),require(["mockup-bundles-widgets"]);
//# sourceMappingURL=++resource++plone.app.widgets.min.js.map